const MS=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}};MS();function NS(t,e){const n=Object.create(null),s=t.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const OS=()=>{},LS=Object.assign,PS=Object.prototype.hasOwnProperty,Zd=(t,e)=>PS.call(t,e),Cr=Array.isArray,Dh=t=>Y3(t)==="[object Map]",DS=t=>typeof t=="function",BS=t=>typeof t=="string",kp=t=>typeof t=="symbol",Jd=t=>t!==null&&typeof t=="object",FS=Object.prototype.toString,Y3=t=>FS.call(t),US=t=>Y3(t).slice(8,-1),Mp=t=>BS(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,X3=(t,e)=>!Object.is(t,e),jS=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})};let xi;class HS{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&xi&&(this.parent=xi,this.index=(xi.scopes||(xi.scopes=[])).push(this)-1)}run(e){if(this.active){const n=xi;try{return xi=this,e()}finally{xi=n}}}on(){xi=this}off(){xi=this.parent}stop(e){if(this.active){let n,s;for(n=0,s=this.effects.length;n<s;n++)this.effects[n].stop();for(n=0,s=this.cleanups.length;n<s;n++)this.cleanups[n]();if(this.scopes)for(n=0,s=this.scopes.length;n<s;n++)this.scopes[n].stop(!0);if(this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.active=!1}}}function VS(t,e=xi){e&&e.active&&e.effects.push(t)}const Np=t=>{const e=new Set(t);return e.w=0,e.n=0,e},Q3=t=>(t.w&Fr)>0,Z3=t=>(t.n&Fr)>0,qS=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=Fr},$S=t=>{const{deps:e}=t;if(e.length){let n=0;for(let s=0;s<e.length;s++){const i=e[s];Q3(i)&&!Z3(i)?i.delete(t):e[n++]=i,i.w&=~Fr,i.n&=~Fr}e.length=n}},Hm=new WeakMap;let Ql=0,Fr=1;const Vm=30;let li;const Oo=Symbol(""),qm=Symbol("");class Op{constructor(e,n=null,s){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,VS(this,s)}run(){if(!this.active)return this.fn();let e=li,n=Ir;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=li,li=this,Ir=!0,Fr=1<<++Ql,Ql<=Vm?qS(this):Xv(this),this.fn()}finally{Ql<=Vm&&$S(this),Fr=1<<--Ql,li=this.parent,Ir=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){li===this?this.deferStop=!0:this.active&&(Xv(this),this.onStop&&this.onStop(),this.active=!1)}}function Xv(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Ir=!0;const J3=[];function pl(){J3.push(Ir),Ir=!1}function gl(){const t=J3.pop();Ir=t===void 0?!0:t}function Fs(t,e,n){if(Ir&&li){let s=Hm.get(t);s||Hm.set(t,s=new Map);let i=s.get(n);i||s.set(n,i=Np()),ew(i)}}function ew(t,e){let n=!1;Ql<=Vm?Z3(t)||(t.n|=Fr,n=!Q3(t)):n=!t.has(li),n&&(t.add(li),li.deps.push(t))}function nr(t,e,n,s,i,r){const o=Hm.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(n==="length"&&Cr(t))o.forEach((l,c)=>{(c==="length"||c>=s)&&a.push(l)});else switch(n!==void 0&&a.push(o.get(n)),e){case"add":Cr(t)?Mp(n)&&a.push(o.get("length")):(a.push(o.get(Oo)),Dh(t)&&a.push(o.get(qm)));break;case"delete":Cr(t)||(a.push(o.get(Oo)),Dh(t)&&a.push(o.get(qm)));break;case"set":Dh(t)&&a.push(o.get(Oo));break}if(a.length===1)a[0]&&$m(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);$m(Np(l))}}function $m(t,e){const n=Cr(t)?t:[...t];for(const s of n)s.computed&&Qv(s);for(const s of n)s.computed||Qv(s)}function Qv(t,e){(t!==li||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const zS=NS("__proto__,__v_isRef,__isVue"),tw=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(kp)),KS=Lp(),GS=Lp(!1,!0),WS=Lp(!0),Zv=YS();function YS(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const s=Ht(this);for(let r=0,o=this.length;r<o;r++)Fs(s,"get",r+"");const i=s[e](...n);return i===-1||i===!1?s[e](...n.map(Ht)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){pl();const s=Ht(this)[e].apply(this,n);return gl(),s}}),t}function Lp(t=!1,e=!1){return function(s,i,r){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_isShallow")return e;if(i==="__v_raw"&&r===(t?e?h8:ow:e?rw:iw).get(s))return s;const o=Cr(s);if(!t&&o&&Zd(Zv,i))return Reflect.get(Zv,i,r);const a=Reflect.get(s,i,r);return(kp(i)?tw.has(i):zS(i))||(t||Fs(s,"get",i),e)?a:ss(a)?o&&Mp(i)?a:a.value:Jd(a)?t?aw(a):Bp(a):a}}const XS=nw(),QS=nw(!0);function nw(t=!1){return function(n,s,i,r){let o=n[s];if(Ac(o)&&ss(o)&&!ss(i))return!1;if(!t&&!Ac(i)&&(zm(i)||(i=Ht(i),o=Ht(o)),!Cr(n)&&ss(o)&&!ss(i)))return o.value=i,!0;const a=Cr(n)&&Mp(s)?Number(s)<n.length:Zd(n,s),l=Reflect.set(n,s,i,r);return n===Ht(r)&&(a?X3(i,o)&&nr(n,"set",s,i):nr(n,"add",s,i)),l}}function ZS(t,e){const n=Zd(t,e);t[e];const s=Reflect.deleteProperty(t,e);return s&&n&&nr(t,"delete",e,void 0),s}function JS(t,e){const n=Reflect.has(t,e);return(!kp(e)||!tw.has(e))&&Fs(t,"has",e),n}function e8(t){return Fs(t,"iterate",Cr(t)?"length":Oo),Reflect.ownKeys(t)}const sw={get:KS,set:XS,deleteProperty:ZS,has:JS,ownKeys:e8},t8={get:WS,set(t,e){return!0},deleteProperty(t,e){return!0}},n8=LS({},sw,{get:GS,set:QS}),Pp=t=>t,ef=t=>Reflect.getPrototypeOf(t);function nh(t,e,n=!1,s=!1){t=t.__v_raw;const i=Ht(t),r=Ht(e);n||(e!==r&&Fs(i,"get",e),Fs(i,"get",r));const{has:o}=ef(i),a=s?Pp:n?jp:Up;if(o.call(i,e))return a(t.get(e));if(o.call(i,r))return a(t.get(r));t!==i&&t.get(e)}function sh(t,e=!1){const n=this.__v_raw,s=Ht(n),i=Ht(t);return e||(t!==i&&Fs(s,"has",t),Fs(s,"has",i)),t===i?n.has(t):n.has(t)||n.has(i)}function ih(t,e=!1){return t=t.__v_raw,!e&&Fs(Ht(t),"iterate",Oo),Reflect.get(t,"size",t)}function Jv(t){t=Ht(t);const e=Ht(this);return ef(e).has.call(e,t)||(e.add(t),nr(e,"add",t,t)),this}function e2(t,e){e=Ht(e);const n=Ht(this),{has:s,get:i}=ef(n);let r=s.call(n,t);r||(t=Ht(t),r=s.call(n,t));const o=i.call(n,t);return n.set(t,e),r?X3(e,o)&&nr(n,"set",t,e):nr(n,"add",t,e),this}function t2(t){const e=Ht(this),{has:n,get:s}=ef(e);let i=n.call(e,t);i||(t=Ht(t),i=n.call(e,t)),s&&s.call(e,t);const r=e.delete(t);return i&&nr(e,"delete",t,void 0),r}function n2(){const t=Ht(this),e=t.size!==0,n=t.clear();return e&&nr(t,"clear",void 0,void 0),n}function rh(t,e){return function(s,i){const r=this,o=r.__v_raw,a=Ht(o),l=e?Pp:t?jp:Up;return!t&&Fs(a,"iterate",Oo),o.forEach((c,d)=>s.call(i,l(c),l(d),r))}}function oh(t,e,n){return function(...s){const i=this.__v_raw,r=Ht(i),o=Dh(r),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=i[t](...s),d=n?Pp:e?jp:Up;return!e&&Fs(r,"iterate",l?qm:Oo),{next(){const{value:u,done:f}=c.next();return f?{value:u,done:f}:{value:a?[d(u[0]),d(u[1])]:d(u),done:f}},[Symbol.iterator](){return this}}}}function fr(t){return function(...e){return t==="delete"?!1:this}}function s8(){const t={get(r){return nh(this,r)},get size(){return ih(this)},has:sh,add:Jv,set:e2,delete:t2,clear:n2,forEach:rh(!1,!1)},e={get(r){return nh(this,r,!1,!0)},get size(){return ih(this)},has:sh,add:Jv,set:e2,delete:t2,clear:n2,forEach:rh(!1,!0)},n={get(r){return nh(this,r,!0)},get size(){return ih(this,!0)},has(r){return sh.call(this,r,!0)},add:fr("add"),set:fr("set"),delete:fr("delete"),clear:fr("clear"),forEach:rh(!0,!1)},s={get(r){return nh(this,r,!0,!0)},get size(){return ih(this,!0)},has(r){return sh.call(this,r,!0)},add:fr("add"),set:fr("set"),delete:fr("delete"),clear:fr("clear"),forEach:rh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=oh(r,!1,!1),n[r]=oh(r,!0,!1),e[r]=oh(r,!1,!0),s[r]=oh(r,!0,!0)}),[t,n,e,s]}const[i8,r8,o8,a8]=s8();function Dp(t,e){const n=e?t?a8:o8:t?r8:i8;return(s,i,r)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?s:Reflect.get(Zd(n,i)&&i in s?n:s,i,r)}const l8={get:Dp(!1,!1)},c8={get:Dp(!1,!0)},u8={get:Dp(!0,!1)},iw=new WeakMap,rw=new WeakMap,ow=new WeakMap,h8=new WeakMap;function d8(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function f8(t){return t.__v_skip||!Object.isExtensible(t)?0:d8(US(t))}function Bp(t){return Ac(t)?t:Fp(t,!1,sw,l8,iw)}function m8(t){return Fp(t,!1,n8,c8,rw)}function aw(t){return Fp(t,!0,t8,u8,ow)}function Fp(t,e,n,s,i){if(!Jd(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const r=i.get(t);if(r)return r;const o=f8(t);if(o===0)return t;const a=new Proxy(t,o===2?s:n);return i.set(t,a),a}function La(t){return Ac(t)?La(t.__v_raw):!!(t&&t.__v_isReactive)}function Ac(t){return!!(t&&t.__v_isReadonly)}function zm(t){return!!(t&&t.__v_isShallow)}function lw(t){return La(t)||Ac(t)}function Ht(t){const e=t&&t.__v_raw;return e?Ht(e):t}function cw(t){return jS(t,"__v_skip",!0),t}const Up=t=>Jd(t)?Bp(t):t,jp=t=>Jd(t)?aw(t):t;function p8(t){Ir&&li&&(t=Ht(t),ew(t.dep||(t.dep=Np())))}function g8(t,e){t=Ht(t),t.dep&&$m(t.dep)}function ss(t){return!!(t&&t.__v_isRef===!0)}function _8(t){return ss(t)?t.value:t}const v8={get:(t,e,n)=>_8(Reflect.get(t,e,n)),set:(t,e,n,s)=>{const i=t[e];return ss(i)&&!ss(n)?(i.value=n,!0):Reflect.set(t,e,n,s)}};function uw(t){return La(t)?t:new Proxy(t,v8)}class y8{constructor(e,n,s,i){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new Op(e,()=>{this._dirty||(this._dirty=!0,g8(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=s}get value(){const e=Ht(this);return p8(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function b8(t,e,n=!1){let s,i;const r=DS(t);return r?(s=t,i=OS):(s=t.get,i=t.set),new y8(s,i,r||!i,n)}function w8(t,e){const n=Object.create(null),s=t.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}function Hp(t){if(It(t)){const e={};for(let n=0;n<t.length;n++){const s=t[n],i=js(s)?T8(s):Hp(s);if(i)for(const r in i)e[r]=i[r]}return e}else{if(js(t))return t;if(as(t))return t}}const E8=/;(?![^(]*\))/g,x8=/:(.+)/;function T8(t){const e={};return t.split(E8).forEach(n=>{if(n){const s=n.split(x8);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Ka(t){let e="";if(js(t))e=t;else if(It(t))for(let n=0;n<t.length;n++){const s=Ka(t[n]);s&&(e+=s+" ")}else if(as(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const hw=t=>js(t)?t:t==null?"":It(t)||as(t)&&(t.toString===_w||!xt(t.toString))?JSON.stringify(t,dw,2):String(t),dw=(t,e)=>e&&e.__v_isRef?dw(t,e.value):mw(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[s,i])=>(n[`${s} =>`]=i,n),{})}:pw(e)?{[`Set(${e.size})`]:[...e.values()]}:as(e)&&!It(e)&&!vw(e)?String(e):e,Wt={},Pa=[],Oi=()=>{},S8=()=>!1,A8=/^on[^a-z]/,Vp=t=>A8.test(t),fw=t=>t.startsWith("onUpdate:"),Us=Object.assign,qp=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},R8=Object.prototype.hasOwnProperty,Pt=(t,e)=>R8.call(t,e),It=Array.isArray,mw=t=>$p(t)==="[object Map]",pw=t=>$p(t)==="[object Set]",xt=t=>typeof t=="function",js=t=>typeof t=="string",as=t=>t!==null&&typeof t=="object",gw=t=>as(t)&&xt(t.then)&&xt(t.catch),_w=Object.prototype.toString,$p=t=>_w.call(t),vw=t=>$p(t)==="[object Object]",Bh=w8(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),tf=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},C8=/-(\w)/g,Di=tf(t=>t.replace(C8,(e,n)=>n?n.toUpperCase():"")),I8=/\B([A-Z])/g,nf=tf(t=>t.replace(I8,"-$1").toLowerCase()),zp=tf(t=>t.charAt(0).toUpperCase()+t.slice(1)),U0=tf(t=>t?`on${zp(t)}`:""),s2=(t,e)=>!Object.is(t,e),j0=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},Km=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},k8=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let i2;const M8=()=>i2||(i2=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});function kr(t,e,n,s){let i;try{i=s?t(...s):t()}catch(r){sf(r,e,n)}return i}function ei(t,e,n,s){if(xt(t)){const r=kr(t,e,n,s);return r&&gw(r)&&r.catch(o=>{sf(o,e,n)}),r}const i=[];for(let r=0;r<t.length;r++)i.push(ei(t[r],e,n,s));return i}function sf(t,e,n,s=!0){const i=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=n;for(;r;){const c=r.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](t,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){kr(l,null,10,[t,o,a]);return}}N8(t,n,i,s)}function N8(t,e,n,s=!0){console.error(t)}let Jh=!1,Gm=!1;const ks=[];let qi=0;const cc=[];let Zl=null,Sa=0;const uc=[];let wr=null,Aa=0;const yw=Promise.resolve();let Kp=null,Wm=null;function O8(t){const e=Kp||yw;return t?e.then(this?t.bind(this):t):e}function L8(t){let e=qi+1,n=ks.length;for(;e<n;){const s=e+n>>>1;Rc(ks[s])<t?e=s+1:n=s}return e}function bw(t){(!ks.length||!ks.includes(t,Jh&&t.allowRecurse?qi+1:qi))&&t!==Wm&&(t.id==null?ks.push(t):ks.splice(L8(t.id),0,t),ww())}function ww(){!Jh&&!Gm&&(Gm=!0,Kp=yw.then(Tw))}function P8(t){const e=ks.indexOf(t);e>qi&&ks.splice(e,1)}function Ew(t,e,n,s){It(t)?n.push(...t):(!e||!e.includes(t,t.allowRecurse?s+1:s))&&n.push(t),ww()}function D8(t){Ew(t,Zl,cc,Sa)}function B8(t){Ew(t,wr,uc,Aa)}function rf(t,e=null){if(cc.length){for(Wm=e,Zl=[...new Set(cc)],cc.length=0,Sa=0;Sa<Zl.length;Sa++)Zl[Sa]();Zl=null,Sa=0,Wm=null,rf(t,e)}}function xw(t){if(rf(),uc.length){const e=[...new Set(uc)];if(uc.length=0,wr){wr.push(...e);return}for(wr=e,wr.sort((n,s)=>Rc(n)-Rc(s)),Aa=0;Aa<wr.length;Aa++)wr[Aa]();wr=null,Aa=0}}const Rc=t=>t.id==null?1/0:t.id;function Tw(t){Gm=!1,Jh=!0,rf(t),ks.sort((n,s)=>Rc(n)-Rc(s));const e=Oi;try{for(qi=0;qi<ks.length;qi++){const n=ks[qi];n&&n.active!==!1&&kr(n,null,14)}}finally{qi=0,ks.length=0,xw(),Jh=!1,Kp=null,(ks.length||cc.length||uc.length)&&Tw(t)}}function F8(t,e,...n){if(t.isUnmounted)return;const s=t.vnode.props||Wt;let i=n;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in s){const d=`${o==="modelValue"?"model":o}Modifiers`,{number:u,trim:f}=s[d]||Wt;f&&(i=n.map(m=>m.trim())),u&&(i=n.map(k8))}let a,l=s[a=U0(e)]||s[a=U0(Di(e))];!l&&r&&(l=s[a=U0(nf(e))]),l&&ei(l,t,6,i);const c=s[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,ei(c,t,6,i)}}function Sw(t,e,n=!1){const s=e.emitsCache,i=s.get(t);if(i!==void 0)return i;const r=t.emits;let o={},a=!1;if(!xt(t)){const l=c=>{const d=Sw(c,e,!0);d&&(a=!0,Us(o,d))};!n&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!r&&!a?(s.set(t,null),null):(It(r)?r.forEach(l=>o[l]=null):Us(o,r),s.set(t,o),o)}function of(t,e){return!t||!Vp(e)?!1:(e=e.slice(2).replace(/Once$/,""),Pt(t,e[0].toLowerCase()+e.slice(1))||Pt(t,nf(e))||Pt(t,e))}let Zs=null,af=null;function ed(t){const e=Zs;return Zs=t,af=t&&t.type.__scopeId||null,e}function U8(t){af=t}function j8(){af=null}function H8(t,e=Zs,n){if(!e||t._n)return t;const s=(...i)=>{s._d&&p2(-1);const r=ed(e),o=t(...i);return ed(r),s._d&&p2(1),o};return s._n=!0,s._c=!0,s._d=!0,s}function H0(t){const{type:e,vnode:n,proxy:s,withProxy:i,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:d,renderCache:u,data:f,setupState:m,ctx:h,inheritAttrs:k}=t;let I,L;const p=ed(t);try{if(n.shapeFlag&4){const P=i||s;I=Ai(d.call(P,P,u,r,m,f,h)),L=l}else{const P=e;I=Ai(P.length>1?P(r,{attrs:l,slots:a,emit:c}):P(r,null)),L=e.props?l:V8(l)}}catch(P){hc.length=0,sf(P,t,1),I=Os(mi)}let C=I;if(L&&k!==!1){const P=Object.keys(L),{shapeFlag:M}=C;P.length&&M&7&&(o&&P.some(fw)&&(L=q8(L,o)),C=Ur(C,L))}return n.dirs&&(C=Ur(C),C.dirs=C.dirs?C.dirs.concat(n.dirs):n.dirs),n.transition&&(C.transition=n.transition),I=C,ed(p),I}const V8=t=>{let e;for(const n in t)(n==="class"||n==="style"||Vp(n))&&((e||(e={}))[n]=t[n]);return e},q8=(t,e)=>{const n={};for(const s in t)(!fw(s)||!(s.slice(9)in e))&&(n[s]=t[s]);return n};function $8(t,e,n){const{props:s,children:i,component:r}=t,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return s?r2(s,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let u=0;u<d.length;u++){const f=d[u];if(o[f]!==s[f]&&!of(c,f))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?r2(s,o,c):!0:!!o;return!1}function r2(t,e,n){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let i=0;i<s.length;i++){const r=s[i];if(e[r]!==t[r]&&!of(n,r))return!0}return!1}function z8({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const K8=t=>t.__isSuspense;function G8(t,e){e&&e.pendingBranch?It(t)?e.effects.push(...t):e.effects.push(t):B8(t)}function W8(t,e){if(In){let n=In.provides;const s=In.parent&&In.parent.provides;s===n&&(n=In.provides=Object.create(s)),n[t]=e}}function V0(t,e,n=!1){const s=In||Zs;if(s){const i=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(i&&t in i)return i[t];if(arguments.length>1)return n&&xt(e)?e.call(s.proxy):e}}const o2={};function q0(t,e,n){return Aw(t,e,n)}function Aw(t,e,{immediate:n,deep:s,flush:i,onTrack:r,onTrigger:o}=Wt){const a=In;let l,c=!1,d=!1;if(ss(t)?(l=()=>t.value,c=zm(t)):La(t)?(l=()=>t,s=!0):It(t)?(d=!0,c=t.some(L=>La(L)||zm(L)),l=()=>t.map(L=>{if(ss(L))return L.value;if(La(L))return To(L);if(xt(L))return kr(L,a,2)})):xt(t)?e?l=()=>kr(t,a,2):l=()=>{if(!(a&&a.isUnmounted))return u&&u(),ei(t,a,3,[f])}:l=Oi,e&&s){const L=l;l=()=>To(L())}let u,f=L=>{u=I.onStop=()=>{kr(L,a,4)}};if(Ic)return f=Oi,e?n&&ei(e,a,3,[l(),d?[]:void 0,f]):l(),Oi;let m=d?[]:o2;const h=()=>{if(!!I.active)if(e){const L=I.run();(s||c||(d?L.some((p,C)=>s2(p,m[C])):s2(L,m)))&&(u&&u(),ei(e,a,3,[L,m===o2?void 0:m,f]),m=L)}else I.run()};h.allowRecurse=!!e;let k;i==="sync"?k=h:i==="post"?k=()=>ps(h,a&&a.suspense):k=()=>D8(h);const I=new Op(l,k);return e?n?h():m=I.run():i==="post"?ps(I.run.bind(I),a&&a.suspense):I.run(),()=>{I.stop(),a&&a.scope&&qp(a.scope.effects,I)}}function Y8(t,e,n){const s=this.proxy,i=js(t)?t.includes(".")?Rw(s,t):()=>s[t]:t.bind(s,s);let r;xt(e)?r=e:(r=e.handler,n=e);const o=In;Ga(this);const a=Aw(i,r.bind(s),n);return o?Ga(o):Lo(),a}function Rw(t,e){const n=e.split(".");return()=>{let s=t;for(let i=0;i<n.length&&s;i++)s=s[n[i]];return s}}function To(t,e){if(!as(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),ss(t))To(t.value,e);else if(It(t))for(let n=0;n<t.length;n++)To(t[n],e);else if(pw(t)||mw(t))t.forEach(n=>{To(n,e)});else if(vw(t))for(const n in t)To(t[n],e);return t}function X8(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Mw(()=>{t.isMounted=!0}),Nw(()=>{t.isUnmounting=!0}),t}const zs=[Function,Array],Q8={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:zs,onEnter:zs,onAfterEnter:zs,onEnterCancelled:zs,onBeforeLeave:zs,onLeave:zs,onAfterLeave:zs,onLeaveCancelled:zs,onBeforeAppear:zs,onAppear:zs,onAfterAppear:zs,onAppearCancelled:zs},setup(t,{slots:e}){const n=BA(),s=X8();let i;return()=>{const r=e.default&&Iw(e.default(),!0);if(!r||!r.length)return;let o=r[0];if(r.length>1){for(const k of r)if(k.type!==mi){o=k;break}}const a=Ht(t),{mode:l}=a;if(s.isLeaving)return $0(o);const c=a2(o);if(!c)return $0(o);const d=Ym(c,a,s,n);Xm(c,d);const u=n.subTree,f=u&&a2(u);let m=!1;const{getTransitionKey:h}=c.type;if(h){const k=h();i===void 0?i=k:k!==i&&(i=k,m=!0)}if(f&&f.type!==mi&&(!_o(c,f)||m)){const k=Ym(f,a,s,n);if(Xm(f,k),l==="out-in")return s.isLeaving=!0,k.afterLeave=()=>{s.isLeaving=!1,n.update()},$0(o);l==="in-out"&&c.type!==mi&&(k.delayLeave=(I,L,p)=>{const C=Cw(s,f);C[String(f.key)]=f,I._leaveCb=()=>{L(),I._leaveCb=void 0,delete d.delayedLeave},d.delayedLeave=p})}return o}}},Z8=Q8;function Cw(t,e){const{leavingVNodes:n}=t;let s=n.get(e.type);return s||(s=Object.create(null),n.set(e.type,s)),s}function Ym(t,e,n,s){const{appear:i,mode:r,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:d,onBeforeLeave:u,onLeave:f,onAfterLeave:m,onLeaveCancelled:h,onBeforeAppear:k,onAppear:I,onAfterAppear:L,onAppearCancelled:p}=e,C=String(t.key),P=Cw(n,t),M=(S,x)=>{S&&ei(S,s,9,x)},F=(S,x)=>{const v=x[1];M(S,x),It(S)?S.every(w=>w.length<=1)&&v():S.length<=1&&v()},_={mode:r,persisted:o,beforeEnter(S){let x=a;if(!n.isMounted)if(i)x=k||a;else return;S._leaveCb&&S._leaveCb(!0);const v=P[C];v&&_o(t,v)&&v.el._leaveCb&&v.el._leaveCb(),M(x,[S])},enter(S){let x=l,v=c,w=d;if(!n.isMounted)if(i)x=I||l,v=L||c,w=p||d;else return;let b=!1;const y=S._enterCb=A=>{b||(b=!0,A?M(w,[S]):M(v,[S]),_.delayedLeave&&_.delayedLeave(),S._enterCb=void 0)};x?F(x,[S,y]):y()},leave(S,x){const v=String(t.key);if(S._enterCb&&S._enterCb(!0),n.isUnmounting)return x();M(u,[S]);let w=!1;const b=S._leaveCb=y=>{w||(w=!0,x(),y?M(h,[S]):M(m,[S]),S._leaveCb=void 0,P[v]===t&&delete P[v])};P[v]=t,f?F(f,[S,b]):b()},clone(S){return Ym(S,e,n,s)}};return _}function $0(t){if(lf(t))return t=Ur(t),t.children=null,t}function a2(t){return lf(t)?t.children?t.children[0]:void 0:t}function Xm(t,e){t.shapeFlag&6&&t.component?Xm(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function Iw(t,e=!1,n){let s=[],i=0;for(let r=0;r<t.length;r++){let o=t[r];const a=n==null?o.key:String(n)+String(o.key!=null?o.key:r);o.type===Xs?(o.patchFlag&128&&i++,s=s.concat(Iw(o.children,e,a))):(e||o.type!==mi)&&s.push(a!=null?Ur(o,{key:a}):o)}if(i>1)for(let r=0;r<s.length;r++)s[r].patchFlag=-2;return s}const Fh=t=>!!t.type.__asyncLoader,lf=t=>t.type.__isKeepAlive;function J8(t,e){kw(t,"a",e)}function eA(t,e){kw(t,"da",e)}function kw(t,e,n=In){const s=t.__wdc||(t.__wdc=()=>{let i=n;for(;i;){if(i.isDeactivated)return;i=i.parent}return t()});if(cf(e,s,n),n){let i=n.parent;for(;i&&i.parent;)lf(i.parent.vnode)&&tA(s,e,n,i),i=i.parent}}function tA(t,e,n,s){const i=cf(e,t,s,!0);Ow(()=>{qp(s[e],i)},n)}function cf(t,e,n=In,s=!1){if(n){const i=n[t]||(n[t]=[]),r=e.__weh||(e.__weh=(...o)=>{if(n.isUnmounted)return;pl(),Ga(n);const a=ei(e,n,t,o);return Lo(),gl(),a});return s?i.unshift(r):i.push(r),r}}const cr=t=>(e,n=In)=>(!Ic||t==="sp")&&cf(t,e,n),nA=cr("bm"),Mw=cr("m"),sA=cr("bu"),iA=cr("u"),Nw=cr("bum"),Ow=cr("um"),rA=cr("sp"),oA=cr("rtg"),aA=cr("rtc");function lA(t,e=In){cf("ec",t,e)}function Uh(t,e){const n=Zs;if(n===null)return t;const s=hf(n)||n.proxy,i=t.dirs||(t.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=Wt]=e[r];xt(o)&&(o={mounted:o,updated:o}),o.deep&&To(a),i.push({dir:o,instance:s,value:a,oldValue:void 0,arg:l,modifiers:c})}return t}function eo(t,e,n,s){const i=t.dirs,r=e&&e.dirs;for(let o=0;o<i.length;o++){const a=i[o];r&&(a.oldValue=r[o].value);let l=a.dir[s];l&&(pl(),ei(l,n,8,[t.el,a,t,e]),gl())}}const Lw="components";function cA(t,e){return hA(Lw,t,!0,e)||t}const uA=Symbol();function hA(t,e,n=!0,s=!1){const i=Zs||In;if(i){const r=i.type;if(t===Lw){const a=VA(r,!1);if(a&&(a===e||a===Di(e)||a===zp(Di(e))))return r}const o=l2(i[t]||r[t],e)||l2(i.appContext[t],e);return!o&&s?r:o}}function l2(t,e){return t&&(t[e]||t[Di(e)]||t[zp(Di(e))])}function Pw(t,e,n,s){let i;const r=n&&n[s];if(It(t)||js(t)){i=new Array(t.length);for(let o=0,a=t.length;o<a;o++)i[o]=e(t[o],o,void 0,r&&r[o])}else if(typeof t=="number"){i=new Array(t);for(let o=0;o<t;o++)i[o]=e(o+1,o,void 0,r&&r[o])}else if(as(t))if(t[Symbol.iterator])i=Array.from(t,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(t);i=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];i[a]=e(t[c],c,a,r&&r[a])}}else i=[];return n&&(n[s]=i),i}const Qm=t=>t?Ww(t)?hf(t)||t.proxy:Qm(t.parent):null,td=Us(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Qm(t.parent),$root:t=>Qm(t.root),$emit:t=>t.emit,$options:t=>Bw(t),$forceUpdate:t=>t.f||(t.f=()=>bw(t.update)),$nextTick:t=>t.n||(t.n=O8.bind(t.proxy)),$watch:t=>Y8.bind(t)}),dA={get({_:t},e){const{ctx:n,setupState:s,data:i,props:r,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const m=o[e];if(m!==void 0)switch(m){case 1:return s[e];case 2:return i[e];case 4:return n[e];case 3:return r[e]}else{if(s!==Wt&&Pt(s,e))return o[e]=1,s[e];if(i!==Wt&&Pt(i,e))return o[e]=2,i[e];if((c=t.propsOptions[0])&&Pt(c,e))return o[e]=3,r[e];if(n!==Wt&&Pt(n,e))return o[e]=4,n[e];Zm&&(o[e]=0)}}const d=td[e];let u,f;if(d)return e==="$attrs"&&Fs(t,"get",e),d(t);if((u=a.__cssModules)&&(u=u[e]))return u;if(n!==Wt&&Pt(n,e))return o[e]=4,n[e];if(f=l.config.globalProperties,Pt(f,e))return f[e]},set({_:t},e,n){const{data:s,setupState:i,ctx:r}=t;return i!==Wt&&Pt(i,e)?(i[e]=n,!0):s!==Wt&&Pt(s,e)?(s[e]=n,!0):Pt(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(r[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:s,appContext:i,propsOptions:r}},o){let a;return!!n[o]||t!==Wt&&Pt(t,o)||e!==Wt&&Pt(e,o)||(a=r[0])&&Pt(a,o)||Pt(s,o)||Pt(td,o)||Pt(i.config.globalProperties,o)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Pt(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let Zm=!0;function fA(t){const e=Bw(t),n=t.proxy,s=t.ctx;Zm=!1,e.beforeCreate&&c2(e.beforeCreate,t,"bc");const{data:i,computed:r,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:u,mounted:f,beforeUpdate:m,updated:h,activated:k,deactivated:I,beforeDestroy:L,beforeUnmount:p,destroyed:C,unmounted:P,render:M,renderTracked:F,renderTriggered:_,errorCaptured:S,serverPrefetch:x,expose:v,inheritAttrs:w,components:b,directives:y,filters:A}=e;if(c&&mA(c,s,null,t.appContext.config.unwrapInjectedRef),o)for(const W in o){const j=o[W];xt(j)&&(s[W]=j.bind(n))}if(i){const W=i.call(n,n);as(W)&&(t.data=Bp(W))}if(Zm=!0,r)for(const W in r){const j=r[W],K=xt(j)?j.bind(n,n):xt(j.get)?j.get.bind(n,n):Oi,g=!xt(j)&&xt(j.set)?j.set.bind(n):Oi,R=$A({get:K,set:g});Object.defineProperty(s,W,{enumerable:!0,configurable:!0,get:()=>R.value,set:ee=>R.value=ee})}if(a)for(const W in a)Dw(a[W],s,n,W);if(l){const W=xt(l)?l.call(n):l;Reflect.ownKeys(W).forEach(j=>{W8(j,W[j])})}d&&c2(d,t,"c");function U(W,j){It(j)?j.forEach(K=>W(K.bind(n))):j&&W(j.bind(n))}if(U(nA,u),U(Mw,f),U(sA,m),U(iA,h),U(J8,k),U(eA,I),U(lA,S),U(aA,F),U(oA,_),U(Nw,p),U(Ow,P),U(rA,x),It(v))if(v.length){const W=t.exposed||(t.exposed={});v.forEach(j=>{Object.defineProperty(W,j,{get:()=>n[j],set:K=>n[j]=K})})}else t.exposed||(t.exposed={});M&&t.render===Oi&&(t.render=M),w!=null&&(t.inheritAttrs=w),b&&(t.components=b),y&&(t.directives=y)}function mA(t,e,n=Oi,s=!1){It(t)&&(t=Jm(t));for(const i in t){const r=t[i];let o;as(r)?"default"in r?o=V0(r.from||i,r.default,!0):o=V0(r.from||i):o=V0(r),ss(o)&&s?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[i]=o}}function c2(t,e,n){ei(It(t)?t.map(s=>s.bind(e.proxy)):t.bind(e.proxy),e,n)}function Dw(t,e,n,s){const i=s.includes(".")?Rw(n,s):()=>n[s];if(js(t)){const r=e[t];xt(r)&&q0(i,r)}else if(xt(t))q0(i,t.bind(n));else if(as(t))if(It(t))t.forEach(r=>Dw(r,e,n,s));else{const r=xt(t.handler)?t.handler.bind(n):e[t.handler];xt(r)&&q0(i,r,t)}}function Bw(t){const e=t.type,{mixins:n,extends:s}=e,{mixins:i,optionsCache:r,config:{optionMergeStrategies:o}}=t.appContext,a=r.get(e);let l;return a?l=a:!i.length&&!n&&!s?l=e:(l={},i.length&&i.forEach(c=>nd(l,c,o,!0)),nd(l,e,o)),r.set(e,l),l}function nd(t,e,n,s=!1){const{mixins:i,extends:r}=e;r&&nd(t,r,n,!0),i&&i.forEach(o=>nd(t,o,n,!0));for(const o in e)if(!(s&&o==="expose")){const a=pA[o]||n&&n[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const pA={data:u2,props:fo,emits:fo,methods:fo,computed:fo,beforeCreate:Jn,created:Jn,beforeMount:Jn,mounted:Jn,beforeUpdate:Jn,updated:Jn,beforeDestroy:Jn,beforeUnmount:Jn,destroyed:Jn,unmounted:Jn,activated:Jn,deactivated:Jn,errorCaptured:Jn,serverPrefetch:Jn,components:fo,directives:fo,watch:_A,provide:u2,inject:gA};function u2(t,e){return e?t?function(){return Us(xt(t)?t.call(this,this):t,xt(e)?e.call(this,this):e)}:e:t}function gA(t,e){return fo(Jm(t),Jm(e))}function Jm(t){if(It(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function Jn(t,e){return t?[...new Set([].concat(t,e))]:e}function fo(t,e){return t?Us(Us(Object.create(null),t),e):e}function _A(t,e){if(!t)return e;if(!e)return t;const n=Us(Object.create(null),t);for(const s in e)n[s]=Jn(t[s],e[s]);return n}function vA(t,e,n,s=!1){const i={},r={};Km(r,uf,1),t.propsDefaults=Object.create(null),Fw(t,e,i,r);for(const o in t.propsOptions[0])o in i||(i[o]=void 0);n?t.props=s?i:m8(i):t.type.props?t.props=i:t.props=r,t.attrs=r}function yA(t,e,n,s){const{props:i,attrs:r,vnode:{patchFlag:o}}=t,a=Ht(i),[l]=t.propsOptions;let c=!1;if((s||o>0)&&!(o&16)){if(o&8){const d=t.vnode.dynamicProps;for(let u=0;u<d.length;u++){let f=d[u];if(of(t.emitsOptions,f))continue;const m=e[f];if(l)if(Pt(r,f))m!==r[f]&&(r[f]=m,c=!0);else{const h=Di(f);i[h]=e1(l,a,h,m,t,!1)}else m!==r[f]&&(r[f]=m,c=!0)}}}else{Fw(t,e,i,r)&&(c=!0);let d;for(const u in a)(!e||!Pt(e,u)&&((d=nf(u))===u||!Pt(e,d)))&&(l?n&&(n[u]!==void 0||n[d]!==void 0)&&(i[u]=e1(l,a,u,void 0,t,!0)):delete i[u]);if(r!==a)for(const u in r)(!e||!Pt(e,u)&&!0)&&(delete r[u],c=!0)}c&&nr(t,"set","$attrs")}function Fw(t,e,n,s){const[i,r]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if(Bh(l))continue;const c=e[l];let d;i&&Pt(i,d=Di(l))?!r||!r.includes(d)?n[d]=c:(a||(a={}))[d]=c:of(t.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,o=!0)}if(r){const l=Ht(n),c=a||Wt;for(let d=0;d<r.length;d++){const u=r[d];n[u]=e1(i,l,u,c[u],t,!Pt(c,u))}}return o}function e1(t,e,n,s,i,r){const o=t[n];if(o!=null){const a=Pt(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&xt(l)){const{propsDefaults:c}=i;n in c?s=c[n]:(Ga(i),s=c[n]=l.call(null,e),Lo())}else s=l}o[0]&&(r&&!a?s=!1:o[1]&&(s===""||s===nf(n))&&(s=!0))}return s}function Uw(t,e,n=!1){const s=e.propsCache,i=s.get(t);if(i)return i;const r=t.props,o={},a=[];let l=!1;if(!xt(t)){const d=u=>{l=!0;const[f,m]=Uw(u,e,!0);Us(o,f),m&&a.push(...m)};!n&&e.mixins.length&&e.mixins.forEach(d),t.extends&&d(t.extends),t.mixins&&t.mixins.forEach(d)}if(!r&&!l)return s.set(t,Pa),Pa;if(It(r))for(let d=0;d<r.length;d++){const u=Di(r[d]);h2(u)&&(o[u]=Wt)}else if(r)for(const d in r){const u=Di(d);if(h2(u)){const f=r[d],m=o[u]=It(f)||xt(f)?{type:f}:f;if(m){const h=m2(Boolean,m.type),k=m2(String,m.type);m[0]=h>-1,m[1]=k<0||h<k,(h>-1||Pt(m,"default"))&&a.push(u)}}}const c=[o,a];return s.set(t,c),c}function h2(t){return t[0]!=="$"}function d2(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function f2(t,e){return d2(t)===d2(e)}function m2(t,e){return It(e)?e.findIndex(n=>f2(n,t)):xt(e)&&f2(e,t)?0:-1}const jw=t=>t[0]==="_"||t==="$stable",Gp=t=>It(t)?t.map(Ai):[Ai(t)],bA=(t,e,n)=>{if(e._n)return e;const s=H8((...i)=>Gp(e(...i)),n);return s._c=!1,s},Hw=(t,e,n)=>{const s=t._ctx;for(const i in t){if(jw(i))continue;const r=t[i];if(xt(r))e[i]=bA(i,r,s);else if(r!=null){const o=Gp(r);e[i]=()=>o}}},Vw=(t,e)=>{const n=Gp(e);t.slots.default=()=>n},wA=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=Ht(e),Km(e,"_",n)):Hw(e,t.slots={})}else t.slots={},e&&Vw(t,e);Km(t.slots,uf,1)},EA=(t,e,n)=>{const{vnode:s,slots:i}=t;let r=!0,o=Wt;if(s.shapeFlag&32){const a=e._;a?n&&a===1?r=!1:(Us(i,e),!n&&a===1&&delete i._):(r=!e.$stable,Hw(e,i)),o=e}else e&&(Vw(t,e),o={default:1});if(r)for(const a in i)!jw(a)&&!(a in o)&&delete i[a]};function qw(){return{app:null,config:{isNativeTag:S8,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let xA=0;function TA(t,e){return function(s,i=null){xt(s)||(s=Object.assign({},s)),i!=null&&!as(i)&&(i=null);const r=qw(),o=new Set;let a=!1;const l=r.app={_uid:xA++,_component:s,_props:i,_container:null,_context:r,_instance:null,version:KA,get config(){return r.config},set config(c){},use(c,...d){return o.has(c)||(c&&xt(c.install)?(o.add(c),c.install(l,...d)):xt(c)&&(o.add(c),c(l,...d))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,d){return d?(r.components[c]=d,l):r.components[c]},directive(c,d){return d?(r.directives[c]=d,l):r.directives[c]},mount(c,d,u){if(!a){const f=Os(s,i);return f.appContext=r,d&&e?e(f,c):t(f,c,u),a=!0,l._container=c,c.__vue_app__=l,hf(f.component)||f.component.proxy}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,d){return r.provides[c]=d,l}};return l}}function t1(t,e,n,s,i=!1){if(It(t)){t.forEach((f,m)=>t1(f,e&&(It(e)?e[m]:e),n,s,i));return}if(Fh(s)&&!i)return;const r=s.shapeFlag&4?hf(s.component)||s.component.proxy:s.el,o=i?null:r,{i:a,r:l}=t,c=e&&e.r,d=a.refs===Wt?a.refs={}:a.refs,u=a.setupState;if(c!=null&&c!==l&&(js(c)?(d[c]=null,Pt(u,c)&&(u[c]=null)):ss(c)&&(c.value=null)),xt(l))kr(l,a,12,[o,d]);else{const f=js(l),m=ss(l);if(f||m){const h=()=>{if(t.f){const k=f?d[l]:l.value;i?It(k)&&qp(k,r):It(k)?k.includes(r)||k.push(r):f?(d[l]=[r],Pt(u,l)&&(u[l]=d[l])):(l.value=[r],t.k&&(d[t.k]=l.value))}else f?(d[l]=o,Pt(u,l)&&(u[l]=o)):m&&(l.value=o,t.k&&(d[t.k]=o))};o?(h.id=-1,ps(h,n)):h()}}}const ps=G8;function SA(t){return AA(t)}function AA(t,e){const n=M8();n.__VUE__=!0;const{insert:s,remove:i,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:u,nextSibling:f,setScopeId:m=Oi,cloneNode:h,insertStaticContent:k}=t,I=(E,N,V,$=null,G=null,te=null,le=!1,Q=null,se=!!N.dynamicChildren)=>{if(E===N)return;E&&!_o(E,N)&&($=ze(E),ne(E,G,te,!0),E=null),N.patchFlag===-2&&(se=!1,N.dynamicChildren=null);const{type:X,ref:ve,shapeFlag:de}=N;switch(X){case Wp:L(E,N,V,$);break;case mi:p(E,N,V,$);break;case z0:E==null&&C(N,V,$,le);break;case Xs:y(E,N,V,$,G,te,le,Q,se);break;default:de&1?F(E,N,V,$,G,te,le,Q,se):de&6?A(E,N,V,$,G,te,le,Q,se):(de&64||de&128)&&X.process(E,N,V,$,G,te,le,Q,se,we)}ve!=null&&G&&t1(ve,E&&E.ref,te,N||E,!N)},L=(E,N,V,$)=>{if(E==null)s(N.el=a(N.children),V,$);else{const G=N.el=E.el;N.children!==E.children&&c(G,N.children)}},p=(E,N,V,$)=>{E==null?s(N.el=l(N.children||""),V,$):N.el=E.el},C=(E,N,V,$)=>{[E.el,E.anchor]=k(E.children,N,V,$,E.el,E.anchor)},P=({el:E,anchor:N},V,$)=>{let G;for(;E&&E!==N;)G=f(E),s(E,V,$),E=G;s(N,V,$)},M=({el:E,anchor:N})=>{let V;for(;E&&E!==N;)V=f(E),i(E),E=V;i(N)},F=(E,N,V,$,G,te,le,Q,se)=>{le=le||N.type==="svg",E==null?_(N,V,$,G,te,le,Q,se):v(E,N,G,te,le,Q,se)},_=(E,N,V,$,G,te,le,Q)=>{let se,X;const{type:ve,props:de,shapeFlag:ye,transition:Re,patchFlag:Le,dirs:ce}=E;if(E.el&&h!==void 0&&Le===-1)se=E.el=h(E.el);else{if(se=E.el=o(E.type,te,de&&de.is,de),ye&8?d(se,E.children):ye&16&&x(E.children,se,null,$,G,te&&ve!=="foreignObject",le,Q),ce&&eo(E,null,$,"created"),de){for(const ie in de)ie!=="value"&&!Bh(ie)&&r(se,ie,null,de[ie],te,E.children,$,G,be);"value"in de&&r(se,"value",null,de.value),(X=de.onVnodeBeforeMount)&&yi(X,$,E)}S(se,E,E.scopeId,le,$)}ce&&eo(E,null,$,"beforeMount");const _e=(!G||G&&!G.pendingBranch)&&Re&&!Re.persisted;_e&&Re.beforeEnter(se),s(se,N,V),((X=de&&de.onVnodeMounted)||_e||ce)&&ps(()=>{X&&yi(X,$,E),_e&&Re.enter(se),ce&&eo(E,null,$,"mounted")},G)},S=(E,N,V,$,G)=>{if(V&&m(E,V),$)for(let te=0;te<$.length;te++)m(E,$[te]);if(G){let te=G.subTree;if(N===te){const le=G.vnode;S(E,le,le.scopeId,le.slotScopeIds,G.parent)}}},x=(E,N,V,$,G,te,le,Q,se=0)=>{for(let X=se;X<E.length;X++){const ve=E[X]=Q?Tr(E[X]):Ai(E[X]);I(null,ve,N,V,$,G,te,le,Q)}},v=(E,N,V,$,G,te,le)=>{const Q=N.el=E.el;let{patchFlag:se,dynamicChildren:X,dirs:ve}=N;se|=E.patchFlag&16;const de=E.props||Wt,ye=N.props||Wt;let Re;V&&to(V,!1),(Re=ye.onVnodeBeforeUpdate)&&yi(Re,V,N,E),ve&&eo(N,E,V,"beforeUpdate"),V&&to(V,!0);const Le=G&&N.type!=="foreignObject";if(X?w(E.dynamicChildren,X,Q,V,$,Le,te):le||K(E,N,Q,null,V,$,Le,te,!1),se>0){if(se&16)b(Q,N,de,ye,V,$,G);else if(se&2&&de.class!==ye.class&&r(Q,"class",null,ye.class,G),se&4&&r(Q,"style",de.style,ye.style,G),se&8){const ce=N.dynamicProps;for(let _e=0;_e<ce.length;_e++){const ie=ce[_e],Ne=de[ie],O=ye[ie];(O!==Ne||ie==="value")&&r(Q,ie,Ne,O,G,E.children,V,$,be)}}se&1&&E.children!==N.children&&d(Q,N.children)}else!le&&X==null&&b(Q,N,de,ye,V,$,G);((Re=ye.onVnodeUpdated)||ve)&&ps(()=>{Re&&yi(Re,V,N,E),ve&&eo(N,E,V,"updated")},$)},w=(E,N,V,$,G,te,le)=>{for(let Q=0;Q<N.length;Q++){const se=E[Q],X=N[Q],ve=se.el&&(se.type===Xs||!_o(se,X)||se.shapeFlag&70)?u(se.el):V;I(se,X,ve,null,$,G,te,le,!0)}},b=(E,N,V,$,G,te,le)=>{if(V!==$){for(const Q in $){if(Bh(Q))continue;const se=$[Q],X=V[Q];se!==X&&Q!=="value"&&r(E,Q,X,se,le,N.children,G,te,be)}if(V!==Wt)for(const Q in V)!Bh(Q)&&!(Q in $)&&r(E,Q,V[Q],null,le,N.children,G,te,be);"value"in $&&r(E,"value",V.value,$.value)}},y=(E,N,V,$,G,te,le,Q,se)=>{const X=N.el=E?E.el:a(""),ve=N.anchor=E?E.anchor:a("");let{patchFlag:de,dynamicChildren:ye,slotScopeIds:Re}=N;Re&&(Q=Q?Q.concat(Re):Re),E==null?(s(X,V,$),s(ve,V,$),x(N.children,V,ve,G,te,le,Q,se)):de>0&&de&64&&ye&&E.dynamicChildren?(w(E.dynamicChildren,ye,V,G,te,le,Q),(N.key!=null||G&&N===G.subTree)&&$w(E,N,!0)):K(E,N,V,ve,G,te,le,Q,se)},A=(E,N,V,$,G,te,le,Q,se)=>{N.slotScopeIds=Q,E==null?N.shapeFlag&512?G.ctx.activate(N,V,$,le,se):T(N,V,$,G,te,le,se):U(E,N,se)},T=(E,N,V,$,G,te,le)=>{const Q=E.component=DA(E,$,G);if(lf(E)&&(Q.ctx.renderer=we),FA(Q),Q.asyncDep){if(G&&G.registerDep(Q,W),!E.el){const se=Q.subTree=Os(mi);p(null,se,N,V)}return}W(Q,E,N,V,G,te,le)},U=(E,N,V)=>{const $=N.component=E.component;if($8(E,N,V))if($.asyncDep&&!$.asyncResolved){j($,N,V);return}else $.next=N,P8($.update),$.update();else N.el=E.el,$.vnode=N},W=(E,N,V,$,G,te,le)=>{const Q=()=>{if(E.isMounted){let{next:ve,bu:de,u:ye,parent:Re,vnode:Le}=E,ce=ve,_e;to(E,!1),ve?(ve.el=Le.el,j(E,ve,le)):ve=Le,de&&j0(de),(_e=ve.props&&ve.props.onVnodeBeforeUpdate)&&yi(_e,Re,ve,Le),to(E,!0);const ie=H0(E),Ne=E.subTree;E.subTree=ie,I(Ne,ie,u(Ne.el),ze(Ne),E,G,te),ve.el=ie.el,ce===null&&z8(E,ie.el),ye&&ps(ye,G),(_e=ve.props&&ve.props.onVnodeUpdated)&&ps(()=>yi(_e,Re,ve,Le),G)}else{let ve;const{el:de,props:ye}=N,{bm:Re,m:Le,parent:ce}=E,_e=Fh(N);if(to(E,!1),Re&&j0(Re),!_e&&(ve=ye&&ye.onVnodeBeforeMount)&&yi(ve,ce,N),to(E,!0),de&&mt){const ie=()=>{E.subTree=H0(E),mt(de,E.subTree,E,G,null)};_e?N.type.__asyncLoader().then(()=>!E.isUnmounted&&ie()):ie()}else{const ie=E.subTree=H0(E);I(null,ie,V,$,E,G,te),N.el=ie.el}if(Le&&ps(Le,G),!_e&&(ve=ye&&ye.onVnodeMounted)){const ie=N;ps(()=>yi(ve,ce,ie),G)}(N.shapeFlag&256||ce&&Fh(ce.vnode)&&ce.vnode.shapeFlag&256)&&E.a&&ps(E.a,G),E.isMounted=!0,N=V=$=null}},se=E.effect=new Op(Q,()=>bw(X),E.scope),X=E.update=()=>se.run();X.id=E.uid,to(E,!0),X()},j=(E,N,V)=>{N.component=E;const $=E.vnode.props;E.vnode=N,E.next=null,yA(E,N.props,$,V),EA(E,N.children,V),pl(),rf(void 0,E.update),gl()},K=(E,N,V,$,G,te,le,Q,se=!1)=>{const X=E&&E.children,ve=E?E.shapeFlag:0,de=N.children,{patchFlag:ye,shapeFlag:Re}=N;if(ye>0){if(ye&128){R(X,de,V,$,G,te,le,Q,se);return}else if(ye&256){g(X,de,V,$,G,te,le,Q,se);return}}Re&8?(ve&16&&be(X,G,te),de!==X&&d(V,de)):ve&16?Re&16?R(X,de,V,$,G,te,le,Q,se):be(X,G,te,!0):(ve&8&&d(V,""),Re&16&&x(de,V,$,G,te,le,Q,se))},g=(E,N,V,$,G,te,le,Q,se)=>{E=E||Pa,N=N||Pa;const X=E.length,ve=N.length,de=Math.min(X,ve);let ye;for(ye=0;ye<de;ye++){const Re=N[ye]=se?Tr(N[ye]):Ai(N[ye]);I(E[ye],Re,V,null,G,te,le,Q,se)}X>ve?be(E,G,te,!0,!1,de):x(N,V,$,G,te,le,Q,se,de)},R=(E,N,V,$,G,te,le,Q,se)=>{let X=0;const ve=N.length;let de=E.length-1,ye=ve-1;for(;X<=de&&X<=ye;){const Re=E[X],Le=N[X]=se?Tr(N[X]):Ai(N[X]);if(_o(Re,Le))I(Re,Le,V,null,G,te,le,Q,se);else break;X++}for(;X<=de&&X<=ye;){const Re=E[de],Le=N[ye]=se?Tr(N[ye]):Ai(N[ye]);if(_o(Re,Le))I(Re,Le,V,null,G,te,le,Q,se);else break;de--,ye--}if(X>de){if(X<=ye){const Re=ye+1,Le=Re<ve?N[Re].el:$;for(;X<=ye;)I(null,N[X]=se?Tr(N[X]):Ai(N[X]),V,Le,G,te,le,Q,se),X++}}else if(X>ye)for(;X<=de;)ne(E[X],G,te,!0),X++;else{const Re=X,Le=X,ce=new Map;for(X=Le;X<=ye;X++){const Y=N[X]=se?Tr(N[X]):Ai(N[X]);Y.key!=null&&ce.set(Y.key,X)}let _e,ie=0;const Ne=ye-Le+1;let O=!1,B=0;const q=new Array(Ne);for(X=0;X<Ne;X++)q[X]=0;for(X=Re;X<=de;X++){const Y=E[X];if(ie>=Ne){ne(Y,G,te,!0);continue}let H;if(Y.key!=null)H=ce.get(Y.key);else for(_e=Le;_e<=ye;_e++)if(q[_e-Le]===0&&_o(Y,N[_e])){H=_e;break}H===void 0?ne(Y,G,te,!0):(q[H-Le]=X+1,H>=B?B=H:O=!0,I(Y,N[H],V,null,G,te,le,Q,se),ie++)}const z=O?RA(q):Pa;for(_e=z.length-1,X=Ne-1;X>=0;X--){const Y=Le+X,H=N[Y],J=Y+1<ve?N[Y+1].el:$;q[X]===0?I(null,H,V,J,G,te,le,Q,se):O&&(_e<0||X!==z[_e]?ee(H,V,J,2):_e--)}}},ee=(E,N,V,$,G=null)=>{const{el:te,type:le,transition:Q,children:se,shapeFlag:X}=E;if(X&6){ee(E.component.subTree,N,V,$);return}if(X&128){E.suspense.move(N,V,$);return}if(X&64){le.move(E,N,V,we);return}if(le===Xs){s(te,N,V);for(let de=0;de<se.length;de++)ee(se[de],N,V,$);s(E.anchor,N,V);return}if(le===z0){P(E,N,V);return}if($!==2&&X&1&&Q)if($===0)Q.beforeEnter(te),s(te,N,V),ps(()=>Q.enter(te),G);else{const{leave:de,delayLeave:ye,afterLeave:Re}=Q,Le=()=>s(te,N,V),ce=()=>{de(te,()=>{Le(),Re&&Re()})};ye?ye(te,Le,ce):ce()}else s(te,N,V)},ne=(E,N,V,$=!1,G=!1)=>{const{type:te,props:le,ref:Q,children:se,dynamicChildren:X,shapeFlag:ve,patchFlag:de,dirs:ye}=E;if(Q!=null&&t1(Q,null,V,E,!0),ve&256){N.ctx.deactivate(E);return}const Re=ve&1&&ye,Le=!Fh(E);let ce;if(Le&&(ce=le&&le.onVnodeBeforeUnmount)&&yi(ce,N,E),ve&6)Me(E.component,V,$);else{if(ve&128){E.suspense.unmount(V,$);return}Re&&eo(E,null,N,"beforeUnmount"),ve&64?E.type.remove(E,N,V,G,we,$):X&&(te!==Xs||de>0&&de&64)?be(X,N,V,!1,!0):(te===Xs&&de&384||!G&&ve&16)&&be(se,N,V),$&&xe(E)}(Le&&(ce=le&&le.onVnodeUnmounted)||Re)&&ps(()=>{ce&&yi(ce,N,E),Re&&eo(E,null,N,"unmounted")},V)},xe=E=>{const{type:N,el:V,anchor:$,transition:G}=E;if(N===Xs){Ie(V,$);return}if(N===z0){M(E);return}const te=()=>{i(V),G&&!G.persisted&&G.afterLeave&&G.afterLeave()};if(E.shapeFlag&1&&G&&!G.persisted){const{leave:le,delayLeave:Q}=G,se=()=>le(V,te);Q?Q(E.el,te,se):se()}else te()},Ie=(E,N)=>{let V;for(;E!==N;)V=f(E),i(E),E=V;i(N)},Me=(E,N,V)=>{const{bum:$,scope:G,update:te,subTree:le,um:Q}=E;$&&j0($),G.stop(),te&&(te.active=!1,ne(le,E,N,V)),Q&&ps(Q,N),ps(()=>{E.isUnmounted=!0},N),N&&N.pendingBranch&&!N.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===N.pendingId&&(N.deps--,N.deps===0&&N.resolve())},be=(E,N,V,$=!1,G=!1,te=0)=>{for(let le=te;le<E.length;le++)ne(E[le],N,V,$,G)},ze=E=>E.shapeFlag&6?ze(E.component.subTree):E.shapeFlag&128?E.suspense.next():f(E.anchor||E.el),De=(E,N,V)=>{E==null?N._vnode&&ne(N._vnode,null,null,!0):I(N._vnode||null,E,N,null,null,null,V),xw(),N._vnode=E},we={p:I,um:ne,m:ee,r:xe,mt:T,mc:x,pc:K,pbc:w,n:ze,o:t};let Xe,mt;return e&&([Xe,mt]=e(we)),{render:De,hydrate:Xe,createApp:TA(De,Xe)}}function to({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function $w(t,e,n=!1){const s=t.children,i=e.children;if(It(s)&&It(i))for(let r=0;r<s.length;r++){const o=s[r];let a=i[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[r]=Tr(i[r]),a.el=o.el),n||$w(o,a))}}function RA(t){const e=t.slice(),n=[0];let s,i,r,o,a;const l=t.length;for(s=0;s<l;s++){const c=t[s];if(c!==0){if(i=n[n.length-1],t[i]<c){e[s]=i,n.push(s);continue}for(r=0,o=n.length-1;r<o;)a=r+o>>1,t[n[a]]<c?r=a+1:o=a;c<t[n[r]]&&(r>0&&(e[s]=n[r-1]),n[r]=s)}}for(r=n.length,o=n[r-1];r-- >0;)n[r]=o,o=e[o];return n}const CA=t=>t.__isTeleport,Xs=Symbol(void 0),Wp=Symbol(void 0),mi=Symbol(void 0),z0=Symbol(void 0),hc=[];let hi=null;function ys(t=!1){hc.push(hi=t?null:[])}function IA(){hc.pop(),hi=hc[hc.length-1]||null}let Cc=1;function p2(t){Cc+=t}function zw(t){return t.dynamicChildren=Cc>0?hi||Pa:null,IA(),Cc>0&&hi&&hi.push(t),t}function Qs(t,e,n,s,i,r){return zw(Tn(t,e,n,s,i,r,!0))}function Kw(t,e,n,s,i){return zw(Os(t,e,n,s,i,!0))}function n1(t){return t?t.__v_isVNode===!0:!1}function _o(t,e){return t.type===e.type&&t.key===e.key}const uf="__vInternal",Gw=({key:t})=>t!=null?t:null,jh=({ref:t,ref_key:e,ref_for:n})=>t!=null?js(t)||ss(t)||xt(t)?{i:Zs,r:t,k:e,f:!!n}:t:null;function Tn(t,e=null,n=null,s=0,i=null,r=t===Xs?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Gw(e),ref:e&&jh(e),scopeId:af,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:i,dynamicChildren:null,appContext:null};return a?(Yp(l,n),r&128&&t.normalize(l)):n&&(l.shapeFlag|=js(n)?8:16),Cc>0&&!o&&hi&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&hi.push(l),l}const Os=kA;function kA(t,e=null,n=null,s=0,i=null,r=!1){if((!t||t===uA)&&(t=mi),n1(t)){const a=Ur(t,e,!0);return n&&Yp(a,n),Cc>0&&!r&&hi&&(a.shapeFlag&6?hi[hi.indexOf(t)]=a:hi.push(a)),a.patchFlag|=-2,a}if(qA(t)&&(t=t.__vccOpts),e){e=MA(e);let{class:a,style:l}=e;a&&!js(a)&&(e.class=Ka(a)),as(l)&&(lw(l)&&!It(l)&&(l=Us({},l)),e.style=Hp(l))}const o=js(t)?1:K8(t)?128:CA(t)?64:as(t)?4:xt(t)?2:0;return Tn(t,e,n,s,i,o,r,!0)}function MA(t){return t?lw(t)||uf in t?Us({},t):t:null}function Ur(t,e,n=!1){const{props:s,ref:i,patchFlag:r,children:o}=t,a=e?OA(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&Gw(a),ref:e&&e.ref?n&&i?It(i)?i.concat(jh(e)):[i,jh(e)]:jh(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:o,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Xs?r===-1?16:r|16:r,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Ur(t.ssContent),ssFallback:t.ssFallback&&Ur(t.ssFallback),el:t.el,anchor:t.anchor}}function NA(t=" ",e=0){return Os(Wp,null,t,e)}function So(t="",e=!1){return e?(ys(),Kw(mi,null,t)):Os(mi,null,t)}function Ai(t){return t==null||typeof t=="boolean"?Os(mi):It(t)?Os(Xs,null,t.slice()):typeof t=="object"?Tr(t):Os(Wp,null,String(t))}function Tr(t){return t.el===null||t.memo?t:Ur(t)}function Yp(t,e){let n=0;const{shapeFlag:s}=t;if(e==null)e=null;else if(It(e))n=16;else if(typeof e=="object")if(s&65){const i=e.default;i&&(i._c&&(i._d=!1),Yp(t,i()),i._c&&(i._d=!0));return}else{n=32;const i=e._;!i&&!(uf in e)?e._ctx=Zs:i===3&&Zs&&(Zs.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else xt(e)?(e={default:e,_ctx:Zs},n=32):(e=String(e),s&64?(n=16,e=[NA(e)]):n=8);t.children=e,t.shapeFlag|=n}function OA(...t){const e={};for(let n=0;n<t.length;n++){const s=t[n];for(const i in s)if(i==="class")e.class!==s.class&&(e.class=Ka([e.class,s.class]));else if(i==="style")e.style=Hp([e.style,s.style]);else if(Vp(i)){const r=e[i],o=s[i];o&&r!==o&&!(It(r)&&r.includes(o))&&(e[i]=r?[].concat(r,o):o)}else i!==""&&(e[i]=s[i])}return e}function yi(t,e,n,s=null){ei(t,e,7,[n,s])}const LA=qw();let PA=0;function DA(t,e,n){const s=t.type,i=(e?e.appContext:t.appContext)||LA,r={uid:PA++,vnode:t,type:s,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new HS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Uw(s,i),emitsOptions:Sw(s,i),emit:null,emitted:null,propsDefaults:Wt,inheritAttrs:s.inheritAttrs,ctx:Wt,data:Wt,props:Wt,attrs:Wt,slots:Wt,refs:Wt,setupState:Wt,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=F8.bind(null,r),t.ce&&t.ce(r),r}let In=null;const BA=()=>In||Zs,Ga=t=>{In=t,t.scope.on()},Lo=()=>{In&&In.scope.off(),In=null};function Ww(t){return t.vnode.shapeFlag&4}let Ic=!1;function FA(t,e=!1){Ic=e;const{props:n,children:s}=t.vnode,i=Ww(t);vA(t,n,i,e),wA(t,s);const r=i?UA(t,e):void 0;return Ic=!1,r}function UA(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=cw(new Proxy(t.ctx,dA));const{setup:s}=n;if(s){const i=t.setupContext=s.length>1?HA(t):null;Ga(t),pl();const r=kr(s,t,0,[t.props,i]);if(gl(),Lo(),gw(r)){if(r.then(Lo,Lo),e)return r.then(o=>{g2(t,o,e)}).catch(o=>{sf(o,t,0)});t.asyncDep=r}else g2(t,r,e)}else Yw(t,e)}function g2(t,e,n){xt(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:as(e)&&(t.setupState=uw(e)),Yw(t,n)}let _2;function Yw(t,e,n){const s=t.type;if(!t.render){if(!e&&_2&&!s.render){const i=s.template;if(i){const{isCustomElement:r,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=s,c=Us(Us({isCustomElement:r,delimiters:a},o),l);s.render=_2(i,c)}}t.render=s.render||Oi}Ga(t),pl(),fA(t),gl(),Lo()}function jA(t){return new Proxy(t.attrs,{get(e,n){return Fs(t,"get","$attrs"),e[n]}})}function HA(t){const e=s=>{t.exposed=s||{}};let n;return{get attrs(){return n||(n=jA(t))},slots:t.slots,emit:t.emit,expose:e}}function hf(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(uw(cw(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in td)return td[n](t)}}))}function VA(t,e=!0){return xt(t)?t.displayName||t.name:t.name||e&&t.__name}function qA(t){return xt(t)&&"__vccOpts"in t}const $A=(t,e)=>b8(t,e,Ic);function zA(t,e,n){const s=arguments.length;return s===2?as(e)&&!It(e)?n1(e)?Os(t,null,[e]):Os(t,e):Os(t,null,e):(s>3?n=Array.prototype.slice.call(arguments,2):s===3&&n1(n)&&(n=[n]),Os(t,e,n))}const KA="3.2.37";function GA(t,e){const n=Object.create(null),s=t.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const WA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",YA=GA(WA);function Xw(t){return!!t||t===""}function XA(t,e){if(t.length!==e.length)return!1;let n=!0;for(let s=0;n&&s<t.length;s++)n=df(t[s],e[s]);return n}function df(t,e){if(t===e)return!0;let n=v2(t),s=v2(e);if(n||s)return n&&s?t.getTime()===e.getTime():!1;if(n=y2(t),s=y2(e),n||s)return t===e;if(n=Ho(t),s=Ho(e),n||s)return n&&s?XA(t,e):!1;if(n=b2(t),s=b2(e),n||s){if(!n||!s)return!1;const i=Object.keys(t).length,r=Object.keys(e).length;if(i!==r)return!1;for(const o in t){const a=t.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!df(t[o],e[o]))return!1}}return String(t)===String(e)}function QA(t,e){return t.findIndex(n=>df(n,e))}const ZA=/^on[^a-z]/,JA=t=>ZA.test(t),eR=t=>t.startsWith("onUpdate:"),Qw=Object.assign,Ho=Array.isArray,Zw=t=>e4(t)==="[object Set]",v2=t=>e4(t)==="[object Date]",Jw=t=>typeof t=="function",sd=t=>typeof t=="string",y2=t=>typeof t=="symbol",b2=t=>t!==null&&typeof t=="object",tR=Object.prototype.toString,e4=t=>tR.call(t),t4=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},nR=/\B([A-Z])/g,n4=t4(t=>t.replace(nR,"-$1").toLowerCase()),sR=t4(t=>t.charAt(0).toUpperCase()+t.slice(1)),iR=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},s1=t=>{const e=parseFloat(t);return isNaN(e)?t:e},rR="http://www.w3.org/2000/svg",vo=typeof document!="undefined"?document:null,w2=vo&&vo.createElement("template"),oR={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,s)=>{const i=e?vo.createElementNS(rR,t):vo.createElement(t,n?{is:n}:void 0);return t==="select"&&s&&s.multiple!=null&&i.setAttribute("multiple",s.multiple),i},createText:t=>vo.createTextNode(t),createComment:t=>vo.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>vo.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},cloneNode(t){const e=t.cloneNode(!0);return"_value"in t&&(e._value=t._value),e},insertStaticContent(t,e,n,s,i,r){const o=n?n.previousSibling:e.lastChild;if(i&&(i===r||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),n),!(i===r||!(i=i.nextSibling)););else{w2.innerHTML=s?`<svg>${t}</svg>`:t;const a=w2.content;if(s){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function aR(t,e,n){const s=t._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function lR(t,e,n){const s=t.style,i=sd(n);if(n&&!i){for(const r in n)i1(s,r,n[r]);if(e&&!sd(e))for(const r in e)n[r]==null&&i1(s,r,"")}else{const r=s.display;i?e!==n&&(s.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(s.display=r)}}const E2=/\s*!important$/;function i1(t,e,n){if(Ho(n))n.forEach(s=>i1(t,e,s));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const s=cR(t,e);E2.test(n)?t.setProperty(n4(s),n.replace(E2,""),"important"):t[s]=n}}const x2=["Webkit","Moz","ms"],K0={};function cR(t,e){const n=K0[e];if(n)return n;let s=Di(e);if(s!=="filter"&&s in t)return K0[e]=s;s=sR(s);for(let i=0;i<x2.length;i++){const r=x2[i]+s;if(r in t)return K0[e]=r}return e}const T2="http://www.w3.org/1999/xlink";function uR(t,e,n,s,i){if(s&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(T2,e.slice(6,e.length)):t.setAttributeNS(T2,e,n);else{const r=YA(e);n==null||r&&!Xw(n)?t.removeAttribute(e):t.setAttribute(e,r?"":n)}}function hR(t,e,n,s,i,r,o){if(e==="innerHTML"||e==="textContent"){s&&o(s,i,r),t[e]=n==null?"":n;return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=n;const l=n==null?"":n;(t.value!==l||t.tagName==="OPTION")&&(t.value=l),n==null&&t.removeAttribute(e);return}let a=!1;if(n===""||n==null){const l=typeof t[e];l==="boolean"?n=Xw(n):n==null&&l==="string"?(n="",a=!0):l==="number"&&(n=0,a=!0)}try{t[e]=n}catch{}a&&t.removeAttribute(e)}const[s4,dR]=(()=>{let t=Date.now,e=!1;if(typeof window!="undefined"){Date.now()>document.createEvent("Event").timeStamp&&(t=performance.now.bind(performance));const n=navigator.userAgent.match(/firefox\/(\d+)/i);e=!!(n&&Number(n[1])<=53)}return[t,e]})();let r1=0;const fR=Promise.resolve(),mR=()=>{r1=0},pR=()=>r1||(fR.then(mR),r1=s4());function yo(t,e,n,s){t.addEventListener(e,n,s)}function gR(t,e,n,s){t.removeEventListener(e,n,s)}function _R(t,e,n,s,i=null){const r=t._vei||(t._vei={}),o=r[e];if(s&&o)o.value=s;else{const[a,l]=vR(e);if(s){const c=r[e]=yR(s,i);yo(t,a,c,l)}else o&&(gR(t,a,o,l),r[e]=void 0)}}const S2=/(?:Once|Passive|Capture)$/;function vR(t){let e;if(S2.test(t)){e={};let n;for(;n=t.match(S2);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[n4(t.slice(2)),e]}function yR(t,e){const n=s=>{const i=s.timeStamp||s4();(dR||i>=n.attached-1)&&ei(bR(s,n.value),e,5,[s])};return n.value=t,n.attached=pR(),n}function bR(t,e){if(Ho(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(s=>i=>!i._stopped&&s&&s(i))}else return e}const A2=/^on[a-z]/,wR=(t,e,n,s,i=!1,r,o,a,l)=>{e==="class"?aR(t,s,i):e==="style"?lR(t,n,s):JA(e)?eR(e)||_R(t,e,n,s,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):ER(t,e,s,i))?hR(t,e,s,r,o,a,l):(e==="true-value"?t._trueValue=s:e==="false-value"&&(t._falseValue=s),uR(t,e,s,i))};function ER(t,e,n,s){return s?!!(e==="innerHTML"||e==="textContent"||e in t&&A2.test(e)&&Jw(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||A2.test(e)&&sd(n)?!1:e in t}const xR={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Z8.props;const id=t=>{const e=t.props["onUpdate:modelValue"]||!1;return Ho(e)?n=>iR(e,n):e};function TR(t){t.target.composing=!0}function R2(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const C2={created(t,{modifiers:{lazy:e,trim:n,number:s}},i){t._assign=id(i);const r=s||i.props&&i.props.type==="number";yo(t,e?"change":"input",o=>{if(o.target.composing)return;let a=t.value;n&&(a=a.trim()),r&&(a=s1(a)),t._assign(a)}),n&&yo(t,"change",()=>{t.value=t.value.trim()}),e||(yo(t,"compositionstart",TR),yo(t,"compositionend",R2),yo(t,"change",R2))},mounted(t,{value:e}){t.value=e==null?"":e},beforeUpdate(t,{value:e,modifiers:{lazy:n,trim:s,number:i}},r){if(t._assign=id(r),t.composing||document.activeElement===t&&t.type!=="range"&&(n||s&&t.value.trim()===e||(i||t.type==="number")&&s1(t.value)===e))return;const o=e==null?"":e;t.value!==o&&(t.value=o)}},i4={deep:!0,created(t,{value:e,modifiers:{number:n}},s){const i=Zw(e);yo(t,"change",()=>{const r=Array.prototype.filter.call(t.options,o=>o.selected).map(o=>n?s1(rd(o)):rd(o));t._assign(t.multiple?i?new Set(r):r:r[0])}),t._assign=id(s)},mounted(t,{value:e}){I2(t,e)},beforeUpdate(t,e,n){t._assign=id(n)},updated(t,{value:e}){I2(t,e)}};function I2(t,e){const n=t.multiple;if(!(n&&!Ho(e)&&!Zw(e))){for(let s=0,i=t.options.length;s<i;s++){const r=t.options[s],o=rd(r);if(n)Ho(e)?r.selected=QA(e,o)>-1:r.selected=e.has(o);else if(df(rd(r),e)){t.selectedIndex!==s&&(t.selectedIndex=s);return}}!n&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function rd(t){return"_value"in t?t._value:t.value}const SR=["ctrl","shift","alt","meta"],AR={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>SR.some(n=>t[`${n}Key`]&&!e.includes(n))},G0=(t,e)=>(n,...s)=>{for(let i=0;i<e.length;i++){const r=AR[e[i]];if(r&&r(n,e))return}return t(n,...s)},RR=Qw({patchProp:wR},oR);let k2;function CR(){return k2||(k2=SA(RR))}const IR=(...t)=>{const e=CR().createApp(...t),{mount:n}=e;return e.mount=s=>{const i=kR(s);if(!i)return;const r=e._component;!Jw(r)&&!r.render&&!r.template&&(r.template=i.innerHTML),i.innerHTML="";const o=n(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},e};function kR(t){return sd(t)?document.querySelector(t):t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r4={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Be=function(t,e){if(!t)throw _l(e)},_l=function(t){return new Error("Firebase Database ("+r4.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},MR=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Xp={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,c=l?t[i+2]:0,d=r>>2,u=(r&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),s.push(n[d],n[u],n[f],n[m])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(o4(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):MR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const r=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const c=i<t.length?n[t.charAt(i)]:64;++i;const u=i<t.length?n[t.charAt(i)]:64;if(++i,r==null||a==null||c==null||u==null)throw Error();const f=r<<2|a>>4;if(s.push(f),c!==64){const m=a<<4&240|c>>2;if(s.push(m),u!==64){const h=c<<6&192|u;s.push(h)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},NR=function(t){const e=o4(t);return Xp.encodeByteArray(e,!0)},M2=function(t){try{return Xp.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OR(t){return a4(void 0,t)}function a4(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!LR(n)||(t[n]=a4(t[n],e[n]));return t}function LR(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ff(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Qp(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ff())}function PR(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function l4(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function DR(){return ff().indexOf("Electron/")>=0}function BR(){const t=ff();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function FR(){return ff().indexOf("MSAppHost/")>=0}function c4(){return r4.NODE_ADMIN===!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UR="FirebaseError";class mf extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=UR,Object.setPrototypeOf(this,mf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,u4.prototype.create)}}class u4{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?jR(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new mf(i,a,s)}}function jR(t,e){return t.replace(HR,(n,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const HR=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(t){return JSON.parse(t)}function kn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4=function(t){let e={},n={},s={},i="";try{const r=t.split(".");e=kc(M2(r[0])||""),n=kc(M2(r[1])||""),i=r[2],s=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:s,signature:i}},VR=function(t){const e=h4(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},qR=function(t){const e=h4(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wa(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function o1(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function od(t,e,n){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=e.call(n,t[i],i,t));return s}function a1(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const r=t[i],o=e[i];if(N2(r)&&N2(o)){if(!a1(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function N2(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $R(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const s=this.W_;if(typeof e=="string")for(let u=0;u<16;u++)s[u]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let u=0;u<16;u++)s[u]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let u=16;u<80;u++){const f=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=(f<<1|f>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,d;for(let u=0;u<80;u++){u<40?u<20?(c=a^r&(o^a),d=1518500249):(c=r^o^a,d=1859775393):u<60?(c=r&o|a&(r|o),d=2400959708):(c=r^o^a,d=3395469782);const f=(i<<5|i>>>27)+c+l+d+s[u]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=i,i=f}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const s=n-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<n;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<n;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function Ya(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KR=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,Be(s<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},pf=function(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _n(t){return t&&t._delegate?t._delegate:t}class vl{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new $i;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(YR(e))try{this.getOrInitializeService({instanceIdentifier:mo})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=mo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=mo){return this.instances.has(e)}getOptions(e=mo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,n){var s;const i=this.normalizeInstanceIdentifier(n),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(!!s)for(const i of s)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:WR(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=mo){return this.component?this.component.multipleInstances?e:mo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function WR(t){return t===mo?void 0:t}function YR(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new GR(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Mt||(Mt={}));const QR={debug:Mt.DEBUG,verbose:Mt.VERBOSE,info:Mt.INFO,warn:Mt.WARN,error:Mt.ERROR,silent:Mt.SILENT},ZR=Mt.INFO,JR={[Mt.DEBUG]:"log",[Mt.VERBOSE]:"log",[Mt.INFO]:"info",[Mt.WARN]:"warn",[Mt.ERROR]:"error"},eC=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),i=JR[e];if(i)console[i](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Zp{constructor(e){this.name=e,this._logLevel=ZR,this._logHandler=eC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Mt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?QR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Mt.DEBUG,...e),this._logHandler(this,Mt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Mt.VERBOSE,...e),this._logHandler(this,Mt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Mt.INFO,...e),this._logHandler(this,Mt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Mt.WARN,...e),this._logHandler(this,Mt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Mt.ERROR,...e),this._logHandler(this,Mt.ERROR,...e)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(nC(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function nC(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const l1="@firebase/app",O2="0.7.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jp=new Zp("@firebase/app"),sC="@firebase/app-compat",iC="@firebase/analytics-compat",rC="@firebase/analytics",oC="@firebase/app-check-compat",aC="@firebase/app-check",lC="@firebase/auth",cC="@firebase/auth-compat",uC="@firebase/database",hC="@firebase/database-compat",dC="@firebase/functions",fC="@firebase/functions-compat",mC="@firebase/installations",pC="@firebase/installations-compat",gC="@firebase/messaging",_C="@firebase/messaging-compat",vC="@firebase/performance",yC="@firebase/performance-compat",bC="@firebase/remote-config",wC="@firebase/remote-config-compat",EC="@firebase/storage",xC="@firebase/storage-compat",TC="@firebase/firestore",SC="@firebase/firestore-compat",AC="firebase",RC="9.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d4="[DEFAULT]",CC={[l1]:"fire-core",[sC]:"fire-core-compat",[rC]:"fire-analytics",[iC]:"fire-analytics-compat",[aC]:"fire-app-check",[oC]:"fire-app-check-compat",[lC]:"fire-auth",[cC]:"fire-auth-compat",[uC]:"fire-rtdb",[hC]:"fire-rtdb-compat",[dC]:"fire-fn",[fC]:"fire-fn-compat",[mC]:"fire-iid",[pC]:"fire-iid-compat",[gC]:"fire-fcm",[_C]:"fire-fcm-compat",[vC]:"fire-perf",[yC]:"fire-perf-compat",[bC]:"fire-rc",[wC]:"fire-rc-compat",[EC]:"fire-gcs",[xC]:"fire-gcs-compat",[TC]:"fire-fst",[SC]:"fire-fst-compat","fire-js":"fire-js",[AC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad=new Map,c1=new Map;function IC(t,e){try{t.container.addComponent(e)}catch(n){Jp.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function mu(t){const e=t.name;if(c1.has(e))return Jp.debug(`There were multiple attempts to register component ${e}.`),!1;c1.set(e,t);for(const n of ad.values())IC(n,t);return!0}function eg(t,e){return t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kC={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function."},ld=new u4("app","Firebase",kC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new vl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ld.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tg=RC;function NC(t,e={}){typeof e!="object"&&(e={name:e});const n=Object.assign({name:d4,automaticDataCollectionEnabled:!1},e),s=n.name;if(typeof s!="string"||!s)throw ld.create("bad-app-name",{appName:String(s)});const i=ad.get(s);if(i){if(a1(t,i.options)&&a1(n,i.config))return i;throw ld.create("duplicate-app",{appName:s})}const r=new XR(s);for(const a of c1.values())r.addComponent(a);const o=new MC(t,n,r);return ad.set(s,o),o}function ng(t=d4){const e=ad.get(t);if(!e)throw ld.create("no-app",{appName:t});return e}function Li(t,e,n){var s;let i=(s=CC[t])!==null&&s!==void 0?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${i}" with version "${e}":`];r&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Jp.warn(a.join(" "));return}mu(new vl(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OC(t){mu(new vl("platform-logger",e=>new tC(e),"PRIVATE")),Li(l1,O2,t),Li(l1,O2,"esm2017"),Li("fire-js","")}OC("");var LC="firebase",PC="9.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Li(LC,PC,"app");const L2="@firebase/database",P2="0.12.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let f4="";function DC(t){f4=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),kn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:kc(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Ui(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4=function(t){try{if(typeof window!="undefined"&&typeof window[t]!="undefined"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new BC(e)}}catch{}return new FC},Ao=m4("localStorage"),u1=m4("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Da=new Zp("@firebase/database"),UC=function(){let t=1;return function(){return t++}}(),p4=function(t){const e=KR(t),n=new zR;n.update(e);const s=n.digest();return Xp.encodeByteArray(s)},pu=function(...t){let e="";for(let n=0;n<t.length;n++){const s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=pu.apply(null,s):typeof s=="object"?e+=kn(s):e+=s,e+=" "}return e};let Po=null,D2=!0;const jC=function(t,e){Be(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(Da.logLevel=Mt.VERBOSE,Po=Da.log.bind(Da),e&&u1.set("logging_enabled",!0)):typeof t=="function"?Po=t:(Po=null,u1.remove("logging_enabled"))},Ln=function(...t){if(D2===!0&&(D2=!1,Po===null&&u1.get("logging_enabled")===!0&&jC(!0)),Po){const e=pu.apply(null,t);Po(e)}},gu=function(t){return function(...e){Ln(t,...e)}},h1=function(...t){const e="FIREBASE INTERNAL ERROR: "+pu(...t);Da.error(e)},Vo=function(...t){const e=`FIREBASE FATAL ERROR: ${pu(...t)}`;throw Da.error(e),new Error(e)},Ts=function(...t){const e="FIREBASE WARNING: "+pu(...t);Da.warn(e)},HC=function(){typeof window!="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ts("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},gf=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},VC=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Xa="[MIN_NAME]",qo="[MAX_NAME]",oa=function(t,e){if(t===e)return 0;if(t===Xa||e===qo)return-1;if(e===Xa||t===qo)return 1;{const n=B2(t),s=B2(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},qC=function(t,e){return t===e?0:t<e?-1:1},Ul=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+kn(e))},sg=function(t){if(typeof t!="object"||t===null)return kn(t);const e=[];for(const s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=kn(e[s]),n+=":",n+=sg(t[e[s]]);return n+="}",n},g4=function(t,e){const n=t.length;if(n<=e)return[t];const s=[];for(let i=0;i<n;i+=e)i+e>n?s.push(t.substring(i,n)):s.push(t.substring(i,i+e));return s};function Gn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const _4=function(t){Be(!gf(t),"Invalid JSON number");const e=11,n=52,s=(1<<e-1)-1;let i,r,o,a,l;t===0?(r=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),r=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-s-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();const d=c.join("");let u="";for(l=0;l<64;l+=8){let f=parseInt(d.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),u=u+f}return u.toLowerCase()},$C=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},zC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function KC(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}const GC=new RegExp("^-?(0*)\\d{1,10}$"),WC=-2147483648,YC=2147483647,B2=function(t){if(GC.test(t)){const e=Number(t);if(e>=WC&&e<=YC)return e}return null},yl=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Ts("Exception was thrown by user callback.",n),e},Math.floor(0))}},XC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},dc=function(t,e){const n=setTimeout(t,e);return typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){Ts(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Ln("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ts(e)}}class d1{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}d1.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ig="5",v4="v",y4="s",b4="r",w4="f",E4=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,x4="ls",JC="p",f1="ac",T4="websocket",S4="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e,n,s,i,r=!1,o="",a=!1){this.secure=n,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ao.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ao.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function tI(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function A4(t,e,n){Be(typeof e=="string","typeof type must == string"),Be(typeof n=="object","typeof params must == object");let s;if(e===T4)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===S4)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);tI(t)&&(n.ns=t.namespace);const i=[];return Gn(n,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(){this.counters_={}}incrementCounter(e,n=1){Ui(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return OR(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W0={},Y0={};function rg(t){const e=t.toString();return W0[e]||(W0[e]=new nI),W0[e]}function sI(t,e){const n=t.toString();return Y0[n]||(Y0[n]=e()),Y0[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iI{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&yl(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2="start",rI="close",oI="pLPCommand",aI="pRTLPCB",R4="id",C4="pw",I4="ser",lI="cb",cI="seg",uI="ts",hI="d",dI="dframe",k4=1870,M4=30,fI=k4-M4,mI=25e3,pI=3e4;class Ia{constructor(e,n,s,i,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=gu(e),this.stats_=rg(n),this.urlFn=l=>(this.appCheckToken&&(l[f1]=this.appCheckToken),A4(n,S4,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new iI(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pI)),VC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new og((...r)=>{const[o,a,l,c,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===F2)this.id=a,this.password=l;else if(o===rI)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[F2]="t",s[I4]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[lI]=this.scriptTagHolder.uniqueCallbackIdentifier),s[v4]=ig,this.transportSessionId&&(s[y4]=this.transportSessionId),this.lastSessionId&&(s[x4]=this.lastSessionId),this.applicationId&&(s[JC]=this.applicationId),this.appCheckToken&&(s[f1]=this.appCheckToken),typeof location!="undefined"&&location.hostname&&E4.test(location.hostname)&&(s[b4]=w4);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ia.forceAllow_=!0}static forceDisallow(){Ia.forceDisallow_=!0}static isAvailable(){return Ia.forceAllow_?!0:!Ia.forceDisallow_&&typeof document!="undefined"&&document.createElement!=null&&!$C()&&!zC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=kn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=NR(n),i=g4(s,fI);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const s={};s[dI]="t",s[R4]=e,s[C4]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=kn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class og{constructor(e,n,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=UC(),window[oI+this.uniqueCallbackIdentifier]=e,window[aI+this.uniqueCallbackIdentifier]=n,this.myIFrame=og.createIFrame_();let r="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"){const a=document.domain;r='<script>document.domain="'+a+'";<\/script>'}const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ln("frame writing exception"),a.stack&&Ln(a.stack),Ln(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ln("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[R4]=this.myID,e[C4]=this.myPW,e[I4]=this.currentSerial;let n=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+M4+s.length<=k4;){const o=this.pendingSegs.shift();s=s+"&"+cI+i+"="+o.seg+"&"+uI+i+"="+o.ts+"&"+hI+i+"="+o.d,i++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(s,Math.floor(mI)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{Ln("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gI=16384,_I=45e3;let cd=null;typeof MozWebSocket!="undefined"?cd=MozWebSocket:typeof WebSocket!="undefined"&&(cd=WebSocket);class ci{constructor(e,n,s,i,r,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=gu(this.connId),this.stats_=rg(n),this.connURL=ci.connectionURL_(n,o,a,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,s,i){const r={};return r[v4]=ig,typeof location!="undefined"&&location.hostname&&E4.test(location.hostname)&&(r[b4]=w4),n&&(r[y4]=n),s&&(r[x4]=s),i&&(r[f1]=i),A4(e,T4,r)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ao.set("previous_websocket_failure",!0);try{if(!c4()){const s={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new cd(this.connURL,[],s)}}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){ci.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator!="undefined"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&cd!==null&&!ci.forceDisallow_}static previouslyFailed(){return Ao.isInMemoryStorage||Ao.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ao.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const s=kc(n);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Be(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const n=kn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=g4(n,gI);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(_I))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ci.responsesRequiredToBeHealthy=2;ci.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ia,ci]}initTransports_(e){const n=ci&&ci.isAvailable();let s=n&&!ci.previouslyFailed();if(e.webSocketOnly&&(n||Ts("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[ci];else{const i=this.transports_=[];for(const r of ag.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vI=6e4,yI=5e3,bI=10*1024,wI=100*1024,X0="t",U2="d",EI="s",j2="r",xI="e",H2="o",V2="a",q2="n",$2="p",TI="h";class SI{constructor(e,n,s,i,r,o,a,l,c,d){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=gu("c:"+this.id+":"),this.transportManager_=new ag(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=dc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>wI?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>bI?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(X0 in e){const n=e[X0];n===V2?this.upgradeIfSecondaryHealthy_():n===j2?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===H2&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Ul("t",e),s=Ul("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:$2,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:V2,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:q2,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Ul("t",e),s=Ul("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Ul(X0,e);if(U2 in e){const s=e[U2];if(n===TI)this.onHandshake_(s);else if(n===q2){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===EI?this.onConnectionShutdown_(s):n===j2?this.onReset_(s):n===xI?h1("Server Error: "+s):n===H2?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):h1("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),ig!==s&&Ts("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),dc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(vI))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):dc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(yI))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:$2,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ao.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{put(e,n,s,i){}merge(e,n,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4{constructor(e){this.allowedEvents_=e,this.listeners_={},Be(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});const i=this.getInitialEvent(e);i&&n.apply(s,i)}off(e,n,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===n&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){Be(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud extends O4{constructor(){super(["online"]),this.online_=!0,typeof window!="undefined"&&typeof window.addEventListener!="undefined"&&!Qp()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ud}getInitialEvent(e){return Be(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2=32,K2=768;class Vt{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Ot(){return new Vt("")}function vt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function jr(t){return t.pieces_.length-t.pieceNum_}function Yt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Vt(t.pieces_,e)}function lg(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function AI(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Mc(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function L4(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Vt(e,0)}function pn(t,e){const n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof Vt)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&n.push(s[i])}return new Vt(n,0)}function bt(t){return t.pieceNum_>=t.pieces_.length}function Es(t,e){const n=vt(t),s=vt(e);if(n===null)return e;if(n===s)return Es(Yt(t),Yt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function RI(t,e){const n=Mc(t,0),s=Mc(e,0);for(let i=0;i<n.length&&i<s.length;i++){const r=oa(n[i],s[i]);if(r!==0)return r}return n.length===s.length?0:n.length<s.length?-1:1}function cg(t,e){if(jr(t)!==jr(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function Js(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(jr(t)>jr(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}class CI{constructor(e,n){this.errorPrefix_=n,this.parts_=Mc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=pf(this.parts_[s]);P4(this)}}function II(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=pf(e),P4(t)}function kI(t){const e=t.parts_.pop();t.byteLength_-=pf(e),t.parts_.length>0&&(t.byteLength_-=1)}function P4(t){if(t.byteLength_>K2)throw new Error(t.errorPrefix_+"has a key path longer than "+K2+" bytes ("+t.byteLength_+").");if(t.parts_.length>z2)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+z2+") or object contains a cycle "+po(t))}function po(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug extends O4{constructor(){super(["visible"]);let e,n;typeof document!="undefined"&&typeof document.addEventListener!="undefined"&&(typeof document.hidden!="undefined"?(n="visibilitychange",e="hidden"):typeof document.mozHidden!="undefined"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden!="undefined"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden!="undefined"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new ug}getInitialEvent(e){return Be(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jl=1e3,MI=60*5*1e3,NI=3*1e3,G2=30*1e3,OI=1.3,LI=3e4,PI="server_kill",W2=3;class Xi extends N4{constructor(e,n,s,i,r,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Xi.nextPersistentConnectionId_++,this.log_=gu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=jl,this.maxReconnectDelay_=MI,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!c4())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ug.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ud.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,s){const i=++this.requestNumber_,r={r:i,a:e,b:n};this.log_(kn(r)),Be(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const n=new $i,s={p:e._path.toString(),q:e._queryObject},i={action:"g",request:s,onComplete:o=>{const a=o.d;o.s==="ok"?(this.onDataUpdate_(s.p,a,!1,null),n.resolve(a)):n.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const o=this.outstandingGets_[r];o===void 0||i!==o||(delete this.outstandingGets_[r],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),this.log_("get "+r+" timed out on connection"),n.reject(new Error("Client is offline.")))},NI),this.connected_&&this.sendGet_(r),n.promise}listen(e,n,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),Be(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Be(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:e,tag:s};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(e){const n=e.query,s=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const l=a.d,c=a.s;Xi.warnOnListenWarnings_(l,n),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Ui(e,"w")){const s=Wa(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();Ts(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||qR(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=G2)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=VR(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,s=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(e,n){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),Be(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,n)}sendUnlisten_(e,n,s,i){this.log_("Unlisten on "+e+" for "+n);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:s})}onDisconnectMerge(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:s})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,s,i){const r={p:n,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,n,s,i){this.putInternal("p",e,n,s,i)}merge(e,n,s,i){this.putInternal("m",e,n,s,i)}putInternal(e,n,s,i,r){this.initConnection_();const o={p:n,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,s,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+kn(e));const n=e.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):h1("Unrecognized action received from server: "+kn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Be(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=jl,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=jl,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>LI&&(this.reconnectDelay_=jl),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*OI)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Xi.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,s())},c=function(u){Be(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(u)};this.realtime_={close:l,sendRequest:c};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[u,f]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Ln("getToken() completed but was canceled"):(Ln("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=f&&f.token,a=new SI(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,s,m=>{Ts(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(PI)},r))}catch(u){this.log_("Failed to get token: "+u),o||(this.repoInfo_.nodeAdmin&&Ts(u),l())}}}interrupt(e){Ln("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ln("Resuming connection for reason: "+e),delete this.interruptReasons_[e],o1(this.interruptReasons_)&&(this.reconnectDelay_=jl,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let s;n?s=n.map(r=>sg(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const s=new Vt(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(n),r.delete(n),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,n){Ln("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=W2&&(this.reconnectDelay_=G2,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Ln("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=W2&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+f4.replace(/\./g,"-")]=1,Qp()?e["framework.cordova"]=1:l4()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ud.getInstance().currentlyOnline();return o1(this.interruptReasons_)&&e}}Xi.nextPersistentConnectionId_=0;Xi.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new wt(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const s=new wt(Xa,e),i=new wt(Xa,n);return this.compare(s,i)!==0}minPost(){return wt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ah;class D4 extends _f{static get __EMPTY_NODE(){return ah}static set __EMPTY_NODE(e){ah=e}compare(e,n){return oa(e.name,n.name)}isDefinedOn(e){throw _l("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return wt.MIN}maxPost(){return new wt(qo,ah)}makePost(e,n){return Be(typeof e=="string","KeyIndex indexValue must always be a string."),new wt(e,ah)}toString(){return".key"}}const Ba=new D4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lh{constructor(e,n,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Cn{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s!=null?s:Cn.RED,this.left=i!=null?i:xs.EMPTY_NODE,this.right=r!=null?r:xs.EMPTY_NODE}copy(e,n,s,i,r){return new Cn(e!=null?e:this.key,n!=null?n:this.value,s!=null?s:this.color,i!=null?i:this.left,r!=null?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return xs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let s,i;if(s=this,n(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(e,s.key)===0){if(s.right.isEmpty())return xs.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Cn.RED=!0;Cn.BLACK=!1;class DI{copy(e,n,s,i,r){return this}insert(e,n,s){return new Cn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class xs{constructor(e,n=xs.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new xs(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Cn.BLACK,null,null))}remove(e){return new xs(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Cn.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,i=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new lh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new lh(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new lh(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new lh(this.root_,null,this.comparator_,!0,e)}}xs.EMPTY_NODE=new DI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BI(t,e){return oa(t.name,e.name)}function hg(t,e){return oa(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m1;function FI(t){m1=t}const B4=function(t){return typeof t=="number"?"number:"+_4(t):"string:"+t},F4=function(t){if(t.isLeafNode()){const e=t.val();Be(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ui(e,".sv"),"Priority must be a string or number.")}else Be(t===m1||t.isEmpty(),"priority of unexpected type.");Be(t===m1||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Y2;class An{constructor(e,n=An.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Be(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),F4(this.priorityNode_)}static set __childrenNodeConstructor(e){Y2=e}static get __childrenNodeConstructor(){return Y2}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new An(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:An.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return bt(e)?this:vt(e)===".priority"?this.priorityNode_:An.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:An.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const s=vt(e);return s===null?n:n.isEmpty()&&s!==".priority"?this:(Be(s!==".priority"||jr(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,An.__childrenNodeConstructor.EMPTY_NODE.updateChild(Yt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+B4(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=_4(this.value_):e+=this.value_,this.lazyHash_=p4(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===An.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof An.__childrenNodeConstructor?-1:(Be(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,s=typeof this.value_,i=An.VALUE_TYPE_ORDER.indexOf(n),r=An.VALUE_TYPE_ORDER.indexOf(s);return Be(i>=0,"Unknown leaf type: "+n),Be(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}An.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let U4,j4;function UI(t){U4=t}function jI(t){j4=t}class HI extends _f{compare(e,n){const s=e.node.getPriority(),i=n.node.getPriority(),r=s.compareTo(i);return r===0?oa(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return wt.MIN}maxPost(){return new wt(qo,new An("[PRIORITY-POST]",j4))}makePost(e,n){const s=U4(e);return new wt(n,new An("[PRIORITY-POST]",s))}toString(){return".priority"}}const cn=new HI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VI=Math.log(2);class qI{constructor(e){const n=r=>parseInt(Math.log(r)/VI,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const hd=function(t,e,n,s){t.sort(e);const i=function(l,c){const d=c-l;let u,f;if(d===0)return null;if(d===1)return u=t[l],f=n?n(u):u,new Cn(f,u.node,Cn.BLACK,null,null);{const m=parseInt(d/2,10)+l,h=i(l,m),k=i(m+1,c);return u=t[m],f=n?n(u):u,new Cn(f,u.node,Cn.BLACK,h,k)}},r=function(l){let c=null,d=null,u=t.length;const f=function(h,k){const I=u-h,L=u;u-=h;const p=i(I+1,L),C=t[I],P=n?n(C):C;m(new Cn(P,C.node,k,null,p))},m=function(h){c?(c.left=h,c=h):(d=h,c=h)};for(let h=0;h<l.count;++h){const k=l.nextBitIsOne(),I=Math.pow(2,l.count-(h+1));k?f(I,Cn.BLACK):(f(I,Cn.BLACK),f(I,Cn.RED))}return d},o=new qI(t.length),a=r(o);return new xs(s||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Q0;const va={};class Ki{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return Be(va&&cn,"ChildrenNode.ts has not been loaded"),Q0=Q0||new Ki({".priority":va},{".priority":cn}),Q0}get(e){const n=Wa(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof xs?n:null}hasIndex(e){return Ui(this.indexSet_,e.toString())}addIndex(e,n){Be(e!==Ba,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=n.getIterator(wt.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=hd(s,e.getCompare()):a=va;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const d=Object.assign({},this.indexes_);return d[l]=a,new Ki(d,c)}addToIndexes(e,n){const s=od(this.indexes_,(i,r)=>{const o=Wa(this.indexSet_,r);if(Be(o,"Missing index implementation for "+r),i===va)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(wt.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),hd(a,o.getCompare())}else return va;else{const a=n.get(e.name);let l=i;return a&&(l=l.remove(new wt(e.name,a))),l.insert(e,e.node)}});return new Ki(s,this.indexSet_)}removeFromIndexes(e,n){const s=od(this.indexes_,i=>{if(i===va)return i;{const r=n.get(e.name);return r?i.remove(new wt(e.name,r)):i}});return new Ki(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hl;class it{constructor(e,n,s){this.children_=e,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&F4(this.priorityNode_),this.children_.isEmpty()&&Be(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Hl||(Hl=new it(new xs(hg),null,Ki.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Hl}updatePriority(e){return this.children_.isEmpty()?this:new it(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Hl:n}}getChild(e){const n=vt(e);return n===null?this:this.getImmediateChild(n).getChild(Yt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(Be(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const s=new wt(e,n);let i,r;n.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Hl:this.priorityNode_;return new it(i,o,r)}}updateChild(e,n){const s=vt(e);if(s===null)return n;{Be(vt(e)!==".priority"||jr(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(Yt(e),n);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let s=0,i=0,r=!0;if(this.forEachChild(cn,(o,a)=>{n[o]=a.val(e),s++,r&&it.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+B4(this.getPriority().val())+":"),this.forEachChild(cn,(n,s)=>{const i=s.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":p4(e)}return this.lazyHash_}getPredecessorChildName(e,n,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new wt(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new wt(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new wt(n,this.children_.get(n)):null}forEachChild(e,n){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,wt.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,wt.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===_u?-1:0}withIndex(e){if(e===Ba||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new it(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Ba||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const s=this.getIterator(cn),i=n.getIterator(cn);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ba?null:this.indexMap_.get(e.toString())}}it.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class $I extends it{constructor(){super(new xs(hg),it.EMPTY_NODE,Ki.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return it.EMPTY_NODE}isEmpty(){return!1}}const _u=new $I;Object.defineProperties(wt,{MIN:{value:new wt(Xa,it.EMPTY_NODE)},MAX:{value:new wt(qo,_u)}});D4.__EMPTY_NODE=it.EMPTY_NODE;An.__childrenNodeConstructor=it;FI(_u);jI(_u);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zI=!0;function En(t,e=null){if(t===null)return it.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),Be(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new An(n,En(e))}if(!(t instanceof Array)&&zI){const n=[];let s=!1;if(Gn(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=En(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new wt(o,l)))}}),n.length===0)return it.EMPTY_NODE;const r=hd(n,BI,o=>o.name,hg);if(s){const o=hd(n,cn.getCompare());return new it(r,En(e),new Ki({".priority":o},{".priority":cn}))}else return new it(r,En(e),Ki.Default)}else{let n=it.EMPTY_NODE;return Gn(t,(s,i)=>{if(Ui(t,s)&&s.substring(0,1)!=="."){const r=En(i);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(s,r))}}),n.updatePriority(En(e))}}UI(En);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KI extends _f{constructor(e){super(),this.indexPath_=e,Be(!bt(e)&&vt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const s=this.extractChild(e.node),i=this.extractChild(n.node),r=s.compareTo(i);return r===0?oa(e.name,n.name):r}makePost(e,n){const s=En(e),i=it.EMPTY_NODE.updateChild(this.indexPath_,s);return new wt(n,i)}maxPost(){const e=it.EMPTY_NODE.updateChild(this.indexPath_,_u);return new wt(qo,e)}toString(){return Mc(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GI extends _f{compare(e,n){const s=e.node.compareTo(n.node);return s===0?oa(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return wt.MIN}maxPost(){return wt.MAX}makePost(e,n){const s=En(e);return new wt(n,s)}toString(){return".value"}}const WI=new GI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H4(t){return{type:"value",snapshotNode:t}}function Qa(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Nc(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Oc(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function YI(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e){this.index_=e}updateChild(e,n,s,i,r,o){Be(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(Nc(n,a)):Be(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Qa(n,s)):o.trackChildChange(Oc(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(cn,(i,r)=>{n.hasChild(i)||s.trackChildChange(Nc(i,r))}),n.isLeafNode()||n.forEachChild(cn,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Oc(i,r,o))}else s.trackChildChange(Qa(i,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?it.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e){this.indexedFilter_=new dg(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Lc.getStartPost_(e),this.endPost_=Lc.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,n,s,i,r,o){return this.matches(new wt(n,s))||(s=it.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,i,r,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=it.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(it.EMPTY_NODE);const r=this;return n.forEachChild(cn,(o,a)=>{r.matches(new wt(o,a))||(i=i.updateImmediateChild(o,it.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e){this.rangedFilter_=new Lc(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,n,s,i,r,o){return this.rangedFilter_.matches(new wt(n,s))||(s=it.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,i,r,o):this.fullLimitUpdateChild_(e,n,s,r,o)}updateFullNode(e,n,s){let i;if(n.isLeafNode()||n.isEmpty())i=it.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=it.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();let l;if(this.reverse_?l=this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:l=this.index_.compare(a,this.rangedFilter_.getEndPost())<=0,l)i=i.updateImmediateChild(a.name,a.node),o++;else break}}else{i=n.withIndex(this.index_),i=i.updatePriority(it.EMPTY_NODE);let r,o,a,l;if(this.reverse_){l=i.getReverseIterator(this.index_),r=this.rangedFilter_.getEndPost(),o=this.rangedFilter_.getStartPost();const u=this.index_.getCompare();a=(f,m)=>u(m,f)}else l=i.getIterator(this.index_),r=this.rangedFilter_.getStartPost(),o=this.rangedFilter_.getEndPost(),a=this.index_.getCompare();let c=0,d=!1;for(;l.hasNext();){const u=l.getNext();!d&&a(r,u)<=0&&(d=!0),d&&c<this.limit_&&a(u,o)<=0?c++:i=i.updateImmediateChild(u.name,it.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,i,r){let o;if(this.reverse_){const u=this.index_.getCompare();o=(f,m)=>u(m,f)}else o=this.index_.getCompare();const a=e;Be(a.numChildren()===this.limit_,"");const l=new wt(n,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(n)){const u=a.getImmediateChild(n);let f=i.getChildAfterChild(this.index_,c,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=i.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:o(f,l);if(d&&!s.isEmpty()&&m>=0)return r!=null&&r.trackChildChange(Oc(n,s,u)),a.updateImmediateChild(n,s);{r!=null&&r.trackChildChange(Nc(n,u));const k=a.updateImmediateChild(n,it.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r!=null&&r.trackChildChange(Qa(f.name,f.node)),k.updateImmediateChild(f.name,f.node)):k}}else return s.isEmpty()?e:d&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Nc(c.name,c.node)),r.trackChildChange(Qa(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(c.name,it.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=cn}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Be(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Be(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Xa}hasEnd(){return this.endSet_}getIndexEndValue(){return Be(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Be(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:qo}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Be(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===cn}copy(){const e=new fg;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function QI(t){return t.loadsAllData()?new dg(t.getIndex()):t.hasLimit()?new XI(t):new Lc(t)}function X2(t){const e={};if(t.isDefault())return e;let n;return t.index_===cn?n="$priority":t.index_===WI?n="$value":t.index_===Ba?n="$key":(Be(t.index_ instanceof KI,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=kn(n),t.startSet_&&(e.startAt=kn(t.indexStartValue_),t.startNameSet_&&(e.startAt+=","+kn(t.indexStartName_))),t.endSet_&&(e.endAt=kn(t.indexEndValue_),t.endNameSet_&&(e.endAt+=","+kn(t.indexEndName_))),t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Q2(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_)),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_)),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==cn&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd extends N4{constructor(e,n,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=gu("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(Be(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=dd.getListenId_(e,s),a={};this.listens_[o]=a;const l=X2(e._queryParams);this.restRequest_(r+".json",l,(c,d)=>{let u=d;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,s),Wa(this.listens_,o)===a){let f;c?c===401?f="permission_denied":f="rest_error:"+c:f="ok",i(f,null)}})}unlisten(e,n){const s=dd.getListenId_(e,n);delete this.listens_[s]}get(e){const n=X2(e._queryParams),s=e._path.toString(),i=new $i;return this.restRequest_(s+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(n.auth=i.accessToken),r&&r.token&&(n.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+$R(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=kc(a.responseText)}catch{Ts("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&Ts("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(){this.rootNode_=it.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(){return{value:null,children:new Map}}function bl(t,e,n){if(bt(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const s=vt(e);t.children.has(s)||t.children.set(s,fd());const i=t.children.get(s);e=Yt(e),bl(i,e,n)}}function p1(t,e){if(bt(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(cn,(s,i)=>{bl(t,new Vt(s),i)}),p1(t,e)}}else if(t.children.size>0){const n=vt(e);return e=Yt(e),t.children.has(n)&&p1(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function g1(t,e,n){t.value!==null?n(e,t.value):JI(t,(s,i)=>{const r=new Vt(e.toString()+"/"+s);g1(i,r,n)})}function JI(t,e){t.children.forEach((n,s)=>{e(s,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e9{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Gn(this.last_,(s,i)=>{n[s]=n[s]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2=10*1e3,t9=30*1e3,n9=5*60*1e3;class s9{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new e9(e);const s=Z2+(t9-Z2)*Math.random();dc(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),n={};let s=!1;Gn(e,(i,r)=>{r>0&&Ui(this.statsToReport_,i)&&(n[i]=r,s=!0)}),s&&this.server_.reportStats(n),dc(this.reportStats_.bind(this),Math.floor(Math.random()*2*n9))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var di;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(di||(di={}));function V4(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function mg(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function pg(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=di.ACK_USER_WRITE,this.source=V4()}operationForChild(e){if(bt(this.path)){if(this.affectedTree.value!=null)return Be(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Vt(e));return new md(Ot(),n,this.revert)}}else return Be(vt(this.path)===e,"operationForChild called for unrelated child."),new md(Yt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc{constructor(e,n){this.source=e,this.path=n,this.type=di.LISTEN_COMPLETE}operationForChild(e){return bt(this.path)?new Pc(this.source,Ot()):new Pc(this.source,Yt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=di.OVERWRITE}operationForChild(e){return bt(this.path)?new $o(this.source,Ot(),this.snap.getImmediateChild(e)):new $o(this.source,Yt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=di.MERGE}operationForChild(e){if(bt(this.path)){const n=this.children.subtree(new Vt(e));return n.isEmpty()?null:n.value?new $o(this.source,Ot(),n.value):new Dc(this.source,Ot(),n)}else return Be(vt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Dc(this.source,Yt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(bt(e))return this.isFullyInitialized()&&!this.filtered_;const n=vt(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i9{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function r9(t,e,n,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(YI(o.childName,o.snapshotNode))}),Vl(t,i,"child_removed",e,s,n),Vl(t,i,"child_added",e,s,n),Vl(t,i,"child_moved",r,s,n),Vl(t,i,"child_changed",e,s,n),Vl(t,i,"value",e,s,n),i}function Vl(t,e,n,s,i,r){const o=s.filter(a=>a.type===n);o.sort((a,l)=>a9(t,a,l)),o.forEach(a=>{const l=o9(t,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function o9(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function a9(t,e,n){if(e.childName==null||n.childName==null)throw _l("Should only compare child_ events.");const s=new wt(e.childName,e.snapshotNode),i=new wt(n.childName,n.snapshotNode);return t.index_.compare(s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vf(t,e){return{eventCache:t,serverCache:e}}function fc(t,e,n,s){return vf(new zo(e,n,s),t.serverCache)}function q4(t,e,n,s){return vf(t.eventCache,new zo(e,n,s))}function _1(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ko(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Z0;const l9=()=>(Z0||(Z0=new xs(qC)),Z0);class tn{constructor(e,n=l9()){this.value=e,this.children=n}static fromObject(e){let n=new tn(null);return Gn(e,(s,i)=>{n=n.set(new Vt(s),i)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Ot(),value:this.value};if(bt(e))return null;{const s=vt(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(Yt(e),n);return r!=null?{path:pn(new Vt(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(bt(e))return this;{const n=vt(e),s=this.children.get(n);return s!==null?s.subtree(Yt(e)):new tn(null)}}set(e,n){if(bt(e))return new tn(n,this.children);{const s=vt(e),r=(this.children.get(s)||new tn(null)).set(Yt(e),n),o=this.children.insert(s,r);return new tn(this.value,o)}}remove(e){if(bt(e))return this.children.isEmpty()?new tn(null):new tn(null,this.children);{const n=vt(e),s=this.children.get(n);if(s){const i=s.remove(Yt(e));let r;return i.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,i),this.value===null&&r.isEmpty()?new tn(null):new tn(this.value,r)}else return this}}get(e){if(bt(e))return this.value;{const n=vt(e),s=this.children.get(n);return s?s.get(Yt(e)):null}}setTree(e,n){if(bt(e))return n;{const s=vt(e),r=(this.children.get(s)||new tn(null)).setTree(Yt(e),n);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new tn(this.value,o)}}fold(e){return this.fold_(Ot(),e)}fold_(e,n){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(pn(e,i),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,Ot(),n)}findOnPath_(e,n,s){const i=this.value?s(n,this.value):!1;if(i)return i;if(bt(e))return null;{const r=vt(e),o=this.children.get(r);return o?o.findOnPath_(Yt(e),pn(n,r),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Ot(),n)}foreachOnPath_(e,n,s){if(bt(e))return this;{this.value&&s(n,this.value);const i=vt(e),r=this.children.get(i);return r?r.foreachOnPath_(Yt(e),pn(n,i),s):new tn(null)}}foreach(e){this.foreach_(Ot(),e)}foreach_(e,n){this.children.inorderTraversal((s,i)=>{i.foreach_(pn(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e){this.writeTree_=e}static empty(){return new pi(new tn(null))}}function mc(t,e,n){if(bt(e))return new pi(new tn(n));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=Es(i,e);return r=r.updateChild(o,n),new pi(t.writeTree_.set(i,r))}else{const i=new tn(n),r=t.writeTree_.setTree(e,i);return new pi(r)}}}function J2(t,e,n){let s=t;return Gn(n,(i,r)=>{s=mc(s,pn(e,i),r)}),s}function ey(t,e){if(bt(e))return pi.empty();{const n=t.writeTree_.setTree(e,new tn(null));return new pi(n)}}function v1(t,e){return aa(t,e)!=null}function aa(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Es(n.path,e)):null}function ty(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(cn,(s,i)=>{e.push(new wt(s,i))}):t.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new wt(s,i.value))}),e}function Mr(t,e){if(bt(e))return t;{const n=aa(t,e);return n!=null?new pi(new tn(n)):new pi(t.writeTree_.subtree(e))}}function y1(t){return t.writeTree_.isEmpty()}function Za(t,e){return $4(Ot(),t.writeTree_,e)}function $4(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(Be(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):n=$4(pn(t,i),r,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(pn(t,".priority"),s)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(t,e){return W4(e,t)}function c9(t,e,n,s,i){Be(s>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:i}),i&&(t.visibleWrites=mc(t.visibleWrites,e,n)),t.lastWriteId=s}function u9(t,e){for(let n=0;n<t.allWrites.length;n++){const s=t.allWrites[n];if(s.writeId===e)return s}return null}function h9(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);Be(n>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[n];t.allWrites.splice(n,1);let i=s.visible,r=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&d9(a,s.path)?i=!1:Js(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return f9(t),!0;if(s.snap)t.visibleWrites=ey(t.visibleWrites,s.path);else{const a=s.children;Gn(a,l=>{t.visibleWrites=ey(t.visibleWrites,pn(s.path,l))})}return!0}else return!1}function d9(t,e){if(t.snap)return Js(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Js(pn(t.path,n),e))return!0;return!1}function f9(t){t.visibleWrites=z4(t.allWrites,m9,Ot()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function m9(t){return t.visible}function z4(t,e,n){let s=pi.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const o=r.path;let a;if(r.snap)Js(n,o)?(a=Es(n,o),s=mc(s,a,r.snap)):Js(o,n)&&(a=Es(o,n),s=mc(s,Ot(),r.snap.getChild(a)));else if(r.children){if(Js(n,o))a=Es(n,o),s=J2(s,a,r.children);else if(Js(o,n))if(a=Es(o,n),bt(a))s=J2(s,Ot(),r.children);else{const l=Wa(r.children,vt(a));if(l){const c=l.getChild(Yt(a));s=mc(s,Ot(),c)}}}else throw _l("WriteRecord should have .snap or .children")}}return s}function K4(t,e,n,s,i){if(!s&&!i){const r=aa(t.visibleWrites,e);if(r!=null)return r;{const o=Mr(t.visibleWrites,e);if(y1(o))return n;if(n==null&&!v1(o,Ot()))return null;{const a=n||it.EMPTY_NODE;return Za(o,a)}}}else{const r=Mr(t.visibleWrites,e);if(!i&&y1(r))return n;if(!i&&n==null&&!v1(r,Ot()))return null;{const o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(Js(c.path,e)||Js(e,c.path))},a=z4(t.allWrites,o,e),l=n||it.EMPTY_NODE;return Za(a,l)}}}function p9(t,e,n){let s=it.EMPTY_NODE;const i=aa(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(cn,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(n){const r=Mr(t.visibleWrites,e);return n.forEachChild(cn,(o,a)=>{const l=Za(Mr(r,new Vt(o)),a);s=s.updateImmediateChild(o,l)}),ty(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=Mr(t.visibleWrites,e);return ty(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function g9(t,e,n,s,i){Be(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=pn(e,n);if(v1(t.visibleWrites,r))return null;{const o=Mr(t.visibleWrites,r);return y1(o)?i.getChild(n):Za(o,i.getChild(n))}}function _9(t,e,n,s){const i=pn(e,n),r=aa(t.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(n)){const o=Mr(t.visibleWrites,i);return Za(o,s.getNode().getImmediateChild(n))}else return null}function v9(t,e){return aa(t.visibleWrites,e)}function y9(t,e,n,s,i,r,o){let a;const l=Mr(t.visibleWrites,e),c=aa(l,Ot());if(c!=null)a=c;else if(n!=null)a=Za(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const d=[],u=o.getCompare(),f=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let m=f.getNext();for(;m&&d.length<i;)u(m,s)!==0&&d.push(m),m=f.getNext();return d}else return[]}function b9(){return{visibleWrites:pi.empty(),allWrites:[],lastWriteId:-1}}function pd(t,e,n,s){return K4(t.writeTree,t.treePath,e,n,s)}function _g(t,e){return p9(t.writeTree,t.treePath,e)}function ny(t,e,n,s){return g9(t.writeTree,t.treePath,e,n,s)}function gd(t,e){return v9(t.writeTree,pn(t.treePath,e))}function w9(t,e,n,s,i,r){return y9(t.writeTree,t.treePath,e,n,s,i,r)}function vg(t,e,n){return _9(t.writeTree,t.treePath,e,n)}function G4(t,e){return W4(pn(t.treePath,e),t.writeTree)}function W4(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,s=e.childName;Be(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),Be(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(s,Oc(s,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(s,Nc(s,i.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(s,Qa(s,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(s,Oc(s,e.snapshotNode,i.oldSnap));else throw _l("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x9{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}}const Y4=new x9;class yg{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new zo(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return vg(this.writes_,e,s)}}getChildAfterChild(e,n,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ko(this.viewCache_),r=w9(this.writes_,i,n,1,s,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T9(t){return{filter:t}}function S9(t,e){Be(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Be(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function A9(t,e,n,s,i){const r=new E9;let o,a;if(n.type===di.OVERWRITE){const c=n;c.source.fromUser?o=b1(t,e,c.path,c.snap,s,i,r):(Be(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!bt(c.path),o=_d(t,e,c.path,c.snap,s,i,a,r))}else if(n.type===di.MERGE){const c=n;c.source.fromUser?o=C9(t,e,c.path,c.children,s,i,r):(Be(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=w1(t,e,c.path,c.children,s,i,a,r))}else if(n.type===di.ACK_USER_WRITE){const c=n;c.revert?o=M9(t,e,c.path,s,i,r):o=I9(t,e,c.path,c.affectedTree,s,i,r)}else if(n.type===di.LISTEN_COMPLETE)o=k9(t,e,n.path,s,r);else throw _l("Unknown operation type: "+n.type);const l=r.getChanges();return R9(e,o,l),{viewCache:o,changes:l}}function R9(t,e,n){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=_1(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&n.push(H4(_1(e)))}}function X4(t,e,n,s,i,r){const o=e.eventCache;if(gd(s,n)!=null)return e;{let a,l;if(bt(n))if(Be(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Ko(e),d=c instanceof it?c:it.EMPTY_NODE,u=_g(s,d);a=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const c=pd(s,Ko(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=vt(n);if(c===".priority"){Be(jr(n)===1,"Can't have a priority with additional path components");const d=o.getNode();l=e.serverCache.getNode();const u=ny(s,n,d,l);u!=null?a=t.filter.updatePriority(d,u):a=o.getNode()}else{const d=Yt(n);let u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const f=ny(s,n,o.getNode(),l);f!=null?u=o.getNode().getImmediateChild(c).updateChild(d,f):u=o.getNode().getImmediateChild(c)}else u=vg(s,c,e.serverCache);u!=null?a=t.filter.updateChild(o.getNode(),c,u,d,i,r):a=o.getNode()}}return fc(e,a,o.isFullyInitialized()||bt(n),t.filter.filtersNodes())}}function _d(t,e,n,s,i,r,o,a){const l=e.serverCache;let c;const d=o?t.filter:t.filter.getIndexedFilter();if(bt(n))c=d.updateFullNode(l.getNode(),s,null);else if(d.filtersNodes()&&!l.isFiltered()){const m=l.getNode().updateChild(n,s);c=d.updateFullNode(l.getNode(),m,null)}else{const m=vt(n);if(!l.isCompleteForPath(n)&&jr(n)>1)return e;const h=Yt(n),I=l.getNode().getImmediateChild(m).updateChild(h,s);m===".priority"?c=d.updatePriority(l.getNode(),I):c=d.updateChild(l.getNode(),m,I,h,Y4,null)}const u=q4(e,c,l.isFullyInitialized()||bt(n),d.filtersNodes()),f=new yg(i,u,r);return X4(t,u,n,i,f,a)}function b1(t,e,n,s,i,r,o){const a=e.eventCache;let l,c;const d=new yg(i,e,r);if(bt(n))c=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=fc(e,c,!0,t.filter.filtersNodes());else{const u=vt(n);if(u===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),s),l=fc(e,c,a.isFullyInitialized(),a.isFiltered());else{const f=Yt(n),m=a.getNode().getImmediateChild(u);let h;if(bt(f))h=s;else{const k=d.getCompleteChild(u);k!=null?lg(f)===".priority"&&k.getChild(L4(f)).isEmpty()?h=k:h=k.updateChild(f,s):h=it.EMPTY_NODE}if(m.equals(h))l=e;else{const k=t.filter.updateChild(a.getNode(),u,h,f,d,o);l=fc(e,k,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function sy(t,e){return t.eventCache.isCompleteForChild(e)}function C9(t,e,n,s,i,r,o){let a=e;return s.foreach((l,c)=>{const d=pn(n,l);sy(e,vt(d))&&(a=b1(t,a,d,c,i,r,o))}),s.foreach((l,c)=>{const d=pn(n,l);sy(e,vt(d))||(a=b1(t,a,d,c,i,r,o))}),a}function iy(t,e,n){return n.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function w1(t,e,n,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;bt(n)?c=s:c=new tn(null).setTree(n,s);const d=e.serverCache.getNode();return c.children.inorderTraversal((u,f)=>{if(d.hasChild(u)){const m=e.serverCache.getNode().getImmediateChild(u),h=iy(t,m,f);l=_d(t,l,new Vt(u),h,i,r,o,a)}}),c.children.inorderTraversal((u,f)=>{const m=!e.serverCache.isCompleteForChild(u)&&f.value===void 0;if(!d.hasChild(u)&&!m){const h=e.serverCache.getNode().getImmediateChild(u),k=iy(t,h,f);l=_d(t,l,new Vt(u),k,i,r,o,a)}}),l}function I9(t,e,n,s,i,r,o){if(gd(i,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(bt(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return _d(t,e,n,l.getNode().getChild(n),i,r,a,o);if(bt(n)){let c=new tn(null);return l.getNode().forEachChild(Ba,(d,u)=>{c=c.set(new Vt(d),u)}),w1(t,e,n,c,i,r,a,o)}else return e}else{let c=new tn(null);return s.foreach((d,u)=>{const f=pn(n,d);l.isCompleteForPath(f)&&(c=c.set(d,l.getNode().getChild(f)))}),w1(t,e,n,c,i,r,a,o)}}function k9(t,e,n,s,i){const r=e.serverCache,o=q4(e,r.getNode(),r.isFullyInitialized()||bt(n),r.isFiltered());return X4(t,o,n,s,Y4,i)}function M9(t,e,n,s,i,r){let o;if(gd(s,n)!=null)return e;{const a=new yg(s,e,i),l=e.eventCache.getNode();let c;if(bt(n)||vt(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=pd(s,Ko(e));else{const u=e.serverCache.getNode();Be(u instanceof it,"serverChildren would be complete if leaf node"),d=_g(s,u)}d=d,c=t.filter.updateFullNode(l,d,r)}else{const d=vt(n);let u=vg(s,d,e.serverCache);u==null&&e.serverCache.isCompleteForChild(d)&&(u=l.getImmediateChild(d)),u!=null?c=t.filter.updateChild(l,d,u,Yt(n),a,r):e.eventCache.getNode().hasChild(d)?c=t.filter.updateChild(l,d,it.EMPTY_NODE,Yt(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=pd(s,Ko(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||gd(s,Ot())!=null,fc(e,c,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N9{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new dg(s.getIndex()),r=QI(s);this.processor_=T9(r);const o=n.serverCache,a=n.eventCache,l=i.updateFullNode(it.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(it.EMPTY_NODE,a.getNode(),null),d=new zo(l,o.isFullyInitialized(),i.filtersNodes()),u=new zo(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=vf(u,d),this.eventGenerator_=new i9(this.query_)}get query(){return this.query_}}function O9(t){return t.viewCache_.serverCache.getNode()}function L9(t,e){const n=Ko(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!bt(e)&&!n.getImmediateChild(vt(e)).isEmpty())?n.getChild(e):null}function ry(t){return t.eventRegistrations_.length===0}function P9(t,e){t.eventRegistrations_.push(e)}function oy(t,e,n){const s=[];if(n){Be(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(n,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){const o=t.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return s}function ay(t,e,n,s){e.type===di.MERGE&&e.source.queryId!==null&&(Be(Ko(t.viewCache_),"We should always have a full cache before handling merges"),Be(_1(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=A9(t.processor_,i,e,n,s);return S9(t.processor_,r.viewCache),Be(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Q4(t,r.changes,r.viewCache.eventCache.getNode(),null)}function D9(t,e){const n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(cn,(r,o)=>{s.push(Qa(r,o))}),n.isFullyInitialized()&&s.push(H4(n.getNode())),Q4(t,s,n.getNode(),e)}function Q4(t,e,n,s){const i=s?[s]:t.eventRegistrations_;return r9(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vd;class B9{constructor(){this.views=new Map}}function F9(t){Be(!vd,"__referenceConstructor has already been defined"),vd=t}function U9(){return Be(vd,"Reference.ts has not been loaded"),vd}function j9(t){return t.views.size===0}function bg(t,e,n,s){const i=e.source.queryId;if(i!==null){const r=t.views.get(i);return Be(r!=null,"SyncTree gave us an op for an invalid query."),ay(r,e,n,s)}else{let r=[];for(const o of t.views.values())r=r.concat(ay(o,e,n,s));return r}}function H9(t,e,n,s,i){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=pd(n,i?s:null),l=!1;a?l=!0:s instanceof it?(a=_g(n,s),l=!1):(a=it.EMPTY_NODE,l=!1);const c=vf(new zo(a,l,!1),new zo(s,i,!1));return new N9(e,c)}return o}function V9(t,e,n,s,i,r){const o=H9(t,e,s,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),P9(o,n),D9(o,n)}function q9(t,e,n,s){const i=e._queryIdentifier,r=[];let o=[];const a=Hr(t);if(i==="default")for(const[l,c]of t.views.entries())o=o.concat(oy(c,n,s)),ry(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=t.views.get(i);l&&(o=o.concat(oy(l,n,s)),ry(l)&&(t.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!Hr(t)&&r.push(new(U9())(e._repo,e._path)),{removed:r,events:o}}function Z4(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Fa(t,e){let n=null;for(const s of t.views.values())n=n||L9(s,e);return n}function J4(t,e){if(e._queryParams.loadsAllData())return yf(t);{const s=e._queryIdentifier;return t.views.get(s)}}function eE(t,e){return J4(t,e)!=null}function Hr(t){return yf(t)!=null}function yf(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yd;function $9(t){Be(!yd,"__referenceConstructor has already been defined"),yd=t}function z9(){return Be(yd,"Reference.ts has not been loaded"),yd}let K9=1;class ly{constructor(e){this.listenProvider_=e,this.syncPointTree_=new tn(null),this.pendingWriteTree_=b9(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function tE(t,e,n,s,i){return c9(t.pendingWriteTree_,e,n,s,i),i?vu(t,new $o(V4(),e,n)):[]}function Ro(t,e,n=!1){const s=u9(t.pendingWriteTree_,e);if(h9(t.pendingWriteTree_,e)){let r=new tn(null);return s.snap!=null?r=r.set(Ot(),!0):Gn(s.children,o=>{r=r.set(new Vt(o),!0)}),vu(t,new md(s.path,r,n))}else return[]}function bf(t,e,n){return vu(t,new $o(mg(),e,n))}function G9(t,e,n){const s=tn.fromObject(n);return vu(t,new Dc(mg(),e,s))}function W9(t,e){return vu(t,new Pc(mg(),e))}function Y9(t,e,n){const s=Eg(t,n);if(s){const i=xg(s),r=i.path,o=i.queryId,a=Es(r,e),l=new Pc(pg(o),a);return Tg(t,r,l)}else return[]}function E1(t,e,n,s){const i=e._path,r=t.syncPointTree_.get(i);let o=[];if(r&&(e._queryIdentifier==="default"||eE(r,e))){const a=q9(r,e,n,s);j9(r)&&(t.syncPointTree_=t.syncPointTree_.remove(i));const l=a.removed;o=a.events;const c=l.findIndex(u=>u._queryParams.loadsAllData())!==-1,d=t.syncPointTree_.findOnPath(i,(u,f)=>Hr(f));if(c&&!d){const u=t.syncPointTree_.subtree(i);if(!u.isEmpty()){const f=Z9(u);for(let m=0;m<f.length;++m){const h=f[m],k=h.query,I=iE(t,h);t.listenProvider_.startListening(pc(k),bd(t,k),I.hashFn,I.onComplete)}}}!d&&l.length>0&&!s&&(c?t.listenProvider_.stopListening(pc(e),null):l.forEach(u=>{const f=t.queryToTagMap.get(wf(u));t.listenProvider_.stopListening(pc(u),f)})),J9(t,l)}return o}function X9(t,e,n,s){const i=Eg(t,s);if(i!=null){const r=xg(i),o=r.path,a=r.queryId,l=Es(o,e),c=new $o(pg(a),l,n);return Tg(t,o,c)}else return[]}function Q9(t,e,n,s){const i=Eg(t,s);if(i){const r=xg(i),o=r.path,a=r.queryId,l=Es(o,e),c=tn.fromObject(n),d=new Dc(pg(a),l,c);return Tg(t,o,d)}else return[]}function cy(t,e,n){const s=e._path;let i=null,r=!1;t.syncPointTree_.foreachOnPath(s,(u,f)=>{const m=Es(u,s);i=i||Fa(f,m),r=r||Hr(f)});let o=t.syncPointTree_.get(s);o?(r=r||Hr(o),i=i||Fa(o,Ot())):(o=new B9,t.syncPointTree_=t.syncPointTree_.set(s,o));let a;i!=null?a=!0:(a=!1,i=it.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((f,m)=>{const h=Fa(m,Ot());h&&(i=i.updateImmediateChild(f,h))}));const l=eE(o,e);if(!l&&!e._queryParams.loadsAllData()){const u=wf(e);Be(!t.queryToTagMap.has(u),"View does not exist, but we have a tag");const f=ek();t.queryToTagMap.set(u,f),t.tagToQueryMap.set(f,u)}const c=gg(t.pendingWriteTree_,s);let d=V9(o,e,n,c,i,a);if(!l&&!r){const u=J4(o,e);d=d.concat(tk(t,e,u))}return d}function wg(t,e,n){const i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=Es(o,e),c=Fa(a,l);if(c)return c});return K4(i,e,r,n,!0)}function vu(t,e){return nE(e,t.syncPointTree_,null,gg(t.pendingWriteTree_,Ot()))}function nE(t,e,n,s){if(bt(t.path))return sE(t,e,n,s);{const i=e.get(Ot());n==null&&i!=null&&(n=Fa(i,Ot()));let r=[];const o=vt(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,d=G4(s,o);r=r.concat(nE(a,l,c,d))}return i&&(r=r.concat(bg(i,t,s,n))),r}}function sE(t,e,n,s){const i=e.get(Ot());n==null&&i!=null&&(n=Fa(i,Ot()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=G4(s,o),d=t.operationForChild(o);d&&(r=r.concat(sE(d,a,l,c)))}),i&&(r=r.concat(bg(i,t,s,n))),r}function iE(t,e){const n=e.query,s=bd(t,n);return{hashFn:()=>(O9(e)||it.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?Y9(t,n._path,s):W9(t,n._path);{const r=KC(i,n);return E1(t,n,null,r)}}}}function bd(t,e){const n=wf(e);return t.queryToTagMap.get(n)}function wf(t){return t._path.toString()+"$"+t._queryIdentifier}function Eg(t,e){return t.tagToQueryMap.get(e)}function xg(t){const e=t.indexOf("$");return Be(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Vt(t.substr(0,e))}}function Tg(t,e,n){const s=t.syncPointTree_.get(e);Be(s,"Missing sync point for query tag that we're tracking");const i=gg(t.pendingWriteTree_,e);return bg(s,n,i,null)}function Z9(t){return t.fold((e,n,s)=>{if(n&&Hr(n))return[yf(n)];{let i=[];return n&&(i=Z4(n)),Gn(s,(r,o)=>{i=i.concat(o)}),i}})}function pc(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(z9())(t._repo,t._path):t}function J9(t,e){for(let n=0;n<e.length;++n){const s=e[n];if(!s._queryParams.loadsAllData()){const i=wf(s),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function ek(){return K9++}function tk(t,e,n){const s=e._path,i=bd(t,e),r=iE(t,n),o=t.listenProvider_.startListening(pc(e),i,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(s);if(i)Be(!Hr(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,d,u)=>{if(!bt(c)&&d&&Hr(d))return[yf(d).query];{let f=[];return d&&(f=f.concat(Z4(d).map(m=>m.query))),Gn(u,(m,h)=>{f=f.concat(h)}),f}});for(let c=0;c<l.length;++c){const d=l[c];t.listenProvider_.stopListening(pc(d),bd(t,d))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Sg(n)}node(){return this.node_}}class Ag{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=pn(this.path_,e);return new Ag(this.syncTree_,n)}node(){return wg(this.syncTree_,this.path_)}}const nk=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},uy=function(t,e,n){if(!t||typeof t!="object")return t;if(Be(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return sk(t[".sv"],e,n);if(typeof t[".sv"]=="object")return ik(t[".sv"],e);Be(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},sk=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Be(!1,"Unexpected server value: "+t)}},ik=function(t,e,n){t.hasOwnProperty("increment")||Be(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&Be(!1,"Unexpected increment value: "+s);const i=e.node();if(Be(i!==null&&typeof i!="undefined","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},rk=function(t,e,n,s){return Rg(e,new Ag(n,t),s)},rE=function(t,e,n){return Rg(t,new Sg(e),n)};function Rg(t,e,n){const s=t.getPriority().val(),i=uy(s,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const o=t,a=uy(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new An(a,En(i)):t}else{const o=t;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new An(i))),o.forEachChild(cn,(a,l)=>{const c=Rg(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}}function Ig(t,e){let n=e instanceof Vt?e:new Vt(e),s=t,i=vt(n);for(;i!==null;){const r=Wa(s.node.children,i)||{children:{},childCount:0};s=new Cg(i,s,r),n=Yt(n),i=vt(n)}return s}function wl(t){return t.node.value}function oE(t,e){t.node.value=e,x1(t)}function aE(t){return t.node.childCount>0}function ok(t){return wl(t)===void 0&&!aE(t)}function Ef(t,e){Gn(t.node.children,(n,s)=>{e(new Cg(n,t,s))})}function lE(t,e,n,s){n&&!s&&e(t),Ef(t,i=>{lE(i,e,!0,s)}),n&&s&&e(t)}function ak(t,e,n){let s=n?t:t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function yu(t){return new Vt(t.parent===null?t.name:yu(t.parent)+"/"+t.name)}function x1(t){t.parent!==null&&lk(t.parent,t.name,t)}function lk(t,e,n){const s=ok(n),i=Ui(t.node.children,e);s&&i?(delete t.node.children[e],t.node.childCount--,x1(t)):!s&&!i&&(t.node.children[e]=n.node,t.node.childCount++,x1(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck=/[\[\].#$\/\u0000-\u001F\u007F]/,uk=/[\[\].#$\u0000-\u001F\u007F]/,J0=10*1024*1024,kg=function(t){return typeof t=="string"&&t.length!==0&&!ck.test(t)},cE=function(t){return typeof t=="string"&&t.length!==0&&!uk.test(t)},hk=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),cE(t)},uE=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!gf(t)||t&&typeof t=="object"&&Ui(t,".sv")},T1=function(t,e,n,s){s&&e===void 0||xf(Ya(t,"value"),e,n)},xf=function(t,e,n){const s=n instanceof Vt?new CI(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+po(s));if(typeof e=="function")throw new Error(t+"contains a function "+po(s)+" with contents = "+e.toString());if(gf(e))throw new Error(t+"contains "+e.toString()+" "+po(s));if(typeof e=="string"&&e.length>J0/3&&pf(e)>J0)throw new Error(t+"contains a string greater than "+J0+" utf8 bytes "+po(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(Gn(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!kg(o)))throw new Error(t+" contains an invalid key ("+o+") "+po(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);II(s,o),xf(t,a,s),kI(s)}),i&&r)throw new Error(t+' contains ".value" child '+po(s)+" in addition to actual children.")}},dk=function(t,e){let n,s;for(n=0;n<e.length;n++){s=e[n];const r=Mc(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!kg(r[o]))throw new Error(t+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(RI);let i=null;for(n=0;n<e.length;n++){if(s=e[n],i!==null&&Js(i,s))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},fk=function(t,e,n,s){if(s&&e===void 0)return;const i=Ya(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];Gn(e,(o,a)=>{const l=new Vt(o);if(xf(i,a,pn(n,l)),lg(l)===".priority"&&!uE(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),dk(i,r)},mk=function(t,e,n){if(!(n&&e===void 0)){if(gf(e))throw new Error(Ya(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!uE(e))throw new Error(Ya(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},hE=function(t,e,n,s){if(!(s&&n===void 0)&&!cE(n))throw new Error(Ya(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},pk=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),hE(t,e,n,s)},Jl=function(t,e){if(vt(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},gk=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!kg(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!hk(n))throw new Error(Ya(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Mg(t,e){let n=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();n!==null&&!cg(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(i)}n&&t.eventLists_.push(n)}function dE(t,e,n){Mg(t,n),fE(t,s=>cg(s,e))}function sr(t,e,n){Mg(t,n),fE(t,s=>Js(s,e)||Js(e,s))}function fE(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){const i=t.eventLists_[s];if(i){const r=i.path;e(r)?(vk(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function vk(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const s=n.getEventRunner();Po&&Ln("event: "+n.toString()),yl(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yk="repo_interrupt",bk=25;class wk{constructor(e,n,s,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new _k,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=fd(),this.transactionQueueTree_=new Cg,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ek(t,e,n){if(t.stats_=rg(t.repoInfo_),t.forceRestClient_||XC())t.server_=new dd(t.repoInfo_,(s,i,r,o)=>{hy(t,s,i,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>dy(t,!0),0);else{if(typeof n!="undefined"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{kn(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Xi(t.repoInfo_,e,(s,i,r,o)=>{hy(t,s,i,r,o)},s=>{dy(t,s)},s=>{Tk(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=sI(t.repoInfo_,()=>new s9(t.stats_,t.server_)),t.infoData_=new ZI,t.infoSyncTree_=new ly({startListening:(s,i,r,o)=>{let a=[];const l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=bf(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Og(t,"connected",!1),t.serverSyncTree_=new ly({startListening:(s,i,r,o)=>(t.server_.listen(s,r,i,(a,l)=>{const c=o(a,l);sr(t.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{t.server_.unlisten(s,i)}})}function xk(t){const n=t.infoData_.getNode(new Vt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function Ng(t){return nk({timestamp:xk(t)})}function hy(t,e,n,s,i){t.dataUpdateCount++;const r=new Vt(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(s){const l=od(n,c=>En(c));o=Q9(t.serverSyncTree_,r,l,i)}else{const l=En(n);o=X9(t.serverSyncTree_,r,l,i)}else if(s){const l=od(n,c=>En(c));o=G9(t.serverSyncTree_,r,l)}else{const l=En(n);o=bf(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Tf(t,r)),sr(t.eventQueue_,a,o)}function dy(t,e){Og(t,"connected",e),e===!1&&Ak(t)}function Tk(t,e){Gn(e,(n,s)=>{Og(t,n,s)})}function Og(t,e,n){const s=new Vt("/.info/"+e),i=En(n);t.infoData_.updateSnapshot(s,i);const r=bf(t.infoSyncTree_,s,i);sr(t.eventQueue_,s,r)}function mE(t){return t.nextWriteId_++}function Sk(t,e,n,s,i){Lg(t,"set",{path:e.toString(),value:n,priority:s});const r=Ng(t),o=En(n,s),a=wg(t.serverSyncTree_,e),l=rE(o,a,r),c=mE(t),d=tE(t.serverSyncTree_,e,l,c,!0);Mg(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(f,m)=>{const h=f==="ok";h||Ts("set at "+e+" failed: "+f);const k=Ro(t.serverSyncTree_,c,!h);sr(t.eventQueue_,e,k),Ja(t,i,f,m)});const u=yE(t,e);Tf(t,u),sr(t.eventQueue_,u,[])}function Ak(t){Lg(t,"onDisconnectEvents");const e=Ng(t),n=fd();g1(t.onDisconnect_,Ot(),(i,r)=>{const o=rk(i,r,t.serverSyncTree_,e);bl(n,i,o)});let s=[];g1(n,Ot(),(i,r)=>{s=s.concat(bf(t.serverSyncTree_,i,r));const o=yE(t,i);Tf(t,o)}),t.onDisconnect_=fd(),sr(t.eventQueue_,Ot(),s)}function Rk(t,e,n){t.server_.onDisconnectCancel(e.toString(),(s,i)=>{s==="ok"&&p1(t.onDisconnect_,e),Ja(t,n,s,i)})}function fy(t,e,n,s){const i=En(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{r==="ok"&&bl(t.onDisconnect_,e,i),Ja(t,s,r,o)})}function Ck(t,e,n,s,i){const r=En(n,s);t.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&bl(t.onDisconnect_,e,r),Ja(t,i,o,a)})}function Ik(t,e,n,s){if(o1(n)){Ln("onDisconnect().update() called with empty data.  Don't do anything."),Ja(t,s,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(i,r)=>{i==="ok"&&Gn(n,(o,a)=>{const l=En(a);bl(t.onDisconnect_,pn(e,o),l)}),Ja(t,s,i,r)})}function kk(t,e,n){let s;vt(e._path)===".info"?s=cy(t.infoSyncTree_,e,n):s=cy(t.serverSyncTree_,e,n),dE(t.eventQueue_,e._path,s)}function my(t,e,n){let s;vt(e._path)===".info"?s=E1(t.infoSyncTree_,e,n):s=E1(t.serverSyncTree_,e,n),dE(t.eventQueue_,e._path,s)}function Mk(t){t.persistentConnection_&&t.persistentConnection_.interrupt(yk)}function Lg(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Ln(n,...e)}function Ja(t,e,n,s){e&&yl(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function pE(t,e,n){return wg(t.serverSyncTree_,e,n)||it.EMPTY_NODE}function Pg(t,e=t.transactionQueueTree_){if(e||Sf(t,e),wl(e)){const n=_E(t,e);Be(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&Nk(t,yu(e),n)}else aE(e)&&Ef(e,n=>{Pg(t,n)})}function Nk(t,e,n){const s=n.map(c=>c.currentWriteId),i=pE(t,e,s);let r=i;const o=i.hash();for(let c=0;c<n.length;c++){const d=n[c];Be(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const u=Es(e,d.path);r=r.updateChild(u,d.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{Lg(t,"transaction put response",{path:l.toString(),status:c});let d=[];if(c==="ok"){const u=[];for(let f=0;f<n.length;f++)n[f].status=2,d=d.concat(Ro(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&u.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Sf(t,Ig(t.transactionQueueTree_,e)),Pg(t,t.transactionQueueTree_),sr(t.eventQueue_,e,d);for(let f=0;f<u.length;f++)yl(u[f])}else{if(c==="datastale")for(let u=0;u<n.length;u++)n[u].status===3?n[u].status=4:n[u].status=0;else{Ts("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<n.length;u++)n[u].status=4,n[u].abortReason=c}Tf(t,e)}},o)}function Tf(t,e){const n=gE(t,e),s=yu(n),i=_E(t,n);return Ok(t,i,s),s}function Ok(t,e,n){if(e.length===0)return;const s=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=Es(n,l.path);let d=!1,u;if(Be(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,u=l.abortReason,i=i.concat(Ro(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=bk)d=!0,u="maxretry",i=i.concat(Ro(t.serverSyncTree_,l.currentWriteId,!0));else{const f=pE(t,l.path,o);l.currentInputSnapshot=f;const m=e[a].update(f.val());if(m!==void 0){xf("transaction failed: Data returned ",m,l.path);let h=En(m);typeof m=="object"&&m!=null&&Ui(m,".priority")||(h=h.updatePriority(f.getPriority()));const I=l.currentWriteId,L=Ng(t),p=rE(h,f,L);l.currentOutputSnapshotRaw=h,l.currentOutputSnapshotResolved=p,l.currentWriteId=mE(t),o.splice(o.indexOf(I),1),i=i.concat(tE(t.serverSyncTree_,l.path,p,l.currentWriteId,l.applyLocally)),i=i.concat(Ro(t.serverSyncTree_,I,!0))}else d=!0,u="nodata",i=i.concat(Ro(t.serverSyncTree_,l.currentWriteId,!0))}sr(t.eventQueue_,n,i),i=[],d&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(u),!1,null))))}Sf(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)yl(s[a]);Pg(t,t.transactionQueueTree_)}function gE(t,e){let n,s=t.transactionQueueTree_;for(n=vt(e);n!==null&&wl(s)===void 0;)s=Ig(s,n),e=Yt(e),n=vt(e);return s}function _E(t,e){const n=[];return vE(t,e,n),n.sort((s,i)=>s.order-i.order),n}function vE(t,e,n){const s=wl(e);if(s)for(let i=0;i<s.length;i++)n.push(s[i]);Ef(e,i=>{vE(t,i,n)})}function Sf(t,e){const n=wl(e);if(n){let s=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[s]=n[i],s++);n.length=s,oE(e,n.length>0?n:void 0)}Ef(e,s=>{Sf(t,s)})}function yE(t,e){const n=yu(gE(t,e)),s=Ig(t.transactionQueueTree_,e);return ak(s,i=>{em(t,i)}),em(t,s),lE(s,i=>{em(t,i)}),n}function em(t,e){const n=wl(e);if(n){const s=[];let i=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(Be(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(Be(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(Ro(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?oE(e,void 0):n.length=r+1,sr(t.eventQueue_,yu(e),i);for(let o=0;o<s.length;o++)yl(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let i=n[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Pk(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Ts(`Invalid query segment '${n}' in query '${t}'`)}return e}const py=function(t,e){const n=Dk(t),s=n.namespace;n.domain==="firebase.com"&&Vo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&Vo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||HC();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new eI(n.host,n.secure,s,e,i,"",s!==n.subdomain),path:new Vt(n.pathString)}},Dk=function(t){let e="",n="",s="",i="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let d=t.indexOf("/");d===-1&&(d=t.length);let u=t.indexOf("?");u===-1&&(u=t.length),e=t.substring(0,Math.min(d,u)),d<u&&(i=Lk(t.substring(d,u)));const f=Pk(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const m=e.slice(0,c);if(m.toLowerCase()==="localhost")n="localhost";else if(m.split(".").length<=2)n=m;else{const h=e.indexOf(".");s=e.substring(0,h).toLowerCase(),n=e.substring(h+1),r=s}"ns"in f&&(r=f.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(e,n,s,i){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+kn(this.snapshot.exportVal())}}class wE{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return Be(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new $i;return Rk(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Jl("OnDisconnect.remove",this._path);const e=new $i;return fy(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Jl("OnDisconnect.set",this._path),T1("OnDisconnect.set",e,this._path,!1);const n=new $i;return fy(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Jl("OnDisconnect.setWithPriority",this._path),T1("OnDisconnect.setWithPriority",e,this._path,!1),mk("OnDisconnect.setWithPriority",n,!1);const s=new $i;return Ck(this._repo,this._path,e,n,s.wrapCallback(()=>{})),s.promise}update(e){Jl("OnDisconnect.update",this._path),fk("OnDisconnect.update",e,this._path,!1);const n=new $i;return Ik(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,n,s,i){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=i}get key(){return bt(this._path)?null:lg(this._path)}get ref(){return new ur(this._repo,this._path)}get _queryIdentifier(){const e=Q2(this._queryParams),n=sg(e);return n==="{}"?"default":n}get _queryObject(){return Q2(this._queryParams)}isEqual(e){if(e=_n(e),!(e instanceof Dg))return!1;const n=this._repo===e._repo,s=cg(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+AI(this._path)}}class ur extends Dg{constructor(e,n){super(e,n,new fg,!1)}get parent(){const e=L4(this._path);return e===null?null:new ur(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Bc{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new Vt(e),s=wd(this.ref,e);return new Bc(this._node.getChild(n),s,cn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new Bc(i,wd(this.ref,s),cn)))}hasChild(e){const n=new Vt(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function EE(t,e){return t=_n(t),t._checkNotDeleted("ref"),e!==void 0?wd(t._root,e):t._root}function wd(t,e){return t=_n(t),vt(t._path)===null?pk("child","path",e,!1):hE("child","path",e,!1),new ur(t._repo,pn(t._path,e))}function Uk(t){return t=_n(t),new Fk(t._repo,t._path)}function jk(t,e){t=_n(t),Jl("set",t._path),T1("set",e,t._path,!1);const n=new $i;return Sk(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}class Bg{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const s=n._queryParams.getIndex();return new bE("value",this,new Bc(e.snapshotNode,new ur(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new wE(this,e,n):null}matches(e){return e instanceof Bg?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Fg{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new wE(this,e,n):null}createEvent(e,n){Be(e.childName!=null,"Child events should have a childName.");const s=wd(new ur(n._repo,n._path),e.childName),i=n._queryParams.getIndex();return new bE(e.type,this,new Bc(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Fg?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Hk(t,e,n,s,i){let r;if(typeof s=="object"&&(r=void 0,i=s),typeof s=="function"&&(r=s),i&&i.onlyOnce){const l=n,c=(d,u)=>{my(t._repo,t,a),l(d,u)};c.userCallback=n.userCallback,c.context=n.context,n=c}const o=new Bk(n,r||void 0),a=e==="value"?new Bg(o):new Fg(e,o);return kk(t._repo,t,a),()=>my(t._repo,t,a)}function xE(t,e,n,s){return Hk(t,"value",e,n,s)}F9(ur);$9(ur);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk="FIREBASE_DATABASE_EMULATOR_HOST",S1={};let qk=!1;function $k(t,e,n,s,i){let r=s||t.options.databaseURL;r===void 0&&(t.options.projectId||Vo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ln("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=py(r,i),a=o.repoInfo,l,c;typeof process!="undefined"&&(c=process.env[Vk]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=py(r,i),a=o.repoInfo):l=!o.repoInfo.secure;const d=i&&l?new d1(d1.OWNER):new ZC(t.name,t.options,e);gk("Invalid Firebase Database URL",o),bt(o.path)||Vo("Database URL must point to the root of a Firebase Database (not including a child path).");const u=Kk(a,t,d,new QC(t.name,n));return new Gk(u,t)}function zk(t,e){const n=S1[e];(!n||n[t.key]!==t)&&Vo(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Mk(t),delete n[t.key]}function Kk(t,e,n,s){let i=S1[e.name];i||(i={},S1[e.name]=i);let r=i[t.toURLString()];return r&&Vo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new wk(t,qk,n,s),i[t.toURLString()]=r,r}class Gk{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ek(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ur(this._repo,Ot())),this._rootInternal}_delete(){return this._rootInternal!==null&&(zk(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Vo("Cannot call "+e+" on a deleted database.")}}function Wk(t=ng(),e){return eg(t,"database").getImmediate({identifier:e})}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yk(t){DC(tg),mu(new vl("database",(e,{instanceIdentifier:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return $k(s,i,r,n)},"PUBLIC").setMultipleInstances(!0)),Li(L2,P2,t),Li(L2,P2,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk={".sv":"timestamp"};function gy(){return Xk}Xi.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Xi.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Yk();var Qk=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Ge,Ug=Ug||{},at=Qk||self;function Ed(){}function A1(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function bu(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function Zk(t){return Object.prototype.hasOwnProperty.call(t,tm)&&t[tm]||(t[tm]=++Jk)}var tm="closure_uid_"+(1e9*Math.random()>>>0),Jk=0;function eM(t,e,n){return t.call.apply(t.bind,arguments)}function tM(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function Pn(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Pn=eM:Pn=tM,Pn.apply(null,arguments)}function ch(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var s=n.slice();return s.push.apply(s,arguments),t.apply(this,s)}}function Fn(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(s,i,r){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(s,o)}}function Gr(){this.s=this.s,this.o=this.o}var nM=0;Gr.prototype.s=!1;Gr.prototype.na=function(){!this.s&&(this.s=!0,this.M(),nM!=0)&&Zk(this)};Gr.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const TE=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},SE=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const s=t.length,i=typeof t=="string"?t.split(""):t;for(let r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function sM(t){e:{var e=WM;const n=t.length,s=typeof t=="string"?t.split(""):t;for(let i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break e}e=-1}return 0>e?null:typeof t=="string"?t.charAt(e):t[e]}function _y(t){return Array.prototype.concat.apply([],arguments)}function jg(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function xd(t){return/^[\s\xa0]*$/.test(t)}var vy=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ts(t,e){return t.indexOf(e)!=-1}function nm(t,e){return t<e?-1:t>e?1:0}var ns;e:{var yy=at.navigator;if(yy){var by=yy.userAgent;if(by){ns=by;break e}}ns=""}function Hg(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function AE(t){const e={};for(const n in t)e[n]=t[n];return e}var wy="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function RE(t,e){let n,s;for(let i=1;i<arguments.length;i++){s=arguments[i];for(n in s)t[n]=s[n];for(let r=0;r<wy.length;r++)n=wy[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Vg(t){return Vg[" "](t),t}Vg[" "]=Ed;function iM(t){var e=aM;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var rM=ts(ns,"Opera"),el=ts(ns,"Trident")||ts(ns,"MSIE"),CE=ts(ns,"Edge"),R1=CE||el,IE=ts(ns,"Gecko")&&!(ts(ns.toLowerCase(),"webkit")&&!ts(ns,"Edge"))&&!(ts(ns,"Trident")||ts(ns,"MSIE"))&&!ts(ns,"Edge"),oM=ts(ns.toLowerCase(),"webkit")&&!ts(ns,"Edge");function kE(){var t=at.document;return t?t.documentMode:void 0}var Td;e:{var sm="",im=function(){var t=ns;if(IE)return/rv:([^\);]+)(\)|;)/.exec(t);if(CE)return/Edge\/([\d\.]+)/.exec(t);if(el)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(oM)return/WebKit\/(\S+)/.exec(t);if(rM)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(im&&(sm=im?im[1]:""),el){var rm=kE();if(rm!=null&&rm>parseFloat(sm)){Td=String(rm);break e}}Td=sm}var aM={};function lM(){return iM(function(){let t=0;const e=vy(String(Td)).split("."),n=vy("9").split("."),s=Math.max(e.length,n.length);for(let o=0;t==0&&o<s;o++){var i=e[o]||"",r=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],i[0].length==0&&r[0].length==0)break;t=nm(i[1].length==0?0:parseInt(i[1],10),r[1].length==0?0:parseInt(r[1],10))||nm(i[2].length==0,r[2].length==0)||nm(i[2],r[2]),i=i[3],r=r[3]}while(t==0)}return 0<=t})}var C1;if(at.document&&el){var Ey=kE();C1=Ey||parseInt(Td,10)||void 0}else C1=void 0;var cM=C1,uM=function(){if(!at.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{at.addEventListener("test",Ed,e),at.removeEventListener("test",Ed,e)}catch{}return t}();function zn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}zn.prototype.h=function(){this.defaultPrevented=!0};function Fc(t,e){if(zn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(IE){e:{try{Vg(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:hM[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Fc.Z.h.call(this)}}Fn(Fc,zn);var hM={2:"touch",3:"pen",4:"mouse"};Fc.prototype.h=function(){Fc.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var wu="closure_listenable_"+(1e6*Math.random()|0),dM=0;function fM(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ia=i,this.key=++dM,this.ca=this.fa=!1}function Af(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Rf(t){this.src=t,this.g={},this.h=0}Rf.prototype.add=function(t,e,n,s,i){var r=t.toString();t=this.g[r],t||(t=this.g[r]=[],this.h++);var o=k1(t,e,s,i);return-1<o?(e=t[o],n||(e.fa=!1)):(e=new fM(e,this.src,r,!!s,i),e.fa=n,t.push(e)),e};function I1(t,e){var n=e.type;if(n in t.g){var s=t.g[n],i=TE(s,e),r;(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(Af(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function k1(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.ca&&r.listener==e&&r.capture==!!n&&r.ia==s)return i}return-1}var qg="closure_lm_"+(1e6*Math.random()|0),om={};function ME(t,e,n,s,i){if(s&&s.once)return OE(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)ME(t,e[r],n,s,i);return null}return n=Kg(n),t&&t[wu]?t.N(e,n,bu(s)?!!s.capture:!!s,i):NE(t,e,n,!1,s,i)}function NE(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=bu(i)?!!i.capture:!!i,a=zg(t);if(a||(t[qg]=a=new Rf(t)),n=a.add(e,n,s,o,r),n.proxy)return n;if(s=mM(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)uM||(i=o),i===void 0&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(PE(e.toString()),s);else if(t.addListener&&t.removeListener)t.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return n}function mM(){function t(n){return e.call(t.src,t.listener,n)}var e=pM;return t}function OE(t,e,n,s,i){if(Array.isArray(e)){for(var r=0;r<e.length;r++)OE(t,e[r],n,s,i);return null}return n=Kg(n),t&&t[wu]?t.O(e,n,bu(s)?!!s.capture:!!s,i):NE(t,e,n,!0,s,i)}function LE(t,e,n,s,i){if(Array.isArray(e))for(var r=0;r<e.length;r++)LE(t,e[r],n,s,i);else s=bu(s)?!!s.capture:!!s,n=Kg(n),t&&t[wu]?(t=t.i,e=String(e).toString(),e in t.g&&(r=t.g[e],n=k1(r,n,s,i),-1<n&&(Af(r[n]),Array.prototype.splice.call(r,n,1),r.length==0&&(delete t.g[e],t.h--)))):t&&(t=zg(t))&&(e=t.g[e.toString()],t=-1,e&&(t=k1(e,n,s,i)),(n=-1<t?e[t]:null)&&$g(n))}function $g(t){if(typeof t!="number"&&t&&!t.ca){var e=t.src;if(e&&e[wu])I1(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(PE(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=zg(e))?(I1(n,t),n.h==0&&(n.src=null,e[qg]=null)):Af(t)}}}function PE(t){return t in om?om[t]:om[t]="on"+t}function pM(t,e){if(t.ca)t=!0;else{e=new Fc(e,this);var n=t.listener,s=t.ia||t.src;t.fa&&$g(t),t=n.call(s,e)}return t}function zg(t){return t=t[qg],t instanceof Rf?t:null}var am="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kg(t){return typeof t=="function"?t:(t[am]||(t[am]=function(e){return t.handleEvent(e)}),t[am])}function Nn(){Gr.call(this),this.i=new Rf(this),this.P=this,this.I=null}Fn(Nn,Gr);Nn.prototype[wu]=!0;Nn.prototype.removeEventListener=function(t,e,n,s){LE(this,t,e,n,s)};function Dn(t,e){var n,s=t.I;if(s)for(n=[];s;s=s.I)n.push(s);if(t=t.P,s=e.type||e,typeof e=="string")e=new zn(e,t);else if(e instanceof zn)e.target=e.target||t;else{var i=e;e=new zn(s,t),RE(e,i)}if(i=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];i=uh(o,s,!0,e)&&i}if(o=e.g=t,i=uh(o,s,!0,e)&&i,i=uh(o,s,!1,e)&&i,n)for(r=0;r<n.length;r++)o=e.g=n[r],i=uh(o,s,!1,e)&&i}Nn.prototype.M=function(){if(Nn.Z.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)Af(n[s]);delete t.g[e],t.h--}}this.I=null};Nn.prototype.N=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)};Nn.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};function uh(t,e,n,s){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,l=o.ia||o.src;o.fa&&I1(t.i,o),i=a.call(l,s)!==!1&&i}}return i&&!s.defaultPrevented}var Gg=at.JSON.stringify;function gM(){var t=BE;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class _M{constructor(){this.h=this.g=null}add(e,n){const s=DE.get();s.set(e,n),this.h?this.h.next=s:this.g=s,this.h=s}}var DE=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new vM,t=>t.reset());class vM{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}}function yM(t){at.setTimeout(()=>{throw t},0)}function Wg(t,e){M1||bM(),N1||(M1(),N1=!0),BE.add(t,e)}var M1;function bM(){var t=at.Promise.resolve(void 0);M1=function(){t.then(wM)}}var N1=!1,BE=new _M;function wM(){for(var t;t=gM();){try{t.h.call(t.g)}catch(n){yM(n)}var e=DE;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}N1=!1}function Cf(t,e){Nn.call(this),this.h=t||1,this.g=e||at,this.j=Pn(this.kb,this),this.l=Date.now()}Fn(Cf,Nn);Ge=Cf.prototype;Ge.da=!1;Ge.S=null;Ge.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Dn(this,"tick"),this.da&&(Yg(this),this.start()))}};Ge.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Yg(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}Ge.M=function(){Cf.Z.M.call(this),Yg(this),delete this.g};function Xg(t,e,n){if(typeof t=="function")n&&(t=Pn(t,n));else if(t&&typeof t.handleEvent=="function")t=Pn(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:at.setTimeout(t,e||0)}function FE(t){t.g=Xg(()=>{t.g=null,t.i&&(t.i=!1,FE(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class EM extends Gr{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:FE(this)}M(){super.M(),this.g&&(at.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Uc(t){Gr.call(this),this.h=t,this.g={}}Fn(Uc,Gr);var xy=[];function UE(t,e,n,s){Array.isArray(n)||(n&&(xy[0]=n.toString()),n=xy);for(var i=0;i<n.length;i++){var r=ME(e,n[i],s||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function jE(t){Hg(t.g,function(e,n){this.g.hasOwnProperty(n)&&$g(e)},t),t.g={}}Uc.prototype.M=function(){Uc.Z.M.call(this),jE(this)};Uc.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function If(){this.g=!0}If.prototype.Aa=function(){this.g=!1};function xM(t,e,n,s,i,r){t.info(function(){if(t.g)if(r)for(var o="",a=r.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var d=c[0];c=c[1];var u=d.split("_");o=2<=u.length&&u[1]=="type"?o+(d+"="+c+"&"):o+(d+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+`
`+n+`
`+o})}function TM(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+`
`+n+`
`+r+" "+o})}function ka(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+AM(t,n)+(s?" "+s:"")})}function SM(t,e){t.info(function(){return"TIMEOUT: "+e})}If.prototype.info=function(){};function AM(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if(r!="noop"&&r!="stop"&&r!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Gg(n)}catch{return e}}var la={},Ty=null;function kf(){return Ty=Ty||new Nn}la.Ma="serverreachability";function HE(t){zn.call(this,la.Ma,t)}Fn(HE,zn);function jc(t){const e=kf();Dn(e,new HE(e))}la.STAT_EVENT="statevent";function VE(t,e){zn.call(this,la.STAT_EVENT,t),this.stat=e}Fn(VE,zn);function is(t){const e=kf();Dn(e,new VE(e,t))}la.Na="timingevent";function qE(t,e){zn.call(this,la.Na,t),this.size=e}Fn(qE,zn);function Eu(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return at.setTimeout(function(){t()},e)}var Mf={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},$E={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Qg(){}Qg.prototype.h=null;function Sy(t){return t.h||(t.h=t.i())}function zE(){}var xu={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Zg(){zn.call(this,"d")}Fn(Zg,zn);function Jg(){zn.call(this,"c")}Fn(Jg,zn);var O1;function Nf(){}Fn(Nf,Qg);Nf.prototype.g=function(){return new XMLHttpRequest};Nf.prototype.i=function(){return{}};O1=new Nf;function Tu(t,e,n,s){this.l=t,this.j=e,this.m=n,this.X=s||1,this.V=new Uc(this),this.P=RM,t=R1?125:void 0,this.W=new Cf(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new KE}function KE(){this.i=null,this.g="",this.h=!1}var RM=45e3,L1={},Sd={};Ge=Tu.prototype;Ge.setTimeout=function(t){this.P=t};function P1(t,e,n){t.K=1,t.v=Lf(ir(e)),t.s=n,t.U=!0,GE(t,null)}function GE(t,e){t.F=Date.now(),Su(t),t.A=ir(t.v);var n=t.A,s=t.X;Array.isArray(s)||(s=[String(s)]),ex(n.h,"t",s),t.C=0,n=t.l.H,t.h=new KE,t.g=bx(t.l,n?e:null,!t.s),0<t.O&&(t.L=new EM(Pn(t.Ia,t,t.g),t.O)),UE(t.V,t.g,"readystatechange",t.gb),e=t.H?AE(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),jc(),xM(t.j,t.u,t.A,t.m,t.X,t.s)}Ge.gb=function(t){t=t.target;const e=this.L;e&&Gi(t)==3?e.l():this.Ia(t)};Ge.Ia=function(t){try{if(t==this.g)e:{const d=Gi(this.g);var e=this.g.Da();const u=this.g.ba();if(!(3>d)&&(d!=3||R1||this.g&&(this.h.h||this.g.ga()||Iy(this.g)))){this.I||d!=4||e==7||(e==8||0>=u?jc(3):jc(2)),Of(this);var n=this.g.ba();this.N=n;t:if(WE(this)){var s=Iy(this.g);t="";var i=s.length,r=Gi(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){Co(this),gc(this);var o="";break t}this.h.i=new at.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:r&&e==i-1});s.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=n==200,TM(this.j,this.u,this.A,this.m,this.X,d,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!xd(a)){var c=a;break t}}c=null}if(n=c)ka(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,D1(this,n);else{this.i=!1,this.o=3,is(12),Co(this),gc(this);break e}}this.U?(YE(this,d,o),R1&&this.i&&d==3&&(UE(this.V,this.W,"tick",this.fb),this.W.start())):(ka(this.j,this.m,o,null),D1(this,o)),d==4&&Co(this),this.i&&!this.I&&(d==4?gx(this.l,this):(this.i=!1,Su(this)))}else n==400&&0<o.indexOf("Unknown SID")?(this.o=3,is(12)):(this.o=0,is(13)),Co(this),gc(this)}}}catch{}finally{}};function WE(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Ba:!1}function YE(t,e,n){let s=!0,i;for(;!t.I&&t.C<n.length;)if(i=CM(t,n),i==Sd){e==4&&(t.o=4,is(14),s=!1),ka(t.j,t.m,null,"[Incomplete Response]");break}else if(i==L1){t.o=4,is(15),ka(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}else ka(t.j,t.m,i,null),D1(t,i);WE(t)&&i!=Sd&&i!=L1&&(t.h.g="",t.C=0),e!=4||n.length!=0||t.h.h||(t.o=1,is(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,e=t.l,e.g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),l_(e),e.L=!0,is(11))):(ka(t.j,t.m,n,"[Invalid Chunked Response]"),Co(t),gc(t))}Ge.fb=function(){if(this.g){var t=Gi(this.g),e=this.g.ga();this.C<e.length&&(Of(this),YE(this,t,e),this.i&&t!=4&&Su(this))}};function CM(t,e){var n=t.C,s=e.indexOf(`
`,n);return s==-1?Sd:(n=Number(e.substring(n,s)),isNaN(n)?L1:(s+=1,s+n>e.length?Sd:(e=e.substr(s,n),t.C=s+n,e)))}Ge.cancel=function(){this.I=!0,Co(this)};function Su(t){t.Y=Date.now()+t.P,XE(t,t.P)}function XE(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=Eu(Pn(t.eb,t),e)}function Of(t){t.B&&(at.clearTimeout(t.B),t.B=null)}Ge.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(SM(this.j,this.A),this.K!=2&&(jc(),is(17)),Co(this),this.o=2,gc(this)):XE(this,this.Y-t)};function gc(t){t.l.G==0||t.I||gx(t.l,t)}function Co(t){Of(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,Yg(t.W),jE(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function D1(t,e){try{var n=t.l;if(n.G!=0&&(n.g==t||B1(n.i,t))){if(n.I=t.N,!t.J&&B1(n.i,t)&&n.G==3){try{var s=n.Ca.g.parse(e)}catch{s=null}if(Array.isArray(s)&&s.length==3){var i=s;if(i[0]==0){e:if(!n.u){if(n.g)if(n.g.F+3e3<t.F)Id(n),Bf(n);else break e;a_(n),is(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&n.A==0&&!n.v&&(n.v=Eu(Pn(n.ab,n),6e3));if(1>=sx(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else Io(n,11)}else if((t.J||n.g==t)&&Id(n),!xd(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.U=c[0],c=c[1],n.G==2)if(c[0]=="c"){n.J=c[1],n.la=c[2];const d=c[3];d!=null&&(n.ma=d,n.h.info("VER="+n.ma));const u=c[4];u!=null&&(n.za=u,n.h.info("SVER="+n.za));const f=c[5];f!=null&&typeof f=="number"&&0<f&&(s=1.5*f,n.K=s,n.h.info("backChannelRequestTimeoutMs_="+s)),s=n;const m=t.g;if(m){const h=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var r=s.i;!r.g&&(ts(h,"spdy")||ts(h,"quic")||ts(h,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(n_(r,r.h),r.h=null))}if(s.D){const k=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null;k&&(s.sa=k,ln(s.F,s.D,k))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms")),s=n;var o=t;if(s.oa=yx(s,s.H?s.la:null,s.W),o.J){ix(s.i,o);var a=o,l=s.K;l&&a.setTimeout(l),a.B&&(Of(a),Su(a)),s.g=o}else mx(s);0<n.l.length&&Ff(n)}else c[0]!="stop"&&c[0]!="close"||Io(n,7);else n.G==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Io(n,7):o_(n):c[0]!="noop"&&n.j&&n.j.wa(c),n.A=0)}}jc(4)}catch{}}function IM(t){if(t.R&&typeof t.R=="function")return t.R();if(typeof t=="string")return t.split("");if(A1(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}e=[],n=0;for(s in t)e[n++]=t[s];return e}function e_(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(A1(t)||typeof t=="string")SE(t,e,void 0);else{if(t.T&&typeof t.T=="function")var n=t.T();else if(t.R&&typeof t.R=="function")n=void 0;else if(A1(t)||typeof t=="string"){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;s=IM(t),i=s.length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function El(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof El)for(n=t.T(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}Ge=El.prototype;Ge.R=function(){t_(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t};Ge.T=function(){return t_(this),this.g.concat()};function t_(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var s=t.g[e];Go(t.h,s)&&(t.g[n++]=s),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)s=t.g[e],Go(i,s)||(t.g[n++]=s,i[s]=1),e++;t.g.length=n}}Ge.get=function(t,e){return Go(this.h,t)?this.h[t]:e};Ge.set=function(t,e){Go(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e};Ge.forEach=function(t,e){for(var n=this.T(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};function Go(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var QE=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function kM(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Wo(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Wo){this.g=e!==void 0?e:t.g,Ad(this,t.j),this.s=t.s,Rd(this,t.i),Cd(this,t.m),this.l=t.l,e=t.h;var n=new Hc;n.i=e.i,e.g&&(n.g=new El(e.g),n.h=e.h),Ay(this,n),this.o=t.o}else t&&(n=String(t).match(QE))?(this.g=!!e,Ad(this,n[1]||"",!0),this.s=_c(n[2]||""),Rd(this,n[3]||"",!0),Cd(this,n[4]),this.l=_c(n[5]||"",!0),Ay(this,n[6]||"",!0),this.o=_c(n[7]||"")):(this.g=!!e,this.h=new Hc(null,this.g))}Wo.prototype.toString=function(){var t=[],e=this.j;e&&t.push(ec(e,Ry,!0),":");var n=this.i;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(ec(e,Ry,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.i&&n.charAt(0)!="/"&&t.push("/"),t.push(ec(n,n.charAt(0)=="/"?PM:LM,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",ec(n,BM)),t.join("")};function ir(t){return new Wo(t)}function Ad(t,e,n){t.j=n?_c(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Rd(t,e,n){t.i=n?_c(e,!0):e}function Cd(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ay(t,e,n){e instanceof Hc?(t.h=e,FM(t.h,t.g)):(n||(e=ec(e,DM)),t.h=new Hc(e,t.g))}function ln(t,e,n){t.h.set(e,n)}function Lf(t){return ln(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function MM(t){return t instanceof Wo?ir(t):new Wo(t,void 0)}function NM(t,e,n,s){var i=new Wo(null,void 0);return t&&Ad(i,t),e&&Rd(i,e),n&&Cd(i,n),s&&(i.l=s),i}function _c(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ec(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,OM),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function OM(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var Ry=/[#\/\?@]/g,LM=/[#\?:]/g,PM=/[#\?]/g,DM=/[#\?@]/g,BM=/#/g;function Hc(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Wr(t){t.g||(t.g=new El,t.h=0,t.i&&kM(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}Ge=Hc.prototype;Ge.add=function(t,e){Wr(this),this.i=null,t=xl(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function ZE(t,e){Wr(t),e=xl(t,e),Go(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,t=t.g,Go(t.h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&t_(t)))}function JE(t,e){return Wr(t),e=xl(t,e),Go(t.g.h,e)}Ge.forEach=function(t,e){Wr(this),this.g.forEach(function(n,s){SE(n,function(i){t.call(e,i,s,this)},this)},this)};Ge.T=function(){Wr(this);for(var t=this.g.R(),e=this.g.T(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n};Ge.R=function(t){Wr(this);var e=[];if(typeof t=="string")JE(this,t)&&(e=_y(e,this.g.get(xl(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=_y(e,t[n])}return e};Ge.set=function(t,e){return Wr(this),this.i=null,t=xl(this,t),JE(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};Ge.get=function(t,e){return t?(t=this.R(t),0<t.length?String(t[0]):e):e};function ex(t,e,n){ZE(t,e),0<n.length&&(t.i=null,t.g.set(xl(t,e),jg(n)),t.h+=n.length)}Ge.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.R(s);for(var r=0;r<s.length;r++){var o=i;s[r]!==""&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.i=t.join("&")};function xl(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function FM(t,e){e&&!t.j&&(Wr(t),t.i=null,t.g.forEach(function(n,s){var i=s.toLowerCase();s!=i&&(ZE(this,s),ex(this,i,n))},t)),t.j=e}var UM=class{constructor(t,e){this.h=t,this.g=e}};function tx(t){this.l=t||jM,at.PerformanceNavigationTiming?(t=at.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(at.g&&at.g.Ea&&at.g.Ea()&&at.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var jM=10;function nx(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function sx(t){return t.h?1:t.g?t.g.size:0}function B1(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function n_(t,e){t.g?t.g.add(e):t.h=e}function ix(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}tx.prototype.cancel=function(){if(this.i=rx(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function rx(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return jg(t.i)}function s_(){}s_.prototype.stringify=function(t){return at.JSON.stringify(t,void 0)};s_.prototype.parse=function(t){return at.JSON.parse(t,void 0)};function HM(){this.g=new s_}function VM(t,e,n){const s=n||"";try{e_(t,function(i,r){let o=i;bu(i)&&(o=Gg(i)),e.push(s+r+"="+encodeURIComponent(o))})}catch(i){throw e.push(s+"type="+encodeURIComponent("_badmap")),i}}function qM(t,e){const n=new If;if(at.Image){const s=new Image;s.onload=ch(hh,n,s,"TestLoadImage: loaded",!0,e),s.onerror=ch(hh,n,s,"TestLoadImage: error",!1,e),s.onabort=ch(hh,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=ch(hh,n,s,"TestLoadImage: timeout",!1,e),at.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}function hh(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch{}}function Au(t){this.l=t.$b||null,this.j=t.ib||!1}Fn(Au,Qg);Au.prototype.g=function(){return new Pf(this.l,this.j)};Au.prototype.i=function(t){return function(){return t}}({});function Pf(t,e){Nn.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=i_,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Fn(Pf,Nn);var i_=0;Ge=Pf.prototype;Ge.open=function(t,e){if(this.readyState!=i_)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Vc(this)};Ge.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||at).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};Ge.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ru(this)),this.readyState=i_};Ge.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Vc(this)),this.g&&(this.readyState=3,Vc(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof at.ReadableStream!="undefined"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ox(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))};function ox(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}Ge.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ru(this):Vc(this),this.readyState==3&&ox(this)}};Ge.Ua=function(t){this.g&&(this.response=this.responseText=t,Ru(this))};Ge.Ta=function(t){this.g&&(this.response=t,Ru(this))};Ge.ha=function(){this.g&&Ru(this)};function Ru(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Vc(t)}Ge.setRequestHeader=function(t,e){this.v.append(t,e)};Ge.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};Ge.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function Vc(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Pf.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var $M=at.JSON.parse;function xn(t){Nn.call(this),this.headers=new El,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=ax,this.K=this.L=!1}Fn(xn,Nn);var ax="",zM=/^https?$/i,KM=["POST","PUT"];Ge=xn.prototype;Ge.ea=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():O1.g(),this.C=this.u?Sy(this.u):Sy(O1),this.g.onreadystatechange=Pn(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(r){Cy(this,r);return}t=n||"";const i=new El(this.headers);s&&e_(s,function(r,o){i.set(o,r)}),s=sM(i.T()),n=at.FormData&&t instanceof at.FormData,!(0<=TE(KM,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(r,o){this.g.setRequestHeader(o,r)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ux(this),0<this.B&&((this.K=GM(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Pn(this.pa,this)):this.A=Xg(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(r){Cy(this,r)}};function GM(t){return el&&lM()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}function WM(t){return t.toLowerCase()=="content-type"}Ge.pa=function(){typeof Ug!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Dn(this,"timeout"),this.abort(8))};function Cy(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,lx(t),Df(t)}function lx(t){t.D||(t.D=!0,Dn(t,"complete"),Dn(t,"error"))}Ge.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Dn(this,"complete"),Dn(this,"abort"),Df(this))};Ge.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Df(this,!0)),xn.Z.M.call(this)};Ge.Fa=function(){this.s||(this.F||this.v||this.l?cx(this):this.cb())};Ge.cb=function(){cx(this)};function cx(t){if(t.h&&typeof Ug!="undefined"&&(!t.C[1]||Gi(t)!=4||t.ba()!=2)){if(t.v&&Gi(t)==4)Xg(t.Fa,0,t);else if(Dn(t,"readystatechange"),Gi(t)==4){t.h=!1;try{const a=t.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var s;if(s=a===0){var i=String(t.H).match(QE)[1]||null;if(!i&&at.self&&at.self.location){var r=at.self.location.protocol;i=r.substr(0,r.length-1)}s=!zM.test(i?i.toLowerCase():"")}n=s}if(n)Dn(t,"complete"),Dn(t,"success");else{t.m=6;try{var o=2<Gi(t)?t.g.statusText:""}catch{o=""}t.j=o+" ["+t.ba()+"]",lx(t)}}finally{Df(t)}}}}function Df(t,e){if(t.g){ux(t);const n=t.g,s=t.C[0]?Ed:null;t.g=null,t.C=null,e||Dn(t,"ready");try{n.onreadystatechange=s}catch{}}}function ux(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(at.clearTimeout(t.A),t.A=null)}function Gi(t){return t.g?t.g.readyState:0}Ge.ba=function(){try{return 2<Gi(this)?this.g.status:-1}catch{return-1}};Ge.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};Ge.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),$M(e)}};function Iy(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case ax:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}Ge.Da=function(){return this.m};Ge.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function YM(t){let e="";return Hg(t,function(n,s){e+=s,e+=":",e+=n,e+=`\r
`}),e}function r_(t,e,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=YM(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):ln(t,e,n))}function ql(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function hx(t){this.za=0,this.l=[],this.h=new If,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ql("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ql("baseRetryDelayMs",5e3,t),this.$a=ql("retryDelaySeedMs",1e4,t),this.Ya=ql("forwardChannelMaxRetries",2,t),this.ra=ql("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new tx(t&&t.concurrentRequestLimit),this.Ca=new HM,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||t.Xb!==!1}Ge=hx.prototype;Ge.ma=8;Ge.G=1;function o_(t){if(dx(t),t.G==3){var e=t.V++,n=ir(t.F);ln(n,"SID",t.J),ln(n,"RID",e),ln(n,"TYPE","terminate"),Cu(t,n),e=new Tu(t,t.h,e,void 0),e.K=2,e.v=Lf(ir(n)),n=!1,at.navigator&&at.navigator.sendBeacon&&(n=at.navigator.sendBeacon(e.v.toString(),"")),!n&&at.Image&&(new Image().src=e.v,n=!0),n||(e.g=bx(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Su(e)}vx(t)}Ge.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch{}};function Bf(t){t.g&&(l_(t),t.g.cancel(),t.g=null)}function dx(t){Bf(t),t.u&&(at.clearTimeout(t.u),t.u=null),Id(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&at.clearTimeout(t.m),t.m=null)}function lm(t,e){t.l.push(new UM(t.Za++,e)),t.G==3&&Ff(t)}function Ff(t){nx(t.i)||t.m||(t.m=!0,Wg(t.Ha,t),t.C=0)}function XM(t,e){return sx(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.l=e.D.concat(t.l),!0):t.G==1||t.G==2||t.C>=(t.Xa?0:t.Ya)?!1:(t.m=Eu(Pn(t.Ha,t,e),_x(t,t.C)),t.C++,!0)}Ge.Ha=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new Tu(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?(r=AE(r),RE(r,this.P)):r=this.P),this.o===null&&(i.H=r),this.ja)e:{for(var e=0,n=0;n<this.l.length;n++){t:{var s=this.l[n];if("__data__"in s.g&&(s=s.g.__data__,typeof s=="string")){s=s.length;break t}s=void 0}if(s===void 0)break;if(e+=s,4096<e){e=n;break e}if(e===4096||n===this.l.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=fx(this,i,e),n=ir(this.F),ln(n,"RID",t),ln(n,"CVER",22),this.D&&ln(n,"X-HTTP-Session-Id",this.D),Cu(this,n),this.o&&r&&r_(n,this.o,r),n_(this.i,i),this.Ra&&ln(n,"TYPE","init"),this.ja?(ln(n,"$req",e),ln(n,"SID","null"),i.$=!0,P1(i,n,null)):P1(i,n,e),this.G=2}}else this.G==3&&(t?ky(this,t):this.l.length==0||nx(this.i)||ky(this))};function ky(t,e){var n;e?n=e.m:n=t.V++;const s=ir(t.F);ln(s,"SID",t.J),ln(s,"RID",n),ln(s,"AID",t.U),Cu(t,s),t.o&&t.s&&r_(s,t.o,t.s),n=new Tu(t,t.h,n,t.C+1),t.o===null&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=fx(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),n_(t.i,n),P1(n,s,e)}function Cu(t,e){t.j&&e_({},function(n,s){ln(e,s,n)})}function fx(t,e,n){n=Math.min(t.l.length,n);var s=t.j?Pn(t.j.Oa,t.j,t):null;e:{var i=t.l;let r=-1;for(;;){const o=["count="+n];r==-1?0<n?(r=i[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let a=!0;for(let l=0;l<n;l++){let c=i[l].h;const d=i[l].g;if(c-=r,0>c)r=Math.max(0,i[l].h-100),a=!1;else try{VM(d,o,"req"+c+"_")}catch{s&&s(d)}}if(a){s=o.join("&");break e}}}return t=t.l.splice(0,n),e.D=t,s}function mx(t){t.g||t.u||(t.Y=1,Wg(t.Ga,t),t.A=0)}function a_(t){return t.g||t.u||3<=t.A?!1:(t.Y++,t.u=Eu(Pn(t.Ga,t),_x(t,t.A)),t.A++,!0)}Ge.Ga=function(){if(this.u=null,px(this),this.$&&!(this.L||this.g==null||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Eu(Pn(this.bb,this),t)}};Ge.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,is(10),Bf(this),px(this))};function l_(t){t.B!=null&&(at.clearTimeout(t.B),t.B=null)}function px(t){t.g=new Tu(t,t.h,"rpc",t.Y),t.o===null&&(t.g.H=t.s),t.g.O=0;var e=ir(t.oa);ln(e,"RID","rpc"),ln(e,"SID",t.J),ln(e,"CI",t.N?"0":"1"),ln(e,"AID",t.U),Cu(t,e),ln(e,"TYPE","xmlhttp"),t.o&&t.s&&r_(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Lf(ir(e)),n.s=null,n.U=!0,GE(n,t)}Ge.ab=function(){this.v!=null&&(this.v=null,Bf(this),a_(this),is(19))};function Id(t){t.v!=null&&(at.clearTimeout(t.v),t.v=null)}function gx(t,e){var n=null;if(t.g==e){Id(t),l_(t),t.g=null;var s=2}else if(B1(t.i,e))n=e.D,ix(t.i,e),s=1;else return;if(t.I=e.N,t.G!=0){if(e.i)if(s==1){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;s=kf(),Dn(s,new qE(s,n)),Ff(t)}else mx(t);else if(i=e.o,i==3||i==0&&0<t.I||!(s==1&&XM(t,e)||s==2&&a_(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Io(t,5);break;case 4:Io(t,10);break;case 3:Io(t,6);break;default:Io(t,2)}}}function _x(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Io(t,e){if(t.h.info("Error code "+e),e==2){var n=null;t.j&&(n=null);var s=Pn(t.jb,t);n||(n=new Wo("//www.google.com/images/cleardot.gif"),at.location&&at.location.protocol=="http"||Ad(n,"https"),Lf(n)),qM(n.toString(),s)}else is(2);t.G=0,t.j&&t.j.va(e),vx(t),dx(t)}Ge.jb=function(t){t?(this.h.info("Successfully pinged google.com"),is(2)):(this.h.info("Failed to ping google.com"),is(1))};function vx(t){t.G=0,t.I=-1,t.j&&((rx(t.i).length!=0||t.l.length!=0)&&(t.i.i.length=0,jg(t.l),t.l.length=0),t.j.ua())}function yx(t,e,n){let s=MM(n);if(s.i!="")e&&Rd(s,e+"."+s.i),Cd(s,s.m);else{const i=at.location;s=NM(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Hg(t.aa,function(i,r){ln(s,r,i)}),e=t.D,n=t.sa,e&&n&&ln(s,e,n),ln(s,"VER",t.ma),Cu(t,s),s}function bx(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=n&&t.Ba&&!t.qa?new xn(new Au({ib:!0})):new xn(t.qa),e.L=t.H,e}function wx(){}Ge=wx.prototype;Ge.xa=function(){};Ge.wa=function(){};Ge.va=function(){};Ge.ua=function(){};Ge.Oa=function(){};function kd(){if(el&&!(10<=Number(cM)))throw Error("Environmental error: no available transport.")}kd.prototype.g=function(t,e){return new Hs(t,e)};function Hs(t,e){Nn.call(this),this.g=new hx(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!xd(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!xd(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Tl(this)}Fn(Hs,Nn);Hs.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Wg(Pn(t.hb,t,e))),is(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=yx(t,null,t.W),Ff(t)};Hs.prototype.close=function(){o_(this.g)};Hs.prototype.u=function(t){if(typeof t=="string"){var e={};e.__data__=t,lm(this.g,e)}else this.v?(e={},e.__data__=Gg(t),lm(this.g,e)):lm(this.g,t)};Hs.prototype.M=function(){this.g.j=null,delete this.j,o_(this.g),delete this.g,Hs.Z.M.call(this)};function Ex(t){Zg.call(this);var e=t.__sm__;if(e){e:{for(const n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Fn(Ex,Zg);function xx(){Jg.call(this),this.status=1}Fn(xx,Jg);function Tl(t){this.g=t}Fn(Tl,wx);Tl.prototype.xa=function(){Dn(this.g,"a")};Tl.prototype.wa=function(t){Dn(this.g,new Ex(t))};Tl.prototype.va=function(t){Dn(this.g,new xx)};Tl.prototype.ua=function(){Dn(this.g,"b")};kd.prototype.createWebChannel=kd.prototype.g;Hs.prototype.send=Hs.prototype.u;Hs.prototype.open=Hs.prototype.m;Hs.prototype.close=Hs.prototype.close;Mf.NO_ERROR=0;Mf.TIMEOUT=8;Mf.HTTP_ERROR=6;$E.COMPLETE="complete";zE.EventType=xu;xu.OPEN="a";xu.CLOSE="b";xu.ERROR="c";xu.MESSAGE="d";Nn.prototype.listen=Nn.prototype.N;xn.prototype.listenOnce=xn.prototype.O;xn.prototype.getLastError=xn.prototype.La;xn.prototype.getLastErrorCode=xn.prototype.Da;xn.prototype.getStatus=xn.prototype.ba;xn.prototype.getResponseJson=xn.prototype.Qa;xn.prototype.getResponseText=xn.prototype.ga;xn.prototype.send=xn.prototype.ea;var QM=function(){return new kd},ZM=function(){return kf()},cm=Mf,JM=$E,e7=la,My={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},t7=Au,dh=zE,n7=xn;const Ny="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_s.UNAUTHENTICATED=new _s(null),_s.GOOGLE_CREDENTIALS=new _s("google-credentials-uid"),_s.FIRST_PARTY=new _s("first-party-uid"),_s.MOCK_USER=new _s("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sl="9.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yo=new Zp("@firebase/firestore");function Oy(){return Yo.logLevel}function tt(t,...e){if(Yo.logLevel<=Mt.DEBUG){const n=e.map(c_);Yo.debug(`Firestore (${Sl}): ${t}`,...n)}}function Vr(t,...e){if(Yo.logLevel<=Mt.ERROR){const n=e.map(c_);Yo.error(`Firestore (${Sl}): ${t}`,...n)}}function Ly(t,...e){if(Yo.logLevel<=Mt.WARN){const n=e.map(c_);Yo.warn(`Firestore (${Sl}): ${t}`,...n)}}function c_(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(t="Unexpected state"){const e=`FIRESTORE (${Sl}) INTERNAL ASSERTION FAILED: `+t;throw Vr(e),new Error(e)}function en(t,e){t||ht()}function dt(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ee={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class qe extends Error{constructor(e,n){super(n),this.code=e,this.message=n,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s7{constructor(e,n){this.user=n,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class i7{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(_s.UNAUTHENTICATED))}shutdown(){}}class r7{constructor(e){this.t=e,this.currentUser=_s.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let s=this.i;const i=l=>this.i!==s?(s=this.i,n(l)):Promise.resolve();let r=new Qi;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Qi,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=r;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{tt("FirebaseCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(tt("FirebaseCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Qi)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(tt("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(en(typeof s.accessToken=="string"),new s7(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return en(e===null||typeof e=="string"),new _s(e)}}class o7{constructor(e,n,s){this.h=e,this.l=n,this.m=s,this.type="FirstParty",this.user=_s.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},n=this.h.auth.getAuthHeaderValueForFirstParty([]);return n&&(e.Authorization=n),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class a7{constructor(e,n,s){this.h=e,this.l=n,this.m=s}getToken(){return Promise.resolve(new o7(this.h,this.l,this.m))}start(e,n){e.enqueueRetryable(()=>n(_s.FIRST_PARTY))}shutdown(){}invalidateToken(){}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u_{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=s=>this.g(s),this.p=s=>n.writeSequenceNumber(s))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.p&&this.p(e),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l7(t){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */u_.T=-1;class Tx{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const i=l7(40);for(let r=0;r<i.length;++r)s.length<20&&i[r]<n&&(s+=e.charAt(i[r]%e.length))}return s}}function jt(t,e){return t<e?-1:t>e?1:0}function tl(t,e,n){return t.length===e.length&&t.every((s,i)=>n(s,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new qe(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new qe(Ee.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new qe(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new qe(Ee.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ds.fromMillis(Date.now())}static fromDate(e){return Ds.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*n));return new Ds(n,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?jt(this.nanoseconds,e.nanoseconds):jt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Bt(e)}static min(){return new Bt(new Ds(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Py(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ca(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Sx(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(e,n,s){n===void 0?n=0:n>e.length&&ht(),s===void 0?s=e.length-n:s>e.length-n&&ht(),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return qc.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof qc?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const s=Math.min(e.length,n.length);for(let i=0;i<s;i++){const r=e.get(i),o=n.get(i);if(r<o)return-1;if(r>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class nn extends qc{construct(e,n,s){return new nn(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const n=[];for(const s of e){if(s.indexOf("//")>=0)throw new qe(Ee.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(i=>i.length>0))}return new nn(n)}static emptyPath(){return new nn([])}}const c7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ws extends qc{construct(e,n,s){return new ws(e,n,s)}static isValidIdentifier(e){return c7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ws.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ws(["__name__"])}static fromServerFormat(e){const n=[];let s="",i=0;const r=()=>{if(s.length===0)throw new qe(Ee.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(s),s=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new qe(Ee.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new qe(Ee.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(s+=a,i++):(r(),i++)}if(r(),o)throw new qe(Ee.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ws(n)}static emptyPath(){return new ws([])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c{constructor(e){this.fields=e,e.sort(ws.comparator)}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return tl(this.fields,e.fields,(n,s)=>n.isEqual(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=atob(e);return new Wn(n)}static fromUint8Array(e){const n=function(s){let i="";for(let r=0;r<s.length;++r)i+=String.fromCharCode(s[r]);return i}(e);return new Wn(n)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return jt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wn.EMPTY_BYTE_STRING=new Wn("");const u7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qr(t){if(en(!!t),typeof t=="string"){let e=0;const n=u7.exec(t);if(en(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:wn(t.seconds),nanos:wn(t.nanos)}}function wn(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function nl(t){return typeof t=="string"?Wn.fromBase64String(t):Wn.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h_(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Ax(t){const e=t.mapValue.fields.__previous_value__;return h_(e)?Ax(e):e}function zc(t){const e=qr(t.mapValue.fields.__local_write_time__.timestampValue);return new Ds(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Al(t){return t==null}function Md(t){return t===0&&1/t==-1/0}function h7(t){return typeof t=="number"&&Number.isInteger(t)&&!Md(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e){this.path=e}static fromPath(e){return new nt(nn.fromString(e))}static fromName(e){return new nt(nn.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return e!==null&&nn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return nn.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new nt(new nn(e.slice()))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?h_(t)?4:10:ht()}function Bi(t,e){const n=Xo(t);if(n!==Xo(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return zc(t).isEqual(zc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const r=qr(s.timestampValue),o=qr(i.timestampValue);return r.seconds===o.seconds&&r.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return nl(s.bytesValue).isEqual(nl(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return wn(s.geoPointValue.latitude)===wn(i.geoPointValue.latitude)&&wn(s.geoPointValue.longitude)===wn(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return wn(s.integerValue)===wn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const r=wn(s.doubleValue),o=wn(i.doubleValue);return r===o?Md(r)===Md(o):isNaN(r)&&isNaN(o)}return!1}(t,e);case 9:return tl(t.arrayValue.values||[],e.arrayValue.values||[],Bi);case 10:return function(s,i){const r=s.mapValue.fields||{},o=i.mapValue.fields||{};if(Py(r)!==Py(o))return!1;for(const a in r)if(r.hasOwnProperty(a)&&(o[a]===void 0||!Bi(r[a],o[a])))return!1;return!0}(t,e);default:return ht()}}function Kc(t,e){return(t.values||[]).find(n=>Bi(n,e))!==void 0}function sl(t,e){const n=Xo(t),s=Xo(e);if(n!==s)return jt(n,s);switch(n){case 0:return 0;case 1:return jt(t.booleanValue,e.booleanValue);case 2:return function(i,r){const o=wn(i.integerValue||i.doubleValue),a=wn(r.integerValue||r.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(t,e);case 3:return Dy(t.timestampValue,e.timestampValue);case 4:return Dy(zc(t),zc(e));case 5:return jt(t.stringValue,e.stringValue);case 6:return function(i,r){const o=nl(i),a=nl(r);return o.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(i,r){const o=i.split("/"),a=r.split("/");for(let l=0;l<o.length&&l<a.length;l++){const c=jt(o[l],a[l]);if(c!==0)return c}return jt(o.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,r){const o=jt(wn(i.latitude),wn(r.latitude));return o!==0?o:jt(wn(i.longitude),wn(r.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(i,r){const o=i.values||[],a=r.values||[];for(let l=0;l<o.length&&l<a.length;++l){const c=sl(o[l],a[l]);if(c)return c}return jt(o.length,a.length)}(t.arrayValue,e.arrayValue);case 10:return function(i,r){const o=i.fields||{},a=Object.keys(o),l=r.fields||{},c=Object.keys(l);a.sort(),c.sort();for(let d=0;d<a.length&&d<c.length;++d){const u=jt(a[d],c[d]);if(u!==0)return u;const f=sl(o[a[d]],l[c[d]]);if(f!==0)return f}return jt(a.length,c.length)}(t.mapValue,e.mapValue);default:throw ht()}}function Dy(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return jt(t,e);const n=qr(t),s=qr(e),i=jt(n.seconds,s.seconds);return i!==0?i:jt(n.nanos,s.nanos)}function d_(t){return F1(t)}function F1(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(s){const i=qr(s);return`time(${i.seconds},${i.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?nl(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,nt.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(s){let i="[",r=!0;for(const o of s.values||[])r?r=!1:i+=",",i+=F1(o);return i+"]"}(t.arrayValue):"mapValue"in t?function(s){const i=Object.keys(s.fields||{}).sort();let r="{",o=!0;for(const a of i)o?o=!1:r+=",",r+=`${a}:${F1(s.fields[a])}`;return r+"}"}(t.mapValue):ht();var e,n}function Nd(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function U1(t){return!!t&&"integerValue"in t}function f_(t){return!!t&&"arrayValue"in t}function By(t){return!!t&&"nullValue"in t}function Fy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Hh(t){return!!t&&"mapValue"in t}function vc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ca(t.mapValue.fields,(n,s)=>e.mapValue.fields[n]=vc(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=vc(t.arrayValue.values[n]);return e}return Object.assign({},t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(e){this.value=e}static empty(){return new Ms({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let s=0;s<e.length-1;++s)if(n=(n.mapValue.fields||{})[e.get(s)],!Hh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=vc(n)}setAll(e){let n=ws.emptyPath(),s={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,s,i),s={},i=[],n=a.popLast()}o?s[a.lastSegment()]=vc(o):i.push(a.lastSegment())});const r=this.getFieldsMap(n);this.applyChanges(r,s,i)}delete(e){const n=this.field(e.popLast());Hh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Bi(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let s=0;s<e.length;++s){let i=n.mapValue.fields[e.get(s)];Hh(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(s)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,s){ca(n,(i,r)=>e[i]=r);for(const i of s)delete e[i]}clone(){return new Ms(vc(this.value))}}function Rx(t){const e=[];return ca(t.fields,(n,s)=>{const i=new ws([n]);if(Hh(s)){const r=Rx(s.mapValue).fields;if(r.length===0)e.push(i);else for(const o of r)e.push(i.child(o))}else e.push(i)}),new $c(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e,n,s,i,r){this.key=e,this.documentType=n,this.version=s,this.data=i,this.documentState=r}static newInvalidDocument(e){return new qn(e,0,Bt.min(),Ms.empty(),0)}static newFoundDocument(e,n,s){return new qn(e,1,n,s,0)}static newNoDocument(e,n){return new qn(e,2,n,Ms.empty(),0)}static newUnknownDocument(e,n){return new qn(e,3,n,Ms.empty(),2)}convertToFoundDocument(e,n){return this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ms.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ms.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof qn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new qn(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d7{constructor(e,n=null,s=[],i=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=s,this.filters=i,this.limit=r,this.startAt=o,this.endAt=a,this.A=null}}function Uy(t,e=null,n=[],s=[],i=null,r=null,o=null){return new d7(t,e,n,s,i,r,o)}function m_(t){const e=dt(t);if(e.A===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(s=>m7(s)).join(","),n+="|ob:",n+=e.orderBy.map(s=>function(i){return i.field.canonicalString()+i.dir}(s)).join(","),Al(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Od(e.startAt)),e.endAt&&(n+="|ub:",n+=Od(e.endAt)),e.A=n}return e.A}function f7(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(n=>{return`${(s=n).field.canonicalString()} ${s.op} ${d_(s.value)}`;var s}).join(", ")}]`),Al(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(n=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(n)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Od(t.startAt)),t.endAt&&(e+=", endAt: "+Od(t.endAt)),`Target(${e})`}function p_(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<t.orderBy.length;i++)if(!E7(t.orderBy[i],e.orderBy[i]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!Bi(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Hy(t.startAt,e.startAt)&&Hy(t.endAt,e.endAt)}function j1(t){return nt.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class rs extends class{}{constructor(e,n,s){super(),this.field=e,this.op=n,this.value=s}static create(e,n,s){return e.isKeyField()?n==="in"||n==="not-in"?this.R(e,n,s):new p7(e,n,s):n==="array-contains"?new v7(e,s):n==="in"?new y7(e,s):n==="not-in"?new b7(e,s):n==="array-contains-any"?new w7(e,s):new rs(e,n,s)}static R(e,n,s){return n==="in"?new g7(e,s):new _7(e,s)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.P(sl(n,this.value)):n!==null&&Xo(this.value)===Xo(n)&&this.P(sl(n,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ht()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}function m7(t){return t.field.canonicalString()+t.op.toString()+d_(t.value)}class p7 extends rs{constructor(e,n,s){super(e,n,s),this.key=nt.fromName(s.referenceValue)}matches(e){const n=nt.comparator(e.key,this.key);return this.P(n)}}class g7 extends rs{constructor(e,n){super(e,"in",n),this.keys=Cx("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class _7 extends rs{constructor(e,n){super(e,"not-in",n),this.keys=Cx("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Cx(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(s=>nt.fromName(s.referenceValue))}class v7 extends rs{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return f_(n)&&Kc(n.arrayValue,this.value)}}class y7 extends rs{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Kc(this.value.arrayValue,n)}}class b7 extends rs{constructor(e,n){super(e,"not-in",n)}matches(e){if(Kc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!Kc(this.value.arrayValue,n)}}class w7 extends rs{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!f_(n)||!n.arrayValue.values)&&n.arrayValue.values.some(s=>Kc(this.value.arrayValue,s))}}class Gc{constructor(e,n){this.position=e,this.before=n}}function Od(t){return`${t.before?"b":"a"}:${t.position.map(e=>d_(e)).join(",")}`}class Ua{constructor(e,n="asc"){this.field=e,this.dir=n}}function E7(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function jy(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(r.field.isKeyField()?s=nt.comparator(nt.fromName(o.referenceValue),n.key):s=sl(o,n.data.field(r.field)),r.dir==="desc"&&(s*=-1),s!==0)break}return t.before?s<=0:s<0}function Hy(t,e){if(t===null)return e===null;if(e===null||t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Bi(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e,n=null,s=[],i=[],r=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=s,this.filters=i,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=l,this.V=null,this.S=null,this.startAt,this.endAt}}function x7(t,e,n,s,i,r,o,a){return new Yr(t,e,n,s,i,r,o,a)}function Uf(t){return new Yr(t)}function Vh(t){return!Al(t.limit)&&t.limitType==="F"}function Ld(t){return!Al(t.limit)&&t.limitType==="L"}function g_(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function __(t){for(const e of t.filters)if(e.v())return e.field;return null}function v_(t){return t.collectionGroup!==null}function il(t){const e=dt(t);if(e.V===null){e.V=[];const n=__(e),s=g_(e);if(n!==null&&s===null)n.isKeyField()||e.V.push(new Ua(n)),e.V.push(new Ua(ws.keyField(),"asc"));else{let i=!1;for(const r of e.explicitOrderBy)e.V.push(r),r.field.isKeyField()&&(i=!0);if(!i){const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new Ua(ws.keyField(),r))}}}return e.V}function Qo(t){const e=dt(t);if(!e.S)if(e.limitType==="F")e.S=Uy(e.path,e.collectionGroup,il(e),e.filters,e.limit,e.startAt,e.endAt);else{const n=[];for(const r of il(e)){const o=r.dir==="desc"?"asc":"desc";n.push(new Ua(r.field,o))}const s=e.endAt?new Gc(e.endAt.position,!e.endAt.before):null,i=e.startAt?new Gc(e.startAt.position,!e.startAt.before):null;e.S=Uy(e.path,e.collectionGroup,n,e.filters,e.limit,s,i)}return e.S}function Ix(t,e,n){return new Yr(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function jf(t,e){return p_(Qo(t),Qo(e))&&t.limitType===e.limitType}function kx(t){return`${m_(Qo(t))}|lt:${t.limitType}`}function H1(t){return`Query(target=${f7(Qo(t))}; limitType=${t.limitType})`}function Hf(t,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):nt.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(t,e)&&function(n,s){for(const i of n.explicitOrderBy)if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(n,s){return!(n.startAt&&!jy(n.startAt,il(n),s)||n.endAt&&jy(n.endAt,il(n),s))}(t,e)}function Mx(t){return(e,n)=>{let s=!1;for(const i of il(t)){const r=T7(i,e,n);if(r!==0)return r;s=s||i.field.isKeyField()}return 0}}function T7(t,e,n){const s=t.field.isKeyField()?nt.comparator(e.key,n.key):function(i,r,o){const a=r.data.field(i),l=o.data.field(i);return a!==null&&l!==null?sl(a,l):ht()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return ht()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nx(t,e){if(t.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Md(e)?"-0":e}}function Ox(t){return{integerValue:""+t}}function S7(t,e){return h7(e)?Ox(e):Nx(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(){this._=void 0}}function A7(t,e,n){return t instanceof Pd?function(s,i){const r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&(r.fields.__previous_value__=i),{mapValue:r}}(n,e):t instanceof rl?Px(t,e):t instanceof ol?Dx(t,e):function(s,i){const r=Lx(s,i),o=Vy(r)+Vy(s.C);return U1(r)&&U1(s.C)?Ox(o):Nx(s.N,o)}(t,e)}function R7(t,e,n){return t instanceof rl?Px(t,e):t instanceof ol?Dx(t,e):n}function Lx(t,e){return t instanceof Dd?U1(n=e)||function(s){return!!s&&"doubleValue"in s}(n)?e:{integerValue:0}:null;var n}class Pd extends Vf{}class rl extends Vf{constructor(e){super(),this.elements=e}}function Px(t,e){const n=Bx(e);for(const s of t.elements)n.some(i=>Bi(i,s))||n.push(s);return{arrayValue:{values:n}}}class ol extends Vf{constructor(e){super(),this.elements=e}}function Dx(t,e){let n=Bx(e);for(const s of t.elements)n=n.filter(i=>!Bi(i,s));return{arrayValue:{values:n}}}class Dd extends Vf{constructor(e,n){super(),this.N=e,this.C=n}}function Vy(t){return wn(t.integerValue||t.doubleValue)}function Bx(t){return f_(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fx{constructor(e,n){this.field=e,this.transform=n}}function C7(t,e){return t.field.isEqual(e.field)&&function(n,s){return n instanceof rl&&s instanceof rl||n instanceof ol&&s instanceof ol?tl(n.elements,s.elements,Bi):n instanceof Dd&&s instanceof Dd?Bi(n.C,s.C):n instanceof Pd&&s instanceof Pd}(t.transform,e.transform)}class I7{constructor(e,n){this.version=e,this.transformResults=n}}class Zi{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Zi}static exists(e){return new Zi(void 0,e)}static updateTime(e){return new Zi(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function qh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class qf{}function k7(t,e,n){t instanceof $f?function(s,i,r){const o=s.value.clone(),a=zy(s.fieldTransforms,i,r.transformResults);o.setAll(a),i.convertToFoundDocument(r.version,o).setHasCommittedMutations()}(t,e,n):t instanceof ua?function(s,i,r){if(!qh(s.precondition,i))return void i.convertToUnknownDocument(r.version);const o=zy(s.fieldTransforms,i,r.transformResults),a=i.data;a.setAll(Ux(s)),a.setAll(o),i.convertToFoundDocument(r.version,a).setHasCommittedMutations()}(t,e,n):function(s,i,r){i.convertToNoDocument(r.version).setHasCommittedMutations()}(0,e,n)}function V1(t,e,n){t instanceof $f?function(s,i,r){if(!qh(s.precondition,i))return;const o=s.value.clone(),a=Ky(s.fieldTransforms,r,i);o.setAll(a),i.convertToFoundDocument($y(i),o).setHasLocalMutations()}(t,e,n):t instanceof ua?function(s,i,r){if(!qh(s.precondition,i))return;const o=Ky(s.fieldTransforms,r,i),a=i.data;a.setAll(Ux(s)),a.setAll(o),i.convertToFoundDocument($y(i),a).setHasLocalMutations()}(t,e,n):function(s,i){qh(s.precondition,i)&&i.convertToNoDocument(Bt.min())}(t,e)}function M7(t,e){let n=null;for(const s of t.fieldTransforms){const i=e.data.field(s.field),r=Lx(s.transform,i||null);r!=null&&(n==null&&(n=Ms.empty()),n.set(s.field,r))}return n||null}function qy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&tl(n,s,(i,r)=>C7(i,r))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function $y(t){return t.isFoundDocument()?t.version:Bt.min()}class $f extends qf{constructor(e,n,s,i=[]){super(),this.key=e,this.value=n,this.precondition=s,this.fieldTransforms=i,this.type=0}}class ua extends qf{constructor(e,n,s,i,r=[]){super(),this.key=e,this.data=n,this.fieldMask=s,this.precondition=i,this.fieldTransforms=r,this.type=1}}function Ux(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}}),e}function zy(t,e,n){const s=new Map;en(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,a=e.data.field(r.field);s.set(r.field,R7(o,a,n[i]))}return s}function Ky(t,e,n){const s=new Map;for(const i of t){const r=i.transform,o=n.data.field(i.field);s.set(i.field,A7(r,o,e))}return s}class jx extends qf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}}class N7 extends qf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O7{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bn,St;function L7(t){switch(t){default:return ht();case Ee.CANCELLED:case Ee.UNKNOWN:case Ee.DEADLINE_EXCEEDED:case Ee.RESOURCE_EXHAUSTED:case Ee.INTERNAL:case Ee.UNAVAILABLE:case Ee.UNAUTHENTICATED:return!1;case Ee.INVALID_ARGUMENT:case Ee.NOT_FOUND:case Ee.ALREADY_EXISTS:case Ee.PERMISSION_DENIED:case Ee.FAILED_PRECONDITION:case Ee.ABORTED:case Ee.OUT_OF_RANGE:case Ee.UNIMPLEMENTED:case Ee.DATA_LOSS:return!0}}function Hx(t){if(t===void 0)return Vr("GRPC error has no .code"),Ee.UNKNOWN;switch(t){case bn.OK:return Ee.OK;case bn.CANCELLED:return Ee.CANCELLED;case bn.UNKNOWN:return Ee.UNKNOWN;case bn.DEADLINE_EXCEEDED:return Ee.DEADLINE_EXCEEDED;case bn.RESOURCE_EXHAUSTED:return Ee.RESOURCE_EXHAUSTED;case bn.INTERNAL:return Ee.INTERNAL;case bn.UNAVAILABLE:return Ee.UNAVAILABLE;case bn.UNAUTHENTICATED:return Ee.UNAUTHENTICATED;case bn.INVALID_ARGUMENT:return Ee.INVALID_ARGUMENT;case bn.NOT_FOUND:return Ee.NOT_FOUND;case bn.ALREADY_EXISTS:return Ee.ALREADY_EXISTS;case bn.PERMISSION_DENIED:return Ee.PERMISSION_DENIED;case bn.FAILED_PRECONDITION:return Ee.FAILED_PRECONDITION;case bn.ABORTED:return Ee.ABORTED;case bn.OUT_OF_RANGE:return Ee.OUT_OF_RANGE;case bn.UNIMPLEMENTED:return Ee.UNIMPLEMENTED;case bn.DATA_LOSS:return Ee.DATA_LOSS;default:return ht()}}(St=bn||(bn={}))[St.OK=0]="OK",St[St.CANCELLED=1]="CANCELLED",St[St.UNKNOWN=2]="UNKNOWN",St[St.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",St[St.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",St[St.NOT_FOUND=5]="NOT_FOUND",St[St.ALREADY_EXISTS=6]="ALREADY_EXISTS",St[St.PERMISSION_DENIED=7]="PERMISSION_DENIED",St[St.UNAUTHENTICATED=16]="UNAUTHENTICATED",St[St.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",St[St.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",St[St.ABORTED=10]="ABORTED",St[St.OUT_OF_RANGE=11]="OUT_OF_RANGE",St[St.UNIMPLEMENTED=12]="UNIMPLEMENTED",St[St.INTERNAL=13]="INTERNAL",St[St.UNAVAILABLE=14]="UNAVAILABLE",St[St.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e,n){this.comparator=e,this.root=n||On.EMPTY}insert(e,n){return new Yn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,On.BLACK,null,null))}remove(e){return new Yn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,On.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){const i=this.comparator(e,s.key);if(i===0)return n+s.left.size;i<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){const e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fh(this.root,e,this.comparator,!1)}getReverseIterator(){return new fh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fh(this.root,e,this.comparator,!0)}}class fh{constructor(e,n,s,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=n?s(e.key,n):1,i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class On{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s!=null?s:On.RED,this.left=i!=null?i:On.EMPTY,this.right=r!=null?r:On.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,i,r){return new On(e!=null?e:this.key,n!=null?n:this.value,s!=null?s:this.color,i!=null?i:this.left,r!=null?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp()}removeMin(){if(this.left.isEmpty())return On.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return On.EMPTY;s=i.right.min(),i=i.copy(s.key,s.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,On.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,On.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ht();const e=this.left.check();if(e!==this.right.check())throw ht();return e+(this.isRed()?0:1)}}On.EMPTY=null,On.RED=!0,On.BLACK=!1;On.EMPTY=new class{constructor(){this.size=0}get key(){throw ht()}get value(){throw ht()}get color(){throw ht()}get left(){throw ht()}get right(){throw ht()}copy(t,e,n,s,i){return this}insert(t,e,n){return new On(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(e){this.comparator=e,this.data=new Yn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const i=s.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Gy(this.data.getIterator())}getIteratorFrom(e){return new Gy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof Bn)||this.size!==e.size)return!1;const n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,r=s.getNext().key;if(this.comparator(i,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Bn(this.comparator);return n.data=e,n}}class Gy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P7=new Yn(nt.comparator);function Zo(){return P7}const D7=new Yn(nt.comparator);function q1(){return D7}const B7=new Yn(nt.comparator);function F7(){return B7}const U7=new Bn(nt.comparator);function sn(...t){let e=U7;for(const n of t)e=e.add(n);return e}const j7=new Bn(jt);function Vx(){return j7}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e,n,s,i,r){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=s,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,n){const s=new Map;return s.set(e,Iu.createSynthesizedTargetChangeForCurrentChange(e,n)),new zf(Bt.min(),s,Vx(),Zo(),sn())}}class Iu{constructor(e,n,s,i,r){this.resumeToken=e,this.current=n,this.addedDocuments=s,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,n){return new Iu(Wn.EMPTY_BYTE_STRING,n,sn(),sn(),sn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $h{constructor(e,n,s,i){this.k=e,this.removedTargetIds=n,this.key=s,this.$=i}}class qx{constructor(e,n){this.targetId=e,this.O=n}}class $x{constructor(e,n,s=Wn.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=s,this.cause=i}}class Wy{constructor(){this.F=0,this.M=Xy(),this.L=Wn.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return this.F!==0}get K(){return this.U}j(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}W(){let e=sn(),n=sn(),s=sn();return this.M.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:s=s.add(i);break;default:ht()}}),new Iu(this.L,this.B,e,n,s)}G(){this.U=!1,this.M=Xy()}H(e,n){this.U=!0,this.M=this.M.insert(e,n)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class H7{constructor(e){this.tt=e,this.et=new Map,this.nt=Zo(),this.st=Yy(),this.it=new Bn(jt)}rt(e){for(const n of e.k)e.$&&e.$.isFoundDocument()?this.ot(n,e.$):this.ct(n,e.key,e.$);for(const n of e.removedTargetIds)this.ct(n,e.key,e.$)}at(e){this.forEachTarget(e,n=>{const s=this.ut(n);switch(e.state){case 0:this.ht(n)&&s.j(e.resumeToken);break;case 1:s.X(),s.q||s.G(),s.j(e.resumeToken);break;case 2:s.X(),s.q||this.removeTarget(n);break;case 3:this.ht(n)&&(s.Z(),s.j(e.resumeToken));break;case 4:this.ht(n)&&(this.lt(n),s.j(e.resumeToken));break;default:ht()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.et.forEach((s,i)=>{this.ht(i)&&n(i)})}ft(e){const n=e.targetId,s=e.O.count,i=this.dt(n);if(i){const r=i.target;if(j1(r))if(s===0){const o=new nt(r.path);this.ct(n,o,qn.newNoDocument(o,Bt.min()))}else en(s===1);else this.wt(n)!==s&&(this.lt(n),this.it=this.it.add(n))}}_t(e){const n=new Map;this.et.forEach((r,o)=>{const a=this.dt(o);if(a){if(r.current&&j1(a.target)){const l=new nt(a.target.path);this.nt.get(l)!==null||this.gt(o,l)||this.ct(o,l,qn.newNoDocument(l,e))}r.K&&(n.set(o,r.W()),r.G())}});let s=sn();this.st.forEach((r,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.dt(l);return!c||c.purpose===2||(a=!1,!1)}),a&&(s=s.add(r))});const i=new zf(e,n,this.it,this.nt,s);return this.nt=Zo(),this.st=Yy(),this.it=new Bn(jt),i}ot(e,n){if(!this.ht(e))return;const s=this.gt(e,n.key)?2:0;this.ut(e).H(n.key,s),this.nt=this.nt.insert(n.key,n),this.st=this.st.insert(n.key,this.yt(n.key).add(e))}ct(e,n,s){if(!this.ht(e))return;const i=this.ut(e);this.gt(e,n)?i.H(n,1):i.J(n),this.st=this.st.insert(n,this.yt(n).delete(e)),s&&(this.nt=this.nt.insert(n,s))}removeTarget(e){this.et.delete(e)}wt(e){const n=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let n=this.et.get(e);return n||(n=new Wy,this.et.set(e,n)),n}yt(e){let n=this.st.get(e);return n||(n=new Bn(jt),this.st=this.st.insert(e,n)),n}ht(e){const n=this.dt(e)!==null;return n||tt("WatchChangeAggregator","Detected inactive target",e),n}dt(e){const n=this.et.get(e);return n&&n.q?null:this.tt.Tt(e)}lt(e){this.et.set(e,new Wy),this.tt.getRemoteKeysForTarget(e).forEach(n=>{this.ct(e,n,null)})}gt(e,n){return this.tt.getRemoteKeysForTarget(e).has(n)}}function Yy(){return new Yn(nt.comparator)}function Xy(){return new Yn(nt.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V7=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),q7=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class $7{constructor(e,n){this.databaseId=e,this.D=n}}function Bd(t,e){return t.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zx(t,e){return t.D?e.toBase64():e.toUint8Array()}function z7(t,e){return Bd(t,e.toTimestamp())}function Ji(t){return en(!!t),Bt.fromTimestamp(function(e){const n=qr(e);return new Ds(n.seconds,n.nanos)}(t))}function y_(t,e){return function(n){return new nn(["projects",n.projectId,"databases",n.database])}(t).child("documents").child(e).canonicalString()}function Kx(t){const e=nn.fromString(t);return en(Yx(e)),e}function $1(t,e){return y_(t.databaseId,e.path)}function um(t,e){const n=Kx(e);if(n.get(1)!==t.databaseId.projectId)throw new qe(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new qe(Ee.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new nt(Gx(n))}function z1(t,e){return y_(t.databaseId,e)}function K7(t){const e=Kx(t);return e.length===4?nn.emptyPath():Gx(e)}function K1(t){return new nn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Gx(t){return en(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Qy(t,e,n){return{name:$1(t,e),fields:n.value.mapValue.fields}}function G7(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:ht()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(l,c){return l.D?(en(c===void 0||typeof c=="string"),Wn.fromBase64String(c||"")):(en(c===void 0||c instanceof Uint8Array),Wn.fromUint8Array(c||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const c=l.code===void 0?Ee.UNKNOWN:Hx(l.code);return new qe(c,l.message||"")}(o);n=new $x(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=um(t,s.document.name),r=Ji(s.document.updateTime),o=new Ms({mapValue:{fields:s.document.fields}}),a=qn.newFoundDocument(i,r,o),l=s.targetIds||[],c=s.removedTargetIds||[];n=new $h(l,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=um(t,s.document),r=s.readTime?Ji(s.readTime):Bt.min(),o=qn.newNoDocument(i,r),a=s.removedTargetIds||[];n=new $h([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=um(t,s.document),r=s.removedTargetIds||[];n=new $h([],r,i,null)}else{if(!("filter"in e))return ht();{e.filter;const s=e.filter;s.targetId;const i=s.count||0,r=new O7(i),o=s.targetId;n=new qx(o,r)}}return n}function W7(t,e){let n;if(e instanceof $f)n={update:Qy(t,e.key,e.value)};else if(e instanceof jx)n={delete:$1(t,e.key)};else if(e instanceof ua)n={update:Qy(t,e.key,e.data),updateMask:iN(e.fieldMask)};else{if(!(e instanceof N7))return ht();n={verify:$1(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(s=>function(i,r){const o=r.transform;if(o instanceof Pd)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof rl)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof ol)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Dd)return{fieldPath:r.field.canonicalString(),increment:o.C};throw ht()}(0,s))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:z7(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ht()}(t,e.precondition)),n}function Y7(t,e){return t&&t.length>0?(en(e!==void 0),t.map(n=>function(s,i){let r=s.updateTime?Ji(s.updateTime):Ji(i);return r.isEqual(Bt.min())&&(r=Ji(i)),new I7(r,s.transformResults||[])}(n,e))):[]}function X7(t,e){return{documents:[z1(t,e.path)]}}function Q7(t,e){const n={structuredQuery:{}},s=e.path;e.collectionGroup!==null?(n.parent=z1(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=z1(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(a){if(a.length===0)return;const l=a.map(c=>function(d){if(d.op==="=="){if(Fy(d.value))return{unaryFilter:{field:ya(d.field),op:"IS_NAN"}};if(By(d.value))return{unaryFilter:{field:ya(d.field),op:"IS_NULL"}}}else if(d.op==="!="){if(Fy(d.value))return{unaryFilter:{field:ya(d.field),op:"IS_NOT_NAN"}};if(By(d.value))return{unaryFilter:{field:ya(d.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ya(d.field),op:tN(d.op),value:d.value}}}(c));return l.length===1?l[0]:{compositeFilter:{op:"AND",filters:l}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(a){if(a.length!==0)return a.map(l=>function(c){return{field:ya(c.field),direction:eN(c.dir)}}(l))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(a,l){return a.D||Al(l)?l:{value:l}}(t,e.limit);return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Zy(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Zy(e.endAt)),n}function Z7(t){let e=K7(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){en(s===1);const d=n.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let r=[];n.where&&(r=Wx(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(d=>function(u){return new Ua(Ma(u.field),function(f){switch(f){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(u.direction))}(d)));let a=null;n.limit&&(a=function(d){let u;return u=typeof d=="object"?d.value:d,Al(u)?null:u}(n.limit));let l=null;n.startAt&&(l=Jy(n.startAt));let c=null;return n.endAt&&(c=Jy(n.endAt)),x7(e,i,o,r,a,"F",l,c)}function J7(t,e){const n=function(s,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ht()}}(0,e.purpose);return n==null?null:{"goog-listen-tags":n}}function Wx(t){return t?t.unaryFilter!==void 0?[sN(t)]:t.fieldFilter!==void 0?[nN(t)]:t.compositeFilter!==void 0?t.compositeFilter.filters.map(e=>Wx(e)).reduce((e,n)=>e.concat(n)):ht():[]}function Zy(t){return{before:t.before,values:t.position}}function Jy(t){const e=!!t.before,n=t.values||[];return new Gc(n,e)}function eN(t){return V7[t]}function tN(t){return q7[t]}function ya(t){return{fieldPath:t.canonicalString()}}function Ma(t){return ws.fromServerFormat(t.fieldPath)}function nN(t){return rs.create(Ma(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ht()}}(t.fieldFilter.op),t.fieldFilter.value)}function sN(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ma(t.unaryFilter.field);return rs.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ma(t.unaryFilter.field);return rs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ma(t.unaryFilter.field);return rs.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ma(t.unaryFilter.field);return rs.create(i,"!=",{nullValue:"NULL_VALUE"});default:return ht()}}function iN(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function Yx(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}const rN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ht(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new Ke((s,i)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(s,i)},this.catchCallback=r=>{this.wrapFailure(n,r).next(s,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof Ke?n:Ke.resolve(n)}catch(n){return Ke.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):Ke.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):Ke.reject(n)}static resolve(e){return new Ke((n,s)=>{n(e)})}static reject(e){return new Ke((n,s)=>{s(e)})}static waitFor(e){return new Ke((n,s)=>{let i=0,r=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++r,o&&r===i&&n()},l=>s(l))}),o=!0,r===i&&n()})}static or(e){let n=Ke.resolve(!1);for(const s of e)n=n.next(i=>i?Ke.resolve(i):s());return n}static forEach(e,n){const s=[];return e.forEach((i,r)=>{s.push(n.call(this,i,r))}),this.waitFor(s)}}function ku(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e,n,s,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=s,this.mutations=i}applyToRemoteDocument(e,n){const s=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const r=this.mutations[i];r.key.isEqual(e.key)&&k7(r,e,s[i])}}applyToLocalView(e){for(const n of this.baseMutations)n.key.isEqual(e.key)&&V1(n,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&V1(n,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(n=>{const s=e.get(n.key),i=s;this.applyToLocalView(i),s.isValidDocument()||i.convertToNoDocument(Bt.min())})}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),sn())}isEqual(e){return this.batchId===e.batchId&&tl(this.mutations,e.mutations,(n,s)=>qy(n,s))&&tl(this.baseMutations,e.baseMutations,(n,s)=>qy(n,s))}}class b_{constructor(e,n,s,i){this.batch=e,this.commitVersion=n,this.mutationResults=s,this.docVersions=i}static from(e,n,s){en(e.mutations.length===s.length);let i=F7();const r=e.mutations;for(let o=0;o<r.length;o++)i=i.insert(r[o].key,s[o].version);return new b_(e,n,s,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,n,s,i,r=Bt.min(),o=Bt.min(),a=Wn.EMPTY_BYTE_STRING){this.target=e,this.targetId=n,this.purpose=s,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new Do(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,n){return new Do(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Do(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(e){this.Wt=e}}function cN(t){const e=Z7({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ix(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{constructor(){this.Gt=new hN}addToCollectionParentIndex(e,n){return this.Gt.add(n),Ke.resolve()}getCollectionParents(e,n){return Ke.resolve(this.Gt.getEntries(n))}}class hN{constructor(){this.index={}}add(e){const n=e.lastSegment(),s=e.popLast(),i=this.index[n]||new Bn(nn.comparator),r=!i.has(s);return this.index[n]=i.add(s),r}has(e){const n=e.lastSegment(),s=e.popLast(),i=this.index[n];return i&&i.has(s)}getEntries(e){return(this.index[e]||new Bn(nn.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new al(0)}static ie(){return new al(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mu(t){if(t.code!==Ee.FAILED_PRECONDITION||t.message!==rN)throw t;tt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={}}get(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s!==void 0){for(const[i,r]of s)if(this.equalsFn(i,e))return r}}has(e){return this.get(e)!==void 0}set(e,n){const s=this.mapKeyFn(e),i=this.inner[s];if(i!==void 0){for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,n]);i.push([e,n])}else this.inner[s]=[[e,n]]}delete(e){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return!1;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return s.length===1?delete this.inner[n]:s.splice(i,1),!0;return!1}forEach(e){ca(this.inner,(n,s)=>{for(const[i,r]of s)e(i,r)})}isEmpty(){return Sx(this.inner)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(){this.changes=new Nu(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}getReadTime(e){const n=this.changes.get(e);return n?n.readTime:Bt.min()}addEntry(e,n){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:n})}removeEntry(e,n=null){this.assertNotApplied(),this.changes.set(e,{document:qn.newInvalidDocument(e),readTime:n})}getEntry(e,n){this.assertNotApplied();const s=this.changes.get(n);return s!==void 0?Ke.resolve(s.document):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(e,n,s){this.He=e,this.In=n,this.Ht=s}An(e,n){return this.In.getAllMutationBatchesAffectingDocumentKey(e,n).next(s=>this.Rn(e,n,s))}Rn(e,n,s){return this.He.getEntry(e,n).next(i=>{for(const r of s)r.applyToLocalView(i);return i})}bn(e,n){e.forEach((s,i)=>{for(const r of n)r.applyToLocalView(i)})}Pn(e,n){return this.He.getEntries(e,n).next(s=>this.vn(e,s).next(()=>s))}vn(e,n){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,n).next(s=>this.bn(n,s))}getDocumentsMatchingQuery(e,n,s){return function(i){return nt.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.Vn(e,n.path):v_(n)?this.Sn(e,n,s):this.Dn(e,n,s)}Vn(e,n){return this.An(e,new nt(n)).next(s=>{let i=q1();return s.isFoundDocument()&&(i=i.insert(s.key,s)),i})}Sn(e,n,s){const i=n.collectionGroup;let r=q1();return this.Ht.getCollectionParents(e,i).next(o=>Ke.forEach(o,a=>{const l=function(c,d){return new Yr(d,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(n,a.child(i));return this.Dn(e,l,s).next(c=>{c.forEach((d,u)=>{r=r.insert(d,u)})})}).next(()=>r))}Dn(e,n,s){let i,r;return this.He.getDocumentsMatchingQuery(e,n,s).next(o=>(i=o,this.In.getAllMutationBatchesAffectingQuery(e,n))).next(o=>(r=o,this.Cn(e,r,i).next(a=>{i=a;for(const l of r)for(const c of l.mutations){const d=c.key;let u=i.get(d);u==null&&(u=qn.newInvalidDocument(d),i=i.insert(d,u)),V1(c,u,l.localWriteTime),u.isFoundDocument()||(i=i.remove(d))}}))).next(()=>(i.forEach((o,a)=>{Hf(n,a)||(i=i.remove(o))}),i))}Cn(e,n,s){let i=sn();for(const o of n)for(const a of o.mutations)a instanceof ua&&s.get(a.key)===null&&(i=i.add(a.key));let r=s;return this.He.getEntries(e,i).next(o=>(o.forEach((a,l)=>{l.isFoundDocument()&&(r=r.insert(a,l))}),r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_{constructor(e,n,s,i){this.targetId=e,this.fromCache=n,this.Nn=s,this.xn=i}static kn(e,n){let s=sn(),i=sn();for(const r of n.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new w_(e,n.fromCache,s,i)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN{$n(e){this.On=e}getDocumentsMatchingQuery(e,n,s,i){return function(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}(n)||s.isEqual(Bt.min())?this.Fn(e,n):this.On.Pn(e,i).next(r=>{const o=this.Mn(n,r);return(Vh(n)||Ld(n))&&this.Ln(n.limitType,o,i,s)?this.Fn(e,n):(Oy()<=Mt.DEBUG&&tt("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),H1(n)),this.On.getDocumentsMatchingQuery(e,n,s).next(a=>(o.forEach(l=>{a=a.insert(l.key,l)}),a)))})}Mn(e,n){let s=new Bn(Mx(e));return n.forEach((i,r)=>{Hf(e,r)&&(s=s.add(r))}),s}Ln(e,n,s,i){if(s.size!==n.size)return!0;const r=e==="F"?n.last():n.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Fn(e,n){return Oy()<=Mt.DEBUG&&tt("QueryEngine","Using full collection scan to execute query:",H1(n)),this.On.getDocumentsMatchingQuery(e,n,Bt.min())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(e,n,s,i){this.persistence=e,this.Bn=n,this.N=i,this.Un=new Yn(jt),this.qn=new Nu(r=>m_(r),p_),this.Kn=Bt.min(),this.In=e.getMutationQueue(s),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new Xx(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Un))}}function pN(t,e,n,s){return new mN(t,e,n,s)}async function Qx(t,e){const n=dt(t);let s=n.In,i=n.Qn;const r=await n.persistence.runTransaction("Handle user change","readonly",o=>{let a;return n.In.getAllMutationBatches(o).next(l=>(a=l,s=n.persistence.getMutationQueue(e),i=new Xx(n.jn,s,n.persistence.getIndexManager()),s.getAllMutationBatches(o))).next(l=>{const c=[],d=[];let u=sn();for(const f of a){c.push(f.batchId);for(const m of f.mutations)u=u.add(m.key)}for(const f of l){d.push(f.batchId);for(const m of f.mutations)u=u.add(m.key)}return i.Pn(o,u).next(f=>({Wn:f,removedBatchIds:c,addedBatchIds:d}))})});return n.In=s,n.Qn=i,n.Bn.$n(n.Qn),r}function gN(t,e){const n=dt(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const i=e.batch.keys(),r=n.jn.newChangeBuffer({trackRemovals:!0});return function(o,a,l,c){const d=l.batch,u=d.keys();let f=Ke.resolve();return u.forEach(m=>{f=f.next(()=>c.getEntry(a,m)).next(h=>{const k=l.docVersions.get(m);en(k!==null),h.version.compareTo(k)<0&&(d.applyToRemoteDocument(h,l),h.isValidDocument()&&c.addEntry(h,l.commitVersion))})}),f.next(()=>o.In.removeMutationBatch(a,d))}(n,s,e,r).next(()=>r.apply(s)).next(()=>n.In.performConsistencyCheck(s)).next(()=>n.Qn.Pn(s,i))})}function Zx(t){const e=dt(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.ze.getLastRemoteSnapshotVersion(n))}function _N(t,e){const n=dt(t),s=e.snapshotVersion;let i=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=n.jn.newChangeBuffer({trackRemovals:!0});i=n.Un;const a=[];e.targetChanges.forEach((c,d)=>{const u=i.get(d);if(!u)return;a.push(n.ze.removeMatchingKeys(r,c.removedDocuments,d).next(()=>n.ze.addMatchingKeys(r,c.addedDocuments,d)));const f=c.resumeToken;if(f.approximateByteSize()>0){const m=u.withResumeToken(f,s).withSequenceNumber(r.currentSequenceNumber);i=i.insert(d,m),function(h,k,I){return en(k.resumeToken.approximateByteSize()>0),h.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-h.snapshotVersion.toMicroseconds()>=3e8?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(u,m,c)&&a.push(n.ze.updateTargetData(r,m))}});let l=Zo();if(e.documentUpdates.forEach((c,d)=>{e.resolvedLimboDocuments.has(c)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(r,c))}),a.push(vN(r,o,e.documentUpdates,s,void 0).next(c=>{l=c})),!s.isEqual(Bt.min())){const c=n.ze.getLastRemoteSnapshotVersion(r).next(d=>n.ze.setTargetsMetadata(r,r.currentSequenceNumber,s));a.push(c)}return Ke.waitFor(a).next(()=>o.apply(r)).next(()=>n.Qn.vn(r,l)).next(()=>l)}).then(r=>(n.Un=i,r))}function vN(t,e,n,s,i){let r=sn();return n.forEach(o=>r=r.add(o)),e.getEntries(t,r).next(o=>{let a=Zo();return n.forEach((l,c)=>{const d=o.get(l),u=(i==null?void 0:i.get(l))||s;c.isNoDocument()&&c.version.isEqual(Bt.min())?(e.removeEntry(l,u),a=a.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c,u),a=a.insert(l,c)):tt("LocalStore","Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),a})}function yN(t,e){const n=dt(t);return n.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),n.In.getNextMutationBatchAfterBatchId(s,e)))}function bN(t,e){const n=dt(t);return n.persistence.runTransaction("Allocate target","readwrite",s=>{let i;return n.ze.getTargetData(s,e).next(r=>r?(i=r,Ke.resolve(i)):n.ze.allocateTargetId(s).next(o=>(i=new Do(e,o,0,s.currentSequenceNumber),n.ze.addTargetData(s,i).next(()=>i))))}).then(s=>{const i=n.Un.get(s.targetId);return(i===null||s.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Un=n.Un.insert(s.targetId,s),n.qn.set(e,s.targetId)),s})}async function G1(t,e,n){const s=dt(t),i=s.Un.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,o=>s.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ku(o))throw o;tt("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}s.Un=s.Un.remove(e),s.qn.delete(i.target)}function eb(t,e,n){const s=dt(t);let i=Bt.min(),r=sn();return s.persistence.runTransaction("Execute query","readonly",o=>function(a,l,c){const d=dt(a),u=d.qn.get(c);return u!==void 0?Ke.resolve(d.Un.get(u)):d.ze.getTargetData(l,c)}(s,o,Qo(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,s.ze.getMatchingKeysForTargetId(o,a.targetId).next(l=>{r=l})}).next(()=>s.Bn.getDocumentsMatchingQuery(o,e,n?i:Bt.min(),n?r:sn())).next(a=>({documents:a,Gn:r})))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,n){return Ke.resolve(this.Yn.get(n))}saveBundleMetadata(e,n){var s;return this.Yn.set(n.id,{id:(s=n).id,version:s.version,createTime:Ji(s.createTime)}),Ke.resolve()}getNamedQuery(e,n){return Ke.resolve(this.Xn.get(n))}saveNamedQuery(e,n){return this.Xn.set(n.name,function(s){return{name:s.name,query:cN(s.bundledQuery),readTime:Ji(s.readTime)}}(n)),Ke.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(){this.Zn=new Bn(Rn.ts),this.es=new Bn(Rn.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,n){const s=new Rn(e,n);this.Zn=this.Zn.add(s),this.es=this.es.add(s)}ss(e,n){e.forEach(s=>this.addReference(s,n))}removeReference(e,n){this.rs(new Rn(e,n))}os(e,n){e.forEach(s=>this.removeReference(s,n))}cs(e){const n=new nt(new nn([])),s=new Rn(n,e),i=new Rn(n,e+1),r=[];return this.es.forEachInRange([s,i],o=>{this.rs(o),r.push(o.key)}),r}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const n=new nt(new nn([])),s=new Rn(n,e),i=new Rn(n,e+1);let r=sn();return this.es.forEachInRange([s,i],o=>{r=r.add(o.key)}),r}containsKey(e){const n=new Rn(e,0),s=this.Zn.firstAfterOrEqual(n);return s!==null&&e.isEqual(s.key)}}class Rn{constructor(e,n){this.key=e,this.ls=n}static ts(e,n){return nt.comparator(e.key,n.key)||jt(e.ls,n.ls)}static ns(e,n){return jt(e.ls,n.ls)||nt.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,n){this.Ht=e,this.referenceDelegate=n,this.In=[],this.fs=1,this.ds=new Bn(Rn.ts)}checkEmpty(e){return Ke.resolve(this.In.length===0)}addMutationBatch(e,n,s,i){const r=this.fs;this.fs++,this.In.length>0&&this.In[this.In.length-1];const o=new aN(r,n,s,i);this.In.push(o);for(const a of i)this.ds=this.ds.add(new Rn(a.key,r)),this.Ht.addToCollectionParentIndex(e,a.key.path.popLast());return Ke.resolve(o)}lookupMutationBatch(e,n){return Ke.resolve(this.ws(n))}getNextMutationBatchAfterBatchId(e,n){const s=n+1,i=this._s(s),r=i<0?0:i;return Ke.resolve(this.In.length>r?this.In[r]:null)}getHighestUnacknowledgedBatchId(){return Ke.resolve(this.In.length===0?-1:this.fs-1)}getAllMutationBatches(e){return Ke.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const s=new Rn(n,0),i=new Rn(n,Number.POSITIVE_INFINITY),r=[];return this.ds.forEachInRange([s,i],o=>{const a=this.ws(o.ls);r.push(a)}),Ke.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,n){let s=new Bn(jt);return n.forEach(i=>{const r=new Rn(i,0),o=new Rn(i,Number.POSITIVE_INFINITY);this.ds.forEachInRange([r,o],a=>{s=s.add(a.ls)})}),Ke.resolve(this.gs(s))}getAllMutationBatchesAffectingQuery(e,n){const s=n.path,i=s.length+1;let r=s;nt.isDocumentKey(r)||(r=r.child(""));const o=new Rn(new nt(r),0);let a=new Bn(jt);return this.ds.forEachWhile(l=>{const c=l.key.path;return!!s.isPrefixOf(c)&&(c.length===i&&(a=a.add(l.ls)),!0)},o),Ke.resolve(this.gs(a))}gs(e){const n=[];return e.forEach(s=>{const i=this.ws(s);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){en(this.ys(n.batchId,"removed")===0),this.In.shift();let s=this.ds;return Ke.forEach(n.mutations,i=>{const r=new Rn(i.key,n.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.ds=s})}te(e){}containsKey(e,n){const s=new Rn(n,0),i=this.ds.firstAfterOrEqual(s);return Ke.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.In.length,Ke.resolve()}ys(e,n){return this._s(e)}_s(e){return this.In.length===0?0:e-this.In[0].batchId}ws(e){const n=this._s(e);return n<0||n>=this.In.length?null:this.In[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(e,n){this.Ht=e,this.ps=n,this.docs=new Yn(nt.comparator),this.size=0}addEntry(e,n,s){const i=n.key,r=this.docs.get(i),o=r?r.size:0,a=this.ps(n);return this.docs=this.docs.insert(i,{document:n.clone(),size:a,readTime:s}),this.size+=a-o,this.Ht.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const s=this.docs.get(n);return Ke.resolve(s?s.document.clone():qn.newInvalidDocument(n))}getEntries(e,n){let s=Zo();return n.forEach(i=>{const r=this.docs.get(i);s=s.insert(i,r?r.document.clone():qn.newInvalidDocument(i))}),Ke.resolve(s)}getDocumentsMatchingQuery(e,n,s){let i=Zo();const r=new nt(n.path.child("")),o=this.docs.getIteratorFrom(r);for(;o.hasNext();){const{key:a,value:{document:l,readTime:c}}=o.getNext();if(!n.path.isPrefixOf(a.path))break;c.compareTo(s)<=0||Hf(n,l)&&(i=i.insert(l.key,l.clone()))}return Ke.resolve(i)}Ts(e,n){return Ke.forEach(this.docs,s=>n(s))}newChangeBuffer(e){return new TN(this)}getSize(e){return Ke.resolve(this.size)}}class TN extends dN{constructor(e){super(),this.Se=e}applyChanges(e){const n=[];return this.changes.forEach((s,i)=>{i.document.isValidDocument()?n.push(this.Se.addEntry(e,i.document,this.getReadTime(s))):this.Se.removeEntry(s)}),Ke.waitFor(n)}getFromCache(e,n){return this.Se.getEntry(e,n)}getAllFromCache(e,n){return this.Se.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SN{constructor(e){this.persistence=e,this.Es=new Nu(n=>m_(n),p_),this.lastRemoteSnapshotVersion=Bt.min(),this.highestTargetId=0,this.Is=0,this.As=new E_,this.targetCount=0,this.Rs=al.se()}forEachTarget(e,n){return this.Es.forEach((s,i)=>n(i)),Ke.resolve()}getLastRemoteSnapshotVersion(e){return Ke.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ke.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),Ke.resolve(this.highestTargetId)}setTargetsMetadata(e,n,s){return s&&(this.lastRemoteSnapshotVersion=s),n>this.Is&&(this.Is=n),Ke.resolve()}ce(e){this.Es.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Rs=new al(n),this.highestTargetId=n),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,n){return this.ce(n),this.targetCount+=1,Ke.resolve()}updateTargetData(e,n){return this.ce(n),Ke.resolve()}removeTargetData(e,n){return this.Es.delete(n.target),this.As.cs(n.targetId),this.targetCount-=1,Ke.resolve()}removeTargets(e,n,s){let i=0;const r=[];return this.Es.forEach((o,a)=>{a.sequenceNumber<=n&&s.get(a.targetId)===null&&(this.Es.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),Ke.waitFor(r).next(()=>i)}getTargetCount(e){return Ke.resolve(this.targetCount)}getTargetData(e,n){const s=this.Es.get(n)||null;return Ke.resolve(s)}addMatchingKeys(e,n,s){return this.As.ss(n,s),Ke.resolve()}removeMatchingKeys(e,n,s){this.As.os(n,s);const i=this.persistence.referenceDelegate,r=[];return i&&n.forEach(o=>{r.push(i.markPotentiallyOrphaned(e,o))}),Ke.waitFor(r)}removeMatchingKeysForTargetId(e,n){return this.As.cs(n),Ke.resolve()}getMatchingKeysForTargetId(e,n){const s=this.As.hs(n);return Ke.resolve(s)}containsKey(e,n){return Ke.resolve(this.As.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AN{constructor(e,n){this.bs={},this.Le=new u_(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new SN(this),this.Ht=new uN,this.He=function(s,i){return new xN(s,i)}(this.Ht,s=>this.referenceDelegate.Ps(s)),this.N=new lN(n),this.Je=new wN(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let n=this.bs[e.toKey()];return n||(n=new EN(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=n),n}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,n,s){tt("MemoryPersistence","Starting transaction:",e);const i=new RN(this.Le.next());return this.referenceDelegate.vs(),s(i).next(r=>this.referenceDelegate.Vs(i).next(()=>r)).toPromise().then(r=>(i.raiseOnCommittedEvent(),r))}Ss(e,n){return Ke.or(Object.values(this.bs).map(s=>()=>s.containsKey(e,n)))}}class RN extends oN{constructor(e){super(),this.currentSequenceNumber=e}}class x_{constructor(e){this.persistence=e,this.Ds=new E_,this.Cs=null}static Ns(e){return new x_(e)}get xs(){if(this.Cs)return this.Cs;throw ht()}addReference(e,n,s){return this.Ds.addReference(s,n),this.xs.delete(s.toString()),Ke.resolve()}removeReference(e,n,s){return this.Ds.removeReference(s,n),this.xs.add(s.toString()),Ke.resolve()}markPotentiallyOrphaned(e,n){return this.xs.add(n.toString()),Ke.resolve()}removeTarget(e,n){this.Ds.cs(n.targetId).forEach(i=>this.xs.add(i.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(r=>this.xs.add(r.toString()))}).next(()=>s.removeTargetData(e,n))}vs(){this.Cs=new Set}Vs(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ke.forEach(this.xs,s=>{const i=nt.fromPath(s);return this.ks(e,i).next(r=>{r||n.removeEntry(i)})}).next(()=>(this.Cs=null,n.apply(e)))}updateLimboDocument(e,n){return this.ks(e,n).next(s=>{s?this.xs.delete(n.toString()):this.xs.add(n.toString())})}Ps(e){return 0}ks(e,n){return Ke.or([()=>Ke.resolve(this.Ds.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ss(e,n)])}}class tb{constructor(){this.activeTargetIds=Vx()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class CN{constructor(){this.yi=new tb,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,s){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,n,s){this.pi[e]=n}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new tb,Promise.resolve()}handleUserChange(e,n,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{Ti(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){tt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){tt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MN{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http";this.Fi=n+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(e,n,s,i){const r=this.Bi(e,n);tt("RestConnection","Sending: ",r,s);const o={};return this.Ui(o,i),this.qi(e,r,o,s).then(a=>(tt("RestConnection","Received: ",a),a),a=>{throw Ly("RestConnection",`${e} failed with error: `,a,"url: ",r,"request:",s),a})}Ki(e,n,s,i){return this.Li(e,n,s,i)}Ui(e,n){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Sl,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(const s in n.authHeaders)n.authHeaders.hasOwnProperty(s)&&(e[s]=n.authHeaders[s])}Bi(e,n){const s=kN[e];return`${this.Fi}/v1/${n}:${s}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(e,n,s,i){return new Promise((r,o)=>{const a=new n7;a.listenOnce(JM.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case cm.NO_ERROR:const c=a.getResponseJson();tt("Connection","XHR received:",JSON.stringify(c)),r(c);break;case cm.TIMEOUT:tt("Connection",'RPC "'+e+'" timed out'),o(new qe(Ee.DEADLINE_EXCEEDED,"Request time out"));break;case cm.HTTP_ERROR:const d=a.getStatus();if(tt("Connection",'RPC "'+e+'" failed with status:',d,"response text:",a.getResponseText()),d>0){const u=a.getResponseJson().error;if(u&&u.status&&u.message){const f=function(m){const h=m.toLowerCase().replace(/_/g,"-");return Object.values(Ee).indexOf(h)>=0?h:Ee.UNKNOWN}(u.status);o(new qe(f,u.message))}else o(new qe(Ee.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new qe(Ee.UNAVAILABLE,"Connection failed."));break;default:ht()}}finally{tt("Connection",'RPC "'+e+'" completed.')}});const l=JSON.stringify(i);a.send(n,"POST",l,s,15)})}ji(e,n){const s=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=QM(),r=ZM(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new t7({})),this.Ui(o.initMessageHeaders,n),Qp()||l4()||DR()||BR()||FR()||PR()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=s.join("");tt("Connection","Creating WebChannel: "+a,o);const l=i.createWebChannel(a,o);let c=!1,d=!1;const u=new MN({vi:m=>{d?tt("Connection","Not sending because WebChannel is closed:",m):(c||(tt("Connection","Opening WebChannel transport."),l.open(),c=!0),tt("Connection","WebChannel sending:",m),l.send(m))},Vi:()=>l.close()}),f=(m,h,k)=>{m.listen(h,I=>{try{k(I)}catch(L){setTimeout(()=>{throw L},0)}})};return f(l,dh.EventType.OPEN,()=>{d||tt("Connection","WebChannel transport opened.")}),f(l,dh.EventType.CLOSE,()=>{d||(d=!0,tt("Connection","WebChannel transport closed"),u.$i())}),f(l,dh.EventType.ERROR,m=>{d||(d=!0,Ly("Connection","WebChannel transport errored:",m),u.$i(new qe(Ee.UNAVAILABLE,"The operation could not be completed")))}),f(l,dh.EventType.MESSAGE,m=>{var h;if(!d){const k=m.data[0];en(!!k);const I=k,L=I.error||((h=I[0])===null||h===void 0?void 0:h.error);if(L){tt("Connection","WebChannel received error:",L);const p=L.status;let C=function(M){const F=bn[M];if(F!==void 0)return Hx(F)}(p),P=L.message;C===void 0&&(C=Ee.INTERNAL,P="Unknown error status: "+p+" with message "+L.message),d=!0,u.$i(new qe(C,P)),l.close()}else tt("Connection","WebChannel received:",k),u.Oi(k)}}),f(r,e7.STAT_EVENT,m=>{m.stat===My.PROXY?tt("Connection","Detected buffering proxy"):m.stat===My.NOPROXY&&tt("Connection","Detected no buffering proxy")}),setTimeout(()=>{u.ki()},0),u}}function hm(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kf(t){return new $7(t,!0)}class Jx{constructor(e,n,s=1e3,i=1.5,r=6e4){this.Oe=e,this.timerId=n,this.Qi=s,this.Wi=i,this.Gi=r,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();const n=Math.floor(this.zi+this.Zi()),s=Math.max(0,Date.now()-this.Ji),i=Math.max(0,n-s);i>0&&tt("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.zi} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,i,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){this.Hi!==null&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){this.Hi!==null&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(e,n,s,i,r,o,a){this.Oe=e,this.er=s,this.nr=i,this.sr=r,this.credentialsProvider=o,this.listener=a,this.state=0,this.ir=0,this.rr=null,this.cr=null,this.stream=null,this.ar=new Jx(e,n)}ur(){return this.state===1||this.state===5||this.hr()}hr(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.lr()}async stop(){this.ur()&&await this.close(0)}dr(){this.state=0,this.ar.reset()}wr(){this.hr()&&this.rr===null&&(this.rr=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this._r()))}mr(e){this.gr(),this.stream.send(e)}async _r(){if(this.hr())return this.close(0)}gr(){this.rr&&(this.rr.cancel(),this.rr=null)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(e,n){this.gr(),this.yr(),this.ar.cancel(),this.ir++,e!==4?this.ar.reset():n&&n.code===Ee.RESOURCE_EXHAUSTED?(Vr(n.toString()),Vr("Using maximum backoff delay to prevent overloading the backend."),this.ar.Yi()):n&&n.code===Ee.UNAUTHENTICATED&&this.state!==3&&this.credentialsProvider.invalidateToken(),this.stream!==null&&(this.pr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(n)}pr(){}auth(){this.state=1;const e=this.Tr(this.ir),n=this.ir;this.credentialsProvider.getToken().then(s=>{this.ir===n&&this.Er(s)},s=>{e(()=>{const i=new qe(Ee.UNKNOWN,"Fetching auth token failed: "+s.message);return this.Ir(i)})})}Er(e){const n=this.Tr(this.ir);this.stream=this.Ar(e),this.stream.Si(()=>{n(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.nr,1e4,()=>(this.hr()&&(this.state=3),Promise.resolve())),this.listener.Si()))}),this.stream.Ci(s=>{n(()=>this.Ir(s))}),this.stream.onMessage(s=>{n(()=>this.onMessage(s))})}lr(){this.state=5,this.ar.Xi(async()=>{this.state=0,this.start()})}Ir(e){return tt("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Tr(e){return n=>{this.Oe.enqueueAndForget(()=>this.ir===e?n():(tt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ON extends e5{constructor(e,n,s,i,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,s,r),this.N=i}Ar(e){return this.sr.ji("Listen",e)}onMessage(e){this.ar.reset();const n=G7(this.N,e),s=function(i){if(!("targetChange"in i))return Bt.min();const r=i.targetChange;return r.targetIds&&r.targetIds.length?Bt.min():r.readTime?Ji(r.readTime):Bt.min()}(e);return this.listener.Rr(n,s)}br(e){const n={};n.database=K1(this.N),n.addTarget=function(i,r){let o;const a=r.target;return o=j1(a)?{documents:X7(i,a)}:{query:Q7(i,a)},o.targetId=r.targetId,r.resumeToken.approximateByteSize()>0?o.resumeToken=zx(i,r.resumeToken):r.snapshotVersion.compareTo(Bt.min())>0&&(o.readTime=Bd(i,r.snapshotVersion.toTimestamp())),o}(this.N,e);const s=J7(this.N,e);s&&(n.labels=s),this.mr(n)}Pr(e){const n={};n.database=K1(this.N),n.removeTarget=e,this.mr(n)}}class LN extends e5{constructor(e,n,s,i,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,s,r),this.N=i,this.vr=!1}get Vr(){return this.vr}start(){this.vr=!1,this.lastStreamToken=void 0,super.start()}pr(){this.vr&&this.Sr([])}Ar(e){return this.sr.ji("Write",e)}onMessage(e){if(en(!!e.streamToken),this.lastStreamToken=e.streamToken,this.vr){this.ar.reset();const n=Y7(e.writeResults,e.commitTime),s=Ji(e.commitTime);return this.listener.Dr(s,n)}return en(!e.writeResults||e.writeResults.length===0),this.vr=!0,this.listener.Cr()}Nr(){const e={};e.database=K1(this.N),this.mr(e)}Sr(e){const n={streamToken:this.lastStreamToken,writes:e.map(s=>W7(this.N,s))};this.mr(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN extends class{}{constructor(e,n,s){super(),this.credentials=e,this.sr=n,this.N=s,this.kr=!1}$r(){if(this.kr)throw new qe(Ee.FAILED_PRECONDITION,"The client has already been terminated.")}Li(e,n,s){return this.$r(),this.credentials.getToken().then(i=>this.sr.Li(e,n,s,i)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Ee.UNAUTHENTICATED&&this.credentials.invalidateToken(),i):new qe(Ee.UNKNOWN,i.toString())})}Ki(e,n,s){return this.$r(),this.credentials.getToken().then(i=>this.sr.Ki(e,n,s,i)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Ee.UNAUTHENTICATED&&this.credentials.invalidateToken(),i):new qe(Ee.UNKNOWN,i.toString())})}terminate(){this.kr=!0}}class DN{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.Or=0,this.Fr=null,this.Mr=!0}Lr(){this.Or===0&&(this.Br("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.Ur("Backend didn't respond within 10 seconds."),this.Br("Offline"),Promise.resolve())))}qr(e){this.state==="Online"?this.Br("Unknown"):(this.Or++,this.Or>=1&&(this.Kr(),this.Ur(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Br("Offline")))}set(e){this.Kr(),this.Or=0,e==="Online"&&(this.Mr=!1),this.Br(e)}Br(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Ur(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Mr?(Vr(n),this.Mr=!1):tt("OnlineStateTracker",n)}Kr(){this.Fr!==null&&(this.Fr.cancel(),this.Fr=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e,n,s,i,r){this.localStore=e,this.datastore=n,this.asyncQueue=s,this.remoteSyncer={},this.jr=[],this.Qr=new Map,this.Wr=new Set,this.Gr=[],this.zr=r,this.zr.Ti(o=>{s.enqueueAndForget(async()=>{ha(this)&&(tt("RemoteStore","Restarting streams for network reachability change."),await async function(a){const l=dt(a);l.Wr.add(4),await Ou(l),l.Hr.set("Unknown"),l.Wr.delete(4),await Gf(l)}(this))})}),this.Hr=new DN(s,i)}}async function Gf(t){if(ha(t))for(const e of t.Gr)await e(!0)}async function Ou(t){for(const e of t.Gr)await e(!1)}function t5(t,e){const n=dt(t);n.Qr.has(e.targetId)||(n.Qr.set(e.targetId,e),A_(n)?S_(n):Rl(n).hr()&&T_(n,e))}function n5(t,e){const n=dt(t),s=Rl(n);n.Qr.delete(e),s.hr()&&s5(n,e),n.Qr.size===0&&(s.hr()?s.wr():ha(n)&&n.Hr.set("Unknown"))}function T_(t,e){t.Jr.Y(e.targetId),Rl(t).br(e)}function s5(t,e){t.Jr.Y(e),Rl(t).Pr(e)}function S_(t){t.Jr=new H7({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.Qr.get(e)||null}),Rl(t).start(),t.Hr.Lr()}function A_(t){return ha(t)&&!Rl(t).ur()&&t.Qr.size>0}function ha(t){return dt(t).Wr.size===0}function i5(t){t.Jr=void 0}async function FN(t){t.Qr.forEach((e,n)=>{T_(t,e)})}async function UN(t,e){i5(t),A_(t)?(t.Hr.qr(e),S_(t)):t.Hr.set("Unknown")}async function jN(t,e,n){if(t.Hr.set("Online"),e instanceof $x&&e.state===2&&e.cause)try{await async function(s,i){const r=i.cause;for(const o of i.targetIds)s.Qr.has(o)&&(await s.remoteSyncer.rejectListen(o,r),s.Qr.delete(o),s.Jr.removeTarget(o))}(t,e)}catch(s){tt("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Fd(t,s)}else if(e instanceof $h?t.Jr.rt(e):e instanceof qx?t.Jr.ft(e):t.Jr.at(e),!n.isEqual(Bt.min()))try{const s=await Zx(t.localStore);n.compareTo(s)>=0&&await function(i,r){const o=i.Jr._t(r);return o.targetChanges.forEach((a,l)=>{if(a.resumeToken.approximateByteSize()>0){const c=i.Qr.get(l);c&&i.Qr.set(l,c.withResumeToken(a.resumeToken,r))}}),o.targetMismatches.forEach(a=>{const l=i.Qr.get(a);if(!l)return;i.Qr.set(a,l.withResumeToken(Wn.EMPTY_BYTE_STRING,l.snapshotVersion)),s5(i,a);const c=new Do(l.target,a,1,l.sequenceNumber);T_(i,c)}),i.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(s){tt("RemoteStore","Failed to raise snapshot:",s),await Fd(t,s)}}async function Fd(t,e,n){if(!ku(e))throw e;t.Wr.add(1),await Ou(t),t.Hr.set("Offline"),n||(n=()=>Zx(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{tt("RemoteStore","Retrying IndexedDB access"),await n(),t.Wr.delete(1),await Gf(t)})}function r5(t,e){return e().catch(n=>Fd(t,n,e))}async function Wf(t){const e=dt(t),n=$r(e);let s=e.jr.length>0?e.jr[e.jr.length-1].batchId:-1;for(;HN(e);)try{const i=await yN(e.localStore,s);if(i===null){e.jr.length===0&&n.wr();break}s=i.batchId,VN(e,i)}catch(i){await Fd(e,i)}o5(e)&&a5(e)}function HN(t){return ha(t)&&t.jr.length<10}function VN(t,e){t.jr.push(e);const n=$r(t);n.hr()&&n.Vr&&n.Sr(e.mutations)}function o5(t){return ha(t)&&!$r(t).ur()&&t.jr.length>0}function a5(t){$r(t).start()}async function qN(t){$r(t).Nr()}async function $N(t){const e=$r(t);for(const n of t.jr)e.Sr(n.mutations)}async function zN(t,e,n){const s=t.jr.shift(),i=b_.from(s,e,n);await r5(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await Wf(t)}async function KN(t,e){e&&$r(t).Vr&&await async function(n,s){if(i=s.code,L7(i)&&i!==Ee.ABORTED){const r=n.jr.shift();$r(n).dr(),await r5(n,()=>n.remoteSyncer.rejectFailedWrite(r.batchId,s)),await Wf(n)}var i}(t,e),o5(t)&&a5(t)}async function GN(t,e){const n=dt(t);e?(n.Wr.delete(2),await Gf(n)):e||(n.Wr.add(2),await Ou(n),n.Hr.set("Unknown"))}function Rl(t){return t.Yr||(t.Yr=function(e,n,s){const i=dt(e);return i.$r(),new ON(n,i.sr,i.credentials,i.N,s)}(t.datastore,t.asyncQueue,{Si:FN.bind(null,t),Ci:UN.bind(null,t),Rr:jN.bind(null,t)}),t.Gr.push(async e=>{e?(t.Yr.dr(),A_(t)?S_(t):t.Hr.set("Unknown")):(await t.Yr.stop(),i5(t))})),t.Yr}function $r(t){return t.Xr||(t.Xr=function(e,n,s){const i=dt(e);return i.$r(),new LN(n,i.sr,i.credentials,i.N,s)}(t.datastore,t.asyncQueue,{Si:qN.bind(null,t),Ci:KN.bind(null,t),Cr:$N.bind(null,t),Dr:zN.bind(null,t)}),t.Gr.push(async e=>{e?(t.Xr.dr(),await Wf(t)):(await t.Xr.stop(),t.jr.length>0&&(tt("RemoteStore",`Stopping write stream with ${t.jr.length} pending writes`),t.jr=[]))})),t.Xr}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R_{constructor(e,n,s,i,r){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=i,this.removalCallback=r,this.deferred=new Qi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,n,s,i,r){const o=Date.now()+s,a=new R_(e,n,o,i,r);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new qe(Ee.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function C_(t,e){if(Vr("AsyncQueue",`${e}: ${t}`),ku(t))return new qe(Ee.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e){this.comparator=e?(n,s)=>e(n,s)||nt.comparator(n.key,s.key):(n,s)=>nt.comparator(n.key,s.key),this.keyedMap=q1(),this.sortedSet=new Yn(this.comparator)}static emptySet(e){return new ja(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,s)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ja)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,r=s.getNext().key;if(!i.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const s=new ja;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=n,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sb{constructor(){this.Zr=new Yn(nt.comparator)}track(e){const n=e.doc.key,s=this.Zr.get(n);s?e.type!==0&&s.type===3?this.Zr=this.Zr.insert(n,e):e.type===3&&s.type!==1?this.Zr=this.Zr.insert(n,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.Zr=this.Zr.insert(n,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.Zr=this.Zr.insert(n,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.Zr=this.Zr.remove(n):e.type===1&&s.type===2?this.Zr=this.Zr.insert(n,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.Zr=this.Zr.insert(n,{type:2,doc:e.doc}):ht():this.Zr=this.Zr.insert(n,e)}eo(){const e=[];return this.Zr.inorderTraversal((n,s)=>{e.push(s)}),e}}class ll{constructor(e,n,s,i,r,o,a,l){this.query=e,this.docs=n,this.oldDocs=s,this.docChanges=i,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l}static fromInitialDocuments(e,n,s,i){const r=[];return n.forEach(o=>{r.push({type:0,doc:o})}),new ll(e,n,ja.emptySet(n),r,s,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,s=e.docChanges;if(n.length!==s.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==s[i].type||!n[i].doc.isEqual(s[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(){this.no=void 0,this.listeners=[]}}class YN{constructor(){this.queries=new Nu(e=>kx(e),jf),this.onlineState="Unknown",this.so=new Set}}async function I_(t,e){const n=dt(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new WN),i)try{r.no=await n.onListen(s)}catch(o){const a=C_(o,`Initialization of query '${H1(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,r),r.listeners.push(e),e.io(n.onlineState),r.no&&e.ro(r.no)&&M_(n)}async function k_(t,e){const n=dt(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const o=r.listeners.indexOf(e);o>=0&&(r.listeners.splice(o,1),i=r.listeners.length===0)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function XN(t,e){const n=dt(t);let s=!1;for(const i of e){const r=i.query,o=n.queries.get(r);if(o){for(const a of o.listeners)a.ro(i)&&(s=!0);o.no=i}}s&&M_(n)}function QN(t,e,n){const s=dt(t),i=s.queries.get(e);if(i)for(const r of i.listeners)r.onError(n);s.queries.delete(e)}function M_(t){t.so.forEach(e=>{e.next()})}class N_{constructor(e,n,s){this.query=e,this.oo=n,this.co=!1,this.ao=null,this.onlineState="Unknown",this.options=s||{}}ro(e){if(!this.options.includeMetadataChanges){const s=[];for(const i of e.docChanges)i.type!==3&&s.push(i);e=new ll(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let n=!1;return this.co?this.uo(e)&&(this.oo.next(e),n=!0):this.ho(e,this.onlineState)&&(this.lo(e),n=!0),this.ao=e,n}onError(e){this.oo.error(e)}io(e){this.onlineState=e;let n=!1;return this.ao&&!this.co&&this.ho(this.ao,e)&&(this.lo(this.ao),n=!0),n}ho(e,n){if(!e.fromCache)return!0;const s=n!=="Offline";return(!this.options.fo||!s)&&(!e.docs.isEmpty()||n==="Offline")}uo(e){if(e.docChanges.length>0)return!0;const n=this.ao&&this.ao.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}lo(e){e=ll.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.oo.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(e){this.key=e}}class c5{constructor(e){this.key=e}}class ZN{constructor(e,n){this.query=e,this.po=n,this.To=null,this.current=!1,this.Eo=sn(),this.mutatedKeys=sn(),this.Io=Mx(e),this.Ao=new ja(this.Io)}get Ro(){return this.po}bo(e,n){const s=n?n.Po:new sb,i=n?n.Ao:this.Ao;let r=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=Vh(this.query)&&i.size===this.query.limit?i.last():null,c=Ld(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,u)=>{const f=i.get(d),m=Hf(this.query,u)?u:null,h=!!f&&this.mutatedKeys.has(f.key),k=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let I=!1;f&&m?f.data.isEqual(m.data)?h!==k&&(s.track({type:3,doc:m}),I=!0):this.vo(f,m)||(s.track({type:2,doc:m}),I=!0,(l&&this.Io(m,l)>0||c&&this.Io(m,c)<0)&&(a=!0)):!f&&m?(s.track({type:0,doc:m}),I=!0):f&&!m&&(s.track({type:1,doc:f}),I=!0,(l||c)&&(a=!0)),I&&(m?(o=o.add(m),r=k?r.add(d):r.delete(d)):(o=o.delete(d),r=r.delete(d)))}),Vh(this.query)||Ld(this.query))for(;o.size>this.query.limit;){const d=Vh(this.query)?o.last():o.first();o=o.delete(d.key),r=r.delete(d.key),s.track({type:1,doc:d})}return{Ao:o,Po:s,Ln:a,mutatedKeys:r}}vo(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,s){const i=this.Ao;this.Ao=e.Ao,this.mutatedKeys=e.mutatedKeys;const r=e.Po.eo();r.sort((c,d)=>function(u,f){const m=h=>{switch(h){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ht()}};return m(u)-m(f)}(c.type,d.type)||this.Io(c.doc,d.doc)),this.Vo(s);const o=n?this.So():[],a=this.Eo.size===0&&this.current?1:0,l=a!==this.To;return this.To=a,r.length!==0||l?{snapshot:new ll(this.query,e.Ao,i,r,e.mutatedKeys,a===0,l,!1),Do:o}:{Do:o}}io(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ao:this.Ao,Po:new sb,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{Do:[]}}Co(e){return!this.po.has(e)&&!!this.Ao.has(e)&&!this.Ao.get(e).hasLocalMutations}Vo(e){e&&(e.addedDocuments.forEach(n=>this.po=this.po.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.po=this.po.delete(n)),this.current=e.current)}So(){if(!this.current)return[];const e=this.Eo;this.Eo=sn(),this.Ao.forEach(s=>{this.Co(s.key)&&(this.Eo=this.Eo.add(s.key))});const n=[];return e.forEach(s=>{this.Eo.has(s)||n.push(new c5(s))}),this.Eo.forEach(s=>{e.has(s)||n.push(new l5(s))}),n}No(e){this.po=e.Gn,this.Eo=sn();const n=this.bo(e.documents);return this.applyChanges(n,!0)}xo(){return ll.fromInitialDocuments(this.query,this.Ao,this.mutatedKeys,this.To===0)}}class JN{constructor(e,n,s){this.query=e,this.targetId=n,this.view=s}}class eO{constructor(e){this.key=e,this.ko=!1}}class tO{constructor(e,n,s,i,r,o){this.localStore=e,this.remoteStore=n,this.eventManager=s,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.$o={},this.Oo=new Nu(a=>kx(a),jf),this.Fo=new Map,this.Mo=new Set,this.Lo=new Yn(nt.comparator),this.Bo=new Map,this.Uo=new E_,this.qo={},this.Ko=new Map,this.jo=al.ie(),this.onlineState="Unknown",this.Qo=void 0}get isPrimaryClient(){return this.Qo===!0}}async function nO(t,e){const n=dO(t);let s,i;const r=n.Oo.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.xo();else{const o=await bN(n.localStore,Qo(e)),a=n.sharedClientState.addLocalQueryTarget(o.targetId);s=o.targetId,i=await sO(n,e,s,a==="current"),n.isPrimaryClient&&t5(n.remoteStore,o)}return i}async function sO(t,e,n,s){t.Wo=(d,u,f)=>async function(m,h,k,I){let L=h.view.bo(k);L.Ln&&(L=await eb(m.localStore,h.query,!1).then(({documents:P})=>h.view.bo(P,L)));const p=I&&I.targetChanges.get(h.targetId),C=h.view.applyChanges(L,m.isPrimaryClient,p);return rb(m,h.targetId,C.Do),C.snapshot}(t,d,u,f);const i=await eb(t.localStore,e,!0),r=new ZN(e,i.Gn),o=r.bo(i.documents),a=Iu.createSynthesizedTargetChangeForCurrentChange(n,s&&t.onlineState!=="Offline"),l=r.applyChanges(o,t.isPrimaryClient,a);rb(t,n,l.Do);const c=new JN(e,n,r);return t.Oo.set(e,c),t.Fo.has(n)?t.Fo.get(n).push(e):t.Fo.set(n,[e]),l.snapshot}async function iO(t,e){const n=dt(t),s=n.Oo.get(e),i=n.Fo.get(s.targetId);if(i.length>1)return n.Fo.set(s.targetId,i.filter(r=>!jf(r,e))),void n.Oo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await G1(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),n5(n.remoteStore,s.targetId),W1(n,s.targetId)}).catch(Mu)):(W1(n,s.targetId),await G1(n.localStore,s.targetId,!0))}async function rO(t,e,n){const s=fO(t);try{const i=await function(r,o){const a=dt(r),l=Ds.now(),c=o.reduce((u,f)=>u.add(f.key),sn());let d;return a.persistence.runTransaction("Locally write mutations","readwrite",u=>a.Qn.Pn(u,c).next(f=>{d=f;const m=[];for(const h of o){const k=M7(h,d.get(h.key));k!=null&&m.push(new ua(h.key,k,Rx(k.value.mapValue),Zi.exists(!0)))}return a.In.addMutationBatch(u,l,m,o)})).then(u=>(u.applyToLocalDocumentSet(d),{batchId:u.batchId,changes:d}))}(s.localStore,e);s.sharedClientState.addPendingMutation(i.batchId),function(r,o,a){let l=r.qo[r.currentUser.toKey()];l||(l=new Yn(jt)),l=l.insert(o,a),r.qo[r.currentUser.toKey()]=l}(s,i.batchId,n),await Lu(s,i.changes),await Wf(s.remoteStore)}catch(i){const r=C_(i,"Failed to persist write");n.reject(r)}}async function u5(t,e){const n=dt(t);try{const s=await _N(n.localStore,e);e.targetChanges.forEach((i,r)=>{const o=n.Bo.get(r);o&&(en(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.ko=!0:i.modifiedDocuments.size>0?en(o.ko):i.removedDocuments.size>0&&(en(o.ko),o.ko=!1))}),await Lu(n,s,e)}catch(s){await Mu(s)}}function ib(t,e,n){const s=dt(t);if(s.isPrimaryClient&&n===0||!s.isPrimaryClient&&n===1){const i=[];s.Oo.forEach((r,o)=>{const a=o.view.io(e);a.snapshot&&i.push(a.snapshot)}),function(r,o){const a=dt(r);a.onlineState=o;let l=!1;a.queries.forEach((c,d)=>{for(const u of d.listeners)u.io(o)&&(l=!0)}),l&&M_(a)}(s.eventManager,e),i.length&&s.$o.Rr(i),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function oO(t,e,n){const s=dt(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Bo.get(e),r=i&&i.key;if(r){let o=new Yn(nt.comparator);o=o.insert(r,qn.newNoDocument(r,Bt.min()));const a=sn().add(r),l=new zf(Bt.min(),new Map,new Bn(jt),o,a);await u5(s,l),s.Lo=s.Lo.remove(r),s.Bo.delete(e),O_(s)}else await G1(s.localStore,e,!1).then(()=>W1(s,e,n)).catch(Mu)}async function aO(t,e){const n=dt(t),s=e.batch.batchId;try{const i=await gN(n.localStore,e);d5(n,s,null),h5(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Lu(n,i)}catch(i){await Mu(i)}}async function lO(t,e,n){const s=dt(t);try{const i=await function(r,o){const a=dt(r);return a.persistence.runTransaction("Reject batch","readwrite-primary",l=>{let c;return a.In.lookupMutationBatch(l,o).next(d=>(en(d!==null),c=d.keys(),a.In.removeMutationBatch(l,d))).next(()=>a.In.performConsistencyCheck(l)).next(()=>a.Qn.Pn(l,c))})}(s.localStore,e);d5(s,e,n),h5(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Lu(s,i)}catch(i){await Mu(i)}}function h5(t,e){(t.Ko.get(e)||[]).forEach(n=>{n.resolve()}),t.Ko.delete(e)}function d5(t,e,n){const s=dt(t);let i=s.qo[s.currentUser.toKey()];if(i){const r=i.get(e);r&&(n?r.reject(n):r.resolve(),i=i.remove(e)),s.qo[s.currentUser.toKey()]=i}}function W1(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Fo.get(e))t.Oo.delete(s),n&&t.$o.Go(s,n);t.Fo.delete(e),t.isPrimaryClient&&t.Uo.cs(e).forEach(s=>{t.Uo.containsKey(s)||f5(t,s)})}function f5(t,e){t.Mo.delete(e.path.canonicalString());const n=t.Lo.get(e);n!==null&&(n5(t.remoteStore,n),t.Lo=t.Lo.remove(e),t.Bo.delete(n),O_(t))}function rb(t,e,n){for(const s of n)s instanceof l5?(t.Uo.addReference(s.key,e),cO(t,s)):s instanceof c5?(tt("SyncEngine","Document no longer in limbo: "+s.key),t.Uo.removeReference(s.key,e),t.Uo.containsKey(s.key)||f5(t,s.key)):ht()}function cO(t,e){const n=e.key,s=n.path.canonicalString();t.Lo.get(n)||t.Mo.has(s)||(tt("SyncEngine","New document in limbo: "+n),t.Mo.add(s),O_(t))}function O_(t){for(;t.Mo.size>0&&t.Lo.size<t.maxConcurrentLimboResolutions;){const e=t.Mo.values().next().value;t.Mo.delete(e);const n=new nt(nn.fromString(e)),s=t.jo.next();t.Bo.set(s,new eO(n)),t.Lo=t.Lo.insert(n,s),t5(t.remoteStore,new Do(Qo(Uf(n.path)),s,2,u_.T))}}async function Lu(t,e,n){const s=dt(t),i=[],r=[],o=[];s.Oo.isEmpty()||(s.Oo.forEach((a,l)=>{o.push(s.Wo(l,e,n).then(c=>{if(c){s.isPrimaryClient&&s.sharedClientState.updateQueryState(l.targetId,c.fromCache?"not-current":"current"),i.push(c);const d=w_.kn(l.targetId,c);r.push(d)}}))}),await Promise.all(o),s.$o.Rr(i),await async function(a,l){const c=dt(a);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>Ke.forEach(l,u=>Ke.forEach(u.Nn,f=>c.persistence.referenceDelegate.addReference(d,u.targetId,f)).next(()=>Ke.forEach(u.xn,f=>c.persistence.referenceDelegate.removeReference(d,u.targetId,f)))))}catch(d){if(!ku(d))throw d;tt("LocalStore","Failed to update sequence numbers: "+d)}for(const d of l){const u=d.targetId;if(!d.fromCache){const f=c.Un.get(u),m=f.snapshotVersion,h=f.withLastLimboFreeSnapshotVersion(m);c.Un=c.Un.insert(u,h)}}}(s.localStore,r))}async function uO(t,e){const n=dt(t);if(!n.currentUser.isEqual(e)){tt("SyncEngine","User change. New user:",e.toKey());const s=await Qx(n.localStore,e);n.currentUser=e,function(i,r){i.Ko.forEach(o=>{o.forEach(a=>{a.reject(new qe(Ee.CANCELLED,r))})}),i.Ko.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Lu(n,s.Wn)}}function hO(t,e){const n=dt(t),s=n.Bo.get(e);if(s&&s.ko)return sn().add(s.key);{let i=sn();const r=n.Fo.get(e);if(!r)return i;for(const o of r){const a=n.Oo.get(o);i=i.unionWith(a.view.Ro)}return i}}function dO(t){const e=dt(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=u5.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=oO.bind(null,e),e.$o.Rr=XN.bind(null,e.eventManager),e.$o.Go=QN.bind(null,e.eventManager),e}function fO(t){const e=dt(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=aO.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=lO.bind(null,e),e}class mO{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=Kf(e.databaseInfo.databaseId),this.sharedClientState=this.Ho(e),this.persistence=this.Jo(e),await this.persistence.start(),this.gcScheduler=this.Yo(e),this.localStore=this.Xo(e)}Yo(e){return null}Xo(e){return pN(this.persistence,new fN,e.initialUser,this.N)}Jo(e){return new AN(x_.Ns,this.N)}Ho(e){return new CN}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class pO{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>ib(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=uO.bind(null,this.syncEngine),await GN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new YN}createDatastore(e){const n=Kf(e.databaseInfo.databaseId),s=(i=e.databaseInfo,new NN(i));var i;return function(r,o,a){return new PN(r,o,a)}(e.credentials,s,n)}createRemoteStore(e){return n=this.localStore,s=this.datastore,i=e.asyncQueue,r=a=>ib(this.syncEngine,a,0),o=nb.bt()?new nb:new IN,new BN(n,s,i,r,o);var n,s,i,r,o}createSyncEngine(e,n){return function(s,i,r,o,a,l,c){const d=new tO(s,i,r,o,a,l);return c&&(d.Qo=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return async function(e){const n=dt(e);tt("RemoteStore","RemoteStore shutting down."),n.Wr.add(5),await Ou(n),n.zr.shutdown(),n.Hr.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.tc(this.observer.next,e)}error(e){this.observer.error?this.tc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}ec(){this.muted=!0}tc(e,n){this.muted||setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(e,n,s){this.credentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=_s.UNAUTHENTICATED,this.clientId=Tx.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(n,async i=>{tt("FirestoreClient","Received user=",i.uid),await this.credentialListener(i),this.user=i})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new qe(Ee.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Qi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),e.resolve()}catch(n){const s=C_(n,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function _O(t,e){t.asyncQueue.verifyOperationInProgress(),tt("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener(async i=>{s.isEqual(i)||(await Qx(e.localStore,i),s=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function vO(t,e){t.asyncQueue.verifyOperationInProgress();const n=await yO(t);tt("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener(i=>async function(r,o){const a=dt(r);a.asyncQueue.verifyOperationInProgress(),tt("RemoteStore","RemoteStore received new credentials");const l=ha(a);a.Wr.add(3),await Ou(a),l&&a.Hr.set("Unknown"),await a.remoteSyncer.handleCredentialChange(o),a.Wr.delete(3),await Gf(a)}(e.remoteStore,i)),t.onlineComponents=e}async function yO(t){return t.offlineComponents||(tt("FirestoreClient","Using default OfflineComponentProvider"),await _O(t,new mO)),t.offlineComponents}async function m5(t){return t.onlineComponents||(tt("FirestoreClient","Using default OnlineComponentProvider"),await vO(t,new pO)),t.onlineComponents}function bO(t){return m5(t).then(e=>e.syncEngine)}async function Ud(t){const e=await m5(t),n=e.eventManager;return n.onListen=nO.bind(null,e.syncEngine),n.onUnlisten=iO.bind(null,e.syncEngine),n}function wO(t,e,n={}){const s=new Qi;return t.asyncQueue.enqueueAndForget(async()=>function(i,r,o,a,l){const c=new L_({next:u=>{r.enqueueAndForget(()=>k_(i,d));const f=u.docs.has(o);!f&&u.fromCache?l.reject(new qe(Ee.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&u.fromCache&&a&&a.source==="server"?l.reject(new qe(Ee.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(u)},error:u=>l.reject(u)}),d=new N_(Uf(o.path),c,{includeMetadataChanges:!0,fo:!0});return I_(i,d)}(await Ud(t),t.asyncQueue,e,n,s)),s.promise}function EO(t,e,n={}){const s=new Qi;return t.asyncQueue.enqueueAndForget(async()=>function(i,r,o,a,l){const c=new L_({next:u=>{r.enqueueAndForget(()=>k_(i,d)),u.fromCache&&a.source==="server"?l.reject(new qe(Ee.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(u)},error:u=>l.reject(u)}),d=new N_(o,c,{includeMetadataChanges:!0,fo:!0});return I_(i,d)}(await Ud(t),t.asyncQueue,e,n,s)),s.promise}class xO{constructor(e,n,s,i,r,o,a,l){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=i,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=l}}class Wc{constructor(e,n){this.projectId=e,this.database=n||"(default)"}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Wc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ob=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p5(t,e,n){if(!n)throw new qe(Ee.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function TO(t,e,n,s){if(e===!0&&s===!0)throw new qe(Ee.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function ab(t){if(!nt.isDocumentKey(t))throw new qe(Ee.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function lb(t){if(nt.isDocumentKey(t))throw new qe(Ee.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Yf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ht()}function Bs(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new qe(Ee.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yf(t);throw new qe(Ee.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function SO(t,e){if(e<=0)throw new qe(Ee.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e){var n;if(e.host===void 0){if(e.ssl!==void 0)throw new qe(Ee.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new qe(Ee.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,TO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(e,n){this._credentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cb({}),this._settingsFrozen=!1,e instanceof Wc?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new qe(Ee.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wc(s.options.projectId)}(e))}get app(){if(!this._app)throw new qe(Ee.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new qe(Ee.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cb(e),e.credentials!==void 0&&(this._credentials=function(n){if(!n)return new i7;switch(n.type){case"gapi":const s=n.client;return en(!(typeof s!="object"||s===null||!s.auth||!s.auth.getAuthHeaderValueForFirstParty)),new a7(s,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new qe(Ee.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const n=ob.get(e);n&&(tt("ComponentProvider","Removing Datastore"),ob.delete(e),n.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e,n,s){this.converter=n,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Kn(this.firestore,e,this._key)}}class ji{constructor(e,n,s){this.converter=n,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ji(this.firestore,e,this._query)}}class Nr extends ji{constructor(e,n,s){super(e,n,Uf(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Kn(this.firestore,null,new nt(e))}withConverter(e){return new Nr(this.firestore,e,this._path)}}function D_(t,e,...n){if(t=_n(t),p5("collection","path",e),t instanceof P_){const s=nn.fromString(e,...n);return lb(s),new Nr(t,null,s)}{if(!(t instanceof Kn||t instanceof Nr))throw new qe(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(nn.fromString(e,...n));return lb(s),new Nr(t.firestore,null,s)}}function Cl(t,e,...n){if(t=_n(t),arguments.length===1&&(e=Tx.I()),p5("doc","path",e),t instanceof P_){const s=nn.fromString(e,...n);return ab(s),new Kn(t,null,new nt(s))}{if(!(t instanceof Kn||t instanceof Nr))throw new qe(Ee.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(nn.fromString(e,...n));return ab(s),new Kn(t.firestore,t instanceof Nr?t.converter:null,new nt(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(){this._c=Promise.resolve(),this.mc=[],this.gc=!1,this.yc=[],this.Tc=null,this.Ec=!1,this.Ic=!1,this.Ac=[],this.ar=new Jx(this,"async_queue_retry"),this.Rc=()=>{const n=hm();n&&tt("AsyncQueue","Visibility state changed to "+n.visibilityState),this.ar.tr()};const e=hm();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Rc)}get isShuttingDown(){return this.gc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.bc(),this.Pc(e)}enterRestrictedMode(e){if(!this.gc){this.gc=!0,this.Ic=e||!1;const n=hm();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Rc)}}enqueue(e){if(this.bc(),this.gc)return new Promise(()=>{});const n=new Qi;return this.Pc(()=>this.gc&&this.Ic?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.mc.push(e),this.vc()))}async vc(){if(this.mc.length!==0){try{await this.mc[0](),this.mc.shift(),this.ar.reset()}catch(e){if(!ku(e))throw e;tt("AsyncQueue","Operation failed with retryable error: "+e)}this.mc.length>0&&this.ar.Xi(()=>this.vc())}}Pc(e){const n=this._c.then(()=>(this.Ec=!0,e().catch(s=>{this.Tc=s,this.Ec=!1;const i=function(r){let o=r.message||"";return r.stack&&(o=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),o}(s);throw Vr("INTERNAL UNHANDLED ERROR: ",i),s}).then(s=>(this.Ec=!1,s))));return this._c=n,n}enqueueAfterDelay(e,n,s){this.bc(),this.Ac.indexOf(e)>-1&&(n=0);const i=R_.createAndSchedule(this,e,n,s,r=>this.Vc(r));return this.yc.push(i),i}bc(){this.Tc&&ht()}verifyOperationInProgress(){}async Sc(){let e;do e=this._c,await e;while(e!==this._c)}Dc(e){for(const n of this.yc)if(n.timerId===e)return!0;return!1}Cc(e){return this.Sc().then(()=>{this.yc.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(const n of this.yc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Sc()})}Nc(e){this.Ac.push(e)}Vc(e){const n=this.yc.indexOf(e);this.yc.splice(n,1)}}function ub(t){return function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class rr extends P_{constructor(e,n){super(e,n),this.type="firestore",this._queue=new AO,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||g5(this),this._firestoreClient.terminate()}}function RO(t=ng()){return eg(t,"firestore").getImmediate()}function Xf(t){return t._firestoreClient||g5(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function g5(t){var e;const n=t._freezeSettings(),s=function(i,r,o,a){return new xO(i,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new gO(t._credentials,t._queue,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new qe(Ee.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ws(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cl(Wn.fromBase64String(e))}catch(n){throw new qe(Ee.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new cl(Wn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new qe(Ee.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new qe(Ee.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return jt(this._lat,e._lat)||jt(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO=/^__.*__$/;class IO{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return this.fieldMask!==null?new ua(e,this.data,this.fieldMask,n,this.fieldTransforms):new $f(e,this.data,n,this.fieldTransforms)}}class _5{constructor(e,n,s){this.data=e,this.fieldMask=n,this.fieldTransforms=s}toMutation(e,n){return new ua(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function v5(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ht()}}class Zf{constructor(e,n,s,i,r,o){this.settings=e,this.databaseId=n,this.N=s,this.ignoreUndefinedProperties=i,r===void 0&&this.xc(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get kc(){return this.settings.kc}$c(e){return new Zf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Oc(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.$c({path:s,Fc:!1});return i.Mc(e),i}Lc(e){var n;const s=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.$c({path:s,Fc:!1});return i.xc(),i}Bc(e){return this.$c({path:void 0,Fc:!0})}Uc(e){return jd(e,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Kc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Mc(this.path.get(e))}Mc(e){if(e.length===0)throw this.Uc("Document fields must not be empty");if(v5(this.kc)&&CO.test(e))throw this.Uc('Document fields cannot begin and end with "__"')}}class kO{constructor(e,n,s){this.databaseId=e,this.ignoreUndefinedProperties=n,this.N=s||Kf(e)}jc(e,n,s,i=!1){return new Zf({kc:e,methodName:n,Kc:s,path:ws.emptyPath(),Fc:!1,qc:i},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Du(t){const e=t._freezeSettings(),n=Kf(t._databaseId);return new kO(t._databaseId,!!e.ignoreUndefinedProperties,n)}function y5(t,e,n,s,i,r={}){const o=t.jc(r.merge||r.mergeFields?2:0,e,n,i);F_("Data must be an object, but it was:",o,s);const a=E5(s,o);let l,c;if(r.merge)l=new $c(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){const d=[];for(const u of r.mergeFields){const f=Y1(e,u,n);if(!o.contains(f))throw new qe(Ee.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);T5(d,f)||d.push(f)}l=new $c(d),c=o.fieldTransforms.filter(u=>l.covers(u.field))}else l=null,c=o.fieldTransforms;return new IO(new Ms(a),l,c)}class Bu extends Pu{_toFieldTransform(e){if(e.kc!==2)throw e.kc===1?e.Uc(`${this._methodName}() can only appear at the top level of your update data`):e.Uc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Bu}}function b5(t,e,n){return new Zf({kc:3,Kc:e.settings.Kc,methodName:t._methodName,Fc:n},e.databaseId,e.N,e.ignoreUndefinedProperties)}class MO extends Pu{constructor(e,n){super(e),this.Qc=n}_toFieldTransform(e){const n=b5(this,e,!0),s=this.Qc.map(r=>da(r,n)),i=new rl(s);return new Fx(e.path,i)}isEqual(e){return this===e}}class NO extends Pu{constructor(e,n){super(e),this.Qc=n}_toFieldTransform(e){const n=b5(this,e,!0),s=this.Qc.map(r=>da(r,n)),i=new ol(s);return new Fx(e.path,i)}isEqual(e){return this===e}}function OO(t,e,n,s){const i=t.jc(1,e,n);F_("Data must be an object, but it was:",i,s);const r=[],o=Ms.empty();ca(s,(l,c)=>{const d=U_(e,l,n);c=_n(c);const u=i.Lc(d);if(c instanceof Bu)r.push(d);else{const f=da(c,u);f!=null&&(r.push(d),o.set(d,f))}});const a=new $c(r);return new _5(o,a,i.fieldTransforms)}function LO(t,e,n,s,i,r){const o=t.jc(1,e,n),a=[Y1(e,s,n)],l=[i];if(r.length%2!=0)throw new qe(Ee.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<r.length;f+=2)a.push(Y1(e,r[f])),l.push(r[f+1]);const c=[],d=Ms.empty();for(let f=a.length-1;f>=0;--f)if(!T5(c,a[f])){const m=a[f];let h=l[f];h=_n(h);const k=o.Lc(m);if(h instanceof Bu)c.push(m);else{const I=da(h,k);I!=null&&(c.push(m),d.set(m,I))}}const u=new $c(c);return new _5(d,u,o.fieldTransforms)}function w5(t,e,n,s=!1){return da(n,t.jc(s?4:3,e))}function da(t,e){if(x5(t=_n(t)))return F_("Unsupported field value:",e,t),E5(t,e);if(t instanceof Pu)return function(n,s){if(!v5(s.kc))throw s.Uc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Uc(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&e.kc!==4)throw e.Uc("Nested arrays are not supported");return function(n,s){const i=[];let r=0;for(const o of n){let a=da(o,s.Bc(r));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),r++}return{arrayValue:{values:i}}}(t,e)}return function(n,s){if((n=_n(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return S7(s.N,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=Ds.fromDate(n);return{timestampValue:Bd(s.N,i)}}if(n instanceof Ds){const i=new Ds(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Bd(s.N,i)}}if(n instanceof B_)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof cl)return{bytesValue:zx(s.N,n._byteString)};if(n instanceof Kn){const i=s.databaseId,r=n.firestore._databaseId;if(!r.isEqual(i))throw s.Uc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:y_(n.firestore._databaseId||s.databaseId,n._key.path)}}throw s.Uc(`Unsupported field value: ${Yf(n)}`)}(t,e)}function E5(t,e){const n={};return Sx(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ca(t,(s,i)=>{const r=da(i,e.Oc(s));r!=null&&(n[s]=r)}),{mapValue:{fields:n}}}function x5(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ds||t instanceof B_||t instanceof cl||t instanceof Kn||t instanceof Pu)}function F_(t,e,n){if(!x5(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const s=Yf(n);throw s==="an object"?e.Uc(t+" a custom object"):e.Uc(t+" "+s)}}function Y1(t,e,n){if((e=_n(e))instanceof Qf)return e._internalPath;if(typeof e=="string")return U_(t,e);throw jd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const PO=new RegExp("[~\\*/\\[\\]]");function U_(t,e,n){if(e.search(PO)>=0)throw jd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Qf(...e.split("."))._internalPath}catch{throw jd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function jd(t,e,n,s,i){const r=s&&!s.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(r||o)&&(l+=" (found",r&&(l+=` in field ${s}`),o&&(l+=` in document ${i}`),l+=")"),new qe(Ee.INVALID_ARGUMENT,a+t+l)}function T5(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{constructor(e,n,s,i,r){this._firestore=e,this._userDataWriter=n,this._key=s,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Kn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new DO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Jf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class DO extends j_{data(){return super.data()}}function Jf(t,e){return typeof e=="string"?U_(t,e):e instanceof Qf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class S5 extends j_{constructor(e,n,s,i,r,o){super(e,n,s,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new zh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const s=this._document.data.field(Jf("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,n.serverTimestamps)}}}class zh extends S5{data(e={}){return super.data(e)}}class A5{constructor(e,n,s,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new tc(i.hasPendingWrites,i.fromCache),this.query=s}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(s=>{e.call(n,new zh(this._firestore,this._userDataWriter,s.key,s,new tc(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new qe(Ee.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let r=0;return s._snapshot.docChanges.map(o=>({type:"added",doc:new zh(s._firestore,s._userDataWriter,o.doc.key,o.doc,new tc(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:r++}))}{let r=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(o=>i||o.type!==3).map(o=>{const a=new zh(s._firestore,s._userDataWriter,o.doc.key,o.doc,new tc(s._snapshot.mutatedKeys.has(o.doc.key),s._snapshot.fromCache),s.query.converter);let l=-1,c=-1;return o.type!==0&&(l=r.indexOf(o.doc.key),r=r.delete(o.doc.key)),o.type!==1&&(r=r.add(o.doc),c=r.indexOf(o.doc.key)),{type:BO(o.type),doc:a,oldIndex:l,newIndex:c}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function BO(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ht()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5(t){if(Ld(t)&&t.explicitOrderBy.length===0)throw new qe(Ee.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Fu{}function Ls(t,...e){for(const n of e)t=n._apply(t);return t}class FO extends Fu{constructor(e,n,s){super(),this.Gc=e,this.zc=n,this.Hc=s,this.type="where"}_apply(e){const n=Du(e.firestore),s=function(i,r,o,a,l,c,d){let u;if(l.isKeyField()){if(c==="array-contains"||c==="array-contains-any")throw new qe(Ee.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on FieldPath.documentId().`);if(c==="in"||c==="not-in"){mb(d,c);const m=[];for(const h of d)m.push(fb(a,i,h));u={arrayValue:{values:m}}}else u=fb(a,i,d)}else c!=="in"&&c!=="not-in"&&c!=="array-contains-any"||mb(d,c),u=w5(o,r,d,c==="in"||c==="not-in");const f=rs.create(l,c,u);return function(m,h){if(h.v()){const I=__(m);if(I!==null&&!I.isEqual(h.field))throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${I.toString()}' and '${h.field.toString()}'`);const L=g_(m);L!==null&&M5(m,h.field,L)}const k=function(I,L){for(const p of I.filters)if(L.indexOf(p.op)>=0)return p.op;return null}(m,function(I){switch(I){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(h.op));if(k!==null)throw k===h.op?new qe(Ee.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${h.op.toString()}' filter.`):new qe(Ee.INVALID_ARGUMENT,`Invalid query. You cannot use '${h.op.toString()}' filters with '${k.toString()}' filters.`)}(i,f),f}(e._query,"where",n,e.firestore._databaseId,this.Gc,this.zc,this.Hc);return new ji(e.firestore,e.converter,function(i,r){const o=i.filters.concat([r]);return new Yr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),o,i.limit,i.limitType,i.startAt,i.endAt)}(e._query,s))}}function X1(t,e,n){const s=e,i=Jf("where",t);return new FO(i,s,n)}class UO extends Fu{constructor(e,n){super(),this.Gc=e,this.Jc=n,this.type="orderBy"}_apply(e){const n=function(s,i,r){if(s.startAt!==null)throw new qe(Ee.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new qe(Ee.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Ua(i,r);return function(a,l){if(g_(a)===null){const c=__(a);c!==null&&M5(a,c,l.field)}}(s,o),o}(e._query,this.Gc,this.Jc);return new ji(e.firestore,e.converter,function(s,i){const r=s.explicitOrderBy.concat([i]);return new Yr(s.path,s.collectionGroup,r,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function Wi(t,e="asc"){const n=e,s=Jf("orderBy",t);return new UO(s,n)}class jO extends Fu{constructor(e,n,s){super(),this.type=e,this.Yc=n,this.Xc=s}_apply(e){return new ji(e.firestore,e.converter,Ix(e._query,this.Yc,this.Xc))}}function Yc(t){return SO("limit",t),new jO("limit",t,"F")}class C5 extends Fu{constructor(e,n,s){super(),this.type=e,this.Zc=n,this.ta=s}_apply(e){const n=k5(e,this.type,this.Zc,this.ta);return new ji(e.firestore,e.converter,function(s,i){return new Yr(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function hb(...t){return new C5("startAt",t,!0)}function I5(...t){return new C5("startAfter",t,!1)}class HO extends Fu{constructor(e,n,s){super(),this.type=e,this.Zc=n,this.ta=s}_apply(e){const n=k5(e,this.type,this.Zc,this.ta);return new ji(e.firestore,e.converter,function(s,i){return new Yr(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function db(...t){return new HO("endAt",t,!1)}function k5(t,e,n,s){if(n[0]=_n(n[0]),n[0]instanceof j_)return function(i,r,o,a,l){if(!a)throw new qe(Ee.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const d of il(i))if(d.field.isKeyField())c.push(Nd(r,a.key));else{const u=a.data.field(d.field);if(h_(u))throw new qe(Ee.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(u===null){const f=d.field.canonicalString();throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}c.push(u)}return new Gc(c,l)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=Du(t.firestore);return function(r,o,a,l,c,d){const u=r.explicitOrderBy;if(c.length>u.length)throw new qe(Ee.INVALID_ARGUMENT,`Too many arguments provided to ${l}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const f=[];for(let m=0;m<c.length;m++){const h=c[m];if(u[m].field.isKeyField()){if(typeof h!="string")throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${l}(), but got a ${typeof h}`);if(!v_(r)&&h.indexOf("/")!==-1)throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${l}() must be a plain document ID, but '${h}' contains a slash.`);const k=r.path.child(nn.fromString(h));if(!nt.isDocumentKey(k))throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${l}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const I=new nt(k);f.push(Nd(o,I))}else{const k=w5(a,l,h);f.push(k)}}return new Gc(f,d)}(t._query,t.firestore._databaseId,i,e,n,s)}}function fb(t,e,n){if(typeof(n=_n(n))=="string"){if(n==="")throw new qe(Ee.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!v_(e)&&n.indexOf("/")!==-1)throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(nn.fromString(n));if(!nt.isDocumentKey(s))throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Nd(t,new nt(s))}if(n instanceof Kn)return Nd(t,n._key);throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yf(n)}.`)}function mb(t,e){if(!Array.isArray(t)||t.length===0)throw new qe(Ee.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new qe(Ee.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function M5(t,e,n){if(!n.isEqual(e))throw new qe(Ee.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VO{convertValue(e,n="none"){switch(Xo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return wn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(nl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 10:return this.convertObject(e.mapValue,n);default:throw ht()}}convertObject(e,n){const s={};return ca(e.fields,(i,r)=>{s[i]=this.convertValue(r,n)}),s}convertGeoPoint(e){return new B_(wn(e.latitude),wn(e.longitude))}convertArray(e,n){return(e.values||[]).map(s=>this.convertValue(s,n))}convertServerTimestamp(e,n){switch(n){case"previous":const s=Ax(e);return s==null?null:this.convertValue(s,n);case"estimate":return this.convertTimestamp(zc(e));default:return null}}convertTimestamp(e){const n=qr(e);return new Ds(n.seconds,n.nanos)}convertDocumentKey(e,n){const s=nn.fromString(e);en(Yx(s));const i=new Wc(s.get(1),s.get(3)),r=new nt(s.popFirst(5));return i.isEqual(n)||Vr(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N5(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qO(t){t=Bs(t,Kn);const e=Bs(t.firestore,rr);return wO(Xf(e),t._key).then(n=>O5(e,t,n))}class H_ extends VO{constructor(e){super(),this.firestore=e}convertBytes(e){return new cl(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Kn(this.firestore,null,n)}}function $O(t){t=Bs(t,ji);const e=Bs(t.firestore,rr),n=Xf(e),s=new H_(e);return R5(t._query),EO(n,t._query).then(i=>new A5(e,s,t,i))}function zO(t,e,n){t=Bs(t,Kn);const s=Bs(t.firestore,rr),i=N5(t.converter,e,n);return e0(s,[y5(Du(s),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,Zi.none())])}function KO(t,e,n,...s){t=Bs(t,Kn);const i=Bs(t.firestore,rr),r=Du(i);let o;return o=typeof(e=_n(e))=="string"||e instanceof Qf?LO(r,"updateDoc",t._key,e,n,s):OO(r,"updateDoc",t._key,e),e0(i,[o.toMutation(t._key,Zi.exists(!0))])}function GO(t){return e0(Bs(t.firestore,rr),[new jx(t._key,Zi.none())])}function WO(t,e){const n=Bs(t.firestore,rr),s=Cl(t),i=N5(t.converter,e);return e0(n,[y5(Du(t.firestore),"addDoc",s._key,i,t.converter!==null,{}).toMutation(s._key,Zi.exists(!1))]).then(()=>s)}function YO(t,...e){var n,s,i;t=_n(t);let r={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||ub(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(ub(e[o])){const u=e[o];e[o]=(n=u.next)===null||n===void 0?void 0:n.bind(u),e[o+1]=(s=u.error)===null||s===void 0?void 0:s.bind(u),e[o+2]=(i=u.complete)===null||i===void 0?void 0:i.bind(u)}let l,c,d;if(t instanceof Kn)c=Bs(t.firestore,rr),d=Uf(t._key.path),l={next:u=>{e[o]&&e[o](O5(c,t,u))},error:e[o+1],complete:e[o+2]};else{const u=Bs(t,ji);c=Bs(u.firestore,rr),d=u._query;const f=new H_(c);l={next:m=>{e[o]&&e[o](new A5(c,f,u,m))},error:e[o+1],complete:e[o+2]},R5(t._query)}return function(u,f,m,h){const k=new L_(h),I=new N_(f,k,m);return u.asyncQueue.enqueueAndForget(async()=>I_(await Ud(u),I)),()=>{k.ec(),u.asyncQueue.enqueueAndForget(async()=>k_(await Ud(u),I))}}(Xf(c),d,a,l)}function e0(t,e){return function(n,s){const i=new Qi;return n.asyncQueue.enqueueAndForget(async()=>rO(await bO(n),s,i)),i.promise}(Xf(t),e)}function O5(t,e,n){const s=n.docs.get(e._key),i=new H_(t);return new S5(t,i,e._key,s,new tc(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(){return new Bu("deleteField")}function V_(...t){return new MO("arrayUnion",t)}function q_(...t){return new NO("arrayRemove",t)}(function(t,e=!0){(function(n){Sl=n})(tg),mu(new vl("firestore",(n,{options:s})=>{const i=n.getProvider("app").getImmediate(),r=new rr(i,new r7(n.getProvider("auth-internal")));return s=Object.assign({useFetchStreams:e},s),r._setSettings(s),r},"PUBLIC")),Li(Ny,"3.3.0",t),Li(Ny,"3.3.0","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L5="firebasestorage.googleapis.com",P5="storageBucket",QO=2*60*1e3,ZO=10*60*1e3;class fn extends mf{constructor(e,n){super(dm(e),`Firebase Storage: ${n} (${dm(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,fn.prototype)}_codeEquals(e){return dm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function dm(t){return"storage/"+t}function $_(){const t="An unknown error occurred, please check the error payload for server response.";return new fn("unknown",t)}function JO(t){return new fn("object-not-found","Object '"+t+"' does not exist.")}function eL(t){return new fn("quota-exceeded","Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function tL(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new fn("unauthenticated",t)}function nL(){return new fn("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function sL(t){return new fn("unauthorized","User does not have permission to access '"+t+"'.")}function iL(){return new fn("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function D5(){return new fn("canceled","User canceled the upload/download.")}function rL(t){return new fn("invalid-url","Invalid URL '"+t+"'.")}function oL(t){return new fn("invalid-default-bucket","Invalid default bucket '"+t+"'.")}function aL(){return new fn("no-default-bucket","No default bucket found. Did you set the '"+P5+"' property when initializing the app?")}function B5(){return new fn("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function lL(){return new fn("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function cL(){return new fn("no-download-url","The given file does not have any download URLs.")}function Q1(t){return new fn("invalid-argument",t)}function F5(){return new fn("app-deleted","The Firebase app was deleted.")}function uL(t){return new fn("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function yc(t,e){return new fn("invalid-format","String does not match format '"+t+"': "+e)}function mh(t){throw new fn("internal-error","Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let s;try{s=Ps.makeFromUrl(e,n)}catch{return new Ps(e,"")}if(s.path==="")return s;throw oL(e)}static makeFromUrl(e,n){let s=null;const i="([A-Za-z0-9.\\-_]+)";function r(P){P.path.charAt(P.path.length-1)==="/"&&(P.path_=P.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),l={bucket:1,path:3};function c(P){P.path_=decodeURIComponent(P.path)}const d="v[A-Za-z0-9_]+",u=n.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${u}/${d}/b/${i}/o${f}`,"i"),h={bucket:1,path:3},k=n===L5?"(?:storage.googleapis.com|storage.cloud.google.com)":n,I="([^?#]*)",L=new RegExp(`^https?://${k}/${i}/${I}`,"i"),C=[{regex:a,indices:l,postModify:r},{regex:m,indices:h,postModify:c},{regex:L,indices:{bucket:1,path:2},postModify:c}];for(let P=0;P<C.length;P++){const M=C[P],F=M.regex.exec(e);if(F){const _=F[M.indices.bucket];let S=F[M.indices.path];S||(S=""),s=new Ps(_,S),M.postModify(s);break}}if(s==null)throw rL(e);return s}}class hL{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dL(t,e,n){let s=1,i=null,r=!1,o=0;function a(){return o===2}let l=!1;function c(...h){l||(l=!0,e.apply(null,h))}function d(h){i=setTimeout(()=>{i=null,t(u,a())},h)}function u(h,...k){if(l)return;if(h){c.call(null,h,...k);return}if(a()||r){c.call(null,h,...k);return}s<64&&(s*=2);let L;o===1?(o=2,L=0):L=(s+Math.random())*1e3,d(L)}let f=!1;function m(h){f||(f=!0,!l&&(i!==null?(h||(o=2),clearTimeout(i),d(0)):h||(o=1)))}return d(0),setTimeout(()=>{r=!0,m(!0)},n),m}function fL(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mL(t){return t!==void 0}function pL(t){return typeof t=="function"}function gL(t){return typeof t=="object"&&!Array.isArray(t)}function t0(t){return typeof t=="string"||t instanceof String}function pb(t){return z_()&&t instanceof Blob}function z_(){return typeof Blob!="undefined"}function gb(t,e,n,s){if(s<e)throw Q1(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>n)throw Q1(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(t,e,n){let s=e;return n==null&&(s=`https://${e}`),`${n}://${s}/v0${t}`}function U5(t){const e=encodeURIComponent;let n="?";for(const s in t)if(t.hasOwnProperty(s)){const i=e(s)+"="+e(t[s]);n=n+i+"&"}return n=n.slice(0,-1),n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bo;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Bo||(Bo={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _L{constructor(e,n,s,i,r,o,a,l,c,d,u){this.url_=e,this.method_=n,this.headers_=s,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=d,this.connectionFactory_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,m)=>{this.resolve_=f,this.reject_=m,this.start_()})}start_(){const e=(s,i)=>{if(i){s(!1,new ph(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;const a=r.getErrorCode()===Bo.NO_ERROR,l=r.getStatus();if(!a||this.isRetryStatusCode_(l)){const d=r.getErrorCode()===Bo.ABORT;s(!1,new ph(!1,null,d));return}const c=this.successCodes_.indexOf(l)!==-1;s(!0,new ph(c,r))})},n=(s,i)=>{const r=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{const l=this.callback_(a,a.getResponseText());mL(l)?r(l):r()}catch(l){o(l)}else if(a!==null){const l=$_();l.serverResponse=a.getResponseText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(i.canceled){const l=this.appDelete_?F5():D5();o(l)}else{const l=iL();o(l)}};this.canceled_?n(!1,new ph(!1,null,!0)):this.backoffId_=dL(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&fL(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const n=e>=500&&e<600,i=[408,429].indexOf(e)!==-1,r=this.additionalRetryCodes_.indexOf(e)!==-1;return n||i||r}}class ph{constructor(e,n,s){this.wasSuccessCode=e,this.connection=n,this.canceled=!!s}}function vL(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function yL(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function bL(t,e){e&&(t["X-Firebase-GMPID"]=e)}function wL(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function EL(t,e,n,s,i,r){const o=U5(t.urlParams),a=t.url+o,l=Object.assign({},t.headers);return bL(l,e),vL(l,n),yL(l,r),wL(l,s),new _L(a,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xL(){return typeof BlobBuilder!="undefined"?BlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:void 0}function TL(...t){const e=xL();if(e!==void 0){const n=new e;for(let s=0;s<t.length;s++)n.append(t[s]);return n.getBlob()}else{if(z_())return new Blob(t);throw new fn("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function SL(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AL(t){return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ki={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class fm{constructor(e,n){this.data=e,this.contentType=n||null}}function RL(t,e){switch(t){case ki.RAW:return new fm(j5(e));case ki.BASE64:case ki.BASE64URL:return new fm(H5(t,e));case ki.DATA_URL:return new fm(IL(e),kL(e))}throw $_()}function j5(t){const e=[];for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const r=s,o=t.charCodeAt(++n);s=65536|(r&1023)<<10|o&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function CL(t){let e;try{e=decodeURIComponent(t)}catch{throw yc(ki.DATA_URL,"Malformed data URL.")}return j5(e)}function H5(t,e){switch(t){case ki.BASE64:{const i=e.indexOf("-")!==-1,r=e.indexOf("_")!==-1;if(i||r)throw yc(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case ki.BASE64URL:{const i=e.indexOf("+")!==-1,r=e.indexOf("/")!==-1;if(i||r)throw yc(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=AL(e)}catch{throw yc(t,"Invalid character found")}const s=new Uint8Array(n.length);for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return s}class V5{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw yc(ki.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=n[1]||null;s!=null&&(this.base64=ML(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function IL(t){const e=new V5(t);return e.base64?H5(ki.BASE64,e.rest):CL(e.rest)}function kL(t){return new V5(t).contentType}function ML(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,n){let s=0,i="";pb(e)?(this.data_=e,s=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(pb(this.data_)){const s=this.data_,i=SL(s,e,n);return i===null?null:new Ar(i)}else{const s=new Uint8Array(this.data_.buffer,e,n-e);return new Ar(s,!0)}}static getBlob(...e){if(z_()){const n=e.map(s=>s instanceof Ar?s.data_:s);return new Ar(TL.apply(null,n))}else{const n=e.map(o=>t0(o)?RL(ki.RAW,o).data:o.data_);let s=0;n.forEach(o=>{s+=o.byteLength});const i=new Uint8Array(s);let r=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)i[r++]=o[a]}),new Ar(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q5(t){let e;try{e=JSON.parse(t)}catch{return null}return gL(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NL(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function OL(t,e){const n=e.split("/").filter(s=>s.length>0).join("/");return t.length===0?n:t+"/"+n}function $5(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LL(t,e){return e}class Zn{constructor(e,n,s,i){this.server=e,this.local=n||e,this.writable=!!s,this.xform=i||LL}}let gh=null;function PL(t){return!t0(t)||t.length<2?t:$5(t)}function z5(){if(gh)return gh;const t=[];t.push(new Zn("bucket")),t.push(new Zn("generation")),t.push(new Zn("metageneration")),t.push(new Zn("name","fullPath",!0));function e(r,o){return PL(o)}const n=new Zn("name");n.xform=e,t.push(n);function s(r,o){return o!==void 0?Number(o):o}const i=new Zn("size");return i.xform=s,t.push(i),t.push(new Zn("timeCreated")),t.push(new Zn("updated")),t.push(new Zn("md5Hash",null,!0)),t.push(new Zn("cacheControl",null,!0)),t.push(new Zn("contentDisposition",null,!0)),t.push(new Zn("contentEncoding",null,!0)),t.push(new Zn("contentLanguage",null,!0)),t.push(new Zn("contentType",null,!0)),t.push(new Zn("metadata","customMetadata",!0)),gh=t,gh}function DL(t,e){function n(){const s=t.bucket,i=t.fullPath,r=new Ps(s,i);return e._makeStorageReference(r)}Object.defineProperty(t,"ref",{get:n})}function BL(t,e,n){const s={};s.type="file";const i=n.length;for(let r=0;r<i;r++){const o=n[r];s[o.local]=o.xform(s,e[o.server])}return DL(s,t),s}function K5(t,e,n){const s=q5(e);return s===null?null:BL(t,s,n)}function FL(t,e,n,s){const i=q5(e);if(i===null||!t0(i.downloadTokens))return null;const r=i.downloadTokens;if(r.length===0)return null;const o=encodeURIComponent;return r.split(",").map(c=>{const d=t.bucket,u=t.fullPath,f="/b/"+o(d)+"/o/"+o(u),m=Il(f,n,s),h=U5({alt:"media",token:c});return m+h})[0]}function G5(t,e){const n={},s=e.length;for(let i=0;i<s;i++){const r=e[i];r.writable&&(n[r.server]=t[r.local])}return JSON.stringify(n)}class fa{constructor(e,n,s,i){this.url=e,this.method=n,this.handler=s,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function er(t){if(!t)throw $_()}function K_(t,e){function n(s,i){const r=K5(t,i,e);return er(r!==null),r}return n}function UL(t,e){function n(s,i){const r=K5(t,i,e);return er(r!==null),FL(r,i,t.host,t._protocol)}return n}function Uu(t){function e(n,s){let i;return n.getStatus()===401?n.getResponseText().includes("Firebase App Check token is invalid")?i=nL():i=tL():n.getStatus()===402?i=eL(t.bucket):n.getStatus()===403?i=sL(t.path):i=s,i.serverResponse=s.serverResponse,i}return e}function G_(t){const e=Uu(t);function n(s,i){let r=e(s,i);return s.getStatus()===404&&(r=JO(t.path)),r.serverResponse=i.serverResponse,r}return n}function jL(t,e,n){const s=e.fullServerUrl(),i=Il(s,t.host,t._protocol),r="GET",o=t.maxOperationRetryTime,a=new fa(i,r,K_(t,n),o);return a.errorHandler=G_(e),a}function HL(t,e,n){const s=e.fullServerUrl(),i=Il(s,t.host,t._protocol),r="GET",o=t.maxOperationRetryTime,a=new fa(i,r,UL(t,n),o);return a.errorHandler=G_(e),a}function VL(t,e){const n=e.fullServerUrl(),s=Il(n,t.host,t._protocol),i="DELETE",r=t.maxOperationRetryTime;function o(l,c){}const a=new fa(s,i,o,r);return a.successCodes=[200,204],a.errorHandler=G_(e),a}function qL(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function W5(t,e,n){const s=Object.assign({},n);return s.fullPath=t.path,s.size=e.size(),s.contentType||(s.contentType=qL(null,e)),s}function $L(t,e,n,s,i){const r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let C="";for(let P=0;P<2;P++)C=C+Math.random().toString().slice(2);return C}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=W5(e,s,i),d=G5(c,n),u="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,f=`\r
--`+l+"--",m=Ar.getBlob(u,s,f);if(m===null)throw B5();const h={name:c.fullPath},k=Il(r,t.host,t._protocol),I="POST",L=t.maxUploadRetryTime,p=new fa(k,I,K_(t,n),L);return p.urlParams=h,p.headers=o,p.body=m.uploadData(),p.errorHandler=Uu(e),p}class Hd{constructor(e,n,s,i){this.current=e,this.total=n,this.finalized=!!s,this.metadata=i||null}}function W_(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{er(!1)}return er(!!n&&(e||["active"]).indexOf(n)!==-1),n}function zL(t,e,n,s,i){const r=e.bucketOnlyServerUrl(),o=W5(e,s,i),a={name:o.fullPath},l=Il(r,t.host,t._protocol),c="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},u=G5(o,n),f=t.maxUploadRetryTime;function m(k){W_(k);let I;try{I=k.getResponseHeader("X-Goog-Upload-URL")}catch{er(!1)}return er(t0(I)),I}const h=new fa(l,c,m,f);return h.urlParams=a,h.headers=d,h.body=u,h.errorHandler=Uu(e),h}function KL(t,e,n,s){const i={"X-Goog-Upload-Command":"query"};function r(c){const d=W_(c,["active","final"]);let u=null;try{u=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{er(!1)}u||er(!1);const f=Number(u);return er(!isNaN(f)),new Hd(f,s.size(),d==="final")}const o="POST",a=t.maxUploadRetryTime,l=new fa(n,o,r,a);return l.headers=i,l.errorHandler=Uu(e),l}const _b=256*1024;function GL(t,e,n,s,i,r,o,a){const l=new Hd(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=s.size()),s.size()!==l.total)throw lL();const c=l.total-l.current;let d=c;i>0&&(d=Math.min(d,i));const u=l.current,f=u+d,h={"X-Goog-Upload-Command":d===c?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`},k=s.slice(u,f);if(k===null)throw B5();function I(P,M){const F=W_(P,["active","final"]),_=l.current+d,S=s.size();let x;return F==="final"?x=K_(e,r)(P,M):x=null,new Hd(_,S,F==="final",x)}const L="POST",p=e.maxUploadRetryTime,C=new fa(n,L,I,p);return C.headers=h,C.body=k.uploadData(),C.progressCallback=a||null,C.errorHandler=Uu(t),C}const vs={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function mm(t){switch(t){case"running":case"pausing":case"canceling":return vs.RUNNING;case"paused":return vs.PAUSED;case"success":return vs.SUCCESS;case"canceled":return vs.CANCELED;case"error":return vs.ERROR;default:return vs.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WL{constructor(e,n,s){if(pL(e)||n!=null||s!=null)this.next=e,this.error=n!=null?n:void 0,this.complete=s!=null?s:void 0;else{const r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class YL{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Bo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Bo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Bo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,s,i){if(this.sent_)throw mh("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const r in i)i.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,i[r].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw mh("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw mh("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponseText(){if(!this.sent_)throw mh("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}function bo(){return new YL}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e,n,s=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=s,this._mappings=z5(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{this._request=void 0,this._chunkMultiplier=1,i._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=i,this._transition("error"))},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals("canceled")?this.completeTransitions_():(this._error=i,this._transition("error"))},this._promise=new Promise((i,r)=>{this._resolve=i,this._reject=r,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,s])=>{switch(this._state){case"running":e(n,s);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const s=zL(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(s,bo,e,n);this._request=i,i.getPromise().then(r=>{this._request=void 0,this._uploadUrl=r,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,s)=>{const i=KL(this._ref.storage,this._ref._location,e,this._blob),r=this._ref.storage._makeRequest(i,bo,n,s);this._request=r,r.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=_b*this._chunkMultiplier,n=new Hd(this._transferred,this._blob.size()),s=this._uploadUrl;this._resolveToken((i,r)=>{let o;try{o=GL(this._ref._location,this._ref.storage,s,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,bo,i,r);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){_b*this._chunkMultiplier<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const s=jL(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(s,bo,e,n);this._request=i,i.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const s=$L(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(s,bo,e,n);this._request=i,i.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":this._state=e,this._request!==void 0&&this._request.cancel();break;case"pausing":this._state=e,this._request!==void 0&&this._request.cancel();break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=D5(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=mm(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,s,i){const r=new WL(n||void 0,s||void 0,i||void 0);return this._addObserver(r),()=>{this._removeObserver(r)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(mm(this._state)){case vs.SUCCESS:ba(this._resolve.bind(null,this.snapshot))();break;case vs.CANCELED:case vs.ERROR:const n=this._reject;ba(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(mm(this._state)){case vs.RUNNING:case vs.PAUSED:e.next&&ba(e.next.bind(e,this.snapshot))();break;case vs.SUCCESS:e.complete&&ba(e.complete.bind(e))();break;case vs.CANCELED:case vs.ERROR:e.error&&ba(e.error.bind(e,this._error))();break;default:e.error&&ba(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,n){this._service=e,n instanceof Ps?this._location=n:this._location=Ps.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Jo(e,n)}get root(){const e=new Ps(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return $5(this._location.path)}get storage(){return this._service}get parent(){const e=NL(this._location.path);if(e===null)return null;const n=new Ps(this._location.bucket,e);return new Jo(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw uL(e)}}function QL(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new XL(t,new Ar(e),n)}function ZL(t){t._throwIfRoot("getDownloadURL");const e=HL(t.storage,t._location,z5());return t.storage.makeRequestWithTokens(e,bo).then(n=>{if(n===null)throw cL();return n})}function JL(t){t._throwIfRoot("deleteObject");const e=VL(t.storage,t._location);return t.storage.makeRequestWithTokens(e,bo)}function eP(t,e){const n=OL(t._location.path,e),s=new Ps(t._location.bucket,n);return new Jo(t.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tP(t){return/^[A-Za-z]+:\/\//.test(t)}function nP(t,e){return new Jo(t,e)}function Y5(t,e){if(t instanceof Y_){const n=t;if(n._bucket==null)throw aL();const s=new Jo(n,n._bucket);return e!=null?Y5(s,e):s}else return e!==void 0?eP(t,e):t}function sP(t,e){if(e&&tP(e)){if(t instanceof Y_)return nP(t,e);throw Q1("To use ref(service, url), the first argument must be a Storage instance.")}else return Y5(t,e)}function vb(t,e){const n=e==null?void 0:e[P5];return n==null?null:Ps.makeFromBucketSpec(n,t)}class Y_{constructor(e,n,s,i,r){this.app=e,this._authProvider=n,this._appCheckProvider=s,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=L5,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=QO,this._maxUploadRetryTime=ZO,this._requests=new Set,i!=null?this._bucket=Ps.makeFromBucketSpec(i,this._host):this._bucket=vb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ps.makeFromBucketSpec(this._url,e):this._bucket=vb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){gb("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){gb("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Jo(this,e)}_makeRequest(e,n,s,i){if(this._deleted)return new hL(F5());{const r=EL(e,this._appId,s,i,n,this._firebaseVersion);return this._requests.add(r),r.getPromise().then(()=>this._requests.delete(r),()=>this._requests.delete(r)),r}}async makeRequestWithTokens(e,n){const[s,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,s,i).getPromise()}}const yb="@firebase/storage",bb="0.8.6";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5="storage";function iP(t,e,n){return t=_n(t),QL(t,e,n)}function rP(t){return t=_n(t),ZL(t)}function oP(t){return t=_n(t),JL(t)}function aP(t,e){return t=_n(t),sP(t,e)}function lP(t=ng(),e){return t=_n(t),eg(t,X5).getImmediate({identifier:e})}function cP(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new Y_(n,s,i,e,tg)}function uP(){mu(new vl(X5,cP,"PUBLIC").setMultipleInstances(!0)),Li(yb,bb,""),Li(yb,bb,"esm2017")}uP();const hP=JSON.parse('{"apiKey": "AIzaSyCVy3Oc1jgvacBZe5hKBA8mV9EOqmqUG0U", "authDomain": "sandbox-public.firebaseapp.com", "databaseURL": "https://sandbox-public.firebaseio.com", "projectId": "sandbox-public", "storageBucket": "sandbox-public.appspot.com", "messagingSenderId": "694742394920", "appId": "1:694742394920:web:af0d589c7618f85ccc2d1d"}');NC(hP);const Xr=RO(),Q5=Wk(),dP=lP(),ea="users",n0="chatRooms",fP="messages",X_=t=>`${n0}/${t}/${fP}`,ko="timestamp",wb="lastUpdated",mP="typingUsers",pP="reactions",Z5="users",Q_=YO,gP=XO(),Fo=t=>$O(t).then(e=>({data:s0(e),docs:e.docs})),J5=t=>qO(t).then(e=>rT(e)),Z_=(t,e)=>WO(t,e),_P=(t,e,n)=>zO(Cl(Xr,t,e),n),J_=(t,e)=>KO(t,e),ev=(t,e)=>GO(Cl(Xr,t,e)),eT=D_(Xr,ea),tT=t=>Cl(Xr,ea,t),vP=()=>Fo(Ls(eT)),yP=t=>J5(tT(t)),Eb=t=>Z_(eT,t),pm=(t,e)=>_P(ea,t,e),xb=(t,e)=>J_(tT(t),e),bP=t=>ev(ea,t),Xc=D_(Xr,n0),wP=t=>Cl(Xr,n0,t),EP=(t,e,n)=>n?Ls(Xc,X1(ea,"array-contains",t),Wi(wb,"desc"),Yc(e),I5(n)):Ls(Xc,X1(ea,"array-contains",t),Wi(wb,"desc"),Yc(e)),xP=()=>Fo(Ls(Xc)),TP=t=>Fo(t),Na=t=>Z_(Xc,t),Qc=(t,e)=>J_(wP(t),e),nT=t=>ev(n0,t),Tb=(t,e)=>Fo(Ls(Xc,X1(ea,"==",[t,e]))),SP=(t,e)=>Qc(t,{[Z5]:V_(e)}),AP=(t,e)=>Qc(t,{[Z5]:q_(e)}),RP=(t,e,n)=>{const s=n==="add"?V_(e):q_(e);return Qc(t,{[mP]:s})},Yi=t=>D_(Xr,X_(t)),sT=(t,e)=>Cl(Xr,X_(t),e),Z1=(t,e,n)=>Fo(n?Ls(Yi(t),Wi(ko,"desc"),Yc(e),I5(n)):e?Ls(Yi(t),Wi(ko,"desc"),Yc(e)):Yi(t)),CP=(t,e)=>J5(sT(t,e)),IP=(t,e)=>Z_(Yi(t),e),nc=(t,e,n)=>J_(sT(t,e),n),iT=(t,e)=>ev(X_(t),e),kP=(t,e)=>Q_(t,n=>{e(s0(n))}),MP=(t,e,n)=>e&&n?Ls(Yi(t),Wi(ko),hb(e),db(n)):e?Ls(Yi(t),Wi(ko),hb(e)):n?Ls(Yi(t),Wi(ko),db(n)):Ls(Yi(t),Wi(ko)),NP=(t,e,n,s)=>Q_(MP(t,e,n),i=>{s(s0(i))}),rT=t=>({...t.data(),id:t.id}),s0=t=>{const e=[];return t.forEach(n=>{e.push(rT(n))}),e},OP=t=>Ls(Yi(t),Wi(ko,"desc"),Yc(1)),LP=(t,e)=>Q_(Ls(OP(t)),n=>{e(s0(n))}),PP=(t,e,n,s,i)=>{const r=i==="add"?V_(n):q_(n);return nc(t,e,{[`${pP}.${s}`]:r})},DP="files",oT=(t,e,n)=>aP(dP,`${DP}/${t}/${e}/${n}`),J1=(t,e,n)=>oP(oT(t,e,`${n.name}.${n.extension||n.type}`)),BP=t=>rP(t),FP=(t,e,n,s)=>{const i=oT(t,e,`${n.name}.${s}`);return iP(i,n.blob,{contentType:s})},UP=(t,e,n,s,i,r,o)=>{const a=FP(t,e,n,s);a.on("state_changed",l=>{const c=Math.round(l.bytesTransferred/l.totalBytes*100);i(c)},l=>{r(l)},async()=>{const l=await BP(a.snapshot.ref);o(l)})},jP=xE,ep=t=>EE(Q5,"/status/"+t),HP=t=>{const e={state:"offline",lastChanged:gy()},n={state:"online",lastChanged:gy()},s=EE(Q5,".info/connected");xE(s,i=>{i.val()===!0&&Uk(ep(t)).set(e).then(()=>{jk(ep(t),n)})})},_h=(t,e)=>String(t).padStart(e,"0"),VP=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate(),tp=(t,e="")=>{if(!t)return;const n=t.seconds?new Date(t.seconds*1e3):t;if(e==="HH:mm")return`${_h(n.getHours(),2)}:${_h(n.getMinutes(),2)}`;if(e==="DD MMMM YYYY"){const s={month:"long",year:"numeric",day:"numeric"};return`${new Intl.DateTimeFormat("en-GB",s).format(n)}`}else if(e==="DD/MM/YY"){const s={month:"numeric",year:"numeric",day:"numeric"};return`${new Intl.DateTimeFormat("en-GB",s).format(n)}`}else if(e==="DD MMMM, HH:mm"){const s={month:"long",day:"numeric"};return`${new Intl.DateTimeFormat("en-GB",s).format(n)}, ${_h(n.getHours(),2)}:${_h(n.getMinutes(),2)}`}return n},gm=(t,e)=>{const n=VP(t,new Date)?"HH:mm":"DD/MM/YY",s=tp(e,n);return n==="HH:mm"?`Today, ${s}`:s};var qP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQYAAADjCAMAAABQFUqLAAAAilBMVEX///9BuIM0SV5xyqJnd4bz+/dNvIug28FZwZPP7eDn9u9AsYE1UGC35NCJ07I2V2M3ZWc/qn4+nHo7gXHb8ujD6dis4Ml9zqo8jnXy9PWU17llxZo5c2ycprBBVGjJztQ/o3w7h3M6em44bGrm6OuFkp89lXdNYHI2XmWzusJ0gpFaa3zZ3eFrnZOT9yJ3AAAFzElEQVR42szaCVLbQBCF4e6xZOMFzGIWAbZYJIQN3P96MSSTraZcea2o532H0F/TTzIy+ChAlZjVBehjhJvIRHEPAbQWsyJglmowlfJIcU8B1IjRNoBeFHctIseKmy8CZic2VRcwp2owk72R4h4DqBaTdQA9KG4in6ZqsAyYN7FoAuheceNSvpwo7tzlK7kLmMVcccfyXTlW3GnAbCqB1QH0qLiRRJZongVQK7A3n1j+ZInmBRzNwWN5rrgT+eXSI5oFGsuNQyzHM4mM0bwZOJptAJ2ZYxmt1OA1YLphY/mkuKNS/nBLF83CI5aXEvWI5jMczQFjedMrltGVJZqL4aLZBcyrGqwk8o3mO/CY8I1lNLVEc4lGc6hYPtseE5F3NLdEsbySlJk6PC26Sv7BewBdWGIpSUT3OPjyNu/3mOgfzXs0mg1tLCOXe1zLdHlLu/OIZk0Ry1tJ4rnHNRvHy1vateJe/nM0W8/LW9os/z2u9ojlnST53uPWBDPVQflHLKeZ6qD8I1a1yRjLKP+I5ThTHbbyiGbHdHn7W/4Ra5c/lgT3ON+ZiiGaLcNM9Tuee5zv5S0t/4jlM1OVclD+Ect5pkrzv8clYpnt8hblH7GcZiqA0z2uIrq8fSEYsXxnKqpo1kSXt738I1aWmSriucfBl7deMxVdNCuCmeoHghHLd6YijGYje1vGWPre4xhmqk/5Ryyay1vOEYthpiK4x20JZiohGLEYZiqCexzV5S3biMUxUxHc4xx/EE8jGbGYLm8JDj+V88xU37i1YxuGgRgIgnAFguHMdiL1X6QaUMbj/y7ZxAGzBIwmdyzXRCxSpvKM5hGUN6THETIVwONQ8paPWAPGstvjuPL2fF/EaCYzFdfjUPK2MGKh5e35fvtHM5ip2B6HkrdFEYuaqdij2TCW3IhFyFQNHvc3y1syYs0ZS4DHVTPVjNFkjGXJ48zy1hux+JmK6HHHCzKWJY+7zPLGiVjJTCX2uDdoLGsRy5ipWKO5Xd4YEevcLm8Ej4s+iG8fzc+csaxFLGOmwowmcSxrHmeWt2DEMstbMmIZMxXB40jyFoxYxky13+NY8haMWMZM1eFxZnkLRiy1vAWfyo2ZqmM054xlKWIZM1XHaM4Zy5LHGTNVh8eZ5S0YseaMZc3jzPKWjFjGTNXgcWZ5WxexLrS8BT3OmKk6PM4sb8mIZcxUDaM5Zyzvcs0dN2IYhoKFC1kG7Go/QNykyv2PmIq7kCPTPypYcuYSA77htYjlMVM1kKbn5c0yYnnMVA32OI+ZqoU048jy2h7neXkzjFgeM1WLPc7z8ma3x/14Xt4sI5bHTNVgj3O9vBlGLI+ZqoU0PS9vhhHLY6Zqscd99oP4v0WsOLK8FrE8ZqoG0owjy2t7nOflzTJieV7eDPc4j5mqxR7neXmzi1jfHjNVA2kGkuWFiOU0U1lL0/nyZrTHBZPl2adyt5nKVJrhZHnqtAh1TGxLEyTLE3uc80xldVoEOyZ0adJkeXSPC7O8XYpYATLVEWniZHkoYoVa3k7vcUEy1U5pMmW5O2KFyVS7pEmV5Z/TAndMVKSJWt7W9ji0LIvTAnlMLKWJlqUw4Ja3YxErXKbakiZblsKIW97qzJRMpZPhshSelEylM8BlKSTa8rZrjwvxIH6GES5LoaMeEyUZLkthoi1vaxGLekyUJLYsX/S05a3OHZOpdDq2LIUbJlPpTLTlbW2PY8tSeGAylU7PlqWQscdESceWpTDglrc6CXtMLKTJlqUw4pa3OjMlU+lkuCyFJyVTbe1x8R7Ez5DYsnxHLEqm0hnhshQ66jFRknHLW52Jkqm2TgvqMVGS2LJ80dOWtzp3TKbS6diyFG645a3OFyVTbUmTLUvhgclUOj1blkLGLW91nrTlrc4Al6WQsMfEQppsWQojbnmrM1OPiZIMl6Uw0Za3tYhFyVQ6iS3Ld8SiZCqdEbe81enYshRumEylM32ALH8BfJbP09a3ElQAAAAASUVORK5CYII=";function $P(t,e){const n=Object.create(null),s=t.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const zP=()=>{},KP=Object.assign,GP=Object.prototype.hasOwnProperty,i0=(t,e)=>GP.call(t,e),Or=Array.isArray,Kh=t=>aT(t)==="[object Map]",WP=t=>typeof t=="function",YP=t=>typeof t=="string",tv=t=>typeof t=="symbol",r0=t=>t!==null&&typeof t=="object",XP=Object.prototype.toString,aT=t=>XP.call(t),QP=t=>aT(t).slice(8,-1),nv=t=>YP(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,lT=(t,e)=>!Object.is(t,e),ZP=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})};let Ti;class JP{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&Ti&&(this.parent=Ti,this.index=(Ti.scopes||(Ti.scopes=[])).push(this)-1)}run(e){if(this.active){const n=Ti;try{return Ti=this,e()}finally{Ti=n}}}on(){Ti=this}off(){Ti=this.parent}stop(e){if(this.active){let n,s;for(n=0,s=this.effects.length;n<s;n++)this.effects[n].stop();for(n=0,s=this.cleanups.length;n<s;n++)this.cleanups[n]();if(this.scopes)for(n=0,s=this.scopes.length;n<s;n++)this.scopes[n].stop(!0);if(this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.active=!1}}}function eD(t,e=Ti){e&&e.active&&e.effects.push(t)}const sv=t=>{const e=new Set(t);return e.w=0,e.n=0,e},cT=t=>(t.w&zr)>0,uT=t=>(t.n&zr)>0,tD=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=zr},nD=t=>{const{deps:e}=t;if(e.length){let n=0;for(let s=0;s<e.length;s++){const i=e[s];cT(i)&&!uT(i)?i.delete(t):e[n++]=i,i.w&=~zr,i.n&=~zr}e.length=n}},np=new WeakMap;let sc=0,zr=1;const sp=30;let ui;const Uo=Symbol(""),ip=Symbol("");class iv{constructor(e,n=null,s){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,eD(this,s)}run(){if(!this.active)return this.fn();let e=ui,n=Lr;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=ui,ui=this,Lr=!0,zr=1<<++sc,sc<=sp?tD(this):Sb(this),this.fn()}finally{sc<=sp&&nD(this),zr=1<<--sc,ui=this.parent,Lr=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){ui===this?this.deferStop=!0:this.active&&(Sb(this),this.onStop&&this.onStop(),this.active=!1)}}function Sb(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Lr=!0;const hT=[];function kl(){hT.push(Lr),Lr=!1}function Ml(){const t=hT.pop();Lr=t===void 0?!0:t}function Vs(t,e,n){if(Lr&&ui){let s=np.get(t);s||np.set(t,s=new Map);let i=s.get(n);i||s.set(n,i=sv()),dT(i)}}function dT(t,e){let n=!1;sc<=sp?uT(t)||(t.n|=zr,n=!cT(t)):n=!t.has(ui),n&&(t.add(ui),ui.deps.push(t))}function or(t,e,n,s,i,r){const o=np.get(t);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(n==="length"&&Or(t))o.forEach((l,c)=>{(c==="length"||c>=s)&&a.push(l)});else switch(n!==void 0&&a.push(o.get(n)),e){case"add":Or(t)?nv(n)&&a.push(o.get("length")):(a.push(o.get(Uo)),Kh(t)&&a.push(o.get(ip)));break;case"delete":Or(t)||(a.push(o.get(Uo)),Kh(t)&&a.push(o.get(ip)));break;case"set":Kh(t)&&a.push(o.get(Uo));break}if(a.length===1)a[0]&&rp(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);rp(sv(l))}}function rp(t,e){const n=Or(t)?t:[...t];for(const s of n)s.computed&&Ab(s);for(const s of n)s.computed||Ab(s)}function Ab(t,e){(t!==ui||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const sD=$P("__proto__,__v_isRef,__isVue"),fT=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(tv)),iD=rv(),rD=rv(!1,!0),oD=rv(!0),Rb=aD();function aD(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const s=Ft(this);for(let r=0,o=this.length;r<o;r++)Vs(s,"get",r+"");const i=s[e](...n);return i===-1||i===!1?s[e](...n.map(Ft)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){kl();const s=Ft(this)[e].apply(this,n);return Ml(),s}}),t}function rv(t=!1,e=!1){return function(s,i,r){if(i==="__v_isReactive")return!t;if(i==="__v_isReadonly")return t;if(i==="__v_isShallow")return e;if(i==="__v_raw"&&r===(t?e?xD:vT:e?_T:gT).get(s))return s;const o=Or(s);if(!t&&o&&i0(Rb,i))return Reflect.get(Rb,i,r);const a=Reflect.get(s,i,r);return(tv(i)?fT.has(i):sD(i))||(t||Vs(s,"get",i),e)?a:os(a)?o&&nv(i)?a:a.value:r0(a)?t?yT(a):lv(a):a}}const lD=mT(),cD=mT(!0);function mT(t=!1){return function(n,s,i,r){let o=n[s];if(Zc(o)&&os(o)&&!os(i))return!1;if(!t&&!Zc(i)&&(op(i)||(i=Ft(i),o=Ft(o)),!Or(n)&&os(o)&&!os(i)))return o.value=i,!0;const a=Or(n)&&nv(s)?Number(s)<n.length:i0(n,s),l=Reflect.set(n,s,i,r);return n===Ft(r)&&(a?lT(i,o)&&or(n,"set",s,i):or(n,"add",s,i)),l}}function uD(t,e){const n=i0(t,e);t[e];const s=Reflect.deleteProperty(t,e);return s&&n&&or(t,"delete",e,void 0),s}function hD(t,e){const n=Reflect.has(t,e);return(!tv(e)||!fT.has(e))&&Vs(t,"has",e),n}function dD(t){return Vs(t,"iterate",Or(t)?"length":Uo),Reflect.ownKeys(t)}const pT={get:iD,set:lD,deleteProperty:uD,has:hD,ownKeys:dD},fD={get:oD,set(t,e){return!0},deleteProperty(t,e){return!0}},mD=KP({},pT,{get:rD,set:cD}),ov=t=>t,o0=t=>Reflect.getPrototypeOf(t);function vh(t,e,n=!1,s=!1){t=t.__v_raw;const i=Ft(t),r=Ft(e);n||(e!==r&&Vs(i,"get",e),Vs(i,"get",r));const{has:o}=o0(i),a=s?ov:n?hv:uv;if(o.call(i,e))return a(t.get(e));if(o.call(i,r))return a(t.get(r));t!==i&&t.get(e)}function yh(t,e=!1){const n=this.__v_raw,s=Ft(n),i=Ft(t);return e||(t!==i&&Vs(s,"has",t),Vs(s,"has",i)),t===i?n.has(t):n.has(t)||n.has(i)}function bh(t,e=!1){return t=t.__v_raw,!e&&Vs(Ft(t),"iterate",Uo),Reflect.get(t,"size",t)}function Cb(t){t=Ft(t);const e=Ft(this);return o0(e).has.call(e,t)||(e.add(t),or(e,"add",t,t)),this}function Ib(t,e){e=Ft(e);const n=Ft(this),{has:s,get:i}=o0(n);let r=s.call(n,t);r||(t=Ft(t),r=s.call(n,t));const o=i.call(n,t);return n.set(t,e),r?lT(e,o)&&or(n,"set",t,e):or(n,"add",t,e),this}function kb(t){const e=Ft(this),{has:n,get:s}=o0(e);let i=n.call(e,t);i||(t=Ft(t),i=n.call(e,t)),s&&s.call(e,t);const r=e.delete(t);return i&&or(e,"delete",t,void 0),r}function Mb(){const t=Ft(this),e=t.size!==0,n=t.clear();return e&&or(t,"clear",void 0,void 0),n}function wh(t,e){return function(s,i){const r=this,o=r.__v_raw,a=Ft(o),l=e?ov:t?hv:uv;return!t&&Vs(a,"iterate",Uo),o.forEach((c,d)=>s.call(i,l(c),l(d),r))}}function Eh(t,e,n){return function(...s){const i=this.__v_raw,r=Ft(i),o=Kh(r),a=t==="entries"||t===Symbol.iterator&&o,l=t==="keys"&&o,c=i[t](...s),d=n?ov:e?hv:uv;return!e&&Vs(r,"iterate",l?ip:Uo),{next(){const{value:u,done:f}=c.next();return f?{value:u,done:f}:{value:a?[d(u[0]),d(u[1])]:d(u),done:f}},[Symbol.iterator](){return this}}}}function mr(t){return function(...e){return t==="delete"?!1:this}}function pD(){const t={get(r){return vh(this,r)},get size(){return bh(this)},has:yh,add:Cb,set:Ib,delete:kb,clear:Mb,forEach:wh(!1,!1)},e={get(r){return vh(this,r,!1,!0)},get size(){return bh(this)},has:yh,add:Cb,set:Ib,delete:kb,clear:Mb,forEach:wh(!1,!0)},n={get(r){return vh(this,r,!0)},get size(){return bh(this,!0)},has(r){return yh.call(this,r,!0)},add:mr("add"),set:mr("set"),delete:mr("delete"),clear:mr("clear"),forEach:wh(!0,!1)},s={get(r){return vh(this,r,!0,!0)},get size(){return bh(this,!0)},has(r){return yh.call(this,r,!0)},add:mr("add"),set:mr("set"),delete:mr("delete"),clear:mr("clear"),forEach:wh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=Eh(r,!1,!1),n[r]=Eh(r,!0,!1),e[r]=Eh(r,!1,!0),s[r]=Eh(r,!0,!0)}),[t,n,e,s]}const[gD,_D,vD,yD]=pD();function av(t,e){const n=e?t?yD:vD:t?_D:gD;return(s,i,r)=>i==="__v_isReactive"?!t:i==="__v_isReadonly"?t:i==="__v_raw"?s:Reflect.get(i0(n,i)&&i in s?n:s,i,r)}const bD={get:av(!1,!1)},wD={get:av(!1,!0)},ED={get:av(!0,!1)},gT=new WeakMap,_T=new WeakMap,vT=new WeakMap,xD=new WeakMap;function TD(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function SD(t){return t.__v_skip||!Object.isExtensible(t)?0:TD(QP(t))}function lv(t){return Zc(t)?t:cv(t,!1,pT,bD,gT)}function AD(t){return cv(t,!1,mD,wD,_T)}function yT(t){return cv(t,!0,fD,ED,vT)}function cv(t,e,n,s,i){if(!r0(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const r=i.get(t);if(r)return r;const o=SD(t);if(o===0)return t;const a=new Proxy(t,o===2?s:n);return i.set(t,a),a}function Ha(t){return Zc(t)?Ha(t.__v_raw):!!(t&&t.__v_isReactive)}function Zc(t){return!!(t&&t.__v_isReadonly)}function op(t){return!!(t&&t.__v_isShallow)}function bT(t){return Ha(t)||Zc(t)}function Ft(t){const e=t&&t.__v_raw;return e?Ft(e):t}function wT(t){return ZP(t,"__v_skip",!0),t}const uv=t=>r0(t)?lv(t):t,hv=t=>r0(t)?yT(t):t;function RD(t){Lr&&ui&&(t=Ft(t),dT(t.dep||(t.dep=sv())))}function CD(t,e){t=Ft(t),t.dep&&rp(t.dep)}function os(t){return!!(t&&t.__v_isRef===!0)}function ID(t){return os(t)?t.value:t}const kD={get:(t,e,n)=>ID(Reflect.get(t,e,n)),set:(t,e,n,s)=>{const i=t[e];return os(i)&&!os(n)?(i.value=n,!0):Reflect.set(t,e,n,s)}};function ET(t){return Ha(t)?t:new Proxy(t,kD)}class MD{constructor(e,n,s,i){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new iv(e,()=>{this._dirty||(this._dirty=!0,CD(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=s}get value(){const e=Ft(this);return RD(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function ND(t,e,n=!1){let s,i;const r=WP(t);return r?(s=t,i=zP):(s=t.get,i=t.set),new MD(s,i,r||!i,n)}function OD(t,e){const n=Object.create(null),s=t.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}function Lt(t){if(Rt(t)){const e={};for(let n=0;n<t.length;n++){const s=t[n],i=ls(s)?DD(s):Lt(s);if(i)for(const r in i)e[r]=i[r]}return e}else{if(ls(t))return t;if(cs(t))return t}}const LD=/;(?![^(]*\))/g,PD=/:(.+)/;function DD(t){const e={};return t.split(LD).forEach(n=>{if(n){const s=n.split(PD);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function yt(t){let e="";if(ls(t))e=t;else if(Rt(t))for(let n=0;n<t.length;n++){const s=yt(t[n]);s&&(e+=s+" ")}else if(cs(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}function pt(t){if(!t)return null;let{class:e,style:n}=t;return e&&!ls(e)&&(t.class=yt(e)),n&&(t.style=Lt(n)),t}const ot=t=>ls(t)?t:t==null?"":Rt(t)||cs(t)&&(t.toString===CT||!Et(t.toString))?JSON.stringify(t,xT,2):String(t),xT=(t,e)=>e&&e.__v_isRef?xT(t,e.value):ST(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[s,i])=>(n[`${s} =>`]=i,n),{})}:AT(e)?{[`Set(${e.size})`]:[...e.values()]}:cs(e)&&!Rt(e)&&!IT(e)?String(e):e,Xt={},Va=[],Pi=()=>{},BD=()=>!1,FD=/^on[^a-z]/,dv=t=>FD.test(t),TT=t=>t.startsWith("onUpdate:"),qs=Object.assign,fv=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},UD=Object.prototype.hasOwnProperty,Dt=(t,e)=>UD.call(t,e),Rt=Array.isArray,ST=t=>mv(t)==="[object Map]",AT=t=>mv(t)==="[object Set]",Et=t=>typeof t=="function",ls=t=>typeof t=="string",cs=t=>t!==null&&typeof t=="object",RT=t=>cs(t)&&Et(t.then)&&Et(t.catch),CT=Object.prototype.toString,mv=t=>CT.call(t),IT=t=>mv(t)==="[object Object]",Gh=OD(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),a0=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},jD=/-(\w)/g,Fi=a0(t=>t.replace(jD,(e,n)=>n?n.toUpperCase():"")),HD=/\B([A-Z])/g,l0=a0(t=>t.replace(HD,"-$1").toLowerCase()),pv=a0(t=>t.charAt(0).toUpperCase()+t.slice(1)),_m=a0(t=>t?`on${pv(t)}`:""),Nb=(t,e)=>!Object.is(t,e),vm=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},ap=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},VD=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let Ob;const qD=()=>Ob||(Ob=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});function Pr(t,e,n,s){let i;try{i=s?t(...s):t()}catch(r){c0(r,e,n)}return i}function ti(t,e,n,s){if(Et(t)){const r=Pr(t,e,n,s);return r&&RT(r)&&r.catch(o=>{c0(o,e,n)}),r}const i=[];for(let r=0;r<t.length;r++)i.push(ti(t[r],e,n,s));return i}function c0(t,e,n,s=!0){const i=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=n;for(;r;){const c=r.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](t,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){Pr(l,null,10,[t,o,a]);return}}$D(t,n,i,s)}function $D(t,e,n,s=!0){console.error(t)}let Vd=!1,lp=!1;const Ns=[];let zi=0;const bc=[];let ic=null,Ra=0;const wc=[];let Er=null,Ca=0;const kT=Promise.resolve();let gv=null,cp=null;function MT(t){const e=gv||kT;return t?e.then(this?t.bind(this):t):e}function zD(t){let e=zi+1,n=Ns.length;for(;e<n;){const s=e+n>>>1;Jc(Ns[s])<t?e=s+1:n=s}return e}function NT(t){(!Ns.length||!Ns.includes(t,Vd&&t.allowRecurse?zi+1:zi))&&t!==cp&&(t.id==null?Ns.push(t):Ns.splice(zD(t.id),0,t),OT())}function OT(){!Vd&&!lp&&(lp=!0,gv=kT.then(DT))}function KD(t){const e=Ns.indexOf(t);e>zi&&Ns.splice(e,1)}function LT(t,e,n,s){Rt(t)?n.push(...t):(!e||!e.includes(t,t.allowRecurse?s+1:s))&&n.push(t),OT()}function GD(t){LT(t,ic,bc,Ra)}function WD(t){LT(t,Er,wc,Ca)}function u0(t,e=null){if(bc.length){for(cp=e,ic=[...new Set(bc)],bc.length=0,Ra=0;Ra<ic.length;Ra++)ic[Ra]();ic=null,Ra=0,cp=null,u0(t,e)}}function PT(t){if(u0(),wc.length){const e=[...new Set(wc)];if(wc.length=0,Er){Er.push(...e);return}for(Er=e,Er.sort((n,s)=>Jc(n)-Jc(s)),Ca=0;Ca<Er.length;Ca++)Er[Ca]();Er=null,Ca=0}}const Jc=t=>t.id==null?1/0:t.id;function DT(t){lp=!1,Vd=!0,u0(t),Ns.sort((n,s)=>Jc(n)-Jc(s));const e=Pi;try{for(zi=0;zi<Ns.length;zi++){const n=Ns[zi];n&&n.active!==!1&&Pr(n,null,14)}}finally{zi=0,Ns.length=0,PT(),Vd=!1,gv=null,(Ns.length||bc.length||wc.length)&&DT(t)}}function YD(t,e,...n){if(t.isUnmounted)return;const s=t.vnode.props||Xt;let i=n;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in s){const d=`${o==="modelValue"?"model":o}Modifiers`,{number:u,trim:f}=s[d]||Xt;f&&(i=n.map(m=>m.trim())),u&&(i=n.map(VD))}let a,l=s[a=_m(e)]||s[a=_m(Fi(e))];!l&&r&&(l=s[a=_m(l0(e))]),l&&ti(l,t,6,i);const c=s[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,ti(c,t,6,i)}}function BT(t,e,n=!1){const s=e.emitsCache,i=s.get(t);if(i!==void 0)return i;const r=t.emits;let o={},a=!1;if(!Et(t)){const l=c=>{const d=BT(c,e,!0);d&&(a=!0,qs(o,d))};!n&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!r&&!a?(s.set(t,null),null):(Rt(r)?r.forEach(l=>o[l]=null):qs(o,r),s.set(t,o),o)}function h0(t,e){return!t||!dv(e)?!1:(e=e.slice(2).replace(/Once$/,""),Dt(t,e[0].toLowerCase()+e.slice(1))||Dt(t,l0(e))||Dt(t,e))}let $n=null,FT=null;function qd(t){const e=$n;return $n=t,FT=t&&t.type.__scopeId||null,e}function Je(t,e=$n,n){if(!e||t._n)return t;const s=(...i)=>{s._d&&$b(-1);const r=qd(e),o=t(...i);return qd(r),s._d&&$b(1),o};return s._n=!0,s._c=!0,s._d=!0,s}function ym(t){const{type:e,vnode:n,proxy:s,withProxy:i,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:d,renderCache:u,data:f,setupState:m,ctx:h,inheritAttrs:k}=t;let I,L;const p=qd(t);try{if(n.shapeFlag&4){const P=i||s;I=Ri(d.call(P,P,u,r,m,f,h)),L=l}else{const P=e;I=Ri(P.length>1?P(r,{attrs:l,slots:a,emit:c}):P(r,null)),L=e.props?l:XD(l)}}catch(P){xc.length=0,c0(P,t,1),I=Ue(ni)}let C=I;if(L&&k!==!1){const P=Object.keys(L),{shapeFlag:M}=C;P.length&&M&7&&(o&&P.some(TT)&&(L=QD(L,o)),C=Kr(C,L))}return n.dirs&&(C=Kr(C),C.dirs=C.dirs?C.dirs.concat(n.dirs):n.dirs),n.transition&&(C.transition=n.transition),I=C,qd(p),I}const XD=t=>{let e;for(const n in t)(n==="class"||n==="style"||dv(n))&&((e||(e={}))[n]=t[n]);return e},QD=(t,e)=>{const n={};for(const s in t)(!TT(s)||!(s.slice(9)in e))&&(n[s]=t[s]);return n};function ZD(t,e,n){const{props:s,children:i,component:r}=t,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return s?Lb(s,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let u=0;u<d.length;u++){const f=d[u];if(o[f]!==s[f]&&!h0(c,f))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?Lb(s,o,c):!0:!!o;return!1}function Lb(t,e,n){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let i=0;i<s.length;i++){const r=s[i];if(e[r]!==t[r]&&!h0(n,r))return!0}return!1}function JD({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const eB=t=>t.__isSuspense;function tB(t,e){e&&e.pendingBranch?Rt(t)?e.effects.push(...t):e.effects.push(t):WD(t)}function nB(t,e){if(Mn){let n=Mn.provides;const s=Mn.parent&&Mn.parent.provides;s===n&&(n=Mn.provides=Object.create(s)),n[t]=e}}function bm(t,e,n=!1){const s=Mn||$n;if(s){const i=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(i&&t in i)return i[t];if(arguments.length>1)return n&&Et(e)?e.call(s.proxy):e}}const Pb={};function wm(t,e,n){return UT(t,e,n)}function UT(t,e,{immediate:n,deep:s,flush:i,onTrack:r,onTrigger:o}=Xt){const a=Mn;let l,c=!1,d=!1;if(os(t)?(l=()=>t.value,c=op(t)):Ha(t)?(l=()=>t,s=!0):Rt(t)?(d=!0,c=t.some(L=>Ha(L)||op(L)),l=()=>t.map(L=>{if(os(L))return L.value;if(Ha(L))return Mo(L);if(Et(L))return Pr(L,a,2)})):Et(t)?e?l=()=>Pr(t,a,2):l=()=>{if(!(a&&a.isUnmounted))return u&&u(),ti(t,a,3,[f])}:l=Pi,e&&s){const L=l;l=()=>Mo(L())}let u,f=L=>{u=I.onStop=()=>{Pr(L,a,4)}};if(su)return f=Pi,e?n&&ti(e,a,3,[l(),d?[]:void 0,f]):l(),Pi;let m=d?[]:Pb;const h=()=>{if(!!I.active)if(e){const L=I.run();(s||c||(d?L.some((p,C)=>Nb(p,m[C])):Nb(L,m)))&&(u&&u(),ti(e,a,3,[L,m===Pb?void 0:m,f]),m=L)}else I.run()};h.allowRecurse=!!e;let k;i==="sync"?k=h:i==="post"?k=()=>gs(h,a&&a.suspense):k=()=>GD(h);const I=new iv(l,k);return e?n?h():m=I.run():i==="post"?gs(I.run.bind(I),a&&a.suspense):I.run(),()=>{I.stop(),a&&a.scope&&fv(a.scope.effects,I)}}function sB(t,e,n){const s=this.proxy,i=ls(t)?t.includes(".")?jT(s,t):()=>s[t]:t.bind(s,s);let r;Et(e)?r=e:(r=e.handler,n=e);const o=Mn;ul(this);const a=UT(i,r.bind(s),n);return o?ul(o):jo(),a}function jT(t,e){const n=e.split(".");return()=>{let s=t;for(let i=0;i<n.length&&s;i++)s=s[n[i]];return s}}function Mo(t,e){if(!cs(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),os(t))Mo(t.value,e);else if(Rt(t))for(let n=0;n<t.length;n++)Mo(t[n],e);else if(AT(t)||ST(t))t.forEach(n=>{Mo(n,e)});else if(IT(t))for(const n in t)Mo(t[n],e);return t}function HT(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return zT(()=>{t.isMounted=!0}),GT(()=>{t.isUnmounting=!0}),t}const Ks=[Function,Array],iB={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ks,onEnter:Ks,onAfterEnter:Ks,onEnterCancelled:Ks,onBeforeLeave:Ks,onLeave:Ks,onAfterLeave:Ks,onLeaveCancelled:Ks,onBeforeAppear:Ks,onAppear:Ks,onAfterAppear:Ks,onAppearCancelled:Ks},setup(t,{slots:e}){const n=l6(),s=HT();let i;return()=>{const r=e.default&&_v(e.default(),!0);if(!r||!r.length)return;let o=r[0];if(r.length>1){for(const k of r)if(k.type!==ni){o=k;break}}const a=Ft(t),{mode:l}=a;if(s.isLeaving)return Em(o);const c=Db(o);if(!c)return Em(o);const d=eu(c,a,s,n);tu(c,d);const u=n.subTree,f=u&&Db(u);let m=!1;const{getTransitionKey:h}=c.type;if(h){const k=h();i===void 0?i=k:k!==i&&(i=k,m=!0)}if(f&&f.type!==ni&&(!wo(c,f)||m)){const k=eu(f,a,s,n);if(tu(f,k),l==="out-in")return s.isLeaving=!0,k.afterLeave=()=>{s.isLeaving=!1,n.update()},Em(o);l==="in-out"&&c.type!==ni&&(k.delayLeave=(I,L,p)=>{const C=qT(s,f);C[String(f.key)]=f,I._leaveCb=()=>{L(),I._leaveCb=void 0,delete d.delayedLeave},d.delayedLeave=p})}return o}}},VT=iB;function qT(t,e){const{leavingVNodes:n}=t;let s=n.get(e.type);return s||(s=Object.create(null),n.set(e.type,s)),s}function eu(t,e,n,s){const{appear:i,mode:r,persisted:o=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:d,onBeforeLeave:u,onLeave:f,onAfterLeave:m,onLeaveCancelled:h,onBeforeAppear:k,onAppear:I,onAfterAppear:L,onAppearCancelled:p}=e,C=String(t.key),P=qT(n,t),M=(S,x)=>{S&&ti(S,s,9,x)},F=(S,x)=>{const v=x[1];M(S,x),Rt(S)?S.every(w=>w.length<=1)&&v():S.length<=1&&v()},_={mode:r,persisted:o,beforeEnter(S){let x=a;if(!n.isMounted)if(i)x=k||a;else return;S._leaveCb&&S._leaveCb(!0);const v=P[C];v&&wo(t,v)&&v.el._leaveCb&&v.el._leaveCb(),M(x,[S])},enter(S){let x=l,v=c,w=d;if(!n.isMounted)if(i)x=I||l,v=L||c,w=p||d;else return;let b=!1;const y=S._enterCb=A=>{b||(b=!0,A?M(w,[S]):M(v,[S]),_.delayedLeave&&_.delayedLeave(),S._enterCb=void 0)};x?F(x,[S,y]):y()},leave(S,x){const v=String(t.key);if(S._enterCb&&S._enterCb(!0),n.isUnmounting)return x();M(u,[S]);let w=!1;const b=S._leaveCb=y=>{w||(w=!0,x(),y?M(h,[S]):M(m,[S]),S._leaveCb=void 0,P[v]===t&&delete P[v])};P[v]=t,f?F(f,[S,b]):b()},clone(S){return eu(S,e,n,s)}};return _}function Em(t){if(d0(t))return t=Kr(t),t.children=null,t}function Db(t){return d0(t)?t.children?t.children[0]:void 0:t}function tu(t,e){t.shapeFlag&6&&t.component?tu(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function _v(t,e=!1,n){let s=[],i=0;for(let r=0;r<t.length;r++){let o=t[r];const a=n==null?o.key:String(n)+String(o.key!=null?o.key:r);o.type===kt?(o.patchFlag&128&&i++,s=s.concat(_v(o.children,e,a))):(e||o.type!==ni)&&s.push(a!=null?Kr(o,{key:a}):o)}if(i>1)for(let r=0;r<s.length;r++)s[r].patchFlag=-2;return s}function rB(t){return Et(t)?{setup:t,name:t.name}:t}const Ec=t=>!!t.type.__asyncLoader,d0=t=>t.type.__isKeepAlive;function oB(t,e){$T(t,"a",e)}function aB(t,e){$T(t,"da",e)}function $T(t,e,n=Mn){const s=t.__wdc||(t.__wdc=()=>{let i=n;for(;i;){if(i.isDeactivated)return;i=i.parent}return t()});if(f0(e,s,n),n){let i=n.parent;for(;i&&i.parent;)d0(i.parent.vnode)&&lB(s,e,n,i),i=i.parent}}function lB(t,e,n,s){const i=f0(e,t,s,!0);WT(()=>{fv(s[e],i)},n)}function f0(t,e,n=Mn,s=!1){if(n){const i=n[t]||(n[t]=[]),r=e.__weh||(e.__weh=(...o)=>{if(n.isUnmounted)return;kl(),ul(n);const a=ti(e,n,t,o);return jo(),Ml(),a});return s?i.unshift(r):i.push(r),r}}const hr=t=>(e,n=Mn)=>(!su||t==="sp")&&f0(t,e,n),cB=hr("bm"),zT=hr("m"),uB=hr("bu"),KT=hr("u"),GT=hr("bum"),WT=hr("um"),hB=hr("sp"),dB=hr("rtg"),fB=hr("rtc");function mB(t,e=Mn){f0("ec",t,e)}function ar(t,e){const n=$n;if(n===null)return t;const s=g0(n)||n.proxy,i=t.dirs||(t.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=Xt]=e[r];Et(o)&&(o={mounted:o,updated:o}),o.deep&&Mo(a),i.push({dir:o,instance:s,value:a,oldValue:void 0,arg:l,modifiers:c})}return t}function no(t,e,n,s){const i=t.dirs,r=e&&e.dirs;for(let o=0;o<i.length;o++){const a=i[o];r&&(a.oldValue=r[o].value);let l=a.dir[s];l&&(kl(),ti(l,n,8,[t.el,a,t,e]),Ml())}}const vv="components",pB="directives";function et(t,e){return yv(vv,t,!0,e)||t}const YT=Symbol();function gB(t){return ls(t)?yv(vv,t,!1)||t:t||YT}function m0(t){return yv(pB,t)}function yv(t,e,n=!0,s=!1){const i=$n||Mn;if(i){const r=i.type;if(t===vv){const a=qB(r,!1);if(a&&(a===e||a===Fi(e)||a===pv(Fi(e))))return r}const o=Bb(i[t]||r[t],e)||Bb(i.appContext[t],e);return!o&&s?r:o}}function Bb(t,e){return t&&(t[e]||t[Fi(e)]||t[pv(Fi(e))])}function gt(t,e,n,s){let i;const r=n&&n[s];if(Rt(t)||ls(t)){i=new Array(t.length);for(let o=0,a=t.length;o<a;o++)i[o]=e(t[o],o,void 0,r&&r[o])}else if(typeof t=="number"){i=new Array(t);for(let o=0;o<t;o++)i[o]=e(o+1,o,void 0,r&&r[o])}else if(cs(t))if(t[Symbol.iterator])i=Array.from(t,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(t);i=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];i[a]=e(t[c],c,a,r&&r[a])}}else i=[];return n&&(n[s]=i),i}function Jt(t,e){for(let n=0;n<e.length;n++){const s=e[n];if(Rt(s))for(let i=0;i<s.length;i++)t[s[i].name]=s[i].fn;else s&&(t[s.name]=s.fn)}return t}function je(t,e,n={},s,i){if($n.isCE||$n.parent&&Ec($n.parent)&&$n.parent.isCE)return Ue("slot",e==="default"?null:{name:e},s&&s());let r=t[e];r&&r._c&&(r._d=!1),re();const o=r&&XT(r(n)),a=Ut(kt,{key:n.key||`_${e}`},o||(s?s():[]),o&&t._===1?64:-2);return!i&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function XT(t){return t.some(e=>Kd(e)?!(e.type===ni||e.type===kt&&!XT(e.children)):!0)?t:null}const up=t=>t?c6(t)?g0(t)||t.proxy:up(t.parent):null,$d=qs(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>up(t.parent),$root:t=>up(t.root),$emit:t=>t.emit,$options:t=>ZT(t),$forceUpdate:t=>t.f||(t.f=()=>NT(t.update)),$nextTick:t=>t.n||(t.n=MT.bind(t.proxy)),$watch:t=>sB.bind(t)}),_B={get({_:t},e){const{ctx:n,setupState:s,data:i,props:r,accessCache:o,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const m=o[e];if(m!==void 0)switch(m){case 1:return s[e];case 2:return i[e];case 4:return n[e];case 3:return r[e]}else{if(s!==Xt&&Dt(s,e))return o[e]=1,s[e];if(i!==Xt&&Dt(i,e))return o[e]=2,i[e];if((c=t.propsOptions[0])&&Dt(c,e))return o[e]=3,r[e];if(n!==Xt&&Dt(n,e))return o[e]=4,n[e];hp&&(o[e]=0)}}const d=$d[e];let u,f;if(d)return e==="$attrs"&&Vs(t,"get",e),d(t);if((u=a.__cssModules)&&(u=u[e]))return u;if(n!==Xt&&Dt(n,e))return o[e]=4,n[e];if(f=l.config.globalProperties,Dt(f,e))return f[e]},set({_:t},e,n){const{data:s,setupState:i,ctx:r}=t;return i!==Xt&&Dt(i,e)?(i[e]=n,!0):s!==Xt&&Dt(s,e)?(s[e]=n,!0):Dt(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(r[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:s,appContext:i,propsOptions:r}},o){let a;return!!n[o]||t!==Xt&&Dt(t,o)||e!==Xt&&Dt(e,o)||(a=r[0])&&Dt(a,o)||Dt(s,o)||Dt($d,o)||Dt(i.config.globalProperties,o)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Dt(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let hp=!0;function vB(t){const e=ZT(t),n=t.proxy,s=t.ctx;hp=!1,e.beforeCreate&&Fb(e.beforeCreate,t,"bc");const{data:i,computed:r,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:u,mounted:f,beforeUpdate:m,updated:h,activated:k,deactivated:I,beforeDestroy:L,beforeUnmount:p,destroyed:C,unmounted:P,render:M,renderTracked:F,renderTriggered:_,errorCaptured:S,serverPrefetch:x,expose:v,inheritAttrs:w,components:b,directives:y,filters:A}=e;if(c&&yB(c,s,null,t.appContext.config.unwrapInjectedRef),o)for(const W in o){const j=o[W];Et(j)&&(s[W]=j.bind(n))}if(i){const W=i.call(n,n);cs(W)&&(t.data=lv(W))}if(hp=!0,r)for(const W in r){const j=r[W],K=Et(j)?j.bind(n,n):Et(j.get)?j.get.bind(n,n):Pi,g=!Et(j)&&Et(j.set)?j.set.bind(n):Pi,R=zB({get:K,set:g});Object.defineProperty(s,W,{enumerable:!0,configurable:!0,get:()=>R.value,set:ee=>R.value=ee})}if(a)for(const W in a)QT(a[W],s,n,W);if(l){const W=Et(l)?l.call(n):l;Reflect.ownKeys(W).forEach(j=>{nB(j,W[j])})}d&&Fb(d,t,"c");function U(W,j){Rt(j)?j.forEach(K=>W(K.bind(n))):j&&W(j.bind(n))}if(U(cB,u),U(zT,f),U(uB,m),U(KT,h),U(oB,k),U(aB,I),U(mB,S),U(fB,F),U(dB,_),U(GT,p),U(WT,P),U(hB,x),Rt(v))if(v.length){const W=t.exposed||(t.exposed={});v.forEach(j=>{Object.defineProperty(W,j,{get:()=>n[j],set:K=>n[j]=K})})}else t.exposed||(t.exposed={});M&&t.render===Pi&&(t.render=M),w!=null&&(t.inheritAttrs=w),b&&(t.components=b),y&&(t.directives=y)}function yB(t,e,n=Pi,s=!1){Rt(t)&&(t=dp(t));for(const i in t){const r=t[i];let o;cs(r)?"default"in r?o=bm(r.from||i,r.default,!0):o=bm(r.from||i):o=bm(r),os(o)&&s?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[i]=o}}function Fb(t,e,n){ti(Rt(t)?t.map(s=>s.bind(e.proxy)):t.bind(e.proxy),e,n)}function QT(t,e,n,s){const i=s.includes(".")?jT(n,s):()=>n[s];if(ls(t)){const r=e[t];Et(r)&&wm(i,r)}else if(Et(t))wm(i,t.bind(n));else if(cs(t))if(Rt(t))t.forEach(r=>QT(r,e,n,s));else{const r=Et(t.handler)?t.handler.bind(n):e[t.handler];Et(r)&&wm(i,r,t)}}function ZT(t){const e=t.type,{mixins:n,extends:s}=e,{mixins:i,optionsCache:r,config:{optionMergeStrategies:o}}=t.appContext,a=r.get(e);let l;return a?l=a:!i.length&&!n&&!s?l=e:(l={},i.length&&i.forEach(c=>zd(l,c,o,!0)),zd(l,e,o)),r.set(e,l),l}function zd(t,e,n,s=!1){const{mixins:i,extends:r}=e;r&&zd(t,r,n,!0),i&&i.forEach(o=>zd(t,o,n,!0));for(const o in e)if(!(s&&o==="expose")){const a=bB[o]||n&&n[o];t[o]=a?a(t[o],e[o]):e[o]}return t}const bB={data:Ub,props:go,emits:go,methods:go,computed:go,beforeCreate:es,created:es,beforeMount:es,mounted:es,beforeUpdate:es,updated:es,beforeDestroy:es,beforeUnmount:es,destroyed:es,unmounted:es,activated:es,deactivated:es,errorCaptured:es,serverPrefetch:es,components:go,directives:go,watch:EB,provide:Ub,inject:wB};function Ub(t,e){return e?t?function(){return qs(Et(t)?t.call(this,this):t,Et(e)?e.call(this,this):e)}:e:t}function wB(t,e){return go(dp(t),dp(e))}function dp(t){if(Rt(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function es(t,e){return t?[...new Set([].concat(t,e))]:e}function go(t,e){return t?qs(qs(Object.create(null),t),e):e}function EB(t,e){if(!t)return e;if(!e)return t;const n=qs(Object.create(null),t);for(const s in e)n[s]=es(t[s],e[s]);return n}function xB(t,e,n,s=!1){const i={},r={};ap(r,p0,1),t.propsDefaults=Object.create(null),JT(t,e,i,r);for(const o in t.propsOptions[0])o in i||(i[o]=void 0);n?t.props=s?i:AD(i):t.type.props?t.props=i:t.props=r,t.attrs=r}function TB(t,e,n,s){const{props:i,attrs:r,vnode:{patchFlag:o}}=t,a=Ft(i),[l]=t.propsOptions;let c=!1;if((s||o>0)&&!(o&16)){if(o&8){const d=t.vnode.dynamicProps;for(let u=0;u<d.length;u++){let f=d[u];if(h0(t.emitsOptions,f))continue;const m=e[f];if(l)if(Dt(r,f))m!==r[f]&&(r[f]=m,c=!0);else{const h=Fi(f);i[h]=fp(l,a,h,m,t,!1)}else m!==r[f]&&(r[f]=m,c=!0)}}}else{JT(t,e,i,r)&&(c=!0);let d;for(const u in a)(!e||!Dt(e,u)&&((d=l0(u))===u||!Dt(e,d)))&&(l?n&&(n[u]!==void 0||n[d]!==void 0)&&(i[u]=fp(l,a,u,void 0,t,!0)):delete i[u]);if(r!==a)for(const u in r)(!e||!Dt(e,u)&&!0)&&(delete r[u],c=!0)}c&&or(t,"set","$attrs")}function JT(t,e,n,s){const[i,r]=t.propsOptions;let o=!1,a;if(e)for(let l in e){if(Gh(l))continue;const c=e[l];let d;i&&Dt(i,d=Fi(l))?!r||!r.includes(d)?n[d]=c:(a||(a={}))[d]=c:h0(t.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,o=!0)}if(r){const l=Ft(n),c=a||Xt;for(let d=0;d<r.length;d++){const u=r[d];n[u]=fp(i,l,u,c[u],t,!Dt(c,u))}}return o}function fp(t,e,n,s,i,r){const o=t[n];if(o!=null){const a=Dt(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&Et(l)){const{propsDefaults:c}=i;n in c?s=c[n]:(ul(i),s=c[n]=l.call(null,e),jo())}else s=l}o[0]&&(r&&!a?s=!1:o[1]&&(s===""||s===l0(n))&&(s=!0))}return s}function e6(t,e,n=!1){const s=e.propsCache,i=s.get(t);if(i)return i;const r=t.props,o={},a=[];let l=!1;if(!Et(t)){const d=u=>{l=!0;const[f,m]=e6(u,e,!0);qs(o,f),m&&a.push(...m)};!n&&e.mixins.length&&e.mixins.forEach(d),t.extends&&d(t.extends),t.mixins&&t.mixins.forEach(d)}if(!r&&!l)return s.set(t,Va),Va;if(Rt(r))for(let d=0;d<r.length;d++){const u=Fi(r[d]);jb(u)&&(o[u]=Xt)}else if(r)for(const d in r){const u=Fi(d);if(jb(u)){const f=r[d],m=o[u]=Rt(f)||Et(f)?{type:f}:f;if(m){const h=qb(Boolean,m.type),k=qb(String,m.type);m[0]=h>-1,m[1]=k<0||h<k,(h>-1||Dt(m,"default"))&&a.push(u)}}}const c=[o,a];return s.set(t,c),c}function jb(t){return t[0]!=="$"}function Hb(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function Vb(t,e){return Hb(t)===Hb(e)}function qb(t,e){return Rt(e)?e.findIndex(n=>Vb(n,t)):Et(e)&&Vb(e,t)?0:-1}const t6=t=>t[0]==="_"||t==="$stable",bv=t=>Rt(t)?t.map(Ri):[Ri(t)],SB=(t,e,n)=>{if(e._n)return e;const s=Je((...i)=>bv(e(...i)),n);return s._c=!1,s},n6=(t,e,n)=>{const s=t._ctx;for(const i in t){if(t6(i))continue;const r=t[i];if(Et(r))e[i]=SB(i,r,s);else if(r!=null){const o=bv(r);e[i]=()=>o}}},s6=(t,e)=>{const n=bv(e);t.slots.default=()=>n},AB=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=Ft(e),ap(e,"_",n)):n6(e,t.slots={})}else t.slots={},e&&s6(t,e);ap(t.slots,p0,1)},RB=(t,e,n)=>{const{vnode:s,slots:i}=t;let r=!0,o=Xt;if(s.shapeFlag&32){const a=e._;a?n&&a===1?r=!1:(qs(i,e),!n&&a===1&&delete i._):(r=!e.$stable,n6(e,i)),o=e}else e&&(s6(t,e),o={default:1});if(r)for(const a in i)!t6(a)&&!(a in o)&&delete i[a]};function i6(){return{app:null,config:{isNativeTag:BD,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let CB=0;function IB(t,e){return function(s,i=null){Et(s)||(s=Object.assign({},s)),i!=null&&!cs(i)&&(i=null);const r=i6(),o=new Set;let a=!1;const l=r.app={_uid:CB++,_component:s,_props:i,_container:null,_context:r,_instance:null,version:GB,get config(){return r.config},set config(c){},use(c,...d){return o.has(c)||(c&&Et(c.install)?(o.add(c),c.install(l,...d)):Et(c)&&(o.add(c),c(l,...d))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,d){return d?(r.components[c]=d,l):r.components[c]},directive(c,d){return d?(r.directives[c]=d,l):r.directives[c]},mount(c,d,u){if(!a){const f=Ue(s,i);return f.appContext=r,d&&e?e(f,c):t(f,c,u),a=!0,l._container=c,c.__vue_app__=l,g0(f.component)||f.component.proxy}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,d){return r.provides[c]=d,l}};return l}}function mp(t,e,n,s,i=!1){if(Rt(t)){t.forEach((f,m)=>mp(f,e&&(Rt(e)?e[m]:e),n,s,i));return}if(Ec(s)&&!i)return;const r=s.shapeFlag&4?g0(s.component)||s.component.proxy:s.el,o=i?null:r,{i:a,r:l}=t,c=e&&e.r,d=a.refs===Xt?a.refs={}:a.refs,u=a.setupState;if(c!=null&&c!==l&&(ls(c)?(d[c]=null,Dt(u,c)&&(u[c]=null)):os(c)&&(c.value=null)),Et(l))Pr(l,a,12,[o,d]);else{const f=ls(l),m=os(l);if(f||m){const h=()=>{if(t.f){const k=f?d[l]:l.value;i?Rt(k)&&fv(k,r):Rt(k)?k.includes(r)||k.push(r):f?(d[l]=[r],Dt(u,l)&&(u[l]=d[l])):(l.value=[r],t.k&&(d[t.k]=l.value))}else f?(d[l]=o,Dt(u,l)&&(u[l]=o)):m&&(l.value=o,t.k&&(d[t.k]=o))};o?(h.id=-1,gs(h,n)):h()}}}const gs=tB;function kB(t){return MB(t)}function MB(t,e){const n=qD();n.__VUE__=!0;const{insert:s,remove:i,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:u,nextSibling:f,setScopeId:m=Pi,cloneNode:h,insertStaticContent:k}=t,I=(E,N,V,$=null,G=null,te=null,le=!1,Q=null,se=!!N.dynamicChildren)=>{if(E===N)return;E&&!wo(E,N)&&($=ze(E),ne(E,G,te,!0),E=null),N.patchFlag===-2&&(se=!1,N.dynamicChildren=null);const{type:X,ref:ve,shapeFlag:de}=N;switch(X){case wv:L(E,N,V,$);break;case ni:p(E,N,V,$);break;case xm:E==null&&C(N,V,$,le);break;case kt:y(E,N,V,$,G,te,le,Q,se);break;default:de&1?F(E,N,V,$,G,te,le,Q,se):de&6?A(E,N,V,$,G,te,le,Q,se):(de&64||de&128)&&X.process(E,N,V,$,G,te,le,Q,se,we)}ve!=null&&G&&mp(ve,E&&E.ref,te,N||E,!N)},L=(E,N,V,$)=>{if(E==null)s(N.el=a(N.children),V,$);else{const G=N.el=E.el;N.children!==E.children&&c(G,N.children)}},p=(E,N,V,$)=>{E==null?s(N.el=l(N.children||""),V,$):N.el=E.el},C=(E,N,V,$)=>{[E.el,E.anchor]=k(E.children,N,V,$,E.el,E.anchor)},P=({el:E,anchor:N},V,$)=>{let G;for(;E&&E!==N;)G=f(E),s(E,V,$),E=G;s(N,V,$)},M=({el:E,anchor:N})=>{let V;for(;E&&E!==N;)V=f(E),i(E),E=V;i(N)},F=(E,N,V,$,G,te,le,Q,se)=>{le=le||N.type==="svg",E==null?_(N,V,$,G,te,le,Q,se):v(E,N,G,te,le,Q,se)},_=(E,N,V,$,G,te,le,Q)=>{let se,X;const{type:ve,props:de,shapeFlag:ye,transition:Re,patchFlag:Le,dirs:ce}=E;if(E.el&&h!==void 0&&Le===-1)se=E.el=h(E.el);else{if(se=E.el=o(E.type,te,de&&de.is,de),ye&8?d(se,E.children):ye&16&&x(E.children,se,null,$,G,te&&ve!=="foreignObject",le,Q),ce&&no(E,null,$,"created"),de){for(const ie in de)ie!=="value"&&!Gh(ie)&&r(se,ie,null,de[ie],te,E.children,$,G,be);"value"in de&&r(se,"value",null,de.value),(X=de.onVnodeBeforeMount)&&bi(X,$,E)}S(se,E,E.scopeId,le,$)}ce&&no(E,null,$,"beforeMount");const _e=(!G||G&&!G.pendingBranch)&&Re&&!Re.persisted;_e&&Re.beforeEnter(se),s(se,N,V),((X=de&&de.onVnodeMounted)||_e||ce)&&gs(()=>{X&&bi(X,$,E),_e&&Re.enter(se),ce&&no(E,null,$,"mounted")},G)},S=(E,N,V,$,G)=>{if(V&&m(E,V),$)for(let te=0;te<$.length;te++)m(E,$[te]);if(G){let te=G.subTree;if(N===te){const le=G.vnode;S(E,le,le.scopeId,le.slotScopeIds,G.parent)}}},x=(E,N,V,$,G,te,le,Q,se=0)=>{for(let X=se;X<E.length;X++){const ve=E[X]=Q?Sr(E[X]):Ri(E[X]);I(null,ve,N,V,$,G,te,le,Q)}},v=(E,N,V,$,G,te,le)=>{const Q=N.el=E.el;let{patchFlag:se,dynamicChildren:X,dirs:ve}=N;se|=E.patchFlag&16;const de=E.props||Xt,ye=N.props||Xt;let Re;V&&so(V,!1),(Re=ye.onVnodeBeforeUpdate)&&bi(Re,V,N,E),ve&&no(N,E,V,"beforeUpdate"),V&&so(V,!0);const Le=G&&N.type!=="foreignObject";if(X?w(E.dynamicChildren,X,Q,V,$,Le,te):le||K(E,N,Q,null,V,$,Le,te,!1),se>0){if(se&16)b(Q,N,de,ye,V,$,G);else if(se&2&&de.class!==ye.class&&r(Q,"class",null,ye.class,G),se&4&&r(Q,"style",de.style,ye.style,G),se&8){const ce=N.dynamicProps;for(let _e=0;_e<ce.length;_e++){const ie=ce[_e],Ne=de[ie],O=ye[ie];(O!==Ne||ie==="value")&&r(Q,ie,Ne,O,G,E.children,V,$,be)}}se&1&&E.children!==N.children&&d(Q,N.children)}else!le&&X==null&&b(Q,N,de,ye,V,$,G);((Re=ye.onVnodeUpdated)||ve)&&gs(()=>{Re&&bi(Re,V,N,E),ve&&no(N,E,V,"updated")},$)},w=(E,N,V,$,G,te,le)=>{for(let Q=0;Q<N.length;Q++){const se=E[Q],X=N[Q],ve=se.el&&(se.type===kt||!wo(se,X)||se.shapeFlag&70)?u(se.el):V;I(se,X,ve,null,$,G,te,le,!0)}},b=(E,N,V,$,G,te,le)=>{if(V!==$){for(const Q in $){if(Gh(Q))continue;const se=$[Q],X=V[Q];se!==X&&Q!=="value"&&r(E,Q,X,se,le,N.children,G,te,be)}if(V!==Xt)for(const Q in V)!Gh(Q)&&!(Q in $)&&r(E,Q,V[Q],null,le,N.children,G,te,be);"value"in $&&r(E,"value",V.value,$.value)}},y=(E,N,V,$,G,te,le,Q,se)=>{const X=N.el=E?E.el:a(""),ve=N.anchor=E?E.anchor:a("");let{patchFlag:de,dynamicChildren:ye,slotScopeIds:Re}=N;Re&&(Q=Q?Q.concat(Re):Re),E==null?(s(X,V,$),s(ve,V,$),x(N.children,V,ve,G,te,le,Q,se)):de>0&&de&64&&ye&&E.dynamicChildren?(w(E.dynamicChildren,ye,V,G,te,le,Q),(N.key!=null||G&&N===G.subTree)&&r6(E,N,!0)):K(E,N,V,ve,G,te,le,Q,se)},A=(E,N,V,$,G,te,le,Q,se)=>{N.slotScopeIds=Q,E==null?N.shapeFlag&512?G.ctx.activate(N,V,$,le,se):T(N,V,$,G,te,le,se):U(E,N,se)},T=(E,N,V,$,G,te,le)=>{const Q=E.component=FB(E,$,G);if(d0(E)&&(Q.ctx.renderer=we),UB(Q),Q.asyncDep){if(G&&G.registerDep(Q,W),!E.el){const se=Q.subTree=Ue(ni);p(null,se,N,V)}return}W(Q,E,N,V,G,te,le)},U=(E,N,V)=>{const $=N.component=E.component;if(ZD(E,N,V))if($.asyncDep&&!$.asyncResolved){j($,N,V);return}else $.next=N,KD($.update),$.update();else N.el=E.el,$.vnode=N},W=(E,N,V,$,G,te,le)=>{const Q=()=>{if(E.isMounted){let{next:ve,bu:de,u:ye,parent:Re,vnode:Le}=E,ce=ve,_e;so(E,!1),ve?(ve.el=Le.el,j(E,ve,le)):ve=Le,de&&vm(de),(_e=ve.props&&ve.props.onVnodeBeforeUpdate)&&bi(_e,Re,ve,Le),so(E,!0);const ie=ym(E),Ne=E.subTree;E.subTree=ie,I(Ne,ie,u(Ne.el),ze(Ne),E,G,te),ve.el=ie.el,ce===null&&JD(E,ie.el),ye&&gs(ye,G),(_e=ve.props&&ve.props.onVnodeUpdated)&&gs(()=>bi(_e,Re,ve,Le),G)}else{let ve;const{el:de,props:ye}=N,{bm:Re,m:Le,parent:ce}=E,_e=Ec(N);if(so(E,!1),Re&&vm(Re),!_e&&(ve=ye&&ye.onVnodeBeforeMount)&&bi(ve,ce,N),so(E,!0),de&&mt){const ie=()=>{E.subTree=ym(E),mt(de,E.subTree,E,G,null)};_e?N.type.__asyncLoader().then(()=>!E.isUnmounted&&ie()):ie()}else{const ie=E.subTree=ym(E);I(null,ie,V,$,E,G,te),N.el=ie.el}if(Le&&gs(Le,G),!_e&&(ve=ye&&ye.onVnodeMounted)){const ie=N;gs(()=>bi(ve,ce,ie),G)}(N.shapeFlag&256||ce&&Ec(ce.vnode)&&ce.vnode.shapeFlag&256)&&E.a&&gs(E.a,G),E.isMounted=!0,N=V=$=null}},se=E.effect=new iv(Q,()=>NT(X),E.scope),X=E.update=()=>se.run();X.id=E.uid,so(E,!0),X()},j=(E,N,V)=>{N.component=E;const $=E.vnode.props;E.vnode=N,E.next=null,TB(E,N.props,$,V),RB(E,N.children,V),kl(),u0(void 0,E.update),Ml()},K=(E,N,V,$,G,te,le,Q,se=!1)=>{const X=E&&E.children,ve=E?E.shapeFlag:0,de=N.children,{patchFlag:ye,shapeFlag:Re}=N;if(ye>0){if(ye&128){R(X,de,V,$,G,te,le,Q,se);return}else if(ye&256){g(X,de,V,$,G,te,le,Q,se);return}}Re&8?(ve&16&&be(X,G,te),de!==X&&d(V,de)):ve&16?Re&16?R(X,de,V,$,G,te,le,Q,se):be(X,G,te,!0):(ve&8&&d(V,""),Re&16&&x(de,V,$,G,te,le,Q,se))},g=(E,N,V,$,G,te,le,Q,se)=>{E=E||Va,N=N||Va;const X=E.length,ve=N.length,de=Math.min(X,ve);let ye;for(ye=0;ye<de;ye++){const Re=N[ye]=se?Sr(N[ye]):Ri(N[ye]);I(E[ye],Re,V,null,G,te,le,Q,se)}X>ve?be(E,G,te,!0,!1,de):x(N,V,$,G,te,le,Q,se,de)},R=(E,N,V,$,G,te,le,Q,se)=>{let X=0;const ve=N.length;let de=E.length-1,ye=ve-1;for(;X<=de&&X<=ye;){const Re=E[X],Le=N[X]=se?Sr(N[X]):Ri(N[X]);if(wo(Re,Le))I(Re,Le,V,null,G,te,le,Q,se);else break;X++}for(;X<=de&&X<=ye;){const Re=E[de],Le=N[ye]=se?Sr(N[ye]):Ri(N[ye]);if(wo(Re,Le))I(Re,Le,V,null,G,te,le,Q,se);else break;de--,ye--}if(X>de){if(X<=ye){const Re=ye+1,Le=Re<ve?N[Re].el:$;for(;X<=ye;)I(null,N[X]=se?Sr(N[X]):Ri(N[X]),V,Le,G,te,le,Q,se),X++}}else if(X>ye)for(;X<=de;)ne(E[X],G,te,!0),X++;else{const Re=X,Le=X,ce=new Map;for(X=Le;X<=ye;X++){const Y=N[X]=se?Sr(N[X]):Ri(N[X]);Y.key!=null&&ce.set(Y.key,X)}let _e,ie=0;const Ne=ye-Le+1;let O=!1,B=0;const q=new Array(Ne);for(X=0;X<Ne;X++)q[X]=0;for(X=Re;X<=de;X++){const Y=E[X];if(ie>=Ne){ne(Y,G,te,!0);continue}let H;if(Y.key!=null)H=ce.get(Y.key);else for(_e=Le;_e<=ye;_e++)if(q[_e-Le]===0&&wo(Y,N[_e])){H=_e;break}H===void 0?ne(Y,G,te,!0):(q[H-Le]=X+1,H>=B?B=H:O=!0,I(Y,N[H],V,null,G,te,le,Q,se),ie++)}const z=O?NB(q):Va;for(_e=z.length-1,X=Ne-1;X>=0;X--){const Y=Le+X,H=N[Y],J=Y+1<ve?N[Y+1].el:$;q[X]===0?I(null,H,V,J,G,te,le,Q,se):O&&(_e<0||X!==z[_e]?ee(H,V,J,2):_e--)}}},ee=(E,N,V,$,G=null)=>{const{el:te,type:le,transition:Q,children:se,shapeFlag:X}=E;if(X&6){ee(E.component.subTree,N,V,$);return}if(X&128){E.suspense.move(N,V,$);return}if(X&64){le.move(E,N,V,we);return}if(le===kt){s(te,N,V);for(let de=0;de<se.length;de++)ee(se[de],N,V,$);s(E.anchor,N,V);return}if(le===xm){P(E,N,V);return}if($!==2&&X&1&&Q)if($===0)Q.beforeEnter(te),s(te,N,V),gs(()=>Q.enter(te),G);else{const{leave:de,delayLeave:ye,afterLeave:Re}=Q,Le=()=>s(te,N,V),ce=()=>{de(te,()=>{Le(),Re&&Re()})};ye?ye(te,Le,ce):ce()}else s(te,N,V)},ne=(E,N,V,$=!1,G=!1)=>{const{type:te,props:le,ref:Q,children:se,dynamicChildren:X,shapeFlag:ve,patchFlag:de,dirs:ye}=E;if(Q!=null&&mp(Q,null,V,E,!0),ve&256){N.ctx.deactivate(E);return}const Re=ve&1&&ye,Le=!Ec(E);let ce;if(Le&&(ce=le&&le.onVnodeBeforeUnmount)&&bi(ce,N,E),ve&6)Me(E.component,V,$);else{if(ve&128){E.suspense.unmount(V,$);return}Re&&no(E,null,N,"beforeUnmount"),ve&64?E.type.remove(E,N,V,G,we,$):X&&(te!==kt||de>0&&de&64)?be(X,N,V,!1,!0):(te===kt&&de&384||!G&&ve&16)&&be(se,N,V),$&&xe(E)}(Le&&(ce=le&&le.onVnodeUnmounted)||Re)&&gs(()=>{ce&&bi(ce,N,E),Re&&no(E,null,N,"unmounted")},V)},xe=E=>{const{type:N,el:V,anchor:$,transition:G}=E;if(N===kt){Ie(V,$);return}if(N===xm){M(E);return}const te=()=>{i(V),G&&!G.persisted&&G.afterLeave&&G.afterLeave()};if(E.shapeFlag&1&&G&&!G.persisted){const{leave:le,delayLeave:Q}=G,se=()=>le(V,te);Q?Q(E.el,te,se):se()}else te()},Ie=(E,N)=>{let V;for(;E!==N;)V=f(E),i(E),E=V;i(N)},Me=(E,N,V)=>{const{bum:$,scope:G,update:te,subTree:le,um:Q}=E;$&&vm($),G.stop(),te&&(te.active=!1,ne(le,E,N,V)),Q&&gs(Q,N),gs(()=>{E.isUnmounted=!0},N),N&&N.pendingBranch&&!N.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===N.pendingId&&(N.deps--,N.deps===0&&N.resolve())},be=(E,N,V,$=!1,G=!1,te=0)=>{for(let le=te;le<E.length;le++)ne(E[le],N,V,$,G)},ze=E=>E.shapeFlag&6?ze(E.component.subTree):E.shapeFlag&128?E.suspense.next():f(E.anchor||E.el),De=(E,N,V)=>{E==null?N._vnode&&ne(N._vnode,null,null,!0):I(N._vnode||null,E,N,null,null,null,V),PT(),N._vnode=E},we={p:I,um:ne,m:ee,r:xe,mt:T,mc:x,pc:K,pbc:w,n:ze,o:t};let Xe,mt;return e&&([Xe,mt]=e(we)),{render:De,hydrate:Xe,createApp:IB(De,Xe)}}function so({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function r6(t,e,n=!1){const s=t.children,i=e.children;if(Rt(s)&&Rt(i))for(let r=0;r<s.length;r++){const o=s[r];let a=i[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[r]=Sr(i[r]),a.el=o.el),n||r6(o,a))}}function NB(t){const e=t.slice(),n=[0];let s,i,r,o,a;const l=t.length;for(s=0;s<l;s++){const c=t[s];if(c!==0){if(i=n[n.length-1],t[i]<c){e[s]=i,n.push(s);continue}for(r=0,o=n.length-1;r<o;)a=r+o>>1,t[n[a]]<c?r=a+1:o=a;c<t[n[r]]&&(r>0&&(e[s]=n[r-1]),n[r]=s)}}for(r=n.length,o=n[r-1];r-- >0;)n[r]=o,o=e[o];return n}const OB=t=>t.__isTeleport,kt=Symbol(void 0),wv=Symbol(void 0),ni=Symbol(void 0),xm=Symbol(void 0),xc=[];let fi=null;function re(t=!1){xc.push(fi=t?null:[])}function LB(){xc.pop(),fi=xc[xc.length-1]||null}let nu=1;function $b(t){nu+=t}function o6(t){return t.dynamicChildren=nu>0?fi||Va:null,LB(),nu>0&&fi&&fi.push(t),t}function ge(t,e,n,s,i,r){return o6(Ce(t,e,n,s,i,r,!0))}function Ut(t,e,n,s,i){return o6(Ue(t,e,n,s,i,!0))}function Kd(t){return t?t.__v_isVNode===!0:!1}function wo(t,e){return t.type===e.type&&t.key===e.key}const p0="__vInternal",a6=({key:t})=>t!=null?t:null,Wh=({ref:t,ref_key:e,ref_for:n})=>t!=null?ls(t)||os(t)||Et(t)?{i:$n,r:t,k:e,f:!!n}:t:null;function Ce(t,e=null,n=null,s=0,i=null,r=t===kt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&a6(e),ref:e&&Wh(e),scopeId:FT,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:i,dynamicChildren:null,appContext:null};return a?(Ev(l,n),r&128&&t.normalize(l)):n&&(l.shapeFlag|=ls(n)?8:16),nu>0&&!o&&fi&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&fi.push(l),l}const Ue=PB;function PB(t,e=null,n=null,s=0,i=null,r=!1){if((!t||t===YT)&&(t=ni),Kd(t)){const a=Kr(t,e,!0);return n&&Ev(a,n),nu>0&&!r&&fi&&(a.shapeFlag&6?fi[fi.indexOf(t)]=a:fi.push(a)),a.patchFlag|=-2,a}if($B(t)&&(t=t.__vccOpts),e){e=ft(e);let{class:a,style:l}=e;a&&!ls(a)&&(e.class=yt(a)),cs(l)&&(bT(l)&&!Rt(l)&&(l=qs({},l)),e.style=Lt(l))}const o=ls(t)?1:eB(t)?128:OB(t)?64:cs(t)?4:Et(t)?2:0;return Ce(t,e,n,s,i,o,r,!0)}function ft(t){return t?bT(t)||p0 in t?qs({},t):t:null}function Kr(t,e,n=!1){const{props:s,ref:i,patchFlag:r,children:o}=t,a=e?xv(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&a6(a),ref:e&&e.ref?n&&i?Rt(i)?i.concat(Wh(e)):[i,Wh(e)]:Wh(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:o,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==kt?r===-1?16:r|16:r,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Kr(t.ssContent),ssFallback:t.ssFallback&&Kr(t.ssFallback),el:t.el,anchor:t.anchor}}function ma(t=" ",e=0){return Ue(wv,null,t,e)}function He(t="",e=!1){return e?(re(),Ut(ni,null,t)):Ue(ni,null,t)}function Ri(t){return t==null||typeof t=="boolean"?Ue(ni):Rt(t)?Ue(kt,null,t.slice()):typeof t=="object"?Sr(t):Ue(wv,null,String(t))}function Sr(t){return t.el===null||t.memo?t:Kr(t)}function Ev(t,e){let n=0;const{shapeFlag:s}=t;if(e==null)e=null;else if(Rt(e))n=16;else if(typeof e=="object")if(s&65){const i=e.default;i&&(i._c&&(i._d=!1),Ev(t,i()),i._c&&(i._d=!0));return}else{n=32;const i=e._;!i&&!(p0 in e)?e._ctx=$n:i===3&&$n&&($n.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Et(e)?(e={default:e,_ctx:$n},n=32):(e=String(e),s&64?(n=16,e=[ma(e)]):n=8);t.children=e,t.shapeFlag|=n}function xv(...t){const e={};for(let n=0;n<t.length;n++){const s=t[n];for(const i in s)if(i==="class")e.class!==s.class&&(e.class=yt([e.class,s.class]));else if(i==="style")e.style=Lt([e.style,s.style]);else if(dv(i)){const r=e[i],o=s[i];o&&r!==o&&!(Rt(r)&&r.includes(o))&&(e[i]=r?[].concat(r,o):o)}else i!==""&&(e[i]=s[i])}return e}function bi(t,e,n,s=null){ti(t,e,7,[n,s])}const DB=i6();let BB=0;function FB(t,e,n){const s=t.type,i=(e?e.appContext:t.appContext)||DB,r={uid:BB++,vnode:t,type:s,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new JP(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:e6(s,i),emitsOptions:BT(s,i),emit:null,emitted:null,propsDefaults:Xt,inheritAttrs:s.inheritAttrs,ctx:Xt,data:Xt,props:Xt,attrs:Xt,slots:Xt,refs:Xt,setupState:Xt,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=YD.bind(null,r),t.ce&&t.ce(r),r}let Mn=null;const l6=()=>Mn||$n,ul=t=>{Mn=t,t.scope.on()},jo=()=>{Mn&&Mn.scope.off(),Mn=null};function c6(t){return t.vnode.shapeFlag&4}let su=!1;function UB(t,e=!1){su=e;const{props:n,children:s}=t.vnode,i=c6(t);xB(t,n,i,e),AB(t,s);const r=i?jB(t,e):void 0;return su=!1,r}function jB(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=wT(new Proxy(t.ctx,_B));const{setup:s}=n;if(s){const i=t.setupContext=s.length>1?VB(t):null;ul(t),kl();const r=Pr(s,t,0,[t.props,i]);if(Ml(),jo(),RT(r)){if(r.then(jo,jo),e)return r.then(o=>{zb(t,o,e)}).catch(o=>{c0(o,t,0)});t.asyncDep=r}else zb(t,r,e)}else u6(t,e)}function zb(t,e,n){Et(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:cs(e)&&(t.setupState=ET(e)),u6(t,n)}let Kb;function u6(t,e,n){const s=t.type;if(!t.render){if(!e&&Kb&&!s.render){const i=s.template;if(i){const{isCustomElement:r,compilerOptions:o}=t.appContext.config,{delimiters:a,compilerOptions:l}=s,c=qs(qs({isCustomElement:r,delimiters:a},o),l);s.render=Kb(i,c)}}t.render=s.render||Pi}ul(t),kl(),vB(t),Ml(),jo()}function HB(t){return new Proxy(t.attrs,{get(e,n){return Vs(t,"get","$attrs"),e[n]}})}function VB(t){const e=s=>{t.exposed=s||{}};let n;return{get attrs(){return n||(n=HB(t))},slots:t.slots,emit:t.emit,expose:e}}function g0(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(ET(wT(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in $d)return $d[n](t)}}))}function qB(t,e=!0){return Et(t)?t.displayName||t.name:t.name||e&&t.__name}function $B(t){return Et(t)&&"__vccOpts"in t}const zB=(t,e)=>ND(t,e,su);function KB(t,e,n){const s=arguments.length;return s===2?cs(e)&&!Rt(e)?Kd(e)?Ue(t,null,[e]):Ue(t,e):Ue(t,null,e):(s>3?n=Array.prototype.slice.call(arguments,2):s===3&&Kd(n)&&(n=[n]),Ue(t,e,n))}const GB="3.2.37";function WB(t,e){const n=Object.create(null),s=t.split(",");for(let i=0;i<s.length;i++)n[s[i]]=!0;return e?i=>!!n[i.toLowerCase()]:i=>!!n[i]}const YB="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",XB=WB(YB);function h6(t){return!!t||t===""}const QB=/^on[^a-z]/,ZB=t=>QB.test(t),JB=t=>t.startsWith("onUpdate:"),ju=Object.assign,Hu=Array.isArray,eF=t=>typeof t=="function",pp=t=>typeof t=="string",tF=t=>t!==null&&typeof t=="object",Tv=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},nF=/-(\w)/g,Gb=Tv(t=>t.replace(nF,(e,n)=>n?n.toUpperCase():"")),sF=/\B([A-Z])/g,qa=Tv(t=>t.replace(sF,"-$1").toLowerCase()),iF=Tv(t=>t.charAt(0).toUpperCase()+t.slice(1)),gp=t=>{const e=parseFloat(t);return isNaN(e)?t:e},rF="http://www.w3.org/2000/svg",Eo=typeof document!="undefined"?document:null,Wb=Eo&&Eo.createElement("template"),oF={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,s)=>{const i=e?Eo.createElementNS(rF,t):Eo.createElement(t,n?{is:n}:void 0);return t==="select"&&s&&s.multiple!=null&&i.setAttribute("multiple",s.multiple),i},createText:t=>Eo.createTextNode(t),createComment:t=>Eo.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Eo.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},cloneNode(t){const e=t.cloneNode(!0);return"_value"in t&&(e._value=t._value),e},insertStaticContent(t,e,n,s,i,r){const o=n?n.previousSibling:e.lastChild;if(i&&(i===r||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),n),!(i===r||!(i=i.nextSibling)););else{Wb.innerHTML=s?`<svg>${t}</svg>`:t;const a=Wb.content;if(s){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function aF(t,e,n){const s=t._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function lF(t,e,n){const s=t.style,i=pp(n);if(n&&!i){for(const r in n)_p(s,r,n[r]);if(e&&!pp(e))for(const r in e)n[r]==null&&_p(s,r,"")}else{const r=s.display;i?e!==n&&(s.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(s.display=r)}}const Yb=/\s*!important$/;function _p(t,e,n){if(Hu(n))n.forEach(s=>_p(t,e,s));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const s=cF(t,e);Yb.test(n)?t.setProperty(qa(s),n.replace(Yb,""),"important"):t[s]=n}}const Xb=["Webkit","Moz","ms"],Tm={};function cF(t,e){const n=Tm[e];if(n)return n;let s=Fi(e);if(s!=="filter"&&s in t)return Tm[e]=s;s=iF(s);for(let i=0;i<Xb.length;i++){const r=Xb[i]+s;if(r in t)return Tm[e]=r}return e}const Qb="http://www.w3.org/1999/xlink";function uF(t,e,n,s,i){if(s&&e.startsWith("xlink:"))n==null?t.removeAttributeNS(Qb,e.slice(6,e.length)):t.setAttributeNS(Qb,e,n);else{const r=XB(e);n==null||r&&!h6(n)?t.removeAttribute(e):t.setAttribute(e,r?"":n)}}function hF(t,e,n,s,i,r,o){if(e==="innerHTML"||e==="textContent"){s&&o(s,i,r),t[e]=n==null?"":n;return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=n;const l=n==null?"":n;(t.value!==l||t.tagName==="OPTION")&&(t.value=l),n==null&&t.removeAttribute(e);return}let a=!1;if(n===""||n==null){const l=typeof t[e];l==="boolean"?n=h6(n):n==null&&l==="string"?(n="",a=!0):l==="number"&&(n=0,a=!0)}try{t[e]=n}catch{}a&&t.removeAttribute(e)}const[d6,dF]=(()=>{let t=Date.now,e=!1;if(typeof window!="undefined"){Date.now()>document.createEvent("Event").timeStamp&&(t=performance.now.bind(performance));const n=navigator.userAgent.match(/firefox\/(\d+)/i);e=!!(n&&Number(n[1])<=53)}return[t,e]})();let vp=0;const fF=Promise.resolve(),mF=()=>{vp=0},pF=()=>vp||(fF.then(mF),vp=d6());function gF(t,e,n,s){t.addEventListener(e,n,s)}function _F(t,e,n,s){t.removeEventListener(e,n,s)}function vF(t,e,n,s,i=null){const r=t._vei||(t._vei={}),o=r[e];if(s&&o)o.value=s;else{const[a,l]=yF(e);if(s){const c=r[e]=bF(s,i);gF(t,a,c,l)}else o&&(_F(t,a,o,l),r[e]=void 0)}}const Zb=/(?:Once|Passive|Capture)$/;function yF(t){let e;if(Zb.test(t)){e={};let n;for(;n=t.match(Zb);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[qa(t.slice(2)),e]}function bF(t,e){const n=s=>{const i=s.timeStamp||d6();(dF||i>=n.attached-1)&&ti(wF(s,n.value),e,5,[s])};return n.value=t,n.attached=pF(),n}function wF(t,e){if(Hu(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(s=>i=>!i._stopped&&s&&s(i))}else return e}const Jb=/^on[a-z]/,EF=(t,e,n,s,i=!1,r,o,a,l)=>{e==="class"?aF(t,s,i):e==="style"?lF(t,n,s):ZB(e)?JB(e)||vF(t,e,n,s,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):xF(t,e,s,i))?hF(t,e,s,r,o,a,l):(e==="true-value"?t._trueValue=s:e==="false-value"&&(t._falseValue=s),uF(t,e,s,i))};function xF(t,e,n,s){return s?!!(e==="innerHTML"||e==="textContent"||e in t&&Jb.test(e)&&eF(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||Jb.test(e)&&pp(n)?!1:e in t}function TF(t,e){const n=rB(t);class s extends Sv{constructor(r){super(n,r,e)}}return s.def=n,s}const SF=typeof HTMLElement!="undefined"?HTMLElement:class{};class Sv extends SF{constructor(e,n={},s){super(),this._def=e,this._props=n,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this.shadowRoot&&s?s(this._createVNode(),this.shadowRoot):this.attachShadow({mode:"open"})}connectedCallback(){this._connected=!0,this._instance||this._resolveDef()}disconnectedCallback(){this._connected=!1,MT(()=>{this._connected||(o3(null,this.shadowRoot),this._instance=null)})}_resolveDef(){if(this._resolved)return;this._resolved=!0;for(let s=0;s<this.attributes.length;s++)this._setAttr(this.attributes[s].name);new MutationObserver(s=>{for(const i of s)this._setAttr(i.attributeName)}).observe(this,{attributes:!0});const e=s=>{const{props:i,styles:r}=s,o=!Hu(i),a=i?o?Object.keys(i):i:[];let l;if(o)for(const c in this._props){const d=i[c];(d===Number||d&&d.type===Number)&&(this._props[c]=gp(this._props[c]),(l||(l=Object.create(null)))[c]=!0)}this._numberProps=l;for(const c of Object.keys(this))c[0]!=="_"&&this._setProp(c,this[c],!0,!1);for(const c of a.map(Gb))Object.defineProperty(this,c,{get(){return this._getProp(c)},set(d){this._setProp(c,d)}});this._applyStyles(r),this._update()},n=this._def.__asyncLoader;n?n().then(e):e(this._def)}_setAttr(e){let n=this.getAttribute(e);this._numberProps&&this._numberProps[e]&&(n=gp(n)),this._setProp(Gb(e),n,!1)}_getProp(e){return this._props[e]}_setProp(e,n,s=!0,i=!0){n!==this._props[e]&&(this._props[e]=n,i&&this._instance&&this._update(),s&&(n===!0?this.setAttribute(qa(e),""):typeof n=="string"||typeof n=="number"?this.setAttribute(qa(e),n+""):n||this.removeAttribute(qa(e))))}_update(){o3(this._createVNode(),this.shadowRoot)}_createVNode(){const e=Ue(this._def,ju({},this._props));return this._instance||(e.ce=n=>{this._instance=n,n.isCE=!0,n.emit=(i,...r)=>{this.dispatchEvent(new CustomEvent(i,{detail:r}))};let s=this;for(;s=s&&(s.parentNode||s.host);)if(s instanceof Sv){n.parent=s._instance;break}}),e}_applyStyles(e){e&&e.forEach(n=>{const s=document.createElement("style");s.textContent=n,this.shadowRoot.appendChild(s)})}}const pr="transition",$l="animation",gn=(t,{slots:e})=>KB(VT,m6(t),e);gn.displayName="Transition";const f6={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},AF=gn.props=ju({},VT.props,f6),io=(t,e=[])=>{Hu(t)?t.forEach(n=>n(...e)):t&&t(...e)},e3=t=>t?Hu(t)?t.some(e=>e.length>1):t.length>1:!1;function m6(t){const e={};for(const b in t)b in f6||(e[b]=t[b]);if(t.css===!1)return e;const{name:n="v",type:s,duration:i,enterFromClass:r=`${n}-enter-from`,enterActiveClass:o=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:l=r,appearActiveClass:c=o,appearToClass:d=a,leaveFromClass:u=`${n}-leave-from`,leaveActiveClass:f=`${n}-leave-active`,leaveToClass:m=`${n}-leave-to`}=t,h=RF(i),k=h&&h[0],I=h&&h[1],{onBeforeEnter:L,onEnter:p,onEnterCancelled:C,onLeave:P,onLeaveCancelled:M,onBeforeAppear:F=L,onAppear:_=p,onAppearCancelled:S=C}=e,x=(b,y,A)=>{xr(b,y?d:a),xr(b,y?c:o),A&&A()},v=(b,y)=>{b._isLeaving=!1,xr(b,u),xr(b,m),xr(b,f),y&&y()},w=b=>(y,A)=>{const T=b?_:p,U=()=>x(y,b,A);io(T,[y,U]),t3(()=>{xr(y,b?l:r),Hi(y,b?d:a),e3(T)||n3(y,s,k,U)})};return ju(e,{onBeforeEnter(b){io(L,[b]),Hi(b,r),Hi(b,o)},onBeforeAppear(b){io(F,[b]),Hi(b,l),Hi(b,c)},onEnter:w(!1),onAppear:w(!0),onLeave(b,y){b._isLeaving=!0;const A=()=>v(b,y);Hi(b,u),g6(),Hi(b,f),t3(()=>{!b._isLeaving||(xr(b,u),Hi(b,m),e3(P)||n3(b,s,I,A))}),io(P,[b,A])},onEnterCancelled(b){x(b,!1),io(C,[b])},onAppearCancelled(b){x(b,!0),io(S,[b])},onLeaveCancelled(b){v(b),io(M,[b])}})}function RF(t){if(t==null)return null;if(tF(t))return[Sm(t.enter),Sm(t.leave)];{const e=Sm(t);return[e,e]}}function Sm(t){return gp(t)}function Hi(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.add(n)),(t._vtc||(t._vtc=new Set)).add(e)}function xr(t,e){e.split(/\s+/).forEach(s=>s&&t.classList.remove(s));const{_vtc:n}=t;n&&(n.delete(e),n.size||(t._vtc=void 0))}function t3(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let CF=0;function n3(t,e,n,s){const i=t._endId=++CF,r=()=>{i===t._endId&&s()};if(n)return setTimeout(r,n);const{type:o,timeout:a,propCount:l}=p6(t,e);if(!o)return s();const c=o+"end";let d=0;const u=()=>{t.removeEventListener(c,f),r()},f=m=>{m.target===t&&++d>=l&&u()};setTimeout(()=>{d<l&&u()},a+1),t.addEventListener(c,f)}function p6(t,e){const n=window.getComputedStyle(t),s=h=>(n[h]||"").split(", "),i=s(pr+"Delay"),r=s(pr+"Duration"),o=s3(i,r),a=s($l+"Delay"),l=s($l+"Duration"),c=s3(a,l);let d=null,u=0,f=0;e===pr?o>0&&(d=pr,u=o,f=r.length):e===$l?c>0&&(d=$l,u=c,f=l.length):(u=Math.max(o,c),d=u>0?o>c?pr:$l:null,f=d?d===pr?r.length:l.length:0);const m=d===pr&&/\b(transform|all)(,|$)/.test(n[pr+"Property"]);return{type:d,timeout:u,propCount:f,hasTransform:m}}function s3(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((n,s)=>i3(n)+i3(t[s])))}function i3(t){return Number(t.slice(0,-1).replace(",","."))*1e3}function g6(){return document.body.offsetHeight}const _6=new WeakMap,v6=new WeakMap,IF={name:"TransitionGroup",props:ju({},AF,{tag:String,moveClass:String}),setup(t,{slots:e}){const n=l6(),s=HT();let i,r;return KT(()=>{if(!i.length)return;const o=t.moveClass||`${t.name||"v"}-move`;if(!OF(i[0].el,n.vnode.el,o))return;i.forEach(kF),i.forEach(MF);const a=i.filter(NF);g6(),a.forEach(l=>{const c=l.el,d=c.style;Hi(c,o),d.transform=d.webkitTransform=d.transitionDuration="";const u=c._moveCb=f=>{f&&f.target!==c||(!f||/transform$/.test(f.propertyName))&&(c.removeEventListener("transitionend",u),c._moveCb=null,xr(c,o))};c.addEventListener("transitionend",u)})}),()=>{const o=Ft(t),a=m6(o);let l=o.tag||kt;i=r,r=e.default?_v(e.default()):[];for(let c=0;c<r.length;c++){const d=r[c];d.key!=null&&tu(d,eu(d,a,s,n))}if(i)for(let c=0;c<i.length;c++){const d=i[c];tu(d,eu(d,a,s,n)),_6.set(d,d.el.getBoundingClientRect())}return Ue(l,null,r)}}},Av=IF;function kF(t){const e=t.el;e._moveCb&&e._moveCb(),e._enterCb&&e._enterCb()}function MF(t){v6.set(t,t.el.getBoundingClientRect())}function NF(t){const e=_6.get(t),n=v6.get(t),s=e.left-n.left,i=e.top-n.top;if(s||i){const r=t.el.style;return r.transform=r.webkitTransform=`translate(${s}px,${i}px)`,r.transitionDuration="0s",t}}function OF(t,e,n){const s=t.cloneNode();t._vtc&&t._vtc.forEach(o=>{o.split(/\s+/).forEach(a=>a&&s.classList.remove(a))}),n.split(/\s+/).forEach(o=>o&&s.classList.add(o)),s.style.display="none";const i=e.nodeType===1?e:e.parentNode;i.appendChild(s);const{hasTransform:r}=p6(s);return i.removeChild(s),r}const LF=["ctrl","shift","alt","meta"],PF={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>LF.some(n=>t[`${n}Key`]&&!e.includes(n))},Rr=(t,e)=>(n,...s)=>{for(let i=0;i<e.length;i++){const r=PF[e[i]];if(r&&r(n,e))return}return t(n,...s)},DF={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Vi=(t,e)=>n=>{if(!("key"in n))return;const s=qa(n.key);if(e.some(i=>i===s||DF[i]===s))return t(n)},_0={beforeMount(t,{value:e},{transition:n}){t._vod=t.style.display==="none"?"":t.style.display,n&&e?n.beforeEnter(t):zl(t,e)},mounted(t,{value:e},{transition:n}){n&&e&&n.enter(t)},updated(t,{value:e,oldValue:n},{transition:s}){!e!=!n&&(s?e?(s.beforeEnter(t),zl(t,!0),s.enter(t)):s.leave(t,()=>{zl(t,!1)}):zl(t,e))},beforeUnmount(t,{value:e}){zl(t,e)}};function zl(t,e){t.style.display=e?t._vod:"none"}const BF=ju({patchProp:EF},oF);let r3;function FF(){return r3||(r3=kB(BF))}const o3=(...t)=>{FF().render(...t)};var qt=(t,e)=>{const n=t.__vccOpts||t;for(const[s,i]of e)n[s]=i;return n};const UF={name:"AppLoader",props:{show:{type:Boolean,default:!1},infinite:{type:Boolean,default:!1}}},jF=Ce("div",{id:"vac-circle"},null,-1);function HF(t,e,n,s,i,r){return re(),Ut(gn,{name:"vac-fade-spinner",appear:""},{default:Je(()=>[n.show?(re(),ge("div",{key:0,class:yt(["vac-loader-wrapper",{"vac-container-center":!n.infinite,"vac-container-top":n.infinite}])},[je(t.$slots,"spinner-icon",pt(ft({show:n.show,infinite:n.infinite})),()=>[jF])],2)):He("",!0)]),_:3})}var v0=qt(UF,[["render",HF]]);const VF={name:"SvgIcon",props:{name:{type:String,default:null},param:{type:String,default:null}},data(){return{svgItem:{search:{path:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},add:{path:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"},toggle:{path:"M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z"},menu:{path:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"},close:{path:"M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"},file:{path:"M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"},paperclip:{path:"M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 11,1A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"},"close-outline":{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},send:{path:"M2,21L23,12L2,3V10L17,12L2,14V21Z"},emoji:{path:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"},document:{path:"M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z"},pencil:{path:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"},checkmark:{path:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"},"double-checkmark":{path:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"},eye:{path:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"},dropdown:{path:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"},deleted:{path:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,13.85 4.63,15.55 5.68,16.91L16.91,5.68C15.55,4.63 13.85,4 12,4M12,20A8,8 0 0,0 20,12C20,10.15 19.37,8.45 18.32,7.09L7.09,18.32C8.45,19.37 10.15,20 12,20Z"},microphone:{size:"large",path:"M432.8,216.4v39.2c0,45.2-15.3,84.3-45.2,118.4c-29.8,33.2-67.3,52.8-111.6,57.9v40.9h78.4c5.1,0,10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6c0,5.1-1.7,10.2-6,13.6c-4.3,4.3-8.5,6-13.6,6H157.6c-5.1,0-10.2-1.7-13.6-6c-4.3-4.3-6-8.5-6-13.6c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6H236v-40.9c-44.3-5.1-81.8-23.9-111.6-57.9s-45.2-73.3-45.2-118.4v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6s10.2,1.7,13.6,6c4.3,4.3,6,8.5,6,13.6v39.2c0,37.5,13.6,70.7,40,97.1s59.6,40,97.1,40s70.7-13.6,97.1-40c26.4-26.4,40-59.6,40-97.1v-39.2c0-5.1,1.7-10.2,6-13.6c4.3-4.3,8.5-6,13.6-6c5.1,0,10.2,1.7,13.6,6C430.2,206.2,432.8,211.3,432.8,216.4z M353.5,98v157.6c0,27.3-9.4,50.3-29,69c-19.6,19.6-42.6,29-69,29s-50.3-9.4-69-29c-19.6-19.6-29-42.6-29-69V98c0-27.3,9.4-50.3,29-69c19.6-19.6,42.6-29,69-29s50.3,9.4,69,29C344.2,47.7,353.5,71.6,353.5,98z"},"audio-play":{size:"medium",path:"M43.331,21.237L7.233,0.397c-0.917-0.529-2.044-0.529-2.96,0c-0.916,0.528-1.48,1.505-1.48,2.563v41.684   c0,1.058,0.564,2.035,1.48,2.563c0.458,0.268,0.969,0.397,1.48,0.397c0.511,0,1.022-0.133,1.48-0.397l36.098-20.84   c0.918-0.529,1.479-1.506,1.479-2.564S44.247,21.767,43.331,21.237z"},"audio-pause":{size:"medium",path:"M17.991,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C4.729,2.969,7.698,0,11.36,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z",path2:"M42.877,40.976c0,3.662-2.969,6.631-6.631,6.631l0,0c-3.662,0-6.631-2.969-6.631-6.631V6.631C29.616,2.969,32.585,0,36.246,0l0,0c3.662,0,6.631,2.969,6.631,6.631V40.976z"}}}},computed:{svgId(){const t=this.param?"-"+this.param:"";return`vac-icon-${this.name}${t}`},size(){const t=this.svgItem[this.name];return t.size==="large"?512:t.size==="medium"?48:24}}},qF=["viewBox"],$F=["id","d"],zF=["id","d"];function KF(t,e,n,s,i,r){return re(),ge("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"24",height:"24",viewBox:`0 0 ${r.size} ${r.size}`},[Ce("path",{id:r.svgId,d:i.svgItem[n.name].path},null,8,$F),i.svgItem[n.name].path2?(re(),ge("path",{key:0,id:r.svgId,d:i.svgItem[n.name].path2},null,8,zF)):He("",!0)],8,qF)}var Un=qt(VF,[["render",KF]]);const GF={name:"RoomsSearch",components:{SvgIcon:Un},props:{textMessages:{type:Object,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0}},emits:["search-room","add-room"],computed:{showSearchBar(){return this.showSearch||this.showAddRoom}}},WF={key:0,class:"vac-icon-search"},YF=["placeholder"];function XF(t,e,n,s,i,r){const o=et("svg-icon");return re(),ge("div",{class:yt({"vac-box-search":r.showSearchBar,"vac-box-empty":!r.showSearchBar})},[n.showSearch?(re(),ge(kt,{key:0},[!n.loadingRooms&&n.rooms.length?(re(),ge("div",WF,[je(t.$slots,"search-icon",{},()=>[Ue(o,{name:"search"})])])):He("",!0),!n.loadingRooms&&n.rooms.length?(re(),ge("input",{key:1,type:"search",placeholder:n.textMessages.SEARCH,autocomplete:"off",class:"vac-input",onInput:e[0]||(e[0]=a=>t.$emit("search-room",a))},null,40,YF)):He("",!0)],64)):He("",!0),n.showAddRoom?(re(),ge("div",{key:1,class:"vac-svg-button vac-add-icon",onClick:e[1]||(e[1]=a=>t.$emit("add-room"))},[je(t.$slots,"add-icon",{},()=>[Ue(o,{name:"add"})])])):He("",!0)],2)}var QF=qt(GF,[["render",XF]]),Hn={},Nl={};Nl.__esModule=!0;Nl.inherits=ZF;function ZF(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Object.create(t.prototype);for(var i in n)s[i]=n[i];return s.constructor=e,e.prototype=s,e}var Vu={};Vu.__esModule=!0;var JF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Is={defaultProtocol:"http",events:null,format:a3,formatHref:a3,nl2br:!1,tagName:"a",target:tU,validate:!0,ignoreTags:[],attributes:null,className:"linkified"};Vu.defaults=Is;Vu.Options=y6;Vu.contains=eU;function y6(t){t=t||{},this.defaultProtocol=t.hasOwnProperty("defaultProtocol")?t.defaultProtocol:Is.defaultProtocol,this.events=t.hasOwnProperty("events")?t.events:Is.events,this.format=t.hasOwnProperty("format")?t.format:Is.format,this.formatHref=t.hasOwnProperty("formatHref")?t.formatHref:Is.formatHref,this.nl2br=t.hasOwnProperty("nl2br")?t.nl2br:Is.nl2br,this.tagName=t.hasOwnProperty("tagName")?t.tagName:Is.tagName,this.target=t.hasOwnProperty("target")?t.target:Is.target,this.validate=t.hasOwnProperty("validate")?t.validate:Is.validate,this.ignoreTags=[],this.attributes=t.attributes||t.linkAttributes||Is.attributes,this.className=t.hasOwnProperty("className")?t.className:t.linkClass||Is.className;for(var e=t.hasOwnProperty("ignoreTags")?t.ignoreTags:Is.ignoreTags,n=0;n<e.length;n++)this.ignoreTags.push(e[n].toUpperCase())}y6.prototype={resolve:function(e){var n=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",n,e),tagName:this.get("tagName",n,e),className:this.get("className",n,e),target:this.get("target",n,e),events:this.getObject("events",n,e),attributes:this.getObject("attributes",n,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,n,s){var i=void 0,r=this[e];if(!r)return r;switch(typeof r=="undefined"?"undefined":JF(r)){case"function":return r(n,s.type);case"object":return i=r.hasOwnProperty(s.type)?r[s.type]:Is[e],typeof i=="function"?i(n,s.type):i}return r},getObject:function(e,n,s){var i=this[e];return typeof i=="function"?i(n,s.type):i}};function eU(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1}function a3(t){return t}function tU(t,e){return e==="url"?"_blank":null}var Mi={},tr={};tr.__esModule=!0;tr.stateify=tr.TokenState=tr.CharacterState=void 0;var b6=Nl;function Rv(){return function(t){this.j=[],this.T=t||null}}var Cv=Rv();Cv.prototype={defaultTransition:!1,on:function(e,n){if(e instanceof Array){for(var s=0;s<e.length;s++)this.j.push([e[s],n]);return this}return this.j.push([e,n]),this},next:function(e){for(var n=0;n<this.j.length;n++){var s=this.j[n],i=s[0],r=s[1];if(this.test(e,i))return r}return this.defaultTransition},accepts:function(){return!!this.T},test:function(e,n){return e===n},emit:function(){return this.T}};var yp=(0,b6.inherits)(Cv,Rv(),{test:function(e,n){return e===n||n instanceof RegExp&&n.test(e)}}),nU=(0,b6.inherits)(Cv,Rv(),{jump:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=this.next(new e(""));return s===this.defaultTransition?(s=new this.constructor(n),this.on(e,s)):n&&(s.T=n),s},test:function(e,n){return e instanceof n}});function sU(t,e,n,s){for(var i=0,r=t.length,o=e,a=[],l=void 0;i<r&&(l=o.next(t[i]));)o=l,i++;if(i>=r)return[];for(;i<r-1;)l=new yp(s),a.push(l),o.on(t[i],l),o=l,i++;return l=new yp(n),a.push(l),o.on(t[r-1],l),a}tr.CharacterState=yp;tr.TokenState=nU;tr.stateify=sU;var Ye={},y0={};y0.__esModule=!0;function iU(){return function(t){t&&(this.v=t)}}y0.createTokenClass=iU;Ye.__esModule=!0;Ye.AMPERSAND=Ye.CLOSEPAREN=Ye.CLOSEANGLEBRACKET=Ye.CLOSEBRACKET=Ye.CLOSEBRACE=Ye.OPENPAREN=Ye.OPENANGLEBRACKET=Ye.OPENBRACKET=Ye.OPENBRACE=Ye.WS=Ye.TLD=Ye.SYM=Ye.UNDERSCORE=Ye.SLASH=Ye.MAILTO=Ye.PROTOCOL=Ye.QUERY=Ye.POUND=Ye.PLUS=Ye.NUM=Ye.NL=Ye.LOCALHOST=Ye.PUNCTUATION=Ye.DOT=Ye.COLON=Ye.AT=Ye.DOMAIN=Ye.Base=void 0;var w6=y0,rU=Nl,Iv=(0,w6.createTokenClass)();Iv.prototype={toString:function(){return this.v+""}};function Qt(t){var e=t?{v:t}:{};return(0,rU.inherits)(Iv,(0,w6.createTokenClass)(),e)}var oU=Qt(),aU=Qt("@"),lU=Qt(":"),cU=Qt("."),uU=Qt(),hU=Qt(),dU=Qt(`
`),fU=Qt(),mU=Qt("+"),pU=Qt("#"),gU=Qt(),_U=Qt("mailto:"),vU=Qt("?"),yU=Qt("/"),bU=Qt("_"),wU=Qt(),EU=Qt(),xU=Qt(),TU=Qt("{"),SU=Qt("["),AU=Qt("<"),RU=Qt("("),CU=Qt("}"),IU=Qt("]"),kU=Qt(">"),MU=Qt(")"),NU=Qt("&");Ye.Base=Iv;Ye.DOMAIN=oU;Ye.AT=aU;Ye.COLON=lU;Ye.DOT=cU;Ye.PUNCTUATION=uU;Ye.LOCALHOST=hU;Ye.NL=dU;Ye.NUM=fU;Ye.PLUS=mU;Ye.POUND=pU;Ye.QUERY=vU;Ye.PROTOCOL=gU;Ye.MAILTO=_U;Ye.SLASH=yU;Ye.UNDERSCORE=bU;Ye.SYM=wU;Ye.TLD=EU;Ye.WS=xU;Ye.OPENBRACE=TU;Ye.OPENBRACKET=SU;Ye.OPENANGLEBRACKET=AU;Ye.OPENPAREN=RU;Ye.CLOSEBRACE=CU;Ye.CLOSEBRACKET=IU;Ye.CLOSEANGLEBRACKET=kU;Ye.CLOSEPAREN=MU;Ye.AMPERSAND=NU;Mi.__esModule=!0;Mi.start=Mi.run=Mi.TOKENS=Mi.State=void 0;var Qr=tr,_t=Ye,OU=LU(_t);function LU(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var l3="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),kv="0123456789".split(""),b0="0123456789abcdefghijklmnopqrstuvwxyz".split(""),E6=[" ","\f","\r","	","\v","\xA0","\u1680","\u180E"],us=[],zt=function(e){return new Qr.CharacterState(e)},si=zt(),bp=zt(_t.NUM),hl=zt(_t.DOMAIN),iu=zt(),wp=zt(_t.WS);si.on("@",zt(_t.AT)).on(".",zt(_t.DOT)).on("+",zt(_t.PLUS)).on("#",zt(_t.POUND)).on("?",zt(_t.QUERY)).on("/",zt(_t.SLASH)).on("_",zt(_t.UNDERSCORE)).on(":",zt(_t.COLON)).on("{",zt(_t.OPENBRACE)).on("[",zt(_t.OPENBRACKET)).on("<",zt(_t.OPENANGLEBRACKET)).on("(",zt(_t.OPENPAREN)).on("}",zt(_t.CLOSEBRACE)).on("]",zt(_t.CLOSEBRACKET)).on(">",zt(_t.CLOSEANGLEBRACKET)).on(")",zt(_t.CLOSEPAREN)).on("&",zt(_t.AMPERSAND)).on([",",";","!",'"',"'"],zt(_t.PUNCTUATION));si.on(`
`,zt(_t.NL)).on(E6,wp);wp.on(E6,wp);for(var Am=0;Am<l3.length;Am++){var PU=(0,Qr.stateify)(l3[Am],si,_t.TLD,_t.DOMAIN);us.push.apply(us,PU)}var x6=(0,Qr.stateify)("file",si,_t.DOMAIN,_t.DOMAIN),T6=(0,Qr.stateify)("ftp",si,_t.DOMAIN,_t.DOMAIN),S6=(0,Qr.stateify)("http",si,_t.DOMAIN,_t.DOMAIN),A6=(0,Qr.stateify)("mailto",si,_t.DOMAIN,_t.DOMAIN);us.push.apply(us,x6);us.push.apply(us,T6);us.push.apply(us,S6);us.push.apply(us,A6);var DU=x6.pop(),BU=T6.pop(),FU=S6.pop(),UU=A6.pop(),w0=zt(_t.DOMAIN),E0=zt(_t.PROTOCOL),jU=zt(_t.MAILTO);BU.on("s",w0).on(":",E0);FU.on("s",w0).on(":",E0);us.push(w0);DU.on(":",E0);w0.on(":",E0);UU.on(":",jU);var HU=(0,Qr.stateify)("localhost",si,_t.LOCALHOST,_t.DOMAIN);us.push.apply(us,HU);si.on(kv,bp);bp.on("-",iu).on(kv,bp).on(b0,hl);hl.on("-",iu).on(b0,hl);for(var Rm=0;Rm<us.length;Rm++)us[Rm].on("-",iu).on(b0,hl);iu.on("-",iu).on(kv,hl).on(b0,hl);si.defaultTransition=zt(_t.SYM);var VU=function(e){for(var n=e.replace(/[A-Z]/g,function(f){return f.toLowerCase()}),s=e.length,i=[],r=0;r<s;){for(var o=si,a=null,l=0,c=null,d=-1;r<s&&(a=o.next(n[r]));)o=a,o.accepts()?(d=0,c=o):d>=0&&d++,l++,r++;if(!(d<0)){r-=d,l-=d;var u=c.emit();i.push(new u(e.substr(r-l,l)))}}return i},qU=si;Mi.State=Qr.CharacterState;Mi.TOKENS=OU;Mi.run=VU;Mi.start=qU;var Ni={},bs={};bs.__esModule=!0;bs.URL=bs.TEXT=bs.NL=bs.EMAIL=bs.MAILTOEMAIL=bs.Base=void 0;var Ol=y0,qu=Nl,Tc=Ye;function $U(t){return t instanceof Tc.DOMAIN||t instanceof Tc.TLD}var pa=(0,Ol.createTokenClass)();pa.prototype={type:"token",isLink:!1,toString:function(){for(var e=[],n=0;n<this.v.length;n++)e.push(this.v[n].toString());return e.join("")},toHref:function(){return this.toString()},toObject:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(e)}}};var zU=(0,qu.inherits)(pa,(0,Ol.createTokenClass)(),{type:"email",isLink:!0}),KU=(0,qu.inherits)(pa,(0,Ol.createTokenClass)(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),GU=(0,qu.inherits)(pa,(0,Ol.createTokenClass)(),{type:"text"}),WU=(0,qu.inherits)(pa,(0,Ol.createTokenClass)(),{type:"nl"}),YU=(0,qu.inherits)(pa,(0,Ol.createTokenClass)(),{type:"url",isLink:!0,toHref:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",n=!1,s=!1,i=this.v,r=[],o=0;i[o]instanceof Tc.PROTOCOL;)n=!0,r.push(i[o].toString().toLowerCase()),o++;for(;i[o]instanceof Tc.SLASH;)s=!0,r.push(i[o].toString()),o++;for(;$U(i[o]);)r.push(i[o].toString().toLowerCase()),o++;for(;o<i.length;o++)r.push(i[o].toString());return r=r.join(""),n||s||(r=e+"://"+r),r},hasProtocol:function(){return this.v[0]instanceof Tc.PROTOCOL}});bs.Base=pa;bs.MAILTOEMAIL=zU;bs.EMAIL=KU;bs.NL=WU;bs.TEXT=GU;bs.URL=YU;Ni.__esModule=!0;Ni.start=Ni.run=Ni.TOKENS=Ni.State=void 0;var R6=tr,Ss=bs,XU=QU(Ss),ke=Ye;function QU(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var Tt=function(e){return new R6.TokenState(e)},x0=Tt(),C6=Tt(),I6=Tt(),Mv=Tt(),k6=Tt(),Dr=Tt(),T0=Tt(),$u=Tt(Ss.URL),M6=Tt(),N6=Tt(Ss.URL),un=Tt(Ss.URL),ru=Tt(),zu=Tt(),Ku=Tt(),Gu=Tt(),Wu=Tt(),ta=Tt(Ss.URL),na=Tt(Ss.URL),sa=Tt(Ss.URL),ia=Tt(Ss.URL),ou=Tt(),au=Tt(),lu=Tt(),cu=Tt(),$a=Tt(),Nv=Tt(),S0=Tt(Ss.EMAIL),O6=Tt(),ZU=Tt(Ss.EMAIL),No=Tt(Ss.MAILTOEMAIL),Ep=Tt(),dl=Tt(),A0=Tt(),L6=Tt(),JU=Tt(Ss.NL);x0.on(ke.NL,JU).on(ke.PROTOCOL,C6).on(ke.MAILTO,I6).on(ke.SLASH,Mv);C6.on(ke.SLASH,Mv);Mv.on(ke.SLASH,k6);x0.on(ke.TLD,Dr).on(ke.DOMAIN,Dr).on(ke.LOCALHOST,$u).on(ke.NUM,Dr);k6.on(ke.TLD,un).on(ke.DOMAIN,un).on(ke.NUM,un).on(ke.LOCALHOST,un);Dr.on(ke.DOT,T0);$a.on(ke.DOT,Nv);T0.on(ke.TLD,$u).on(ke.DOMAIN,Dr).on(ke.NUM,Dr).on(ke.LOCALHOST,Dr);Nv.on(ke.TLD,S0).on(ke.DOMAIN,$a).on(ke.NUM,$a).on(ke.LOCALHOST,$a);$u.on(ke.DOT,T0);S0.on(ke.DOT,Nv);$u.on(ke.COLON,M6).on(ke.SLASH,un);M6.on(ke.NUM,N6);N6.on(ke.SLASH,un);S0.on(ke.COLON,O6);O6.on(ke.NUM,ZU);var Xn=[ke.DOMAIN,ke.AT,ke.LOCALHOST,ke.NUM,ke.PLUS,ke.POUND,ke.PROTOCOL,ke.SLASH,ke.TLD,ke.UNDERSCORE,ke.SYM,ke.AMPERSAND],Qn=[ke.COLON,ke.DOT,ke.QUERY,ke.PUNCTUATION,ke.CLOSEBRACE,ke.CLOSEBRACKET,ke.CLOSEANGLEBRACKET,ke.CLOSEPAREN,ke.OPENBRACE,ke.OPENBRACKET,ke.OPENANGLEBRACKET,ke.OPENPAREN];un.on(ke.OPENBRACE,zu).on(ke.OPENBRACKET,Ku).on(ke.OPENANGLEBRACKET,Gu).on(ke.OPENPAREN,Wu);ru.on(ke.OPENBRACE,zu).on(ke.OPENBRACKET,Ku).on(ke.OPENANGLEBRACKET,Gu).on(ke.OPENPAREN,Wu);zu.on(ke.CLOSEBRACE,un);Ku.on(ke.CLOSEBRACKET,un);Gu.on(ke.CLOSEANGLEBRACKET,un);Wu.on(ke.CLOSEPAREN,un);ta.on(ke.CLOSEBRACE,un);na.on(ke.CLOSEBRACKET,un);sa.on(ke.CLOSEANGLEBRACKET,un);ia.on(ke.CLOSEPAREN,un);ou.on(ke.CLOSEBRACE,un);au.on(ke.CLOSEBRACKET,un);lu.on(ke.CLOSEANGLEBRACKET,un);cu.on(ke.CLOSEPAREN,un);zu.on(Xn,ta);Ku.on(Xn,na);Gu.on(Xn,sa);Wu.on(Xn,ia);zu.on(Qn,ou);Ku.on(Qn,au);Gu.on(Qn,lu);Wu.on(Qn,cu);ta.on(Xn,ta);na.on(Xn,na);sa.on(Xn,sa);ia.on(Xn,ia);ta.on(Qn,ta);na.on(Qn,na);sa.on(Qn,sa);ia.on(Qn,ia);ou.on(Xn,ta);au.on(Xn,na);lu.on(Xn,sa);cu.on(Xn,ia);ou.on(Qn,ou);au.on(Qn,au);lu.on(Qn,lu);cu.on(Qn,cu);un.on(Xn,un);ru.on(Xn,un);un.on(Qn,ru);ru.on(Qn,ru);I6.on(ke.TLD,No).on(ke.DOMAIN,No).on(ke.NUM,No).on(ke.LOCALHOST,No);No.on(Xn,No).on(Qn,Ep);Ep.on(Xn,No).on(Qn,Ep);var Yu=[ke.DOMAIN,ke.NUM,ke.PLUS,ke.POUND,ke.QUERY,ke.UNDERSCORE,ke.SYM,ke.AMPERSAND,ke.TLD];Dr.on(Yu,dl).on(ke.AT,A0);$u.on(Yu,dl).on(ke.AT,A0);T0.on(Yu,dl);dl.on(Yu,dl).on(ke.AT,A0).on(ke.DOT,L6);L6.on(Yu,dl);A0.on(ke.TLD,$a).on(ke.DOMAIN,$a).on(ke.LOCALHOST,S0);var ej=function(e){for(var n=e.length,s=0,i=[],r=[];s<n;){for(var o=x0,a=null,l=null,c=0,d=null,u=-1;s<n&&!(a=o.next(e[s]));)r.push(e[s++]);for(;s<n&&(l=a||o.next(e[s]));)a=null,o=l,o.accepts()?(u=0,d=o):u>=0&&u++,s++,c++;if(u<0)for(var f=s-c;f<s;f++)r.push(e[f]);else{r.length>0&&(i.push(new Ss.TEXT(r)),r=[]),s-=u,c-=u;var m=d.emit();i.push(new m(e.slice(s-c,s)))}}return r.length>0&&i.push(new Ss.TEXT(r)),i};Ni.State=R6.TokenState;Ni.TOKENS=XU;Ni.run=ej;Ni.start=x0;Hn.__esModule=!0;Hn.tokenize=Hn.test=Hn.scanner=Hn.parser=Hn.options=Hn.inherits=Hn.find=void 0;var tj=Nl,nj=Vu,sj=Ov(nj),ij=Mi,P6=Ov(ij),rj=Ni,D6=Ov(rj);function Ov(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Array.isArray||(Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"});var Lv=function(e){return D6.run(P6.run(e))},oj=function(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=Lv(e),i=[],r=0;r<s.length;r++){var o=s[r];o.isLink&&(!n||o.type===n)&&i.push(o.toObject())}return i},aj=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=Lv(e);return s.length===1&&s[0].isLink&&(!n||s[0].type===n)};Hn.find=oj;Hn.inherits=tj.inherits;Hn.options=sj;Hn.parser=D6;Hn.scanner=P6;Hn.test=aj;Hn.tokenize=Lv;var B6=Hn,lj=(t,e,n)=>{const s={bold:n.bold,italic:n.italic,strike:n.strike,underline:n.underline,multilineCode:n.multilineCode,inlineCode:n.inlineCode},i={[s.bold]:{end:"\\"+s.bold,allowed_chars:".",type:"bold"},[s.italic]:{end:s.italic,allowed_chars:".",type:"italic"},[s.strike]:{end:s.strike,allowed_chars:".",type:"strike"},[s.underline]:{end:s.underline,allowed_chars:".",type:"underline"},[s.multilineCode]:{end:s.multilineCode,allowed_chars:`(.|
)`,type:"multiline-code"},[s.inlineCode]:{end:s.inlineCode,allowed_chars:".",type:"inline-code"},"<usertag>":{allowed_chars:".",end:"</usertag>",type:"tag"}},r=Yh(t,i),o=cj(r,i),a=[].concat.apply([],o);return e&&hj(a),a};function Yh(t,e){let n=[],s=-1,i=null,r=B6.find(t),o=!1;if(r.length>0&&(s=t.indexOf(r[0].value),o=!0),Object.keys(e).forEach(a=>{const l=t.indexOf(a);l>=0&&(s<0||l<s)&&(s=l,i=a,o=!1)}),o&&i!==-1){let a=t.substr(0,s),l=t.substr(s,r[0].value.length),c=t.substr(s+r[0].value.length);return n.push(a),n.push(l),n=n.concat(Yh(c,e)),n}if(i){let a=t.substr(0,s);const l=i;let c=t.substr(s+l.length);if(t.replace(/\s/g,"").length===l.length*2)return[t];const d=c.match(new RegExp("^("+(e[l].allowed_chars||".")+"*"+(e[l].end?"?":"")+")"+(e[l].end?"("+e[l].end+")":""),"m"));if(!d||!d[1])a=a+l,n.push(a);else{a&&n.push(a);const u={start:l,content:Yh(d[1],e),end:d[2],type:e[l].type};n.push(u),c=c.substr(d[0].length)}return n=n.concat(Yh(c,e)),n}else return t?[t]:[]}function cj(t,e){const n=[];return t.forEach(s=>{typeof s=="string"?n.push({types:[],value:s}):e[s.start]&&n.push(uj(s))}),n}function uj(t){const e=[];return F6(t,e,[]),e}function F6(t,e,n){t.content.forEach(s=>{typeof s=="string"?e.push({types:c3(n.concat([t.type])),value:s}):F6(s,e,c3([s.type].concat([t.type]).concat(n)))})}function c3(t){return[...new Set(t)]}function hj(t){const e=[];return t.forEach(n=>{const s=B6.find(n.value);if(s.length){const i=n.value.replace(s[0].value,"");e.push({types:n.types,value:i}),n.types=["url"].concat(n.types),n.href=s[0].href,n.value=s[0].value}e.push(n)}),e}const Pv=["png","jpg","jpeg","webp","svg","gif"],U6=["mp4","video/ogg","webm","quicktime"],dj=["mp3","audio/ogg","wav","mpeg"],fj={name:"FormatMessage",components:{SvgIcon:Un},props:{content:{type:[String,Number],required:!0},deleted:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},linkify:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!1},reply:{type:Boolean,default:!1},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["open-user-tag"],computed:{linkifiedMessage(){const t=lj(this.formatTags(this.content),this.linkify&&!this.linkOptions.disabled,this.textFormatting);return t.forEach(e=>{e.url=this.checkType(e,"url"),e.bold=this.checkType(e,"bold"),e.italic=this.checkType(e,"italic"),e.strike=this.checkType(e,"strike"),e.underline=this.checkType(e,"underline"),e.inline=this.checkType(e,"inline-code"),e.multiline=this.checkType(e,"multiline-code"),e.tag=this.checkType(e,"tag"),e.image=this.checkImageType(e),e.value=this.replaceEmojiByElement(e.value)}),t},formattedContent(){return this.formatTags(this.content)}},methods:{checkType(t,e){return t.types.indexOf(e)!==-1},checkImageType(t){let e=t.value.lastIndexOf(".");t.value.lastIndexOf("/")>e&&(e=-1);const s=t.value.substring(e+1,t.value.length),i=e>0&&Pv.some(r=>s.toLowerCase().includes(r));return i&&this.setImageSize(t),i},setImageSize(t){const e=new Image;e.src=t.value,e.addEventListener("load",n);function n(s){const i=s.path[0].width/150;t.height=Math.round(s.path[0].height/i)+"px",e.removeEventListener("load",n)}},formatTags(t){const e="<usertag>",n="</usertag>",s=[...t.matchAll(new RegExp(e,"gi"))].map(r=>r.index),i=t;return s.forEach(r=>{const o=i.substring(r+e.length,i.indexOf(n,r)),a=this.users.find(l=>l._id===o);t=t.replaceAll(o,`@${(a==null?void 0:a.username)||"unknown"}`)}),t},openTag(t){if(!this.singleLine&&this.checkType(t,"tag")){const e=this.users.find(n=>t.value.indexOf(n.username)!==-1);this.$emit("open-user-tag",e)}},replaceEmojiByElement(t){let e;return this.singleLine?e=16:e=this.containsOnlyEmojis()?28:20,t.replaceAll(/[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/gu,n=>`<span style="font-size: ${e}px">${n}</span>`)},containsOnlyEmojis(){const t=this.content.replace(new RegExp("[\0-\u1EEFf]","g"),""),e=this.content.replace(new RegExp(`[
\rs]+|( )+`,"g"),"");return t.length===e.length}}},mj={class:"vac-image-link-container"},pj={class:"vac-image-link-message"},gj=["innerHTML"],_j=["innerHTML"];function vj(t,e,n,s,i,r){const o=et("svg-icon");return re(),ge("div",{class:yt(["vac-format-message-wrapper",{"vac-text-ellipsis":n.singleLine}])},[n.textFormatting.disabled?(re(),ge("div",{key:1,innerHTML:r.formattedContent},null,8,_j)):(re(),ge("div",{key:0,class:yt({"vac-text-ellipsis":n.singleLine})},[(re(!0),ge(kt,null,gt(r.linkifiedMessage,(a,l)=>(re(),ge("div",{key:l,class:"vac-format-container"},[(re(),Ut(gB(a.url?"a":"span"),{class:yt({"vac-text-ellipsis":n.singleLine,"vac-text-bold":a.bold,"vac-text-italic":n.deleted||a.italic,"vac-text-strike":a.strike,"vac-text-underline":a.underline,"vac-text-inline-code":!n.singleLine&&a.inline,"vac-text-multiline-code":!n.singleLine&&a.multiline,"vac-text-tag":!n.singleLine&&!n.reply&&a.tag}),href:a.href,target:a.href?n.linkOptions.target:null,rel:a.href?n.linkOptions.rel:null,onClick:c=>r.openTag(a)},{default:Je(()=>[je(t.$slots,"deleted-icon",pt(ft({deleted:n.deleted})),()=>[n.deleted?(re(),Ut(o,{key:0,name:"deleted",class:"vac-icon-deleted"})):He("",!0)]),a.url&&a.image?(re(),ge(kt,{key:0},[Ce("div",mj,[Ce("div",{class:"vac-image-link",style:Lt({"background-image":`url('${a.value}')`,height:a.height})},null,4)]),Ce("div",pj,[Ce("span",null,ot(a.value),1)])],64)):(re(),ge("span",{key:1,innerHTML:a.value},null,8,gj))]),_:2},1032,["class","href","target","rel","onClick"]))]))),128))],2))],2)}var Xu=qt(fj,[["render",vj]]);const xo="__v-click-outside",j6=typeof window!="undefined",yj=typeof navigator!="undefined",bj=j6&&("ontouchstart"in window||yj&&navigator.msMaxTouchPoints>0),wj=bj?["touchstart"]:["click"],Ej=t=>{const e=typeof t=="function";if(!e&&typeof t!="object")throw new Error("v-click-outside: Binding value must be a function or an object");return{handler:e?t:t.handler,middleware:t.middleware||(n=>n),events:t.events||wj,isActive:t.isActive!==!1,detectIframe:t.detectIframe!==!1,capture:Boolean(t.capture)}},H6=({event:t,handler:e,middleware:n})=>{n(t)&&e(t)},xj=({el:t,event:e,handler:n,middleware:s})=>{setTimeout(()=>{const{activeElement:i}=document;i&&i.tagName==="IFRAME"&&!t.contains(i)&&H6({event:e,handler:n,middleware:s})},0)},Tj=({el:t,event:e,handler:n,middleware:s})=>{const i=e.path||e.composedPath&&e.composedPath();(i?i.indexOf(t)<0:!t.contains(e.target))&&H6({event:e,handler:n,middleware:s})},V6=(t,{value:e})=>{const{events:n,handler:s,middleware:i,isActive:r,detectIframe:o,capture:a}=Ej(e);if(!!r){if(t[xo]=n.map(l=>({event:l,srcTarget:document.documentElement,handler:c=>Tj({el:t,event:c,handler:s,middleware:i}),capture:a})),o){const l={event:"blur",srcTarget:window,handler:c=>xj({el:t,event:c,handler:s,middleware:i}),capture:a};t[xo]=[...t[xo],l]}t[xo].forEach(({event:l,srcTarget:c,handler:d})=>setTimeout(()=>{!t[xo]||c.addEventListener(l,d,a)},0))}},q6=t=>{(t[xo]||[]).forEach(({event:n,srcTarget:s,handler:i,capture:r})=>s.removeEventListener(n,i,r)),delete t[xo]},Sj=(t,{value:e,oldValue:n})=>{JSON.stringify(e)!==JSON.stringify(n)&&(q6(t),V6(t,{value:e}))},Aj={beforeMount:V6,updated:Sj,unmounted:q6};var R0=j6?Aj:{},$6=(t,e,n)=>{if(t.typingUsers&&t.typingUsers.length){const s=t.users.filter(i=>{if(i._id!==e&&t.typingUsers.indexOf(i._id)!==-1&&!(i.status&&i.status.state==="offline"))return!0});return s.length?t.users.length===2?n.IS_TYPING:s.map(i=>i.username).join(", ")+" "+n.IS_TYPING:void 0}};function uu(t,e){if(!(!e||!e.type))return t.some(n=>e.type.toLowerCase().includes(n))}function fl(t){return uu(Pv,t)}function Qu(t){return uu(U6,t)}function u3(t){return uu(Pv,t)||uu(U6,t)}function C0(t){return uu(dj,t)}const Rj={name:"RoomsContent",components:{SvgIcon:Un,FormatMessage:Xu},directives:{clickOutside:R0},props:{currentUserId:{type:[String,Number],required:!0},room:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},roomActions:{type:Array,required:!0}},emits:["room-action-handler"],data(){return{roomMenuOpened:null}},computed:{getLastMessage(){const t=this.typingUsers;if(t)return t;const e=this.room.lastMessage.deleted?this.textMessages.MESSAGE_DELETED:this.room.lastMessage.content;if(this.room.users.length<=2)return e;const n=this.room.users.find(s=>s._id===this.room.lastMessage.senderId);return this.room.lastMessage.username?`${this.room.lastMessage.username} - ${e}`:!n||n._id===this.currentUserId?e:`${n.username} - ${e}`},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const t=this.room.users.find(e=>e._id!==this.currentUserId);return t&&t.status?t.status.state:null},typingUsers(){return $6(this.room,this.currentUserId,this.textMessages)},isMessageCheckmarkVisible(){return!this.typingUsers&&this.room.lastMessage&&!this.room.lastMessage.deleted&&this.room.lastMessage.senderId===this.currentUserId&&(this.room.lastMessage.saved||this.room.lastMessage.distributed||this.room.lastMessage.seen)},formattedDuration(){var e,n;const t=(n=(e=this.room.lastMessage)==null?void 0:e.files)==null?void 0:n[0];if(t){if(!t.duration)return`${t.name}.${t.extension}`;let s=Math.floor(t.duration);return(s-(s%=60))/60+(s>9?":":":0")+s}return""},isAudio(){return this.room.lastMessage.files?C0(this.room.lastMessage.files[0]):!1}},methods:{roomActionHandler(t){this.closeRoomMenu(),this.$emit("room-action-handler",{action:t,roomId:this.room.roomId})},closeRoomMenu(){this.roomMenuOpened=null}}},Cj={class:"vac-room-container"},Ij={class:"vac-name-container vac-text-ellipsis"},kj={class:"vac-title-container"},Mj={class:"vac-room-name vac-text-ellipsis"},Nj={key:1,class:"vac-text-date"},Oj={key:0},Lj={key:1,class:"vac-text-ellipsis"},Pj={key:3,class:"vac-text-ellipsis"},Dj={class:"vac-room-options-container"},Bj={key:0,class:"vac-badge-counter vac-room-badge"},Fj={key:0,class:"vac-menu-options"},Uj={class:"vac-menu-list"},jj=["onClick"];function Hj(t,e,n,s,i,r){const o=et("svg-icon"),a=et("format-message"),l=m0("click-outside");return re(),ge("div",Cj,[je(t.$slots,"room-list-item",pt(ft({room:n.room})),()=>[je(t.$slots,"room-list-avatar",pt(ft({room:n.room})),()=>[n.room.avatar?(re(),ge("div",{key:0,class:"vac-avatar",style:Lt({"background-image":`url('${n.room.avatar}')`})},null,4)):He("",!0)]),Ce("div",Ij,[Ce("div",kj,[r.userStatus?(re(),ge("div",{key:0,class:yt(["vac-state-circle",{"vac-state-online":r.userStatus==="online"}])},null,2)):He("",!0),Ce("div",Mj,ot(n.room.roomName),1),n.room.lastMessage?(re(),ge("div",Nj,ot(n.room.lastMessage.timestamp),1)):He("",!0)]),Ce("div",{class:yt(["vac-text-last",{"vac-message-new":n.room.lastMessage&&n.room.lastMessage.new&&!r.typingUsers}])},[r.isMessageCheckmarkVisible?(re(),ge("span",Oj,[je(t.$slots,"checkmark-icon",pt(ft({message:n.room.lastMessage})),()=>[Ue(o,{name:n.room.lastMessage.distributed?"double-checkmark":"checkmark",param:n.room.lastMessage.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):He("",!0),n.room.lastMessage&&!n.room.lastMessage.deleted&&r.isAudio?(re(),ge("div",Lj,[je(t.$slots,"microphone-icon",{},()=>[Ue(o,{name:"microphone",class:"vac-icon-microphone"})]),ma(" "+ot(r.formattedDuration),1)])):n.room.lastMessage?(re(),Ut(a,{key:2,content:r.getLastMessage,deleted:!!n.room.lastMessage.deleted&&!r.typingUsers,users:n.room.users,linkify:!1,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"single-line":!0},{"deleted-icon":Je(c=>[je(t.$slots,"deleted-icon",pt(ft(c)))]),_:3},8,["content","deleted","users","text-formatting","link-options"])):He("",!0),!n.room.lastMessage&&r.typingUsers?(re(),ge("div",Pj,ot(r.typingUsers),1)):He("",!0),Ce("div",Dj,[n.room.unreadCount?(re(),ge("div",Bj,ot(n.room.unreadCount),1)):He("",!0),je(t.$slots,"room-list-options",pt(ft({room:n.room})),()=>[n.roomActions.length?(re(),ge("div",{key:0,class:"vac-svg-button vac-list-room-options",onClick:e[0]||(e[0]=Rr(c=>i.roomMenuOpened=n.room.roomId,["stop"]))},[je(t.$slots,"room-list-options-icon",{},()=>[Ue(o,{name:"dropdown",param:"room"})])])):He("",!0),n.roomActions.length?(re(),Ut(gn,{key:1,name:"vac-slide-left"},{default:Je(()=>[i.roomMenuOpened===n.room.roomId?ar((re(),ge("div",Fj,[Ce("div",Uj,[(re(!0),ge(kt,null,gt(n.roomActions,c=>(re(),ge("div",{key:c.name},[Ce("div",{class:"vac-menu-item",onClick:Rr(d=>r.roomActionHandler(c),["stop"])},ot(c.title),9,jj)]))),128))])])),[[l,r.closeRoomMenu]]):He("",!0)]),_:1})):He("",!0)])])],2)])])])}var Vj=qt(Rj,[["render",Hj]]),xp=(t,e,n,s=!1)=>!n||n===""?t:t.filter(i=>s?xh(i[e]).startsWith(xh(n)):xh(i[e]).includes(xh(n)));function xh(t){return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const qj={name:"RoomsList",components:{Loader:v0,RoomsSearch:QF,RoomContent:Vj},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},showRoomsList:{type:Boolean,required:!0},showSearch:{type:Boolean,required:!0},showAddRoom:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},loadingRooms:{type:Boolean,required:!0},roomsLoaded:{type:Boolean,required:!0},room:{type:Object,required:!0},roomActions:{type:Array,required:!0},scrollDistance:{type:Number,required:!0}},emits:["add-room","room-action-handler","loading-more-rooms","fetch-room","fetch-more-rooms"],data(){return{filteredRooms:this.rooms||[],observer:null,showLoader:!0,loadingMoreRooms:!1,selectedRoomId:""}},watch:{rooms:{deep:!0,handler(t,e){this.filteredRooms=t,(t.length!==e.length||this.roomsLoaded)&&(this.loadingMoreRooms=!1)}},loadingRooms(t){t||setTimeout(()=>this.initIntersectionObserver())},loadingMoreRooms(t){this.$emit("loading-more-rooms",t)},roomsLoaded:{immediate:!0,handler(t){t&&(this.loadingMoreRooms=!1,this.loadingRooms||(this.showLoader=!1))}},room:{immediate:!0,handler(t){t&&!this.isMobile&&(this.selectedRoomId=t.roomId)}}},methods:{initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const t=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-rooms");if(t){const e={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("rooms-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(n=>{n[0].isIntersecting&&this.loadMoreRooms()},e),this.observer.observe(t)}},searchRoom(t){this.filteredRooms=xp(this.rooms,"roomName",t.target.value)},openRoom(t){t.roomId===this.room.roomId&&!this.isMobile||(this.isMobile||(this.selectedRoomId=t.roomId),this.$emit("fetch-room",{room:t}))},loadMoreRooms(){if(!this.loadingMoreRooms){if(this.roomsLoaded){this.loadingMoreRooms=!1,this.showLoader=!1;return}this.$emit("fetch-more-rooms"),this.loadingMoreRooms=!0}}}},$j={key:0,class:"vac-rooms-empty"},zj={key:1,id:"rooms-list",class:"vac-room-list"},Kj=["id","onClick"],Gj={key:0,id:"infinite-loader-rooms"};function Wj(t,e,n,s,i,r){const o=et("rooms-search"),a=et("loader"),l=et("room-content");return ar((re(),ge("div",{class:yt(["vac-rooms-container",{"vac-rooms-container-full":n.isMobile,"vac-app-border-r":!n.isMobile}])},[je(t.$slots,"rooms-header"),je(t.$slots,"rooms-list-search",{},()=>[Ue(o,{rooms:n.rooms,"loading-rooms":n.loadingRooms,"text-messages":n.textMessages,"show-search":n.showSearch,"show-add-room":n.showAddRoom,onSearchRoom:r.searchRoom,onAddRoom:e[0]||(e[0]=c=>t.$emit("add-room"))},{"add-icon":Je(()=>[je(t.$slots,"add-icon")]),_:3},8,["rooms","loading-rooms","text-messages","show-search","show-add-room","onSearchRoom"])]),Ue(a,{show:n.loadingRooms},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["show"]),!n.loadingRooms&&!n.rooms.length?(re(),ge("div",$j,[je(t.$slots,"rooms-empty",{},()=>[ma(ot(n.textMessages.ROOMS_EMPTY),1)])])):He("",!0),n.loadingRooms?He("",!0):(re(),ge("div",zj,[(re(!0),ge(kt,null,gt(i.filteredRooms,c=>(re(),ge("div",{id:c.roomId,key:c.roomId,class:yt(["vac-room-item",{"vac-room-selected":i.selectedRoomId===c.roomId}]),onClick:d=>r.openRoom(c)},[Ue(l,{"current-user-id":n.currentUserId,room:c,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"text-messages":n.textMessages,"room-actions":n.roomActions,onRoomActionHandler:e[1]||(e[1]=d=>t.$emit("room-action-handler",d))},Jt({_:2},[gt(t.$slots,(d,u)=>({name:u,fn:Je(f=>[je(t.$slots,u,pt(ft(f)))])}))]),1032,["current-user-id","room","text-formatting","link-options","text-messages","room-actions"])],10,Kj))),128)),Ue(gn,{name:"vac-fade-message"},{default:Je(()=>[n.rooms.length&&!n.loadingRooms?(re(),ge("div",Gj,[Ue(a,{show:i.showLoader,infinite:!0},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["show"])])):He("",!0)]),_:3})]))],2)),[[_0,n.showRoomsList]])}var Yj=qt(qj,[["render",Wj]]);const Xj={name:"RoomHeader",components:{SvgIcon:Un},directives:{clickOutside:R0},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},room:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},messageSelectionActions:{type:Array,required:!0},selectedMessagesTotal:{type:Number,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","cancel-message-selection","message-selection-action-handler"],data(){return{menuOpened:!1,messageSelectionAnimationEnded:!0}},computed:{typingUsers(){return $6(this.room,this.currentUserId,this.textMessages)},userStatus(){if(!this.room.users||this.room.users.length!==2)return;const t=this.room.users.find(n=>n._id!==this.currentUserId);if(!t.status)return;let e="";return t.status.state==="online"?e=this.textMessages.IS_ONLINE:t.status.lastChanged&&(e=this.textMessages.LAST_SEEN+t.status.lastChanged),e}},watch:{messageSelectionEnabled(t){t?this.messageSelectionAnimationEnded=!1:setTimeout(()=>{this.messageSelectionAnimationEnded=!0},300)}},methods:{menuActionHandler(t){this.closeMenu(),this.$emit("menu-action-handler",t)},closeMenu(){this.menuOpened=!1},messageSelectionActionHandler(t){this.$emit("message-selection-action-handler",t)}}},Qj={class:"vac-room-header vac-app-border-b"},Zj={class:"vac-room-wrapper"},Jj={key:0,class:"vac-room-selection"},eH=["id"],tH=["onClick"],nH={class:"vac-selection-button-count"},sH={class:"vac-text-ellipsis"},iH={class:"vac-room-name vac-text-ellipsis"},rH={key:0,class:"vac-room-info vac-text-ellipsis"},oH={key:1,class:"vac-room-info vac-text-ellipsis"},aH={key:0,class:"vac-menu-options"},lH={class:"vac-menu-list"},cH=["onClick"];function uH(t,e,n,s,i,r){const o=et("svg-icon"),a=m0("click-outside");return re(),ge("div",Qj,[je(t.$slots,"room-header",pt(ft({room:n.room,typingUsers:r.typingUsers,userStatus:r.userStatus})),()=>[Ce("div",Zj,[Ue(gn,{name:"vac-slide-up"},{default:Je(()=>[n.messageSelectionEnabled?(re(),ge("div",Jj,[(re(!0),ge(kt,null,gt(n.messageSelectionActions,l=>(re(),ge("div",{id:l.name,key:l.name},[Ce("div",{class:"vac-selection-button",onClick:c=>r.messageSelectionActionHandler(l)},[ma(ot(l.title)+" ",1),Ce("span",nH,ot(n.selectedMessagesTotal),1)],8,tH)],8,eH))),128)),Ce("div",{class:"vac-selection-cancel vac-item-clickable",onClick:e[0]||(e[0]=l=>t.$emit("cancel-message-selection"))},ot(n.textMessages.CANCEL_SELECT_MESSAGE),1)])):He("",!0)]),_:1}),!n.messageSelectionEnabled&&i.messageSelectionAnimationEnded?(re(),ge(kt,{key:0},[n.singleRoom?He("",!0):(re(),ge("div",{key:0,class:yt(["vac-svg-button vac-toggle-button",{"vac-rotate-icon-init":!n.isMobile,"vac-rotate-icon":!n.showRoomsList&&!n.isMobile}]),onClick:e[1]||(e[1]=l=>t.$emit("toggle-rooms-list"))},[je(t.$slots,"toggle-icon",{},()=>[Ue(o,{name:"toggle"})])],2)),Ce("div",{class:yt(["vac-info-wrapper",{"vac-item-clickable":n.roomInfoEnabled}]),onClick:e[2]||(e[2]=l=>t.$emit("room-info"))},[je(t.$slots,"room-header-avatar",pt(ft({room:n.room})),()=>[n.room.avatar?(re(),ge("div",{key:0,class:"vac-avatar",style:Lt({"background-image":`url('${n.room.avatar}')`})},null,4)):He("",!0)]),je(t.$slots,"room-header-info",pt(ft({room:n.room,typingUsers:r.typingUsers,userStatus:r.userStatus})),()=>[Ce("div",sH,[Ce("div",iH,ot(n.room.roomName),1),r.typingUsers?(re(),ge("div",rH,ot(r.typingUsers),1)):(re(),ge("div",oH,ot(r.userStatus),1))])])],2),n.room.roomId?je(t.$slots,"room-options",{key:1},()=>[n.menuActions.length?(re(),ge("div",{key:0,class:"vac-svg-button vac-room-options",onClick:e[3]||(e[3]=l=>i.menuOpened=!i.menuOpened)},[je(t.$slots,"menu-icon",{},()=>[Ue(o,{name:"menu"})])])):He("",!0),n.menuActions.length?(re(),Ut(gn,{key:1,name:"vac-slide-left"},{default:Je(()=>[i.menuOpened?ar((re(),ge("div",aH,[Ce("div",lH,[(re(!0),ge(kt,null,gt(n.menuActions,l=>(re(),ge("div",{key:l.name},[Ce("div",{class:"vac-menu-item",onClick:c=>r.menuActionHandler(l)},ot(l.title),9,cH)]))),128))])])),[[a,r.closeMenu]]):He("",!0)]),_:1})):He("",!0)]):He("",!0)],64)):He("",!0)])])])}var hH=qt(Xj,[["render",uH]]);function Th(t){if(typeof t!="string"||!t)throw new Error("expected a non-empty string, got: "+t)}function Cm(t){if(typeof t!="number")throw new Error("expected a number, got: "+t)}const dH=1,fH=1,ga="emoji",ml="keyvalue",Dv="favorites",mH="tokens",z6="tokens",pH="unicode",K6="count",gH="group",_H="order",G6="group-order",Tp="eTag",Gd="url",h3="skinTone",Ll="readonly",Bv="readwrite",W6="skinUnicodes",vH="skinUnicodes",yH="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",bH="en";function wH(t,e){const n=new Set,s=[];for(const i of t){const r=e(i);n.has(r)||(n.add(r),s.push(i))}return s}function d3(t){return wH(t,e=>e.unicode)}function EH(t){function e(n,s,i){const r=s?t.createObjectStore(n,{keyPath:s}):t.createObjectStore(n);if(i)for(const[o,[a,l]]of Object.entries(i))r.createIndex(o,a,{multiEntry:l});return r}e(ml),e(ga,pH,{[z6]:[mH,!0],[G6]:[[gH,_H]],[W6]:[vH,!0]}),e(Dv,void 0,{[K6]:[""]})}const Sp={},Xh={},Wd={};function Y6(t,e,n){n.onerror=()=>e(n.error),n.onblocked=()=>e(new Error("IDB blocked")),n.onsuccess=()=>t(n.result)}async function xH(t){const e=await new Promise((n,s)=>{const i=indexedDB.open(t,dH);Sp[t]=i,i.onupgradeneeded=r=>{r.oldVersion<fH&&EH(i.result)},Y6(n,s,i)});return e.onclose=()=>Fv(t),e}function TH(t){return Xh[t]||(Xh[t]=xH(t)),Xh[t]}function dr(t,e,n,s){return new Promise((i,r)=>{const o=t.transaction(e,n,{durability:"relaxed"}),a=typeof e=="string"?o.objectStore(e):e.map(c=>o.objectStore(c));let l;s(a,o,c=>{l=c}),o.oncomplete=()=>i(l),o.onerror=()=>r(o.error)})}function Fv(t){const e=Sp[t],n=e&&e.result;if(n){n.close();const s=Wd[t];if(s)for(const i of s)i()}delete Sp[t],delete Xh[t],delete Wd[t]}function SH(t){return new Promise((e,n)=>{Fv(t);const s=indexedDB.deleteDatabase(t);Y6(e,n,s)})}function AH(t,e){let n=Wd[t];n||(n=Wd[t]=[]),n.push(e)}const RH=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function za(t){return t.split(/[\s_]+/).map(e=>!e.match(/\w/)||RH.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase()).filter(Boolean)}const CH=2;function X6(t){return t.filter(Boolean).map(e=>e.toLowerCase()).filter(e=>e.length>=CH)}function IH(t){return t.map(({annotation:n,emoticon:s,group:i,order:r,shortcodes:o,skins:a,tags:l,emoji:c,version:d})=>{const u=[...new Set(X6([...(o||[]).map(za).flat(),...l.map(za).flat(),...za(n),s]))].sort(),f={annotation:n,group:i,order:r,tags:l,tokens:u,unicode:c,version:d};if(s&&(f.emoticon=s),o&&(f.shortcodes=o),a){f.skinTones=[],f.skinUnicodes=[],f.skinVersions=[];for(const{tone:m,emoji:h,version:k}of a)f.skinTones.push(m),f.skinUnicodes.push(h),f.skinVersions.push(k)}return f})}function Q6(t,e,n,s){t[e](n).onsuccess=i=>s&&s(i.target.result)}function ra(t,e,n){Q6(t,"get",e,n)}function Z6(t,e,n){Q6(t,"getAll",e,n)}function Uv(t){t.commit&&t.commit()}function kH(t,e){let n=t[0];for(let s=1;s<t.length;s++){const i=t[s];e(n)>e(i)&&(n=i)}return n}function J6(t,e){const n=kH(t,i=>i.length),s=[];for(const i of n)t.some(r=>r.findIndex(o=>e(o)===e(i))===-1)||s.push(i);return s}async function MH(t){return!await jv(t,ml,Gd)}async function NH(t,e,n){const[s,i]=await Promise.all([Tp,Gd].map(r=>jv(t,ml,r)));return s===n&&i===e}async function OH(t,e){return dr(t,ga,Ll,(s,i,r)=>{let o;const a=()=>{s.getAll(o&&IDBKeyRange.lowerBound(o,!0),50).onsuccess=l=>{const c=l.target.result;for(const d of c)if(o=d.unicode,e(d))return r(d);if(c.length<50)return r();a()}};a()})}async function eS(t,e,n,s){try{const i=IH(e);await dr(t,[ga,ml],Bv,([r,o],a)=>{let l,c,d=0;function u(){++d===2&&f()}function f(){if(!(l===s&&c===n)){r.clear();for(const m of i)r.put(m);o.put(s,Tp),o.put(n,Gd),Uv(a)}}ra(o,Tp,m=>{l=m,u()}),ra(o,Gd,m=>{c=m,u()})})}finally{}}async function LH(t,e){return dr(t,ga,Ll,(n,s,i)=>{const r=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);Z6(n.index(G6),r,i)})}async function tS(t,e){const n=X6(za(e));return n.length?dr(t,ga,Ll,(s,i,r)=>{const o=[],a=()=>{o.length===n.length&&l()},l=()=>{const c=J6(o,d=>d.unicode);r(c.sort((d,u)=>d.order<u.order?-1:1))};for(let c=0;c<n.length;c++){const d=n[c],u=c===n.length-1?IDBKeyRange.bound(d,d+"\uFFFF",!1,!0):IDBKeyRange.only(d);Z6(s.index(z6),u,f=>{o.push(f),a()})}}):[]}async function PH(t,e){const n=await tS(t,e);return n.length?n.filter(s=>(s.shortcodes||[]).map(r=>r.toLowerCase()).includes(e.toLowerCase()))[0]||null:await OH(t,i=>(i.shortcodes||[]).includes(e.toLowerCase()))||null}async function DH(t,e){return dr(t,ga,Ll,(n,s,i)=>ra(n,e,r=>{if(r)return i(r);ra(n.index(W6),e,o=>i(o||null))}))}function jv(t,e,n){return dr(t,e,Ll,(s,i,r)=>ra(s,n,r))}function BH(t,e,n,s){return dr(t,e,Bv,(i,r)=>{i.put(s,n),Uv(r)})}function FH(t,e){return dr(t,Dv,Bv,(n,s)=>ra(n,e,i=>{n.put((i||0)+1,e),Uv(s)}))}function UH(t,e,n){return n===0?[]:dr(t,[Dv,ga],Ll,([s,i],r,o)=>{const a=[];s.index(K6).openCursor(void 0,"prev").onsuccess=l=>{const c=l.target.result;if(!c)return o(a);function d(m){if(a.push(m),a.length===n)return o(a);c.continue()}const u=c.primaryKey,f=e.byName(u);if(f)return d(f);ra(i,u,m=>{if(m)return d(m);c.continue()})}})}const Sh="";function jH(t,e){const n=new Map;for(const i of t){const r=e(i);for(const o of r){let a=n;for(let c=0;c<o.length;c++){const d=o.charAt(c);let u=a.get(d);u||(u=new Map,a.set(d,u)),a=u}let l=a.get(Sh);l||(l=[],a.set(Sh,l)),l.push(i)}}return(i,r)=>{let o=n;for(let c=0;c<i.length;c++){const d=i.charAt(c),u=o.get(d);if(u)o=u;else return[]}if(r)return o.get(Sh)||[];const a=[],l=[o];for(;l.length;){const d=[...l.shift().entries()].sort((u,f)=>u[0]<f[0]?-1:1);for(const[u,f]of d)u===Sh?a.push(...f):l.push(f)}return a}}const HH=["name","url"];function VH(t){const e=t&&Array.isArray(t),n=e&&t.length&&(!t[0]||HH.some(s=>!(s in t[0])));if(!e||n)throw new Error("Custom emojis are in the wrong format")}function f3(t){VH(t);const e=(f,m)=>f.name.toLowerCase()<m.name.toLowerCase()?-1:1,n=t.sort(e),i=jH(t,f=>[...new Set((f.shortcodes||[]).map(m=>za(m)).flat())]),r=f=>i(f,!0),o=f=>i(f,!1),a=f=>{const m=za(f),h=m.map((k,I)=>(I<m.length-1?r:o)(k));return J6(h,k=>k.name).sort(e)},l=new Map,c=new Map;for(const f of t){c.set(f.name.toLowerCase(),f);for(const m of f.shortcodes||[])l.set(m.toLowerCase(),f)}return{all:n,search:a,byShortcode:f=>l.get(f.toLowerCase()),byName:f=>c.get(f.toLowerCase())}}function Kl(t){if(!t)return t;if(delete t.tokens,t.skinTones){const e=t.skinTones.length;t.skins=Array(e);for(let n=0;n<e;n++)t.skins[n]={tone:t.skinTones[n],unicode:t.skinUnicodes[n],version:t.skinVersions[n]};delete t.skinTones,delete t.skinUnicodes,delete t.skinVersions}return t}function nS(t){t||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const qH=["annotation","emoji","group","order","tags","version"];function $H(t){if(!t||!Array.isArray(t)||!t[0]||typeof t[0]!="object"||qH.some(e=>!(e in t[0])))throw new Error("Emoji data is in the wrong format")}function sS(t,e){if(Math.floor(t.status/100)!==2)throw new Error("Failed to fetch: "+e+":  "+t.status)}async function zH(t){const e=await fetch(t,{method:"HEAD"});sS(e,t);const n=e.headers.get("etag");return nS(n),n}async function Ap(t){const e=await fetch(t);sS(e,t);const n=e.headers.get("etag");nS(n);const s=await e.json();return $H(s),[n,s]}function KH(t){for(var e="",n=new Uint8Array(t),s=n.byteLength,i=-1;++i<s;)e+=String.fromCharCode(n[i]);return e}function GH(t){for(var e=t.length,n=new ArrayBuffer(e),s=new Uint8Array(n),i=-1;++i<e;)s[i]=t.charCodeAt(i);return n}async function iS(t){const e=JSON.stringify(t),n=GH(e),s=await crypto.subtle.digest("SHA-1",n),i=KH(s);return btoa(i)}async function WH(t,e){let n,s=await zH(e);if(!s){const i=await Ap(e);s=i[0],n=i[1],s||(s=await iS(n))}await NH(t,e,s)||(n||(n=(await Ap(e))[1]),await eS(t,n,e,s))}async function YH(t,e){let[n,s]=await Ap(e);n||(n=await iS(s)),await eS(t,s,e,n)}class rS{constructor({dataSource:e=yH,locale:n=bH,customEmoji:s=[]}={}){this.dataSource=e,this.locale=n,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=f3(s),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await TH(this._dbName);AH(this._dbName,this._clear);const n=this.dataSource;await MH(e)?await YH(e,n):this._lazyUpdate=WH(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Cm(e),await this.ready(),d3(await LH(this._db,e)).map(Kl)}async getEmojiBySearchQuery(e){Th(e),await this.ready();const n=this._custom.search(e),s=d3(await tS(this._db,e)).map(Kl);return[...n,...s]}async getEmojiByShortcode(e){Th(e),await this.ready();const n=this._custom.byShortcode(e);return n||Kl(await PH(this._db,e))}async getEmojiByUnicodeOrName(e){Th(e),await this.ready();const n=this._custom.byName(e);return n||Kl(await DH(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await jv(this._db,ml,h3)||0}async setPreferredSkinTone(e){return Cm(e),await this.ready(),BH(this._db,ml,h3,e)}async incrementFavoriteEmojiCount(e){return Th(e),await this.ready(),FH(this._db,e)}async getTopFavoriteEmoji(e){return Cm(e),await this.ready(),(await UH(this._db,this._custom,e)).map(Kl)}set customEmoji(e){this._custom=f3(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await Fv(this._dbName)}async delete(){await this._shutdown(),await SH(this._dbName)}}function hu(){}function oS(t){return t()}function m3(){return Object.create(null)}function Zu(t){t.forEach(oS)}function aS(t){return typeof t=="function"}function XH(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Ah;function Yd(t,e){return Ah||(Ah=document.createElement("a")),Ah.href=e,t===Ah.href}function QH(t){return Object.keys(t).length===0}function ZH(t){return t&&aS(t.destroy)?t.destroy:hu}function Gt(t,e){t.appendChild(e)}function gi(t,e,n){t.insertBefore(e,n||null)}function _i(t){t.parentNode.removeChild(t)}function $t(t){return document.createElement(t)}function Ci(t){return document.createTextNode(t)}function ai(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function ue(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ii(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function p3(t,e){t.value=e==null?"":e}function gr(t,e,n,s){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,s?"important":"")}let Hv;function Sc(t){Hv=t}const rc=[],Oa=[],Qh=[],g3=[],lS=Promise.resolve();let Rp=!1;function cS(){Rp||(Rp=!0,lS.then(uS))}function JH(){return cS(),lS}function Cp(t){Qh.push(t)}const Im=new Set;let Rh=0;function uS(){const t=Hv;do{for(;Rh<rc.length;){const e=rc[Rh];Rh++,Sc(e),eV(e.$$)}for(Sc(null),rc.length=0,Rh=0;Oa.length;)Oa.pop()();for(let e=0;e<Qh.length;e+=1){const n=Qh[e];Im.has(n)||(Im.add(n),n())}Qh.length=0}while(rc.length);for(;g3.length;)g3.pop()();Rp=!1,Im.clear(),Sc(t)}function eV(t){if(t.fragment!==null){t.update(),Zu(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Cp)}}const tV=new Set;function nV(t,e){t&&t.i&&(tV.delete(t),t.i(e))}const sV=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;function oc(t,e){t.d(1),e.delete(t.key)}function ac(t,e,n,s,i,r,o,a,l,c,d,u){let f=t.length,m=r.length,h=f;const k={};for(;h--;)k[t[h].key]=h;const I=[],L=new Map,p=new Map;for(h=m;h--;){const F=u(i,r,h),_=n(F);let S=o.get(_);S?s&&S.p(F,e):(S=c(_,F),S.c()),L.set(_,I[h]=S),_ in k&&p.set(_,Math.abs(h-k[_]))}const C=new Set,P=new Set;function M(F){nV(F,1),F.m(a,d),o.set(F.key,F),d=F.first,m--}for(;f&&m;){const F=I[m-1],_=t[f-1],S=F.key,x=_.key;F===_?(d=F.first,f--,m--):L.has(x)?!o.has(S)||C.has(S)?M(F):P.has(x)?f--:p.get(S)>p.get(x)?(P.add(S),M(F)):(C.add(x),f--):(l(_,o),f--)}for(;f--;){const F=t[f];L.has(F.key)||l(F,o)}for(;m;)M(I[m-1]);return I}function iV(t,e,n,s){const{fragment:i,on_mount:r,on_destroy:o,after_update:a}=t.$$;i&&i.m(e,n),s||Cp(()=>{const l=r.map(oS).filter(aS);o?o.push(...l):Zu(l),t.$$.on_mount=[]}),a.forEach(Cp)}function rV(t,e){const n=t.$$;n.fragment!==null&&(Zu(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function oV(t,e){t.$$.dirty[0]===-1&&(rc.push(t),cS(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function aV(t,e,n,s,i,r,o,a=[-1]){const l=Hv;Sc(t);const c=t.$$={fragment:null,ctx:null,props:r,update:hu,not_equal:i,bound:m3(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:m3(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let d=!1;c.ctx=n?n(t,e.props||{},(u,f,...m)=>{const h=m.length?m[0]:f;return c.ctx&&i(c.ctx[u],c.ctx[u]=h)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](h),d&&oV(t,u)),f}):[],c.update(),d=!0,Zu(c.before_update),c.fragment=s?s(c.ctx):!1,e.target&&(c.fragment&&c.fragment.c(),iV(t,e.target,void 0,void 0),uS()),Sc(l)}class lV{$destroy(){rV(this,1),this.$destroy=hu}$on(e,n){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!QH(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const hS=[[-1,"\u2728","custom"],[0,"\u{1F600}","smileys-emotion"],[1,"\u{1F44B}","people-body"],[3,"\u{1F431}","animals-nature"],[4,"\u{1F34E}","food-drink"],[5,"\u{1F3E0}\uFE0F","travel-places"],[6,"\u26BD","activities"],[7,"\u{1F4DD}","objects"],[8,"\u26D4\uFE0F","symbols"],[9,"\u{1F3C1}","flags"]].map(([t,e,n])=>({id:t,emoji:e,name:n})),Ch=hS.slice(1),cV=hS[0],uV=2,_3=6,dS=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function v3(t){return t.unicode.includes("\u200D")}const hV={"\u{1FAE0}":14,"\u{1F972}":13.1,"\u{1F97B}":12.1,"\u{1F970}":11,"\u{1F929}":5,"\u{1F471}\u200D\u2640\uFE0F":4,"\u{1F923}":3,"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":2,"\u{1F600}":1,"\u{1F610}\uFE0F":.7,"\u{1F603}":.6},dV=1e3,fV="\u{1F590}\uFE0F",mV=8,pV=["\u{1F60A}","\u{1F612}","\u2665\uFE0F","\u{1F44D}\uFE0F","\u{1F60D}","\u{1F602}","\u{1F62D}","\u263A\uFE0F","\u{1F614}","\u{1F629}","\u{1F60F}","\u{1F495}","\u{1F64C}","\u{1F618}"],fS='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',gV=(t,e)=>t<e?-1:t>e?1:0,y3=(t,e)=>{const n=document.createElement("canvas");n.width=n.height=1;const s=n.getContext("2d");return s.textBaseline="top",s.font=`100px ${fS}`,s.fillStyle=e,s.scale(.01,.01),s.fillText(t,0,0),s.getImageData(0,0,1,1).data},_V=(t,e)=>{const n=[...t].join(","),s=[...e].join(",");return n===s&&!n.startsWith("0,0,0,")};function vV(t){const e=y3(t,"#000"),n=y3(t,"#fff");return e&&n&&_V(e,n)}function yV(){const t=Object.entries(hV);try{for(const[e,n]of t)if(vV(e))return n}catch{}finally{}return t[0][1]}const km=new Promise(t=>dS(()=>t(yV()))),Ip=new Map,bV="\uFE0F",wV="\uD83C",EV="\u200D",xV=127995,TV=57339;function SV(t,e){if(e===0)return t;const n=t.indexOf(EV);return n!==-1?t.substring(0,n)+String.fromCodePoint(xV+e-1)+t.substring(n):(t.endsWith(bV)&&(t=t.substring(0,t.length-1)),t+wV+String.fromCodePoint(TV+e-1))}function _r(t){t.preventDefault(),t.stopPropagation()}function Mm(t,e,n){return e+=t?-1:1,e<0?e=n.length-1:e>=n.length&&(e=0),e}function mS(t,e){const n=new Set,s=[];for(const i of t){const r=e(i);n.has(r)||(n.add(r),s.push(i))}return s}function AV(t,e){const n=s=>{const i={};for(const r of s)typeof r.tone=="number"&&r.version<=e&&(i[r.tone]=r.unicode);return i};return t.map(({unicode:s,skins:i,shortcodes:r,url:o,name:a,category:l})=>({unicode:s,name:a,shortcodes:r,url:o,category:l,id:s||a,skins:i&&n(i),title:(r||[]).join(", ")}))}const Zh=requestAnimationFrame;let RV=typeof ResizeObserver=="function";function CV(t,e){let n;return RV?(n=new ResizeObserver(s=>e(s[0].contentRect.width)),n.observe(t)):Zh(()=>e(t.getBoundingClientRect().width)),{destroy(){n&&n.disconnect()}}}function b3(t){{const e=document.createRange();return e.selectNode(t.firstChild),e.getBoundingClientRect().width}}let Nm;function IV(t,e,n){for(const s of t){const i=n(s),r=b3(i);typeof Nm=="undefined"&&(Nm=b3(e));const o=r/1.8<Nm;Ip.set(s.unicode,o)}}function kV(t){return mS(t,e=>e)}const{Map:lc}=sV;function w3(t,e,n){const s=t.slice();return s[63]=e[n],s[65]=n,s}function E3(t,e,n){const s=t.slice();return s[66]=e[n],s[65]=n,s}function x3(t,e,n){const s=t.slice();return s[63]=e[n],s[65]=n,s}function T3(t,e,n){const s=t.slice();return s[69]=e[n],s}function S3(t,e,n){const s=t.slice();return s[72]=e[n],s[65]=n,s}function A3(t,e){let n,s=e[72]+"",i,r,o,a,l,c;return{key:t,first:null,c(){n=$t("div"),i=Ci(s),ue(n,"id",r="skintone-"+e[65]),ue(n,"class",o="emoji hide-focus "+(e[65]===e[20]?"active":"")),ue(n,"aria-selected",a=e[65]===e[20]),ue(n,"role","option"),ue(n,"title",l=e[0].skinTones[e[65]]),ue(n,"tabindex","-1"),ue(n,"aria-label",c=e[0].skinTones[e[65]]),this.first=n},m(d,u){gi(d,n,u),Gt(n,i)},p(d,u){e=d,u[0]&512&&s!==(s=e[72]+"")&&Ii(i,s),u[0]&512&&r!==(r="skintone-"+e[65])&&ue(n,"id",r),u[0]&1049088&&o!==(o="emoji hide-focus "+(e[65]===e[20]?"active":""))&&ue(n,"class",o),u[0]&1049088&&a!==(a=e[65]===e[20])&&ue(n,"aria-selected",a),u[0]&513&&l!==(l=e[0].skinTones[e[65]])&&ue(n,"title",l),u[0]&513&&c!==(c=e[0].skinTones[e[65]])&&ue(n,"aria-label",c)},d(d){d&&_i(n)}}}function R3(t,e){let n,s,i=e[69].emoji+"",r,o,a,l,c,d,u;function f(){return e[49](e[69])}return{key:t,first:null,c(){n=$t("button"),s=$t("div"),r=Ci(i),ue(s,"class","nav-emoji emoji"),ue(n,"role","tab"),ue(n,"class","nav-button"),ue(n,"aria-controls",o="tab-"+e[69].id),ue(n,"aria-label",a=e[0].categories[e[69].name]),ue(n,"aria-selected",l=!e[4]&&e[13].id===e[69].id),ue(n,"title",c=e[0].categories[e[69].name]),this.first=n},m(m,h){gi(m,n,h),Gt(n,s),Gt(s,r),d||(u=ai(n,"click",f),d=!0)},p(m,h){e=m,h[0]&4096&&i!==(i=e[69].emoji+"")&&Ii(r,i),h[0]&4096&&o!==(o="tab-"+e[69].id)&&ue(n,"aria-controls",o),h[0]&4097&&a!==(a=e[0].categories[e[69].name])&&ue(n,"aria-label",a),h[0]&12304&&l!==(l=!e[4]&&e[13].id===e[69].id)&&ue(n,"aria-selected",l),h[0]&4097&&c!==(c=e[0].categories[e[69].name])&&ue(n,"title",c)},d(m){m&&_i(n),d=!1,u()}}}function MV(t){let e,n;return{c(){e=$t("img"),ue(e,"class","custom-emoji"),Yd(e.src,n=t[63].url)||ue(e,"src",n),ue(e,"alt",""),ue(e,"loading","lazy")},m(s,i){gi(s,e,i)},p(s,i){i[0]&32768&&!Yd(e.src,n=s[63].url)&&ue(e,"src",n)},d(s){s&&_i(e)}}}function NV(t){let e=t[27](t[63],t[8])+"",n;return{c(){n=Ci(e)},m(s,i){gi(s,n,i)},p(s,i){i[0]&33024&&e!==(e=s[27](s[63],s[8])+"")&&Ii(n,e)},d(s){s&&_i(n)}}}function C3(t,e){let n,s,i,r,o,a,l;function c(f,m){return f[63].unicode?NV:MV}let d=c(e),u=d(e);return{key:t,first:null,c(){n=$t("button"),u.c(),ue(n,"role",s=e[4]?"option":"menuitem"),ue(n,"aria-selected",i=e[4]?e[65]==e[5]:""),ue(n,"aria-label",r=e[28](e[63],e[8])),ue(n,"title",o=e[63].title),ue(n,"class",a="emoji "+(e[4]&&e[65]===e[5]?"active":"")),ue(n,"id",l="emo-"+e[63].id),this.first=n},m(f,m){gi(f,n,m),u.m(n,null)},p(f,m){e=f,d===(d=c(e))&&u?u.p(e,m):(u.d(1),u=d(e),u&&(u.c(),u.m(n,null))),m[0]&16&&s!==(s=e[4]?"option":"menuitem")&&ue(n,"role",s),m[0]&32816&&i!==(i=e[4]?e[65]==e[5]:"")&&ue(n,"aria-selected",i),m[0]&33024&&r!==(r=e[28](e[63],e[8]))&&ue(n,"aria-label",r),m[0]&32768&&o!==(o=e[63].title)&&ue(n,"title",o),m[0]&32816&&a!==(a="emoji "+(e[4]&&e[65]===e[5]?"active":""))&&ue(n,"class",a),m[0]&32768&&l!==(l="emo-"+e[63].id)&&ue(n,"id",l)},d(f){f&&_i(n),u.d()}}}function I3(t,e){let n,s=(e[4]?e[0].searchResultsLabel:e[66].category?e[66].category:e[15].length>1?e[0].categories.custom:e[0].categories[e[13].name])+"",i,r,o,a,l=[],c=new lc,d,u,f,m=e[66].emojis;const h=k=>k[63].id;for(let k=0;k<m.length;k+=1){let I=x3(e,m,k),L=h(I);c.set(L,l[k]=C3(L,I))}return{key:t,first:null,c(){n=$t("div"),i=Ci(s),a=$t("div");for(let k=0;k<l.length;k+=1)l[k].c();ue(n,"id",r="menu-label-"+e[65]),ue(n,"class",o="category "+(e[15].length===1&&e[15][0].category===""?"gone":"")),ue(n,"aria-hidden","true"),ue(a,"class","emoji-menu"),ue(a,"role",d=e[4]?"listbox":"menu"),ue(a,"aria-labelledby",u="menu-label-"+e[65]),ue(a,"id",f=e[4]?"search-results":""),this.first=n},m(k,I){gi(k,n,I),Gt(n,i),gi(k,a,I);for(let L=0;L<l.length;L+=1)l[L].m(a,null)},p(k,I){e=k,I[0]&40977&&s!==(s=(e[4]?e[0].searchResultsLabel:e[66].category?e[66].category:e[15].length>1?e[0].categories.custom:e[0].categories[e[13].name])+"")&&Ii(i,s),I[0]&32768&&r!==(r="menu-label-"+e[65])&&ue(n,"id",r),I[0]&32768&&o!==(o="category "+(e[15].length===1&&e[15][0].category===""?"gone":""))&&ue(n,"class",o),I[0]&402686256&&(m=e[66].emojis,l=ac(l,I,h,1,e,m,c,a,oc,C3,null,x3)),I[0]&16&&d!==(d=e[4]?"listbox":"menu")&&ue(a,"role",d),I[0]&32768&&u!==(u="menu-label-"+e[65])&&ue(a,"aria-labelledby",u),I[0]&16&&f!==(f=e[4]?"search-results":"")&&ue(a,"id",f)},d(k){k&&_i(n),k&&_i(a);for(let I=0;I<l.length;I+=1)l[I].d()}}}function OV(t){let e,n;return{c(){e=$t("img"),ue(e,"class","custom-emoji"),Yd(e.src,n=t[63].url)||ue(e,"src",n),ue(e,"alt",""),ue(e,"loading","lazy")},m(s,i){gi(s,e,i)},p(s,i){i[0]&1024&&!Yd(e.src,n=s[63].url)&&ue(e,"src",n)},d(s){s&&_i(e)}}}function LV(t){let e=t[27](t[63],t[8])+"",n;return{c(){n=Ci(e)},m(s,i){gi(s,n,i)},p(s,i){i[0]&1280&&e!==(e=s[27](s[63],s[8])+"")&&Ii(n,e)},d(s){s&&_i(n)}}}function k3(t,e){let n,s,i,r;function o(c,d){return c[63].unicode?LV:OV}let a=o(e),l=a(e);return{key:t,first:null,c(){n=$t("button"),l.c(),ue(n,"role","menuitem"),ue(n,"aria-label",s=e[28](e[63],e[8])),ue(n,"title",i=e[63].title),ue(n,"class","emoji"),ue(n,"id",r="fav-"+e[63].id),this.first=n},m(c,d){gi(c,n,d),l.m(n,null)},p(c,d){e=c,a===(a=o(e))&&l?l.p(e,d):(l.d(1),l=a(e),l&&(l.c(),l.m(n,null))),d[0]&1280&&s!==(s=e[28](e[63],e[8]))&&ue(n,"aria-label",s),d[0]&1024&&i!==(i=e[63].title)&&ue(n,"title",i),d[0]&1024&&r!==(r="fav-"+e[63].id)&&ue(n,"id",r)},d(c){c&&_i(n),l.d()}}}function PV(t){let e,n,s,i,r,o,a,l,c,d=t[0].searchLabel+"",u,f,m=t[0].searchDescription+"",h,k,I,L,p,C,P,M=t[0].skinToneDescription+"",F,_,S=[],x=new lc,v,w,b,y,A,T=[],U=new lc,W,j,K,g,R,ee,ne,xe,Ie=[],Me=new lc,be,ze,De,we,Xe,mt=[],E=new lc,N,V,$,G,te,le,Q=t[9];const se=ce=>ce[72];for(let ce=0;ce<Q.length;ce+=1){let _e=S3(t,Q,ce),ie=se(_e);x.set(ie,S[ce]=A3(ie,_e))}let X=t[12];const ve=ce=>ce[69].id;for(let ce=0;ce<X.length;ce+=1){let _e=T3(t,X,ce),ie=ve(_e);U.set(ie,T[ce]=R3(ie,_e))}let de=t[15];const ye=ce=>ce[66].category;for(let ce=0;ce<de.length;ce+=1){let _e=E3(t,de,ce),ie=ye(_e);Me.set(ie,Ie[ce]=I3(ie,_e))}let Re=t[10];const Le=ce=>ce[63].id;for(let ce=0;ce<Re.length;ce+=1){let _e=w3(t,Re,ce),ie=Le(_e);E.set(ie,mt[ce]=k3(ie,_e))}return{c(){e=$t("section"),n=$t("div"),s=$t("div"),i=$t("div"),r=$t("input"),c=$t("label"),u=Ci(d),f=$t("span"),h=Ci(m),k=$t("div"),I=$t("button"),L=Ci(t[21]),P=$t("span"),F=Ci(M),_=$t("div");for(let ce=0;ce<S.length;ce+=1)S[ce].c();A=$t("div");for(let ce=0;ce<T.length;ce+=1)T[ce].c();j=$t("div"),K=$t("div"),g=$t("div"),R=Ci(t[18]),ne=$t("div"),xe=$t("div");for(let ce=0;ce<Ie.length;ce+=1)Ie[ce].c();Xe=$t("div");for(let ce=0;ce<mt.length;ce+=1)mt[ce].c();$=$t("button"),$.textContent="\u{1F600}",ue(n,"class","pad-top"),ue(r,"id","search"),ue(r,"class","search"),ue(r,"type","search"),ue(r,"role","combobox"),ue(r,"enterkeyhint","search"),ue(r,"placeholder",o=t[0].searchLabel),ue(r,"autocapitalize","none"),ue(r,"autocomplete","off"),ue(r,"spellcheck","true"),ue(r,"aria-expanded",a=!!(t[4]&&t[1].length)),ue(r,"aria-controls","search-results"),ue(r,"aria-describedby","search-description"),ue(r,"aria-autocomplete","list"),ue(r,"aria-activedescendant",l=t[26]?`emo-${t[26]}`:""),ue(c,"class","sr-only"),ue(c,"for","search"),ue(f,"id","search-description"),ue(f,"class","sr-only"),ue(i,"class","search-wrapper"),ue(I,"id","skintone-button"),ue(I,"class",p="emoji "+(t[6]?"hide-focus":"")),ue(I,"aria-label",t[23]),ue(I,"title",t[23]),ue(I,"aria-describedby","skintone-description"),ue(I,"aria-haspopup","listbox"),ue(I,"aria-expanded",t[6]),ue(I,"aria-controls","skintone-list"),ue(k,"class",C="skintone-button-wrapper "+(t[19]?"expanded":"")),ue(P,"id","skintone-description"),ue(P,"class","sr-only"),ue(_,"id","skintone-list"),ue(_,"class",v="skintone-list "+(t[6]?"":"hidden no-animate")),gr(_,"transform","translateY("+(t[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),ue(_,"role","listbox"),ue(_,"aria-label",w=t[0].skinTonesLabel),ue(_,"aria-activedescendant",b="skintone-"+t[20]),ue(_,"aria-hidden",y=!t[6]),ue(s,"class","search-row"),ue(A,"class","nav"),ue(A,"role","tablist"),gr(A,"grid-template-columns","repeat("+t[12].length+", 1fr)"),ue(A,"aria-label",W=t[0].categoriesLabel),ue(K,"class","indicator"),gr(K,"transform","translateX("+(t[24]?-1:1)*t[11]*100+"%)"),ue(j,"class","indicator-wrapper"),ue(g,"class",ee="message "+(t[18]?"":"gone")),ue(g,"role","alert"),ue(g,"aria-live","polite"),ue(ne,"class",be="tabpanel "+(!t[14]||t[18]?"gone":"")),ue(ne,"role",ze=t[4]?"region":"tabpanel"),ue(ne,"aria-label",De=t[4]?t[0].searchResultsLabel:t[0].categories[t[13].name]),ue(ne,"id",we=t[4]?"":`tab-${t[13].id}`),ue(ne,"tabindex","0"),ue(Xe,"class",N="favorites emoji-menu "+(t[18]?"gone":"")),ue(Xe,"role","menu"),ue(Xe,"aria-label",V=t[0].favoritesLabel),gr(Xe,"padding-inline-end",t[25]+"px"),ue($,"aria-hidden","true"),ue($,"tabindex","-1"),ue($,"class","abs-pos hidden emoji"),ue(e,"class","picker"),ue(e,"aria-label",G=t[0].regionLabel),ue(e,"style",t[22])},m(ce,_e){gi(ce,e,_e),Gt(e,n),Gt(e,s),Gt(s,i),Gt(i,r),p3(r,t[2]),Gt(i,c),Gt(c,u),Gt(i,f),Gt(f,h),Gt(s,k),Gt(k,I),Gt(I,L),Gt(s,P),Gt(P,F),Gt(s,_);for(let ie=0;ie<S.length;ie+=1)S[ie].m(_,null);t[48](_),Gt(e,A);for(let ie=0;ie<T.length;ie+=1)T[ie].m(A,null);Gt(e,j),Gt(j,K),Gt(e,g),Gt(g,R),Gt(e,ne),Gt(ne,xe);for(let ie=0;ie<Ie.length;ie+=1)Ie[ie].m(xe,null);t[50](ne),Gt(e,Xe);for(let ie=0;ie<mt.length;ie+=1)mt[ie].m(Xe,null);Gt(e,$),t[51]($),t[52](e),te||(le=[ai(r,"input",t[47]),ai(r,"keydown",t[30]),ai(I,"click",t[35]),ai(_,"focusout",t[38]),ai(_,"click",t[34]),ai(_,"keydown",t[36]),ai(_,"keyup",t[37]),ai(A,"keydown",t[32]),ZH(t[29].call(null,xe)),ai(ne,"click",t[33]),ai(Xe,"click",t[33])],te=!0)},p(ce,_e){_e[0]&1&&o!==(o=ce[0].searchLabel)&&ue(r,"placeholder",o),_e[0]&18&&a!==(a=!!(ce[4]&&ce[1].length))&&ue(r,"aria-expanded",a),_e[0]&67108864&&l!==(l=ce[26]?`emo-${ce[26]}`:"")&&ue(r,"aria-activedescendant",l),_e[0]&4&&p3(r,ce[2]),_e[0]&1&&d!==(d=ce[0].searchLabel+"")&&Ii(u,d),_e[0]&1&&m!==(m=ce[0].searchDescription+"")&&Ii(h,m),_e[0]&2097152&&Ii(L,ce[21]),_e[0]&64&&p!==(p="emoji "+(ce[6]?"hide-focus":""))&&ue(I,"class",p),_e[0]&8388608&&ue(I,"aria-label",ce[23]),_e[0]&8388608&&ue(I,"title",ce[23]),_e[0]&64&&ue(I,"aria-expanded",ce[6]),_e[0]&524288&&C!==(C="skintone-button-wrapper "+(ce[19]?"expanded":""))&&ue(k,"class",C),_e[0]&1&&M!==(M=ce[0].skinToneDescription+"")&&Ii(F,M),_e[0]&1049089&&(Q=ce[9],S=ac(S,_e,se,1,ce,Q,x,_,oc,A3,null,S3)),_e[0]&64&&v!==(v="skintone-list "+(ce[6]?"":"hidden no-animate"))&&ue(_,"class",v),_e[0]&64&&gr(_,"transform","translateY("+(ce[6]?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))")+")"),_e[0]&1&&w!==(w=ce[0].skinTonesLabel)&&ue(_,"aria-label",w),_e[0]&1048576&&b!==(b="skintone-"+ce[20])&&ue(_,"aria-activedescendant",b),_e[0]&64&&y!==(y=!ce[6])&&ue(_,"aria-hidden",y),_e[0]&12305|_e[1]&1&&(X=ce[12],T=ac(T,_e,ve,1,ce,X,U,A,oc,R3,null,T3)),_e[0]&4096&&gr(A,"grid-template-columns","repeat("+ce[12].length+", 1fr)"),_e[0]&1&&W!==(W=ce[0].categoriesLabel)&&ue(A,"aria-label",W),_e[0]&16779264&&gr(K,"transform","translateX("+(ce[24]?-1:1)*ce[11]*100+"%)"),_e[0]&262144&&Ii(R,ce[18]),_e[0]&262144&&ee!==(ee="message "+(ce[18]?"":"gone"))&&ue(g,"class",ee),_e[0]&402694449&&(de=ce[15],Ie=ac(Ie,_e,ye,1,ce,de,Me,xe,oc,I3,null,E3)),_e[0]&278528&&be!==(be="tabpanel "+(!ce[14]||ce[18]?"gone":""))&&ue(ne,"class",be),_e[0]&16&&ze!==(ze=ce[4]?"region":"tabpanel")&&ue(ne,"role",ze),_e[0]&8209&&De!==(De=ce[4]?ce[0].searchResultsLabel:ce[0].categories[ce[13].name])&&ue(ne,"aria-label",De),_e[0]&8208&&we!==(we=ce[4]?"":`tab-${ce[13].id}`)&&ue(ne,"id",we),_e[0]&402654464&&(Re=ce[10],mt=ac(mt,_e,Le,1,ce,Re,E,Xe,oc,k3,null,w3)),_e[0]&262144&&N!==(N="favorites emoji-menu "+(ce[18]?"gone":""))&&ue(Xe,"class",N),_e[0]&1&&V!==(V=ce[0].favoritesLabel)&&ue(Xe,"aria-label",V),_e[0]&33554432&&gr(Xe,"padding-inline-end",ce[25]+"px"),_e[0]&1&&G!==(G=ce[0].regionLabel)&&ue(e,"aria-label",G),_e[0]&4194304&&ue(e,"style",ce[22])},i:hu,o:hu,d(ce){ce&&_i(e);for(let _e=0;_e<S.length;_e+=1)S[_e].d();t[48](null);for(let _e=0;_e<T.length;_e+=1)T[_e].d();for(let _e=0;_e<Ie.length;_e+=1)Ie[_e].d();t[50](null);for(let _e=0;_e<mt.length;_e+=1)mt[_e].d();t[51](null),t[52](null),te=!1,Zu(le)}}}function DV(t,e,n){let{skinToneEmoji:s}=e,{i18n:i}=e,{database:r}=e,{customEmoji:o}=e,{customCategorySorting:a}=e,l=!0,c=[],d=[],u="",f="",m,h,k,I=!1,L=-1,p,C=!1,P=!1,M,F=0,_=0,S,x,v="",w=[],b=[],y,A=mV,T=!1,U=0,W=0,j=Ch,K,g=!1,R;const ee=ie=>{m.getRootNode().getElementById(ie).focus()},ne=(ie,Ne)=>{m.dispatchEvent(new CustomEvent(ie,{detail:Ne,bubbles:!0,composed:!0}))},xe=(ie,Ne)=>Ne&&ie.skins&&ie.skins[Ne]||ie.unicode,Ie=(ie,Ne)=>kV([ie.name||xe(ie,Ne),...ie.shortcodes||[]]).join(", "),Me=ie=>/^skintone-/.test(ie.id);km.then(ie=>{ie||n(18,p=i.emojiUnsupportedMessage)});function be(ie){return CV(ie,Ne=>{{const O=getComputedStyle(m),B=parseInt(O.getPropertyValue("--num-columns"),10),q=O.getPropertyValue("direction")==="rtl",Y=ie.parentElement.getBoundingClientRect().width-Ne;n(46,A=B),n(25,U=Y),n(24,T=q)}})}function ze(ie){const Ne=m.getRootNode();IV(ie,h,B=>Ne.getElementById(`emo-${B.id}`)),n(1,c=c)}function De(ie){return!ie.unicode||!v3(ie)||Ip.get(ie.unicode)}async function we(ie){const Ne=await km;return ie.filter(({version:O})=>!O||O<=Ne)}async function Xe(ie){return AV(ie,await km)}async function mt(ie){if(typeof ie=="undefined")return[];const Ne=ie===-1?o:await r.getEmojiByGroup(ie);return Xe(await we(Ne))}async function E(ie){return Xe(await we(await r.getEmojiBySearchQuery(ie)))}function N(ie){if(!I||!c.length)return;const Ne=O=>{_r(ie),n(5,L=Mm(O,L,c))};switch(ie.key){case"ArrowDown":return Ne(!1);case"ArrowUp":return Ne(!0);case"Enter":if(L!==-1)return _r(ie),G(c[L].id);c.length&&n(5,L=0)}}function V(ie){n(2,u=""),n(44,f=""),n(5,L=-1),n(11,W=j.findIndex(Ne=>Ne.id===ie.id))}function $(ie){const{target:Ne,key:O}=ie,B=q=>{q&&(_r(ie),q.focus())};switch(O){case"ArrowLeft":return B(Ne.previousSibling);case"ArrowRight":return B(Ne.nextSibling);case"Home":return B(Ne.parentElement.firstChild);case"End":return B(Ne.parentElement.lastChild)}}async function G(ie){const Ne=await r.getEmojiByUnicodeOrName(ie),O=[...c,...b].find(q=>q.id===ie),B=O.unicode&&xe(O,F);await r.incrementFavoriteEmojiCount(ie),ne("emoji-click",{emoji:Ne,skinTone:F,...B&&{unicode:B},...O.name&&{name:O.name}})}async function te(ie){const{target:Ne}=ie;if(!Ne.classList.contains("emoji"))return;_r(ie);const O=Ne.id.substring(4);G(O)}async function le(ie){const{target:Ne}=ie;if(!Me(Ne))return;_r(ie);const O=parseInt(Ne.id.slice(9),10);n(8,F=O),n(6,C=!1),ee("skintone-button"),ne("skin-tone-change",{skinTone:O}),r.setPreferredSkinTone(O)}async function Q(ie){n(6,C=!C),n(20,_=F),C&&(_r(ie),Zh(()=>ee(`skintone-${_}`)))}function se(ie){if(!C)return;const Ne=async O=>{_r(ie),n(20,_=O),await JH(),ee(`skintone-${_}`)};switch(ie.key){case"ArrowUp":return Ne(Mm(!0,_,w));case"ArrowDown":return Ne(Mm(!1,_,w));case"Home":return Ne(0);case"End":return Ne(w.length-1);case"Enter":return le(ie);case"Escape":return _r(ie),n(6,C=!1),ee("skintone-button")}}function X(ie){if(!!C)switch(ie.key){case" ":return le(ie)}}async function ve(ie){const{relatedTarget:Ne}=ie;(!Ne||!Me(Ne))&&n(6,C=!1)}function de(){u=this.value,n(2,u)}function ye(ie){Oa[ie?"unshift":"push"](()=>{M=ie,n(7,M)})}const Re=ie=>V(ie);function Le(ie){Oa[ie?"unshift":"push"](()=>{k=ie,n(3,k)})}function ce(ie){Oa[ie?"unshift":"push"](()=>{h=ie,n(17,h)})}function _e(ie){Oa[ie?"unshift":"push"](()=>{m=ie,n(16,m)})}return t.$$set=ie=>{"skinToneEmoji"in ie&&n(40,s=ie.skinToneEmoji),"i18n"in ie&&n(0,i=ie.i18n),"database"in ie&&n(39,r=ie.database),"customEmoji"in ie&&n(41,o=ie.customEmoji),"customCategorySorting"in ie&&n(42,a=ie.customCategorySorting)},t.$$.update=()=>{if(t.$$.dirty[1]&1280&&o&&r&&n(39,r.customEmoji=o,r),t.$$.dirty[0]&1|t.$$.dirty[1]&256){async function Ne(){let O=!1;const B=setTimeout(()=>{O=!0,n(18,p=i.loadingMessage)},dV);try{await r.ready(),n(14,g=!0)}catch(q){console.error(q),n(18,p=i.networkErrorMessage)}finally{clearTimeout(B),O&&(O=!1,n(18,p=""))}}r&&Ne()}if(t.$$.dirty[0]&6144|t.$$.dirty[1]&1024&&(o&&o.length?n(12,j=[cV,...Ch]):j!==Ch&&(W&&n(11,W--,W),n(12,j=Ch))),t.$$.dirty[0]&4&&dS(()=>{n(44,f=(u||"").trim()),n(5,L=-1)}),t.$$.dirty[0]&6144&&n(13,K=j[W]),t.$$.dirty[0]&24576|t.$$.dirty[1]&8192){async function Ne(){if(!g)n(1,c=[]),n(4,I=!1);else if(f.length>=uV){const O=f,B=await E(O);O===f&&(n(1,c=B),n(4,I=!0))}else if(K){const O=K.id,B=await mt(O);O===K.id&&(n(1,c=B),n(4,I=!1))}}Ne()}if(t.$$.dirty[0]&4112&&n(22,x=`
  --font-family: ${fS};
  --num-groups: ${j.length}; 
  --indicator-opacity: ${I?0:1}; 
  --num-skintones: ${_3};`),t.$$.dirty[0]&16384|t.$$.dirty[1]&256){async function Ne(){g&&n(8,F=await r.getPreferredSkinTone())}Ne()}if(t.$$.dirty[1]&512&&n(9,w=Array(_3).fill().map((Ne,O)=>SV(s,O))),t.$$.dirty[0]&768&&n(21,S=w[F]),t.$$.dirty[0]&257&&n(23,v=i.skinToneLabel.replace("{skinTone}",i.skinTones[F])),t.$$.dirty[0]&16384|t.$$.dirty[1]&256){async function Ne(){n(45,y=(await Promise.all(pV.map(O=>r.getEmojiByUnicodeOrName(O)))).filter(Boolean))}g&&Ne()}if(t.$$.dirty[0]&16384|t.$$.dirty[1]&49408){async function Ne(){const O=await r.getTopFavoriteEmoji(A),B=await Xe(mS([...O,...y],q=>q.unicode||q.name).slice(0,A));n(10,b=B)}g&&y&&Ne()}if(t.$$.dirty[0]&10){const Ne=c.filter(O=>O.unicode).filter(O=>v3(O)&&!Ip.has(O.unicode));Ne.length?Zh(()=>ze(Ne)):(n(1,c=c.filter(De)),Zh(()=>{(k||{}).scrollTop=0}))}if(t.$$.dirty[0]&1026|t.$$.dirty[1]&4096,t.$$.dirty[0]&18|t.$$.dirty[1]&2048){let Ne=function(){if(I)return[{category:"",emojis:c}];const O=new Map;for(const B of c){const q=B.category||"";let z=O.get(q);z||(z=[],O.set(q,z)),z.push(B)}return[...O.entries()].map(([B,q])=>({category:B,emojis:q})).sort((B,q)=>a(B.category,q.category))};var ie=Ne;n(15,d=Ne())}t.$$.dirty[0]&34&&n(26,R=L!==-1&&c[L].id),t.$$.dirty[0]&192&&(C?M.addEventListener("transitionend",()=>{n(19,P=!0)},{once:!0}):n(19,P=!1))},[i,c,u,k,I,L,C,M,F,w,b,W,j,K,g,d,m,h,p,P,_,S,x,v,T,U,R,xe,Ie,be,N,V,$,te,le,Q,se,X,ve,r,s,o,a,l,f,y,A,de,ye,Re,Le,ce,_e]}class BV extends lV{constructor(e){super(),aV(this,e,DV,PV,XH,{skinToneEmoji:40,i18n:0,database:39,customEmoji:41,customCategorySorting:42},null,[-1,-1,-1])}}const FV="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",UV="en";var jV={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading\u2026",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}};const pS=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji"];class gS extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const n=document.createElement("style");n.textContent=":host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.custom-emoji,.emoji,button.emoji{height:var(--total-emoji-size);width:var(--total-emoji-size)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;line-height:1;overflow:hidden;font-family:var(--font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.custom-emoji{padding:var(--emoji-padding);object-fit:contain;pointer-events:none;background-repeat:no-repeat;background-position:center center;background-size:var(--emoji-size) var(--emoji-size)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}",this.shadowRoot.appendChild(n),this._ctx={locale:UV,dataSource:FV,skinToneEmoji:fV,customCategorySorting:gV,customEmoji:null,i18n:jV,...e};for(const s of pS)s!=="database"&&Object.prototype.hasOwnProperty.call(this,s)&&(this._ctx[s]=this[s],delete this[s]);this._dbFlush()}connectedCallback(){this._cmp=new BV({target:this.shadowRoot,props:this._ctx})}disconnectedCallback(){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e&&e.close().catch(n=>console.error(n))}static get observedAttributes(){return["locale","data-source","skin-tone-emoji"]}attributeChangedCallback(e,n,s){this._set(e.replace(/-([a-z])/g,(i,r)=>r.toUpperCase()),s)}_set(e,n){this._ctx[e]=n,this._cmp&&this._cmp.$set({[e]:n}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:n,database:s}=this._ctx;(!s||s.locale!==e||s.dataSource!==n)&&this._set("database",new rS({locale:e,dataSource:n}))}_dbFlush(){Promise.resolve().then(()=>this._dbCreate())}}const _S={};for(const t of pS)_S[t]={get(){return t==="database"&&this._dbCreate(),this._ctx[t]},set(e){if(t==="database")throw new Error("database is read-only");this._set(t,e)}};Object.defineProperties(gS.prototype,_S);customElements.get("emoji-picker")||customElements.define("emoji-picker",gS);const HV={name:"EmojiPickerContainer",components:{SvgIcon:Un},props:{emojiOpened:{type:Boolean,default:!1},emojiReaction:{type:Boolean,default:!1},positionTop:{type:Boolean,default:!1},positionRight:{type:Boolean,default:!1}},emits:["add-emoji","open-emoji"],data(){return{emojiPickerHeight:320,emojiPickerTop:0,emojiPickerRight:""}},watch:{emojiOpened(t){t&&setTimeout(()=>{this.addCustomStyling(),this.$refs.emojiPicker.shadowRoot.addEventListener("emoji-click",({detail:e})=>{this.$emit("add-emoji",{unicode:e.unicode})})},0)}},methods:{addCustomStyling(){const t=`.picker {
				border: none;
			}`,e=`.nav {
				overflow-x: auto;
			}`,n=`.search-wrapper {
				padding-right: 2px;
				padding-left: 2px;
			}`,s=`input.search {
				height: 32px;
				font-size: 14px;
				border-radius: 10rem;
				border: var(--chat-border-style);
				padding: 5px 10px;
				outline: none;
				background: var(--chat-bg-color-input);
				color: var(--chat-color);
			}`,i=document.createElement("style");i.textContent=t+e+n+s,this.$refs.emojiPicker.shadowRoot.appendChild(i)},openEmoji(t){this.$emit("open-emoji",!this.emojiOpened),this.setEmojiPickerPosition(t.clientY,t.view.innerWidth,t.view.innerHeight)},setEmojiPickerPosition(t,e,n){const s=e<500||n<700,i=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!i){s&&(this.emojiPickerRight="-50px");return}s?(this.emojiPickerRight=e/2-(this.positionTop?200:150)+"px",this.emojiPickerTop=100,this.emojiPickerHeight=n-200):(i.getBoundingClientRect().top-t>this.emojiPickerHeight-50?this.emojiPickerTop=t+10:this.emojiPickerTop=t-this.emojiPickerHeight-10,this.emojiPickerRight=this.positionTop?"0px":this.positionRight?"60px":"")}}},VV={class:"vac-emoji-wrapper"},qV={ref:"emojiPicker","v-if":"emojiOpened"};function $V(t,e,n,s,i,r){const o=et("svg-icon");return re(),ge("div",VV,[Ce("div",{class:yt(["vac-svg-button",{"vac-emoji-reaction":n.emojiReaction}]),onClick:e[0]||(e[0]=(...a)=>r.openEmoji&&r.openEmoji(...a))},[je(t.$slots,"emoji-picker-icon",{},()=>[Ue(o,{name:"emoji",param:n.emojiReaction?"reaction":""},null,8,["param"])])],2),n.emojiOpened?(re(),Ut(gn,{key:0,name:"vac-slide-up",appear:""},{default:Je(()=>[Ce("div",{class:yt(["vac-emoji-picker",{"vac-picker-reaction":n.emojiReaction}]),style:Lt({height:`${i.emojiPickerHeight}px`,top:n.positionTop?i.emojiPickerHeight:`${i.emojiPickerTop}px`,right:i.emojiPickerRight,display:i.emojiPickerTop||!n.emojiReaction?"initial":"none"})},[Ce("emoji-picker",qV,null,512)],6)]),_:1})):He("",!0)])}var vS=qt(HV,[["render",$V]]);const zV={name:"RoomFiles",components:{Loader:v0,SvgIcon:Un},props:{file:{type:Object,required:!0},index:{type:Number,required:!0}},emits:["remove-file"],computed:{isImage(){return fl(this.file)},isVideo(){return Qu(this.file)}}},KV={class:"vac-room-file-container"},GV=["src"],WV={class:"vac-text-ellipsis"},YV={key:0,class:"vac-text-ellipsis vac-text-extension"};function XV(t,e,n,s,i,r){const o=et("loader"),a=et("svg-icon");return re(),ge("div",KV,[Ue(o,{show:n.file.loading},Jt({_:2},[gt(t.$slots,(l,c)=>({name:c,fn:Je(d=>[je(t.$slots,c,pt(ft(d)))])}))]),1032,["show"]),Ce("div",{class:"vac-svg-button vac-icon-remove",onClick:e[0]||(e[0]=l=>t.$emit("remove-file",n.index))},[je(t.$slots,"image-close-icon",{},()=>[Ue(a,{name:"close",param:"image"})])]),r.isImage?(re(),ge("div",{key:0,class:yt(["vac-message-image",{"vac-blur-loading":n.file.loading}]),style:Lt({"background-image":`url('${n.file.localUrl||n.file.url}')`})},null,6)):r.isVideo?(re(),ge("video",{key:1,controls:"",class:yt({"vac-blur-loading":n.file.loading})},[Ce("source",{src:n.file.localUrl||n.file.url},null,8,GV)],2)):(re(),ge("div",{key:2,class:yt(["vac-file-container",{"vac-blur-loading":n.file.loading}])},[Ce("div",null,[je(t.$slots,"file-icon",{},()=>[Ue(a,{name:"file"})])]),Ce("div",WV,ot(n.file.name),1),n.file.extension?(re(),ge("div",YV,ot(n.file.extension),1)):He("",!0)],2))])}var QV=qt(zV,[["render",XV]]);const ZV={name:"RoomFiles",components:{SvgIcon:Un,RoomFile:QV},props:{files:{type:Array,required:!0}},emits:["remove-file","reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}}},JV={class:"vac-files-box"},eq={class:"vac-icon-close"};function tq(t,e,n,s,i,r){const o=et("room-file"),a=et("svg-icon");return re(),Ut(gn,{name:"vac-slide-up"},{default:Je(()=>[n.files.length?(re(),ge("div",{key:0,class:"vac-room-files-container",style:Lt({bottom:`${r.footerHeight}px`})},[Ce("div",JV,[(re(!0),ge(kt,null,gt(n.files,(l,c)=>(re(),ge("div",{key:c},[Ue(o,{file:l,index:c,onRemoveFile:e[0]||(e[0]=d=>t.$emit("remove-file",d))},null,8,["file","index"])]))),128))]),Ce("div",eq,[Ce("div",{class:"vac-svg-button",onClick:e[1]||(e[1]=l=>t.$emit("reset-message"))},[je(t.$slots,"reply-close-icon",{},()=>[Ue(a,{name:"close-outline"})])])])],4)):He("",!0)]),_:3})}var nq=qt(ZV,[["render",tq]]);const sq={props:{percentage:{type:Number,default:0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","change-linehead"],data(){return{isMouseDown:!1}},methods:{onMouseDown(t){if(this.messageSelectionEnabled)return;this.isMouseDown=!0;const e=this.calculateLineHeadPosition(t,this.$refs.progress);this.$emit("change-linehead",e),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},onMouseUp(t){if(this.messageSelectionEnabled)return;this.isMouseDown=!1,document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove);const e=this.calculateLineHeadPosition(t,this.$refs.progress);this.$emit("change-linehead",e)},onMouseMove(t){if(this.messageSelectionEnabled)return;const e=this.calculateLineHeadPosition(t,this.$refs.progress);this.$emit("change-linehead",e)},calculateLineHeadPosition(t,e){const n=e.getBoundingClientRect().width,s=e.getBoundingClientRect().left;let i=(t.clientX-s)/n;return i=i<0?0:i,i=i>1?1:i,i}}},iq={class:"vac-player-progress"},rq={class:"vac-line-container"};function oq(t,e,n,s,i,r){return re(),ge("div",{ref:"progress",class:"vac-player-bar",onMousedown:e[0]||(e[0]=(...o)=>r.onMouseDown&&r.onMouseDown(...o)),onMouseover:e[1]||(e[1]=o=>t.$emit("hover-audio-progress",!0)),onMouseout:e[2]||(e[2]=o=>t.$emit("hover-audio-progress",!1))},[Ce("div",iq,[Ce("div",rq,[Ce("div",{class:"vac-line-progress",style:Lt({width:`${n.percentage}%`})},null,4),Ce("div",{class:yt(["vac-line-dot",{"vac-line-dot__active":i.isMouseDown}]),style:Lt({left:`${n.percentage}%`})},null,6)])])],544)}var aq=qt(sq,[["render",oq]]);const lq={name:"AudioPlayer",components:{SvgIcon:Un,AudioControl:aq},props:{messageId:{type:[String,Number],default:null},src:{type:String,default:null},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["hover-audio-progress","update-progress-time"],data(){return{isPlaying:!1,duration:this.convertTimeMMSS(0),playedTime:this.convertTimeMMSS(0),progress:0}},computed:{playerUniqId(){return`audio-player${this.messageId}`},audioSource(){return this.src?this.src:(this.resetProgress(),null)}},mounted(){this.player=document.querySelector("vue-advanced-chat").shadowRoot.getElementById(this.playerUniqId),this.player.addEventListener("ended",()=>{this.isPlaying=!1}),this.player.addEventListener("loadeddata",()=>{this.resetProgress(),this.duration=this.convertTimeMMSS(this.player.duration),this.updateProgressTime()}),this.player.addEventListener("timeupdate",this.onTimeUpdate)},methods:{convertTimeMMSS(t){return new Date(t*1e3).toISOString().substr(14,5)},playback(){this.messageSelectionEnabled||!this.audioSource||(this.isPlaying?this.player.pause():setTimeout(()=>this.player.play()),this.isPlaying=!this.isPlaying)},resetProgress(){this.isPlaying&&this.player.pause(),this.duration=this.convertTimeMMSS(0),this.playedTime=this.convertTimeMMSS(0),this.progress=0,this.isPlaying=!1,this.updateProgressTime()},onTimeUpdate(){this.playedTime=this.convertTimeMMSS(this.player.currentTime),this.progress=this.player.currentTime/this.player.duration*100,this.updateProgressTime()},onUpdateProgress(t){t&&(this.player.currentTime=t*this.player.duration)},updateProgressTime(){this.$emit("update-progress-time",this.progress>1?this.playedTime:this.duration)}}},cq={class:"vac-audio-player"},uq=["id","src"];function hq(t,e,n,s,i,r){const o=et("svg-icon"),a=et("audio-control");return re(),ge("div",null,[Ce("div",cq,[Ce("div",{class:"vac-svg-button",onClick:e[0]||(e[0]=(...l)=>r.playback&&r.playback(...l))},[i.isPlaying?je(t.$slots,"audio-pause-icon",{key:0},()=>[Ue(o,{name:"audio-pause"})]):je(t.$slots,"audio-play-icon",{key:1},()=>[Ue(o,{name:"audio-play"})])]),Ue(a,{percentage:i.progress,"message-selection-enabled":n.messageSelectionEnabled,onChangeLinehead:r.onUpdateProgress,onHoverAudioProgress:e[1]||(e[1]=l=>t.$emit("hover-audio-progress",l))},null,8,["percentage","message-selection-enabled","onChangeLinehead"]),Ce("audio",{id:r.playerUniqId,src:r.audioSource},null,8,uq)])])}var Vv=qt(lq,[["render",hq]]);const dq={name:"RoomMessageReply",components:{SvgIcon:Un,FormatMessage:Xu,AudioPlayer:Vv},props:{room:{type:Object,required:!0},messageReply:{type:Object,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0}},emits:["reset-message"],computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight},firstFile(){var t,e;return(e=(t=this.messageReply)==null?void 0:t.files)!=null&&e.length?this.messageReply.files[0]:{}},isImage(){return fl(this.firstFile)},isVideo(){return Qu(this.firstFile)},isAudio(){return C0(this.firstFile)},isOtherFile(){var t,e;return((e=(t=this.messageReply)==null?void 0:t.files)==null?void 0:e.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},fq={class:"vac-reply-box"},mq={class:"vac-reply-info"},pq={class:"vac-reply-username"},gq={class:"vac-reply-content"},_q=["src"],vq={key:1,controls:"",class:"vac-image-reply"},yq=["src"],bq={key:3,class:"vac-image-reply vac-file-container"},wq={class:"vac-text-ellipsis"},Eq={key:0,class:"vac-text-ellipsis vac-text-extension"},xq={class:"vac-icon-reply"};function Tq(t,e,n,s,i,r){const o=et("format-message"),a=et("audio-player"),l=et("svg-icon");return re(),Ut(gn,{name:"vac-slide-up"},{default:Je(()=>[n.messageReply?(re(),ge("div",{key:0,class:"vac-reply-container",style:Lt({bottom:`${r.footerHeight}px`})},[Ce("div",fq,[Ce("div",mq,[Ce("div",pq,ot(n.messageReply.username),1),Ce("div",gq,[Ue(o,{content:n.messageReply.content,users:n.room.users,"text-formatting":n.textFormatting,"link-options":n.linkOptions,reply:!0},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["content","users","text-formatting","link-options"])])]),r.isImage?(re(),ge("img",{key:0,src:r.firstFile.url,class:"vac-image-reply"},null,8,_q)):r.isVideo?(re(),ge("video",vq,[Ce("source",{src:r.firstFile.url},null,8,yq)])):r.isAudio?(re(),Ut(a,{key:2,src:r.firstFile.url,class:"vac-audio-reply"},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["src"])):r.isOtherFile?(re(),ge("div",bq,[Ce("div",null,[je(t.$slots,"file-icon",{},()=>[Ue(l,{name:"file"})])]),Ce("div",wq,ot(r.firstFile.name),1),r.firstFile.extension?(re(),ge("div",Eq,ot(r.firstFile.extension),1)):He("",!0)])):He("",!0)]),Ce("div",xq,[Ce("div",{class:"vac-svg-button",onClick:e[0]||(e[0]=c=>t.$emit("reset-message"))},[je(t.$slots,"reply-close-icon",{},()=>[Ue(l,{name:"close-outline"})])])])],4)):He("",!0)]),_:3})}var Sq=qt(dq,[["render",Tq]]);const Aq={name:"RoomUsersTag",props:{filteredUsersTag:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-user-tag","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredUsersTag(t,e){(!e.length||t.length!==e.length)&&(this.activeItem=0)},selectItem(t){t&&this.$emit("select-user-tag",this.filteredUsersTag[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredUsersTag.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},Rq=["onMouseover","onClick"],Cq={class:"vac-tags-info"},Iq={class:"vac-tags-username"};function kq(t,e,n,s,i,r){return re(),Ut(gn,{name:"vac-slide-up"},{default:Je(()=>[n.filteredUsersTag.length?(re(),ge("div",{key:0,class:"vac-tags-container",style:Lt({bottom:`${r.footerHeight}px`})},[(re(!0),ge(kt,null,gt(n.filteredUsersTag,(o,a)=>(re(),ge("div",{key:o._id,class:yt(["vac-tags-box",{"vac-tags-box-active":a===i.activeItem}]),onMouseover:l=>i.activeItem=a,onClick:l=>t.$emit("select-user-tag",o)},[Ce("div",Cq,[o.avatar?(re(),ge("div",{key:0,class:"vac-avatar vac-tags-avatar",style:Lt({"background-image":`url('${o.avatar}')`})},null,4)):He("",!0),Ce("div",Iq,ot(o.username),1)])],42,Rq))),128))],4)):He("",!0)]),_:1})}var Mq=qt(Aq,[["render",kq]]);const Nq={name:"RoomEmojis",props:{filteredEmojis:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-emoji","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredEmojis(t,e){(!e.length||t.length!==e.length)&&(this.activeItem=0)},selectItem(t){t&&this.$emit("select-emoji",this.filteredEmojis[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredEmojis.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},Oq=["onMouseover","onClick"];function Lq(t,e,n,s,i,r){return re(),Ut(gn,{name:"vac-slide-up"},{default:Je(()=>[n.filteredEmojis.length?(re(),ge("div",{key:0,class:"vac-emojis-container",style:Lt({bottom:`${r.footerHeight}px`})},[(re(!0),ge(kt,null,gt(n.filteredEmojis,(o,a)=>(re(),ge("div",{key:o,class:yt(["vac-emoji-element",{"vac-emoji-element-active":a===i.activeItem}]),onMouseover:l=>i.activeItem=a,onClick:l=>t.$emit("select-emoji",o)},ot(o),43,Oq))),128))],4)):He("",!0)]),_:1})}var Pq=qt(Nq,[["render",Lq]]);const Dq={name:"RoomTemplatesText",props:{filteredTemplatesText:{type:Array,required:!0},selectItem:{type:Boolean,default:null},activeUpOrDown:{type:Number,default:null}},emits:["select-template-text","activate-item"],data(){return{activeItem:null}},computed:{footerHeight(){return document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer").clientHeight}},watch:{filteredTemplatesText(t,e){(!e.length||t.length!==e.length)&&(this.activeItem=0)},selectItem(t){t&&this.$emit("select-template-text",this.filteredTemplatesText[this.activeItem])},activeUpOrDown(){this.activeUpOrDown>0&&this.activeItem<this.filteredTemplatesText.length-1?this.activeItem++:this.activeUpOrDown<0&&this.activeItem>0&&this.activeItem--,this.$emit("activate-item")}}},Bq=["onMouseover","onClick"],Fq={class:"vac-template-info"},Uq={class:"vac-template-tag"},jq={class:"vac-template-text"};function Hq(t,e,n,s,i,r){return re(),Ut(gn,{name:"vac-slide-up"},{default:Je(()=>[n.filteredTemplatesText.length?(re(),ge("div",{key:0,class:"vac-template-container vac-app-box-shadow",style:Lt({bottom:`${r.footerHeight}px`})},[(re(!0),ge(kt,null,gt(n.filteredTemplatesText,(o,a)=>(re(),ge("div",{key:a,class:yt(["vac-template-box",{"vac-template-active":a===i.activeItem}]),onMouseover:l=>i.activeItem=a,onClick:l=>t.$emit("select-template-text",o)},[Ce("div",Fq,[Ce("div",Uq," /"+ot(o.tag),1),Ce("div",jq,ot(o.text),1)])],42,Bq))),128))],4)):He("",!0)]),_:1})}var Vq=qt(Dq,[["render",Hq]]);function qq(t){return new Int8Array(t)}function yS(t){return new Int16Array(t)}function bS(t){return new Int32Array(t)}function wS(t){return new Float32Array(t)}function $q(t){return new Float64Array(t)}function ES(t){if(t.length==1)return wS(t[0]);var e=t[0];t=t.slice(1);for(var n=[],s=0;s<e;s++)n.push(ES(t));return n}function xS(t){if(t.length==1)return bS(t[0]);var e=t[0];t=t.slice(1);for(var n=[],s=0;s<e;s++)n.push(xS(t));return n}function TS(t){if(t.length==1)return yS(t[0]);var e=t[0];t=t.slice(1);for(var n=[],s=0;s<e;s++)n.push(TS(t));return n}function SS(t){if(t.length==1)return new Array(t[0]);var e=t[0];t=t.slice(1);for(var n=[],s=0;s<e;s++)n.push(SS(t));return n}var AS={};AS.fill=function(t,e,n,s){if(arguments.length==2)for(var i=0;i<t.length;i++)t[i]=arguments[1];else for(var i=e;i<n;i++)t[i]=s};var Ju={};Ju.arraycopy=function(t,e,n,s,i){for(var r=e+i;e<r;)n[s++]=t[e++]};Ju.out={};Ju.out.println=function(t){console.log(t)};Ju.out.printf=function(){console.log.apply(console,arguments)};var I0={};I0.SQRT2=1.4142135623730951;I0.FAST_LOG10=function(t){return Math.log10(t)};I0.FAST_LOG10_X=function(t,e){return Math.log10(t)*e};function lr(t){this.ordinal=t}lr.short_block_allowed=new lr(0);lr.short_block_coupled=new lr(1);lr.short_block_dispensed=new lr(2);lr.short_block_forced=new lr(3);var RS={};RS.MAX_VALUE=34028235e31;function $s(t){this.ordinal=t}$s.vbr_off=new $s(0);$s.vbr_mt=new $s(1);$s.vbr_rh=new $s(2);$s.vbr_abr=new $s(3);$s.vbr_mtrh=new $s(4);$s.vbr_default=$s.vbr_mtrh;var zq=function(t){},Oe={System:Ju,VbrMode:$s,Float:RS,ShortBlock:lr,Util:I0,Arrays:AS,new_array_n:SS,new_byte:qq,new_double:$q,new_float:wS,new_float_n:ES,new_int:bS,new_int_n:xS,new_short:yS,new_short_n:TS,assert:zq},Kq=Oe.System,hn=Oe.Util,Gq=Oe.Arrays,Wq=Oe.new_float;function Yq(){var t=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*hn.SQRT2*.5/2384e-9,.017876148*hn.SQRT2*.5/2384e-9,.003134727*hn.SQRT2*.5/2384e-9,.002457142*hn.SQRT2*.5/2384e-9,971317e-9*hn.SQRT2*.5/2384e-9,218868e-9*hn.SQRT2*.5/2384e-9,101566e-9*hn.SQRT2*.5/2384e-9,13828e-9*hn.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],e=12,n=36,s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],i=s[D.SHORT_TYPE],r=s[D.SHORT_TYPE],o=s[D.SHORT_TYPE],a=s[D.SHORT_TYPE],l=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function c(f,m,h){for(var k=10,I=m+238-14-286,L=-15;L<0;L++){var p,C,P;p=t[k+-10],C=f[I+-224]*p,P=f[m+224]*p,p=t[k+-9],C+=f[I+-160]*p,P+=f[m+160]*p,p=t[k+-8],C+=f[I+-96]*p,P+=f[m+96]*p,p=t[k+-7],C+=f[I+-32]*p,P+=f[m+32]*p,p=t[k+-6],C+=f[I+32]*p,P+=f[m+-32]*p,p=t[k+-5],C+=f[I+96]*p,P+=f[m+-96]*p,p=t[k+-4],C+=f[I+160]*p,P+=f[m+-160]*p,p=t[k+-3],C+=f[I+224]*p,P+=f[m+-224]*p,p=t[k+-2],C+=f[m+-256]*p,P-=f[I+256]*p,p=t[k+-1],C+=f[m+-192]*p,P-=f[I+192]*p,p=t[k+0],C+=f[m+-128]*p,P-=f[I+128]*p,p=t[k+1],C+=f[m+-64]*p,P-=f[I+64]*p,p=t[k+2],C+=f[m+0]*p,P-=f[I+0]*p,p=t[k+3],C+=f[m+64]*p,P-=f[I+-64]*p,p=t[k+4],C+=f[m+128]*p,P-=f[I+-128]*p,p=t[k+5],C+=f[m+192]*p,P-=f[I+-192]*p,C*=t[k+6],p=P-C,h[30+L*2]=P+C,h[31+L*2]=t[k+7]*p,k+=18,m--,I++}{var C,P,M,F;P=f[m+-16]*t[k+-10],C=f[m+-32]*t[k+-2],P+=(f[m+-48]-f[m+16])*t[k+-9],C+=f[m+-96]*t[k+-1],P+=(f[m+-80]+f[m+48])*t[k+-8],C+=f[m+-160]*t[k+0],P+=(f[m+-112]-f[m+80])*t[k+-7],C+=f[m+-224]*t[k+1],P+=(f[m+-144]+f[m+112])*t[k+-6],C-=f[m+32]*t[k+2],P+=(f[m+-176]-f[m+144])*t[k+-5],C-=f[m+96]*t[k+3],P+=(f[m+-208]+f[m+176])*t[k+-4],C-=f[m+160]*t[k+4],P+=(f[m+-240]-f[m+208])*t[k+-3],C-=f[m+224],M=C-P,F=C+P,P=h[14],C=h[15]-P,h[31]=F+P,h[30]=M+C,h[15]=M-C,h[14]=F-P}{var _;_=h[28]-h[0],h[0]+=h[28],h[28]=_*t[k+-2*18+7],_=h[29]-h[1],h[1]+=h[29],h[29]=_*t[k+-2*18+7],_=h[26]-h[2],h[2]+=h[26],h[26]=_*t[k+-4*18+7],_=h[27]-h[3],h[3]+=h[27],h[27]=_*t[k+-4*18+7],_=h[24]-h[4],h[4]+=h[24],h[24]=_*t[k+-6*18+7],_=h[25]-h[5],h[5]+=h[25],h[25]=_*t[k+-6*18+7],_=h[22]-h[6],h[6]+=h[22],h[22]=_*hn.SQRT2,_=h[23]-h[7],h[7]+=h[23],h[23]=_*hn.SQRT2-h[7],h[7]-=h[6],h[22]-=h[7],h[23]-=h[22],_=h[6],h[6]=h[31]-_,h[31]=h[31]+_,_=h[7],h[7]=h[30]-_,h[30]=h[30]+_,_=h[22],h[22]=h[15]-_,h[15]=h[15]+_,_=h[23],h[23]=h[14]-_,h[14]=h[14]+_,_=h[20]-h[8],h[8]+=h[20],h[20]=_*t[k+-10*18+7],_=h[21]-h[9],h[9]+=h[21],h[21]=_*t[k+-10*18+7],_=h[18]-h[10],h[10]+=h[18],h[18]=_*t[k+-12*18+7],_=h[19]-h[11],h[11]+=h[19],h[19]=_*t[k+-12*18+7],_=h[16]-h[12],h[12]+=h[16],h[16]=_*t[k+-14*18+7],_=h[17]-h[13],h[13]+=h[17],h[17]=_*t[k+-14*18+7],_=-h[20]+h[24],h[20]+=h[24],h[24]=_*t[k+-12*18+7],_=-h[21]+h[25],h[21]+=h[25],h[25]=_*t[k+-12*18+7],_=h[4]-h[8],h[4]+=h[8],h[8]=_*t[k+-12*18+7],_=h[5]-h[9],h[5]+=h[9],h[9]=_*t[k+-12*18+7],_=h[0]-h[12],h[0]+=h[12],h[12]=_*t[k+-4*18+7],_=h[1]-h[13],h[1]+=h[13],h[13]=_*t[k+-4*18+7],_=h[16]-h[28],h[16]+=h[28],h[28]=_*t[k+-4*18+7],_=-h[17]+h[29],h[17]+=h[29],h[29]=_*t[k+-4*18+7],_=hn.SQRT2*(h[2]-h[10]),h[2]+=h[10],h[10]=_,_=hn.SQRT2*(h[3]-h[11]),h[3]+=h[11],h[11]=_,_=hn.SQRT2*(-h[18]+h[26]),h[18]+=h[26],h[26]=_-h[18],_=hn.SQRT2*(-h[19]+h[27]),h[19]+=h[27],h[27]=_-h[19],_=h[2],h[19]-=h[3],h[3]-=_,h[2]=h[31]-_,h[31]+=_,_=h[3],h[11]-=h[19],h[18]-=_,h[3]=h[30]-_,h[30]+=_,_=h[18],h[27]-=h[11],h[19]-=_,h[18]=h[15]-_,h[15]+=_,_=h[19],h[10]-=_,h[19]=h[14]-_,h[14]+=_,_=h[10],h[11]-=_,h[10]=h[23]-_,h[23]+=_,_=h[11],h[26]-=_,h[11]=h[22]-_,h[22]+=_,_=h[26],h[27]-=_,h[26]=h[7]-_,h[7]+=_,_=h[27],h[27]=h[6]-_,h[6]+=_,_=hn.SQRT2*(h[0]-h[4]),h[0]+=h[4],h[4]=_,_=hn.SQRT2*(h[1]-h[5]),h[1]+=h[5],h[5]=_,_=hn.SQRT2*(h[16]-h[20]),h[16]+=h[20],h[20]=_,_=hn.SQRT2*(h[17]-h[21]),h[17]+=h[21],h[21]=_,_=-hn.SQRT2*(h[8]-h[12]),h[8]+=h[12],h[12]=_-h[8],_=-hn.SQRT2*(h[9]-h[13]),h[9]+=h[13],h[13]=_-h[9],_=-hn.SQRT2*(h[25]-h[29]),h[25]+=h[29],h[29]=_-h[25],_=-hn.SQRT2*(h[24]+h[28]),h[24]-=h[28],h[28]=_-h[24],_=h[24]-h[16],h[24]=_,_=h[20]-_,h[20]=_,_=h[28]-_,h[28]=_,_=h[25]-h[17],h[25]=_,_=h[21]-_,h[21]=_,_=h[29]-_,h[29]=_,_=h[17]-h[1],h[17]=_,_=h[9]-_,h[9]=_,_=h[25]-_,h[25]=_,_=h[5]-_,h[5]=_,_=h[21]-_,h[21]=_,_=h[13]-_,h[13]=_,_=h[29]-_,h[29]=_,_=h[1]-h[0],h[1]=_,_=h[16]-_,h[16]=_,_=h[17]-_,h[17]=_,_=h[8]-_,h[8]=_,_=h[9]-_,h[9]=_,_=h[24]-_,h[24]=_,_=h[25]-_,h[25]=_,_=h[4]-_,h[4]=_,_=h[5]-_,h[5]=_,_=h[20]-_,h[20]=_,_=h[21]-_,h[21]=_,_=h[12]-_,h[12]=_,_=h[13]-_,h[13]=_,_=h[28]-_,h[28]=_,_=h[29]-_,h[29]=_,_=h[0],h[0]+=h[31],h[31]-=_,_=h[1],h[1]+=h[30],h[30]-=_,_=h[16],h[16]+=h[15],h[15]-=_,_=h[17],h[17]+=h[14],h[14]-=_,_=h[8],h[8]+=h[23],h[23]-=_,_=h[9],h[9]+=h[22],h[22]-=_,_=h[24],h[24]+=h[7],h[7]-=_,_=h[25],h[25]+=h[6],h[6]-=_,_=h[4],h[4]+=h[27],h[27]-=_,_=h[5],h[5]+=h[26],h[26]-=_,_=h[20],h[20]+=h[11],h[11]-=_,_=h[21],h[21]+=h[10],h[10]-=_,_=h[12],h[12]+=h[19],h[19]-=_,_=h[13],h[13]+=h[18],h[18]-=_,_=h[28],h[28]+=h[3],h[3]-=_,_=h[29],h[29]+=h[2],h[2]-=_}}function d(f,m){for(var h=0;h<3;h++){var k,I,L,p,C,P;p=f[m+2*3]*s[D.SHORT_TYPE][0]-f[m+5*3],k=f[m+0*3]*s[D.SHORT_TYPE][2]-f[m+3*3],I=p+k,L=p-k,p=f[m+5*3]*s[D.SHORT_TYPE][0]+f[m+2*3],k=f[m+3*3]*s[D.SHORT_TYPE][2]+f[m+0*3],C=p+k,P=-p+k,k=(f[m+1*3]*s[D.SHORT_TYPE][1]-f[m+4*3])*2069978111953089e-26,p=(f[m+4*3]*s[D.SHORT_TYPE][1]+f[m+1*3])*2069978111953089e-26,f[m+3*0]=I*190752519173728e-25+k,f[m+3*5]=-C*190752519173728e-25+p,L=L*.8660254037844387*1907525191737281e-26,C=C*.5*1907525191737281e-26+p,f[m+3*1]=L-C,f[m+3*2]=L+C,I=I*.5*1907525191737281e-26-k,P=P*.8660254037844387*1907525191737281e-26,f[m+3*3]=I+P,f[m+3*4]=I-P,m++}}function u(f,m,h){var k,I;{var L,p,C,P,M,F,_,S;L=h[17]-h[9],C=h[15]-h[11],P=h[14]-h[12],M=h[0]+h[8],F=h[1]+h[7],_=h[2]+h[6],S=h[3]+h[5],f[m+17]=M+_-S-(F-h[4]),I=(M+_-S)*r[12+7]+(F-h[4]),k=(L-C-P)*r[12+6],f[m+5]=k+I,f[m+6]=k-I,p=(h[16]-h[10])*r[12+6],F=F*r[12+7]+h[4],k=L*r[12+0]+p+C*r[12+1]+P*r[12+2],I=-M*r[12+4]+F-_*r[12+5]+S*r[12+3],f[m+1]=k+I,f[m+2]=k-I,k=L*r[12+1]-p-C*r[12+2]+P*r[12+0],I=-M*r[12+5]+F-_*r[12+3]+S*r[12+4],f[m+9]=k+I,f[m+10]=k-I,k=L*r[12+2]-p+C*r[12+0]-P*r[12+1],I=M*r[12+3]-F+_*r[12+4]-S*r[12+5],f[m+13]=k+I,f[m+14]=k-I}{var x,v,w,b,y,A,T,U;x=h[8]-h[0],w=h[6]-h[2],b=h[5]-h[3],y=h[17]+h[9],A=h[16]+h[10],T=h[15]+h[11],U=h[14]+h[12],f[m+0]=y+T+U+(A+h[13]),k=(y+T+U)*r[12+7]-(A+h[13]),I=(x-w+b)*r[12+6],f[m+11]=k+I,f[m+12]=k-I,v=(h[7]-h[1])*r[12+6],A=h[13]-A*r[12+7],k=y*r[12+3]-A+T*r[12+4]+U*r[12+5],I=x*r[12+2]+v+w*r[12+0]+b*r[12+1],f[m+3]=k+I,f[m+4]=k-I,k=-y*r[12+5]+A-T*r[12+3]-U*r[12+4],I=x*r[12+1]+v-w*r[12+2]-b*r[12+0],f[m+7]=k+I,f[m+8]=k-I,k=-y*r[12+4]+A-T*r[12+5]-U*r[12+3],I=x*r[12+0]-v+w*r[12+1]-b*r[12+2],f[m+15]=k+I,f[m+16]=k-I}}this.mdct_sub48=function(f,m,h){for(var k=m,I=286,L=0;L<f.channels_out;L++){for(var p=0;p<f.mode_gr;p++){for(var C,P=f.l3_side.tt[p][L],M=P.xr,F=0,_=f.sb_sample[L][1-p],S=0,x=0;x<18/2;x++)for(c(k,I,_[S]),c(k,I+32,_[S+1]),S+=2,I+=64,C=1;C<32;C+=2)_[S-1][C]*=-1;for(C=0;C<32;C++,F+=18){var v=P.block_type,w=f.sb_sample[L][p],b=f.sb_sample[L][1-p];if(P.mixed_block_flag!=0&&C<2&&(v=0),f.amp_filter[C]<1e-12)Gq.fill(M,F+0,F+18,0);else{if(f.amp_filter[C]<1)for(var x=0;x<18;x++)b[x][l[C]]*=f.amp_filter[C];if(v==D.SHORT_TYPE){for(var x=-e/4;x<0;x++){var y=s[D.SHORT_TYPE][x+3];M[F+x*3+9]=w[9+x][l[C]]*y-w[8-x][l[C]],M[F+x*3+18]=w[14-x][l[C]]*y+w[15+x][l[C]],M[F+x*3+10]=w[15+x][l[C]]*y-w[14-x][l[C]],M[F+x*3+19]=b[2-x][l[C]]*y+b[3+x][l[C]],M[F+x*3+11]=b[3+x][l[C]]*y-b[2-x][l[C]],M[F+x*3+20]=b[8-x][l[C]]*y+b[9+x][l[C]]}d(M,F)}else{for(var A=Wq(18),x=-n/4;x<0;x++){var T,U;T=s[v][x+27]*b[x+9][l[C]]+s[v][x+36]*b[8-x][l[C]],U=s[v][x+9]*w[x+9][l[C]]-s[v][x+18]*w[8-x][l[C]],A[x+9]=T-U*i[3+x+9],A[x+18]=T*i[3+x+9]+U}u(M,F,A)}}if(v!=D.SHORT_TYPE&&C!=0)for(var x=7;x>=0;--x){var W,j;W=M[F+x]*o[20+x]+M[F+-1-x]*a[28+x],j=M[F+x]*a[28+x]-M[F+-1-x]*o[20+x],M[F+-1-x]=W,M[F+x]=j}}}if(k=h,I=286,f.mode_gr==1)for(var K=0;K<18;K++)Kq.arraycopy(f.sb_sample[L][1][K],0,f.sb_sample[L][0][K],0,32)}}}var Xq=Oe.System,Qq=Oe.new_float,Zq=Oe.new_float_n;function Xd(){this.l=Qq(D.SBMAX_l),this.s=Zq([D.SBMAX_s,3]);var t=this;this.assign=function(e){Xq.arraycopy(e.l,0,t.l,0,D.SBMAX_l);for(var n=0;n<D.SBMAX_s;n++)for(var s=0;s<3;s++)t.s[n][s]=e.s[n][s]}}function vr(){this.thm=new Xd,this.en=new Xd}function Nt(t){var e=t;this.ordinal=function(){return e}}Nt.STEREO=new Nt(0);Nt.JOINT_STEREO=new Nt(1);Nt.DUAL_CHANNEL=new Nt(2);Nt.MONO=new Nt(3);Nt.NOT_SET=new Nt(4);var M3=Oe.System,Ih=Oe.VbrMode,N3=Oe.new_array_n,O3=Oe.new_float,Jq=Oe.new_float_n,e$=Oe.new_int,kh=Oe.assert;D.ENCDELAY=576;D.POSTDELAY=1152;D.MDCTDELAY=48;D.FFTOFFSET=224+D.MDCTDELAY;D.DECDELAY=528;D.SBLIMIT=32;D.CBANDS=64;D.SBPSY_l=21;D.SBPSY_s=12;D.SBMAX_l=22;D.SBMAX_s=13;D.PSFB21=6;D.PSFB12=6;D.BLKSIZE=1024;D.HBLKSIZE=D.BLKSIZE/2+1;D.BLKSIZE_s=256;D.HBLKSIZE_s=D.BLKSIZE_s/2+1;D.NORM_TYPE=0;D.START_TYPE=1;D.SHORT_TYPE=2;D.STOP_TYPE=3;D.MPG_MD_LR_LR=0;D.MPG_MD_LR_I=1;D.MPG_MD_MS_LR=2;D.MPG_MD_MS_I=3;D.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function D(){var t=D.FFTOFFSET,e=D.MPG_MD_MS_LR,n=null;this.psy=null;var s=null,i=null,r=null;this.setModules=function(d,u,f,m){n=d,this.psy=u,s=u,i=m,r=f};var o=new Yq;function a(d){var u,f;if(d.ATH.useAdjust==0){d.ATH.adjust=1;return}if(f=d.loudness_sq[0][0],u=d.loudness_sq[1][0],d.channels_out==2?(f+=d.loudness_sq[0][1],u+=d.loudness_sq[1][1]):(f+=f,u+=u),d.mode_gr==2&&(f=Math.max(f,u)),f*=.5,f*=d.ATH.aaSensitivityP,f>.03125)d.ATH.adjust>=1?d.ATH.adjust=1:d.ATH.adjust<d.ATH.adjustLimit&&(d.ATH.adjust=d.ATH.adjustLimit),d.ATH.adjustLimit=1;else{var m=31.98*f+625e-6;d.ATH.adjust>=m?(d.ATH.adjust*=m*.075+.925,d.ATH.adjust<m&&(d.ATH.adjust=m)):d.ATH.adjustLimit>=m?d.ATH.adjust=m:d.ATH.adjust<d.ATH.adjustLimit&&(d.ATH.adjust=d.ATH.adjustLimit),d.ATH.adjustLimit=m}}function l(d){var u,f;for(kh(d.bitrate_index>=0&&d.bitrate_index<16),kh(d.mode_ext>=0&&d.mode_ext<4),d.bitrate_stereoMode_Hist[d.bitrate_index][4]++,d.bitrate_stereoMode_Hist[15][4]++,d.channels_out==2&&(d.bitrate_stereoMode_Hist[d.bitrate_index][d.mode_ext]++,d.bitrate_stereoMode_Hist[15][d.mode_ext]++),u=0;u<d.mode_gr;++u)for(f=0;f<d.channels_out;++f){var m=d.l3_side.tt[u][f].block_type|0;d.l3_side.tt[u][f].mixed_block_flag!=0&&(m=4),d.bitrate_blockType_Hist[d.bitrate_index][m]++,d.bitrate_blockType_Hist[d.bitrate_index][5]++,d.bitrate_blockType_Hist[15][m]++,d.bitrate_blockType_Hist[15][5]++}}function c(d,u){var f=d.internal_flags,m,h;if(f.lame_encode_frame_init==0){var k,I,L=O3(2014),p=O3(286+1152+576);for(f.lame_encode_frame_init=1,k=0,I=0;k<286+576*(1+f.mode_gr);++k)k<576*f.mode_gr?(L[k]=0,f.channels_out==2&&(p[k]=0)):(L[k]=u[0][I],f.channels_out==2&&(p[k]=u[1][I]),++I);for(h=0;h<f.mode_gr;h++)for(m=0;m<f.channels_out;m++)f.l3_side.tt[h][m].block_type=D.SHORT_TYPE;o.mdct_sub48(f,L,p),kh(f.mf_size>=D.BLKSIZE+d.framesize-D.FFTOFFSET),kh(f.mf_size>=512+d.framesize-32)}}this.lame_encode_mp3_frame=function(d,u,f,m,h,k){var I,L=N3([2,2]);L[0][0]=new vr,L[0][1]=new vr,L[1][0]=new vr,L[1][1]=new vr;var p=N3([2,2]);p[0][0]=new vr,p[0][1]=new vr,p[1][0]=new vr,p[1][1]=new vr;var C,P=[null,null],M=d.internal_flags,F=Jq([2,4]),_=[.5,.5],S=[[0,0],[0,0]],x=[[0,0],[0,0]],v,w,b;if(P[0]=u,P[1]=f,M.lame_encode_frame_init==0&&c(d,P),M.padding=0,(M.slot_lag-=M.frac_SpF)<0&&(M.slot_lag+=d.out_samplerate,M.padding=1),M.psymodel!=0){var y,A=[null,null],T=0,U=e$(2);for(b=0;b<M.mode_gr;b++){for(w=0;w<M.channels_out;w++)A[w]=P[w],T=576+b*576-D.FFTOFFSET;if(d.VBR==Ih.vbr_mtrh||d.VBR==Ih.vbr_mt?y=s.L3psycho_anal_vbr(d,A,T,b,L,p,S[b],x[b],F[b],U):y=s.L3psycho_anal_ns(d,A,T,b,L,p,S[b],x[b],F[b],U),y!=0)return-4;for(d.mode==Nt.JOINT_STEREO&&(_[b]=F[b][2]+F[b][3],_[b]>0&&(_[b]=F[b][3]/_[b])),w=0;w<M.channels_out;w++){var W=M.l3_side.tt[b][w];W.block_type=U[w],W.mixed_block_flag=0}}}else for(b=0;b<M.mode_gr;b++)for(w=0;w<M.channels_out;w++)M.l3_side.tt[b][w].block_type=D.NORM_TYPE,M.l3_side.tt[b][w].mixed_block_flag=0,x[b][w]=S[b][w]=700;if(a(M),o.mdct_sub48(M,P[0],P[1]),M.mode_ext=D.MPG_MD_LR_LR,d.force_ms)M.mode_ext=D.MPG_MD_MS_LR;else if(d.mode==Nt.JOINT_STEREO){var j=0,K=0;for(b=0;b<M.mode_gr;b++)for(w=0;w<M.channels_out;w++)j+=x[b][w],K+=S[b][w];if(j<=1*K){var g=M.l3_side.tt[0],R=M.l3_side.tt[M.mode_gr-1];g[0].block_type==g[1].block_type&&R[0].block_type==R[1].block_type&&(M.mode_ext=D.MPG_MD_MS_LR)}}if(M.mode_ext==e?(C=p,v=x):(C=L,v=S),d.analysis&&M.pinfo!=null)for(b=0;b<M.mode_gr;b++)for(w=0;w<M.channels_out;w++)M.pinfo.ms_ratio[b]=M.ms_ratio[b],M.pinfo.ms_ener_ratio[b]=_[b],M.pinfo.blocktype[b][w]=M.l3_side.tt[b][w].block_type,M.pinfo.pe[b][w]=v[b][w],M3.arraycopy(M.l3_side.tt[b][w].xr,0,M.pinfo.xr[b][w],0,576),M.mode_ext==e&&(M.pinfo.ers[b][w]=M.pinfo.ers[b][w+2],M3.arraycopy(M.pinfo.energy[b][w+2],0,M.pinfo.energy[b][w],0,M.pinfo.energy[b][w].length));if(d.VBR==Ih.vbr_off||d.VBR==Ih.vbr_abr){var ee,ne;for(ee=0;ee<18;ee++)M.nsPsy.pefirbuf[ee]=M.nsPsy.pefirbuf[ee+1];for(ne=0,b=0;b<M.mode_gr;b++)for(w=0;w<M.channels_out;w++)ne+=v[b][w];for(M.nsPsy.pefirbuf[18]=ne,ne=M.nsPsy.pefirbuf[9],ee=0;ee<9;ee++)ne+=(M.nsPsy.pefirbuf[ee]+M.nsPsy.pefirbuf[18-ee])*D.fircoef[ee];for(ne=670*5*M.mode_gr*M.channels_out/ne,b=0;b<M.mode_gr;b++)for(w=0;w<M.channels_out;w++)v[b][w]*=ne}if(M.iteration_loop.iteration_loop(d,v,_,C),n.format_bitstream(d),I=n.copy_buffer(M,m,h,k,1),d.bWriteVbrTag&&i.addVbrFrame(d),d.analysis&&M.pinfo!=null){for(w=0;w<M.channels_out;w++){var xe;for(xe=0;xe<t;xe++)M.pinfo.pcmdata[w][xe]=M.pinfo.pcmdata[w][xe+d.framesize];for(xe=t;xe<1600;xe++)M.pinfo.pcmdata[w][xe]=P[w][xe-t]}r.set_frame_pinfo(d,C)}return l(M),I}}var L3=Oe.Util,P3=Oe.new_float;function t$(){var t=P3(D.BLKSIZE),e=P3(D.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function s(r,o,a){var l=0,c,d,u;a<<=1;var f=o+a;c=4;do{var m,h,k,I,L,p,C;C=c>>1,I=c,L=c<<1,p=L+I,c=L<<1,d=o,u=d+C;do{var P,M,F,_;M=r[d+0]-r[d+I],P=r[d+0]+r[d+I],_=r[d+L]-r[d+p],F=r[d+L]+r[d+p],r[d+L]=P-F,r[d+0]=P+F,r[d+p]=M-_,r[d+I]=M+_,M=r[u+0]-r[u+I],P=r[u+0]+r[u+I],_=L3.SQRT2*r[u+p],F=L3.SQRT2*r[u+L],r[u+L]=P-F,r[u+0]=P+F,r[u+p]=M-_,r[u+I]=M+_,u+=c,d+=c}while(d<f);for(h=n[l+0],m=n[l+1],k=1;k<C;k++){var S,x;S=1-2*m*m,x=2*m*h,d=o+k,u=o+I-k;do{var v,w,b,P,M,y,F,A,_,T;w=x*r[d+I]-S*r[u+I],v=S*r[d+I]+x*r[u+I],M=r[d+0]-v,P=r[d+0]+v,y=r[u+0]-w,b=r[u+0]+w,w=x*r[d+p]-S*r[u+p],v=S*r[d+p]+x*r[u+p],_=r[d+L]-v,F=r[d+L]+v,T=r[u+L]-w,A=r[u+L]+w,w=m*F-h*T,v=h*F+m*T,r[d+L]=P-v,r[d+0]=P+v,r[u+p]=y-w,r[u+I]=y+w,w=h*A-m*_,v=m*A+h*_,r[u+L]=b-v,r[u+0]=b+v,r[d+p]=M-w,r[d+I]=M+w,u+=c,d+=c}while(d<f);S=h,h=S*n[l+0]-m*n[l+1],m=S*n[l+1]+m*n[l+0]}l+=2}while(c<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(r,o,a,l,c){for(var d=0;d<3;d++){var u=D.BLKSIZE_s/2,f=65535&576/3*(d+1),m=D.BLKSIZE_s/8-1;do{var h,k,I,L,p,C=i[m<<2]&255;h=e[C]*l[a][c+C+f],p=e[127-C]*l[a][c+C+f+128],k=h-p,h=h+p,I=e[C+64]*l[a][c+C+f+64],p=e[63-C]*l[a][c+C+f+192],L=I-p,I=I+p,u-=4,o[d][u+0]=h+I,o[d][u+2]=h-I,o[d][u+1]=k+L,o[d][u+3]=k-L,h=e[C+1]*l[a][c+C+f+1],p=e[126-C]*l[a][c+C+f+129],k=h-p,h=h+p,I=e[C+65]*l[a][c+C+f+65],p=e[62-C]*l[a][c+C+f+193],L=I-p,I=I+p,o[d][u+D.BLKSIZE_s/2+0]=h+I,o[d][u+D.BLKSIZE_s/2+2]=h-I,o[d][u+D.BLKSIZE_s/2+1]=k+L,o[d][u+D.BLKSIZE_s/2+3]=k-L}while(--m>=0);s(o[d],u,D.BLKSIZE_s/2)}},this.fft_long=function(r,o,a,l,c){var d=D.BLKSIZE/8-1,u=D.BLKSIZE/2;do{var f,m,h,k,I,L=i[d]&255;f=t[L]*l[a][c+L],I=t[L+512]*l[a][c+L+512],m=f-I,f=f+I,h=t[L+256]*l[a][c+L+256],I=t[L+768]*l[a][c+L+768],k=h-I,h=h+I,u-=4,o[u+0]=f+h,o[u+2]=f-h,o[u+1]=m+k,o[u+3]=m-k,f=t[L+1]*l[a][c+L+1],I=t[L+513]*l[a][c+L+513],m=f-I,f=f+I,h=t[L+257]*l[a][c+L+257],I=t[L+769]*l[a][c+L+769],k=h-I,h=h+I,o[u+D.BLKSIZE/2+0]=f+h,o[u+D.BLKSIZE/2+2]=f-h,o[u+D.BLKSIZE/2+1]=m+k,o[u+D.BLKSIZE/2+3]=m-k}while(--d>=0);s(o,u,D.BLKSIZE/2)},this.init_fft=function(r){for(var o=0;o<D.BLKSIZE;o++)t[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/D.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/D.BLKSIZE);for(var o=0;o<D.BLKSIZE_s/2;o++)e[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/D.BLKSIZE_s))}}var wa=Oe.VbrMode,D3=Oe.Float,Ea=Oe.ShortBlock,fs=Oe.Util,n$=Oe.Arrays,vn=Oe.new_float,Gs=Oe.new_float_n,ro=Oe.new_int,ct=Oe.assert;function Om(){var t=new t$,e=2.302585092994046,n=2,s=16,i=2,r=16,o=.34,a=1/(14752*14752)/(D.BLKSIZE/2),l=.01,c=.8,d=.6,u=.3,f=3.5,m=21,h=.2302585093;function k(O){return O}function I(O,B){for(var q=0,z=0;z<D.BLKSIZE/2;++z)q+=O[z]*B.ATH.eql_w[z];return q*=a,q}function L(O,B,q,z,Y,H,J,oe,Z,me,ae){var pe=O.internal_flags;if(Z<2)t.fft_long(pe,z[Y],Z,me,ae),t.fft_short(pe,H[J],Z,me,ae);else if(Z==2){for(var Pe=D.BLKSIZE-1;Pe>=0;--Pe){var Qe=z[Y+0][Pe],Te=z[Y+1][Pe];z[Y+0][Pe]=(Qe+Te)*fs.SQRT2*.5,z[Y+1][Pe]=(Qe-Te)*fs.SQRT2*.5}for(var We=2;We>=0;--We)for(var Pe=D.BLKSIZE_s-1;Pe>=0;--Pe){var Qe=H[J+0][We][Pe],Te=H[J+1][We][Pe];H[J+0][We][Pe]=(Qe+Te)*fs.SQRT2*.5,H[J+1][We][Pe]=(Qe-Te)*fs.SQRT2*.5}}B[0]=z[Y+0][0],B[0]*=B[0];for(var Pe=D.BLKSIZE/2-1;Pe>=0;--Pe){var he=z[Y+0][D.BLKSIZE/2-Pe],Ve=z[Y+0][D.BLKSIZE/2+Pe];B[D.BLKSIZE/2-Pe]=(he*he+Ve*Ve)*.5}for(var We=2;We>=0;--We){q[We][0]=H[J+0][We][0],q[We][0]*=q[We][0];for(var Pe=D.BLKSIZE_s/2-1;Pe>=0;--Pe){var he=H[J+0][We][D.BLKSIZE_s/2-Pe],Ve=H[J+0][We][D.BLKSIZE_s/2+Pe];q[We][D.BLKSIZE_s/2-Pe]=(he*he+Ve*Ve)*.5}}{for(var lt=0,Pe=11;Pe<D.HBLKSIZE;Pe++)lt+=B[Pe];pe.tot_ener[Z]=lt}if(O.analysis){for(var Pe=0;Pe<D.HBLKSIZE;Pe++)pe.pinfo.energy[oe][Z][Pe]=pe.pinfo.energy_save[Z][Pe],pe.pinfo.energy_save[Z][Pe]=B[Pe];pe.pinfo.pe[oe][Z]=pe.pe[Z]}O.athaa_loudapprox==2&&Z<2&&(pe.loudness_sq[oe][Z]=pe.loudness_sq_save[Z],pe.loudness_sq_save[Z]=I(B,pe))}var p=8,C=23,P=15,M,F,_,S=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function x(){M=Math.pow(10,(p+1)/16),F=Math.pow(10,(C+1)/16),_=Math.pow(10,P/10)}var v=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],w=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],b=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function y(O,B,q,z,Y,H){var J;if(B>O)if(B<O*F)J=B/O;else return O+B;else{if(O>=B*F)return O+B;J=O/B}if(O+=B,z+3<=3+3){if(J>=M)return O;var oe=0|fs.FAST_LOG10_X(J,16);return O*w[oe]}var oe=0|fs.FAST_LOG10_X(J,16);if(H!=0?B=Y.ATH.cb_s[q]*Y.ATH.adjust:B=Y.ATH.cb_l[q]*Y.ATH.adjust,O<_*B){if(O>B){var Z,me;return Z=1,oe<=13&&(Z=b[oe]),me=fs.FAST_LOG10_X(O/B,10/15),O*((v[oe]-Z)*me+Z)}return oe>13?O:O*b[oe]}return O*v[oe]}var A=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function T(O,B,q){var z;if(O<0&&(O=0),B<0&&(B=0),O<=0)return B;if(B<=0)return O;if(B>O?z=B/O:z=O/B,q>=-2&&q<=2){if(z>=M)return O+B;var Y=0|fs.FAST_LOG10_X(z,16);return(O+B)*A[Y]}return z<F?O+B:(O<B&&(O=B),O)}function U(O,B){var q=O.internal_flags;if(q.channels_out>1){for(var z=0;z<D.SBMAX_l;z++){var Y=q.thm[0].l[z],H=q.thm[1].l[z];q.thm[0].l[z]+=H*B,q.thm[1].l[z]+=Y*B}for(var z=0;z<D.SBMAX_s;z++)for(var J=0;J<3;J++){var Y=q.thm[0].s[z][J],H=q.thm[1].s[z][J];q.thm[0].s[z][J]+=H*B,q.thm[1].s[z][J]+=Y*B}}}function W(O){for(var B=0;B<D.SBMAX_l;B++)if(!(O.thm[0].l[B]>1.58*O.thm[1].l[B]||O.thm[1].l[B]>1.58*O.thm[0].l[B])){var q=O.mld_l[B]*O.en[3].l[B],z=Math.max(O.thm[2].l[B],Math.min(O.thm[3].l[B],q));q=O.mld_l[B]*O.en[2].l[B];var Y=Math.max(O.thm[3].l[B],Math.min(O.thm[2].l[B],q));O.thm[2].l[B]=z,O.thm[3].l[B]=Y}for(var B=0;B<D.SBMAX_s;B++)for(var H=0;H<3;H++)if(!(O.thm[0].s[B][H]>1.58*O.thm[1].s[B][H]||O.thm[1].s[B][H]>1.58*O.thm[0].s[B][H])){var q=O.mld_s[B]*O.en[3].s[B][H],z=Math.max(O.thm[2].s[B][H],Math.min(O.thm[3].s[B][H],q));q=O.mld_s[B]*O.en[2].s[B][H];var Y=Math.max(O.thm[3].s[B][H],Math.min(O.thm[2].s[B][H],q));O.thm[2].s[B][H]=z,O.thm[3].s[B][H]=Y}}function j(O,B,q){var z=B,Y=Math.pow(10,q);B*=2,z*=2;for(var H=0;H<D.SBMAX_l;H++){var J,oe,Z,me;if(me=O.ATH.cb_l[O.bm_l[H]]*Y,J=Math.min(Math.max(O.thm[0].l[H],me),Math.max(O.thm[1].l[H],me)),oe=Math.max(O.thm[2].l[H],me),Z=Math.max(O.thm[3].l[H],me),J*B<oe+Z){var ae=J*z/(oe+Z);oe*=ae,Z*=ae}O.thm[2].l[H]=Math.min(oe,O.thm[2].l[H]),O.thm[3].l[H]=Math.min(Z,O.thm[3].l[H])}Y*=D.BLKSIZE_s/D.BLKSIZE;for(var H=0;H<D.SBMAX_s;H++)for(var pe=0;pe<3;pe++){var J,oe,Z,me;if(me=O.ATH.cb_s[O.bm_s[H]]*Y,J=Math.min(Math.max(O.thm[0].s[H][pe],me),Math.max(O.thm[1].s[H][pe],me)),oe=Math.max(O.thm[2].s[H][pe],me),Z=Math.max(O.thm[3].s[H][pe],me),J*B<oe+Z){var ae=J*B/(oe+Z);oe*=ae,Z*=ae}O.thm[2].s[H][pe]=Math.min(O.thm[2].s[H][pe],oe),O.thm[3].s[H][pe]=Math.min(O.thm[3].s[H][pe],Z)}}function K(O,B,q,z,Y){var H,J,oe=0,Z=0;for(H=J=0;H<D.SBMAX_s;++J,++H){for(var me=O.bo_s[H],ae=O.npart_s,pe=me<ae?me:ae;J<pe;)ct(B[J]>=0),ct(q[J]>=0),oe+=B[J],Z+=q[J],J++;if(O.en[z].s[H][Y]=oe,O.thm[z].s[H][Y]=Z,J>=ae){++H;break}ct(B[J]>=0),ct(q[J]>=0);{var Pe=O.PSY.bo_s_weight[H],Qe=1-Pe;oe=Pe*B[J],Z=Pe*q[J],O.en[z].s[H][Y]+=oe,O.thm[z].s[H][Y]+=Z,oe=Qe*B[J],Z=Qe*q[J]}}for(;H<D.SBMAX_s;++H)O.en[z].s[H][Y]=0,O.thm[z].s[H][Y]=0}function g(O,B,q,z){var Y,H,J=0,oe=0;for(Y=H=0;Y<D.SBMAX_l;++H,++Y){for(var Z=O.bo_l[Y],me=O.npart_l,ae=Z<me?Z:me;H<ae;)ct(B[H]>=0),ct(q[H]>=0),J+=B[H],oe+=q[H],H++;if(O.en[z].l[Y]=J,O.thm[z].l[Y]=oe,H>=me){++Y;break}ct(B[H]>=0),ct(q[H]>=0);{var pe=O.PSY.bo_l_weight[Y],Pe=1-pe;J=pe*B[H],oe=pe*q[H],O.en[z].l[Y]+=J,O.thm[z].l[Y]+=oe,J=Pe*B[H],oe=Pe*q[H]}}for(;Y<D.SBMAX_l;++Y)O.en[z].l[Y]=0,O.thm[z].l[Y]=0}function R(O,B,q,z,Y,H){var J=O.internal_flags,oe,Z;for(Z=oe=0;Z<J.npart_s;++Z){for(var me=0,ae=J.numlines_s[Z],pe=0;pe<ae;++pe,++oe){var Pe=B[H][oe];me+=Pe}q[Z]=me}for(ct(Z==J.npart_s),oe=Z=0;Z<J.npart_s;Z++){var Qe=J.s3ind_s[Z][0],Te=J.s3_ss[oe++]*q[Qe];for(++Qe;Qe<=J.s3ind_s[Z][1];)Te+=J.s3_ss[oe]*q[Qe],++oe,++Qe;{var We=i*J.nb_s1[Y][Z];z[Z]=Math.min(Te,We)}if(J.blocktype_old[Y&1]==D.SHORT_TYPE){var We=r*J.nb_s2[Y][Z],he=z[Z];z[Z]=Math.min(We,he)}J.nb_s2[Y][Z]=J.nb_s1[Y][Z],J.nb_s1[Y][Z]=Te,ct(z[Z]>=0)}for(;Z<=D.CBANDS;++Z)q[Z]=0,z[Z]=0}function ee(O,B,q,z){var Y=O.internal_flags;O.short_blocks==Ea.short_block_coupled&&!(B[0]!=0&&B[1]!=0)&&(B[0]=B[1]=0);for(var H=0;H<Y.channels_out;H++)z[H]=D.NORM_TYPE,O.short_blocks==Ea.short_block_dispensed&&(B[H]=1),O.short_blocks==Ea.short_block_forced&&(B[H]=0),B[H]!=0?(ct(Y.blocktype_old[H]!=D.START_TYPE),Y.blocktype_old[H]==D.SHORT_TYPE&&(z[H]=D.STOP_TYPE)):(z[H]=D.SHORT_TYPE,Y.blocktype_old[H]==D.NORM_TYPE&&(Y.blocktype_old[H]=D.START_TYPE),Y.blocktype_old[H]==D.STOP_TYPE&&(Y.blocktype_old[H]=D.SHORT_TYPE)),q[H]=Y.blocktype_old[H],Y.blocktype_old[H]=z[H]}function ne(O,B,q){return q>=1?O:q<=0?B:B>0?Math.pow(O/B,q)*B:0}var xe=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function Ie(O,B){for(var q=309.07,z=0;z<D.SBMAX_s-1;z++)for(var Y=0;Y<3;Y++){var H=O.thm.s[z][Y];if(H>0){var J=H*B,oe=O.en.s[z][Y];oe>J&&(oe>J*1e10?q+=xe[z]*(10*e):q+=xe[z]*fs.FAST_LOG10(oe/J))}}return q}var Me=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function be(O,B){for(var q=281.0575,z=0;z<D.SBMAX_l-1;z++){var Y=O.thm.l[z];if(Y>0){var H=Y*B,J=O.en.l[z];J>H&&(J>H*1e10?q+=Me[z]*(10*e):q+=Me[z]*fs.FAST_LOG10(J/H))}}return q}function ze(O,B,q,z,Y){var H,J;for(H=J=0;H<O.npart_l;++H){var oe=0,Z=0,me;for(me=0;me<O.numlines_l[H];++me,++J){var ae=B[J];oe+=ae,Z<ae&&(Z=ae)}q[H]=oe,z[H]=Z,Y[H]=oe*O.rnumlines_l[H],ct(O.rnumlines_l[H]>=0),ct(q[H]>=0),ct(z[H]>=0),ct(Y[H]>=0)}}function De(O,B,q,z){var Y=S.length-1,H=0,J=q[H]+q[H+1];if(J>0){var oe=B[H];oe<B[H+1]&&(oe=B[H+1]),ct(O.numlines_l[H]+O.numlines_l[H+1]-1>0),J=20*(oe*2-J)/(J*(O.numlines_l[H]+O.numlines_l[H+1]-1));var Z=0|J;Z>Y&&(Z=Y),z[H]=Z}else z[H]=0;for(H=1;H<O.npart_l-1;H++)if(J=q[H-1]+q[H]+q[H+1],J>0){var oe=B[H-1];oe<B[H]&&(oe=B[H]),oe<B[H+1]&&(oe=B[H+1]),ct(O.numlines_l[H-1]+O.numlines_l[H]+O.numlines_l[H+1]-1>0),J=20*(oe*3-J)/(J*(O.numlines_l[H-1]+O.numlines_l[H]+O.numlines_l[H+1]-1));var Z=0|J;Z>Y&&(Z=Y),z[H]=Z}else z[H]=0;if(ct(H==O.npart_l-1),J=q[H-1]+q[H],J>0){var oe=B[H-1];oe<B[H]&&(oe=B[H]),ct(O.numlines_l[H-1]+O.numlines_l[H]-1>0),J=20*(oe*2-J)/(J*(O.numlines_l[H-1]+O.numlines_l[H]-1));var Z=0|J;Z>Y&&(Z=Y),z[H]=Z}else z[H]=0;ct(H==O.npart_l-1)}var we=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(O,B,q,z,Y,H,J,oe,Z,me){var ae=O.internal_flags,pe=Gs([2,D.BLKSIZE]),Pe=Gs([2,3,D.BLKSIZE_s]),Qe=vn(D.CBANDS+1),Te=vn(D.CBANDS+1),We=vn(D.CBANDS+2),he=ro(2),Ve=ro(2),lt,Se,$e,Ae,Ze,Zt,Fe,st,ut=Gs([2,576]),rn,As=ro(D.CBANDS+2),mn=ro(D.CBANDS+2);for(n$.fill(mn,0),lt=ae.channels_out,O.mode==Nt.JOINT_STEREO&&(lt=4),O.VBR==wa.vbr_off?rn=ae.ResvMax==0?0:ae.ResvSize/ae.ResvMax*.5:O.VBR==wa.vbr_rh||O.VBR==wa.vbr_mtrh||O.VBR==wa.vbr_mt?rn=.6:rn=1,Se=0;Se<ae.channels_out;Se++){var on=B[Se],hs=q+576-350-m+192;for(Ae=0;Ae<576;Ae++){var Rs,Cs;for(Rs=on[hs+Ae+10],Cs=0,Ze=0;Ze<(m-1)/2-1;Ze+=2)Rs+=we[Ze]*(on[hs+Ae+Ze]+on[hs+Ae+m-Ze]),Cs+=we[Ze+1]*(on[hs+Ae+Ze+1]+on[hs+Ae+m-Ze-1]);ut[Se][Ae]=Rs+Cs}Y[z][Se].en.assign(ae.en[Se]),Y[z][Se].thm.assign(ae.thm[Se]),lt>2&&(H[z][Se].en.assign(ae.en[Se+2]),H[z][Se].thm.assign(ae.thm[Se+2]))}for(Se=0;Se<lt;Se++){var ii,ri,jn=vn(12),vi=[0,0,0,0],_a=vn(12),M0=1,$v,zv=vn(D.CBANDS),Kv=vn(D.CBANDS),an=[0,0,0,0],Gv=vn(D.HBLKSIZE),Wv=Gs([3,D.HBLKSIZE_s]);for(ct(ae.npart_s<=D.CBANDS),ct(ae.npart_l<=D.CBANDS),Ae=0;Ae<3;Ae++)jn[Ae]=ae.nsPsy.last_en_subshort[Se][Ae+6],ct(ae.nsPsy.last_en_subshort[Se][Ae+4]>0),_a[Ae]=jn[Ae]/ae.nsPsy.last_en_subshort[Se][Ae+4],vi[0]+=jn[Ae];if(Se==2)for(Ae=0;Ae<576;Ae++){var N0,O0;N0=ut[0][Ae],O0=ut[1][Ae],ut[0][Ae]=N0+O0,ut[1][Ae]=N0-O0}{var Yv=ut[Se&1],Pl=0;for(Ae=0;Ae<9;Ae++){for(var kS=Pl+64,Sn=1;Pl<kS;Pl++)Sn<Math.abs(Yv[Pl])&&(Sn=Math.abs(Yv[Pl]));ae.nsPsy.last_en_subshort[Se][Ae]=jn[Ae+3]=Sn,vi[1+Ae/3]+=Sn,Sn>jn[Ae+3-2]?(ct(jn[Ae+3-2]>0),Sn=Sn/jn[Ae+3-2]):jn[Ae+3-2]>Sn*10?Sn=jn[Ae+3-2]/(Sn*10):Sn=0,_a[Ae+3]=Sn}}if(O.analysis){var L0=_a[0];for(Ae=1;Ae<12;Ae++)L0<_a[Ae]&&(L0=_a[Ae]);ae.pinfo.ers[z][Se]=ae.pinfo.ers_save[Se],ae.pinfo.ers_save[Se]=L0}for($v=Se==3?ae.nsPsy.attackthre_s:ae.nsPsy.attackthre,Ae=0;Ae<12;Ae++)an[Ae/3]==0&&_a[Ae]>$v&&(an[Ae/3]=Ae%3+1);for(Ae=1;Ae<4;Ae++){var P0;vi[Ae-1]>vi[Ae]?(ct(vi[Ae]>0),P0=vi[Ae-1]/vi[Ae]):(ct(vi[Ae-1]>0),P0=vi[Ae]/vi[Ae-1]),P0<1.7&&(an[Ae]=0,Ae==1&&(an[0]=0))}for(an[0]!=0&&ae.nsPsy.lastAttacks[Se]!=0&&(an[0]=0),(ae.nsPsy.lastAttacks[Se]==3||an[0]+an[1]+an[2]+an[3]!=0)&&(M0=0,an[1]!=0&&an[0]!=0&&(an[1]=0),an[2]!=0&&an[1]!=0&&(an[2]=0),an[3]!=0&&an[2]!=0&&(an[3]=0)),Se<2?Ve[Se]=M0:M0==0&&(Ve[0]=Ve[1]=0),Z[Se]=ae.tot_ener[Se],ri=Pe,ii=pe,L(O,Gv,Wv,ii,Se&1,ri,Se&1,z,Se,B,q),ze(ae,Gv,Qe,zv,Kv),De(ae,zv,Kv,As),st=0;st<3;st++){var D0,ds;for(R(O,Wv,Te,We,Se,st),K(ae,Te,We,Se,st),Fe=0;Fe<D.SBMAX_s;Fe++){if(ds=ae.thm[Se].s[Fe][st],ds*=c,an[st]>=2||an[st+1]==1){var Dl=st!=0?st-1:2,Sn=ne(ae.thm[Se].s[Fe][Dl],ds,d*rn);ds=Math.min(ds,Sn)}if(an[st]==1){var Dl=st!=0?st-1:2,Sn=ne(ae.thm[Se].s[Fe][Dl],ds,u*rn);ds=Math.min(ds,Sn)}else if(st!=0&&an[st-1]==3||st==0&&ae.nsPsy.lastAttacks[Se]==3){var Dl=st!=2?st+1:0,Sn=ne(ae.thm[Se].s[Fe][Dl],ds,u*rn);ds=Math.min(ds,Sn)}D0=jn[st*3+3]+jn[st*3+4]+jn[st*3+5],jn[st*3+5]*6<D0&&(ds*=.5,jn[st*3+4]*6<D0&&(ds*=.5)),ae.thm[Se].s[Fe][st]=ds}}for(ae.nsPsy.lastAttacks[Se]=an[2],Zt=0,$e=0;$e<ae.npart_l;$e++){for(var Zr=ae.s3ind[$e][0],B0=Qe[Zr]*S[As[Zr]],Jr=ae.s3_ll[Zt++]*B0;++Zr<=ae.s3ind[$e][1];)B0=Qe[Zr]*S[As[Zr]],Jr=y(Jr,ae.s3_ll[Zt++]*B0,Zr,Zr-$e,ae,0);Jr*=.158489319246111,ae.blocktype_old[Se&1]==D.SHORT_TYPE?We[$e]=Jr:We[$e]=ne(Math.min(Jr,Math.min(n*ae.nb_1[Se][$e],s*ae.nb_2[Se][$e])),Jr,rn),ae.nb_2[Se][$e]=ae.nb_1[Se][$e],ae.nb_1[Se][$e]=Jr}for(;$e<=D.CBANDS;++$e)Qe[$e]=0,We[$e]=0;g(ae,Qe,We,Se)}if((O.mode==Nt.STEREO||O.mode==Nt.JOINT_STEREO)&&O.interChRatio>0&&U(O,O.interChRatio),O.mode==Nt.JOINT_STEREO){var F0;W(ae),F0=O.msfix,Math.abs(F0)>0&&j(ae,F0,O.ATHlower*ae.ATH.adjust)}for(ee(O,Ve,me,he),Se=0;Se<lt;Se++){var Bl,Fl=0,eh,th;Se>1?(Bl=oe,Fl=-2,eh=D.NORM_TYPE,(me[0]==D.SHORT_TYPE||me[1]==D.SHORT_TYPE)&&(eh=D.SHORT_TYPE),th=H[z][Se-2]):(Bl=J,Fl=0,eh=me[Se],th=Y[z][Se]),eh==D.SHORT_TYPE?Bl[Fl+Se]=Ie(th,ae.masking_lower):Bl[Fl+Se]=be(th,ae.masking_lower),O.analysis&&(ae.pinfo.pe[z][Se]=Bl[Fl+Se])}return 0};function Xe(O,B,q,z,Y,H,J,oe){var Z=O.internal_flags;if(z<2)t.fft_long(Z,J[oe],z,B,q);else if(z==2)for(var me=D.BLKSIZE-1;me>=0;--me){var ae=J[oe+0][me],pe=J[oe+1][me];J[oe+0][me]=(ae+pe)*fs.SQRT2*.5,J[oe+1][me]=(ae-pe)*fs.SQRT2*.5}H[0]=J[oe+0][0],H[0]*=H[0];for(var me=D.BLKSIZE/2-1;me>=0;--me){var Pe=J[oe+0][D.BLKSIZE/2-me],Qe=J[oe+0][D.BLKSIZE/2+me];H[D.BLKSIZE/2-me]=(Pe*Pe+Qe*Qe)*.5}{for(var Te=0,me=11;me<D.HBLKSIZE;me++)Te+=H[me];Z.tot_ener[z]=Te}if(O.analysis){for(var me=0;me<D.HBLKSIZE;me++)Z.pinfo.energy[Y][z][me]=Z.pinfo.energy_save[z][me],Z.pinfo.energy_save[z][me]=H[me];Z.pinfo.pe[Y][z]=Z.pe[z]}}function mt(O,B,q,z,Y,H,J,oe){var Z=O.internal_flags;if(Y==0&&z<2&&t.fft_short(Z,J[oe],z,B,q),z==2)for(var me=D.BLKSIZE_s-1;me>=0;--me){var ae=J[oe+0][Y][me],pe=J[oe+1][Y][me];J[oe+0][Y][me]=(ae+pe)*fs.SQRT2*.5,J[oe+1][Y][me]=(ae-pe)*fs.SQRT2*.5}H[Y][0]=J[oe+0][Y][0],H[Y][0]*=H[Y][0];for(var me=D.BLKSIZE_s/2-1;me>=0;--me){var Pe=J[oe+0][Y][D.BLKSIZE_s/2-me],Qe=J[oe+0][Y][D.BLKSIZE_s/2+me];H[Y][D.BLKSIZE_s/2-me]=(Pe*Pe+Qe*Qe)*.5}}function E(O,B,q,z){var Y=O.internal_flags;O.athaa_loudapprox==2&&q<2&&(Y.loudness_sq[B][q]=Y.loudness_sq_save[q],Y.loudness_sq_save[q]=I(z,Y))}var N=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function V(O,B,q,z,Y,H,J,oe,Z,me){for(var ae=Gs([2,576]),pe=O.internal_flags,Pe=pe.channels_out,Qe=O.mode==Nt.JOINT_STEREO?4:Pe,Te=0;Te<Pe;Te++){firbuf=B[Te];for(var We=q+576-350-m+192,he=0;he<576;he++){var Ve,lt;Ve=firbuf[We+he+10],lt=0;for(var Se=0;Se<(m-1)/2-1;Se+=2)Ve+=N[Se]*(firbuf[We+he+Se]+firbuf[We+he+m-Se]),lt+=N[Se+1]*(firbuf[We+he+Se+1]+firbuf[We+he+m-Se-1]);ae[Te][he]=Ve+lt}Y[z][Te].en.assign(pe.en[Te]),Y[z][Te].thm.assign(pe.thm[Te]),Qe>2&&(H[z][Te].en.assign(pe.en[Te+2]),H[z][Te].thm.assign(pe.thm[Te+2]))}for(var Te=0;Te<Qe;Te++){var $e=vn(12),Ae=vn(12),Ze=[0,0,0,0],Zt=ae[Te&1],Fe=0,st=Te==3?pe.nsPsy.attackthre_s:pe.nsPsy.attackthre,ut=1;if(Te==2)for(var he=0,Se=576;Se>0;++he,--Se){var rn=ae[0][he],As=ae[1][he];ae[0][he]=rn+As,ae[1][he]=rn-As}for(var he=0;he<3;he++)Ae[he]=pe.nsPsy.last_en_subshort[Te][he+6],ct(pe.nsPsy.last_en_subshort[Te][he+4]>0),$e[he]=Ae[he]/pe.nsPsy.last_en_subshort[Te][he+4],Ze[0]+=Ae[he];for(var he=0;he<9;he++){for(var mn=Fe+64,on=1;Fe<mn;Fe++)on<Math.abs(Zt[Fe])&&(on=Math.abs(Zt[Fe]));pe.nsPsy.last_en_subshort[Te][he]=Ae[he+3]=on,Ze[1+he/3]+=on,on>Ae[he+3-2]?(ct(Ae[he+3-2]>0),on=on/Ae[he+3-2]):Ae[he+3-2]>on*10?on=Ae[he+3-2]/(on*10):on=0,$e[he+3]=on}for(var he=0;he<3;++he){var hs=Ae[he*3+3]+Ae[he*3+4]+Ae[he*3+5],Rs=1;Ae[he*3+5]*6<hs&&(Rs*=.5,Ae[he*3+4]*6<hs&&(Rs*=.5)),oe[Te][he]=Rs}if(O.analysis){for(var Cs=$e[0],he=1;he<12;he++)Cs<$e[he]&&(Cs=$e[he]);pe.pinfo.ers[z][Te]=pe.pinfo.ers_save[Te],pe.pinfo.ers_save[Te]=Cs}for(var he=0;he<12;he++)Z[Te][he/3]==0&&$e[he]>st&&(Z[Te][he/3]=he%3+1);for(var he=1;he<4;he++){var ii=Ze[he-1],ri=Ze[he],jn=Math.max(ii,ri);jn<4e4&&ii<1.7*ri&&ri<1.7*ii&&(he==1&&Z[Te][0]<=Z[Te][he]&&(Z[Te][0]=0),Z[Te][he]=0)}Z[Te][0]<=pe.nsPsy.lastAttacks[Te]&&(Z[Te][0]=0),(pe.nsPsy.lastAttacks[Te]==3||Z[Te][0]+Z[Te][1]+Z[Te][2]+Z[Te][3]!=0)&&(ut=0,Z[Te][1]!=0&&Z[Te][0]!=0&&(Z[Te][1]=0),Z[Te][2]!=0&&Z[Te][1]!=0&&(Z[Te][2]=0),Z[Te][3]!=0&&Z[Te][2]!=0&&(Z[Te][3]=0)),Te<2?me[Te]=ut:ut==0&&(me[0]=me[1]=0),J[Te]=pe.tot_ener[Te]}}function $(O,B,q){if(q==0)for(var z=0;z<O.npart_s;z++)O.nb_s2[B][z]=O.nb_s1[B][z],O.nb_s1[B][z]=0}function G(O,B){for(var q=0;q<O.npart_l;q++)O.nb_2[B][q]=O.nb_1[B][q],O.nb_1[B][q]=0}function te(O,B,q,z){var Y=S.length-1,H=0,J=q[H]+q[H+1];if(J>0){var oe=B[H];oe<B[H+1]&&(oe=B[H+1]),ct(O.numlines_s[H]+O.numlines_s[H+1]-1>0),J=20*(oe*2-J)/(J*(O.numlines_s[H]+O.numlines_s[H+1]-1));var Z=0|J;Z>Y&&(Z=Y),z[H]=Z}else z[H]=0;for(H=1;H<O.npart_s-1;H++)if(J=q[H-1]+q[H]+q[H+1],ct(H+1<O.npart_s),J>0){var oe=B[H-1];oe<B[H]&&(oe=B[H]),oe<B[H+1]&&(oe=B[H+1]),ct(O.numlines_s[H-1]+O.numlines_s[H]+O.numlines_s[H+1]-1>0),J=20*(oe*3-J)/(J*(O.numlines_s[H-1]+O.numlines_s[H]+O.numlines_s[H+1]-1));var Z=0|J;Z>Y&&(Z=Y),z[H]=Z}else z[H]=0;if(ct(H==O.npart_s-1),J=q[H-1]+q[H],J>0){var oe=B[H-1];oe<B[H]&&(oe=B[H]),ct(O.numlines_s[H-1]+O.numlines_s[H]-1>0),J=20*(oe*2-J)/(J*(O.numlines_s[H-1]+O.numlines_s[H]-1));var Z=0|J;Z>Y&&(Z=Y),z[H]=Z}else z[H]=0;ct(H==O.npart_s-1)}function le(O,B,q,z,Y,H){var J=O.internal_flags,oe=new float[D.CBANDS],Z=vn(D.CBANDS),me,ae,pe,Pe=new int[D.CBANDS];for(pe=ae=0;pe<J.npart_s;++pe){var Qe=0,Te=0,We=J.numlines_s[pe];for(me=0;me<We;++me,++ae){var he=B[H][ae];Qe+=he,Te<he&&(Te=he)}q[pe]=Qe,oe[pe]=Te,Z[pe]=Qe/We,ct(Z[pe]>=0)}for(ct(pe==J.npart_s);pe<D.CBANDS;++pe)oe[pe]=0,Z[pe]=0;for(te(J,oe,Z,Pe),ae=pe=0;pe<J.npart_s;pe++){var Ve=J.s3ind_s[pe][0],lt=J.s3ind_s[pe][1],Se,$e,Ae,Ze,Zt;for(Se=Pe[Ve],$e=1,Ze=J.s3_ss[ae]*q[Ve]*S[Pe[Ve]],++ae,++Ve;Ve<=lt;)Se+=Pe[Ve],$e+=1,Ae=J.s3_ss[ae]*q[Ve]*S[Pe[Ve]],Ze=T(Ze,Ae,Ve-pe),++ae,++Ve;Se=(1+2*Se)/(2*$e),Zt=S[Se]*.5,Ze*=Zt,z[pe]=Ze,J.nb_s2[Y][pe]=J.nb_s1[Y][pe],J.nb_s1[Y][pe]=Ze,Ae=oe[pe],Ae*=J.minval_s[pe],Ae*=Zt,z[pe]>Ae&&(z[pe]=Ae),J.masking_lower>1&&(z[pe]*=J.masking_lower),z[pe]>q[pe]&&(z[pe]=q[pe]),J.masking_lower<1&&(z[pe]*=J.masking_lower),ct(z[pe]>=0)}for(;pe<D.CBANDS;++pe)q[pe]=0,z[pe]=0}function Q(O,B,q,z,Y){var H=vn(D.CBANDS),J=vn(D.CBANDS),oe=ro(D.CBANDS+2),Z;ze(O,B,q,H,J),De(O,H,J,oe);var me=0;for(Z=0;Z<O.npart_l;Z++){var ae,pe,Pe,Qe,Te=O.s3ind[Z][0],We=O.s3ind[Z][1],he=0,Ve=0;for(he=oe[Te],Ve+=1,pe=O.s3_ll[me]*q[Te]*S[oe[Te]],++me,++Te;Te<=We;)he+=oe[Te],Ve+=1,ae=O.s3_ll[me]*q[Te]*S[oe[Te]],Qe=T(pe,ae,Te-Z),pe=Qe,++me,++Te;if(he=(1+2*he)/(2*Ve),Pe=S[he]*.5,pe*=Pe,O.blocktype_old[Y&1]==D.SHORT_TYPE){var lt=n*O.nb_1[Y][Z];lt>0?z[Z]=Math.min(pe,lt):z[Z]=Math.min(pe,q[Z]*u)}else{var Se=s*O.nb_2[Y][Z],$e=n*O.nb_1[Y][Z],lt;Se<=0&&(Se=pe),$e<=0&&($e=pe),O.blocktype_old[Y&1]==D.NORM_TYPE?lt=Math.min($e,Se):lt=$e,z[Z]=Math.min(pe,lt)}O.nb_2[Y][Z]=O.nb_1[Y][Z],O.nb_1[Y][Z]=pe,ae=H[Z],ae*=O.minval_l[Z],ae*=Pe,z[Z]>ae&&(z[Z]=ae),O.masking_lower>1&&(z[Z]*=O.masking_lower),z[Z]>q[Z]&&(z[Z]=q[Z]),O.masking_lower<1&&(z[Z]*=O.masking_lower),ct(z[Z]>=0)}for(;Z<D.CBANDS;++Z)q[Z]=0,z[Z]=0}function se(O,B){var q=O.internal_flags;O.short_blocks==Ea.short_block_coupled&&!(B[0]!=0&&B[1]!=0)&&(B[0]=B[1]=0);for(var z=0;z<q.channels_out;z++)O.short_blocks==Ea.short_block_dispensed&&(B[z]=1),O.short_blocks==Ea.short_block_forced&&(B[z]=0)}function X(O,B,q){for(var z=O.internal_flags,Y=0;Y<z.channels_out;Y++){var H=D.NORM_TYPE;B[Y]!=0?(ct(z.blocktype_old[Y]!=D.START_TYPE),z.blocktype_old[Y]==D.SHORT_TYPE&&(H=D.STOP_TYPE)):(H=D.SHORT_TYPE,z.blocktype_old[Y]==D.NORM_TYPE&&(z.blocktype_old[Y]=D.START_TYPE),z.blocktype_old[Y]==D.STOP_TYPE&&(z.blocktype_old[Y]=D.SHORT_TYPE)),q[Y]=z.blocktype_old[Y],z.blocktype_old[Y]=H}}function ve(O,B,q,z,Y,H,J){for(var oe=H*2,Z=H>0?Math.pow(10,Y):1,me,ae,pe=0;pe<J;++pe){var Pe=O[2][pe],Qe=O[3][pe],Te=B[0][pe],We=B[1][pe],he=B[2][pe],Ve=B[3][pe];if(Te<=1.58*We&&We<=1.58*Te){var lt=q[pe]*Qe,Se=q[pe]*Pe;ae=Math.max(he,Math.min(Ve,lt)),me=Math.max(Ve,Math.min(he,Se))}else ae=he,me=Ve;if(H>0){var $e,Ae,Ze=z[pe]*Z;if($e=Math.min(Math.max(Te,Ze),Math.max(We,Ze)),he=Math.max(ae,Ze),Ve=Math.max(me,Ze),Ae=he+Ve,Ae>0&&$e*oe<Ae){var Zt=$e*oe/Ae;he*=Zt,Ve*=Zt}ae=Math.min(he,ae),me=Math.min(Ve,me)}ae>Pe&&(ae=Pe),me>Qe&&(me=Qe),B[2][pe]=ae,B[3][pe]=me}}this.L3psycho_anal_vbr=function(O,B,q,z,Y,H,J,oe,Z,me){var ae=O.internal_flags,pe,Pe,Qe=vn(D.HBLKSIZE),Te=Gs([3,D.HBLKSIZE_s]),We=Gs([2,D.BLKSIZE]),he=Gs([2,3,D.BLKSIZE_s]),Ve=Gs([4,D.CBANDS]),lt=Gs([4,D.CBANDS]),Se=Gs([4,3]),$e=.6,Ae=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ze=ro(2),Zt=O.mode==Nt.JOINT_STEREO?4:ae.channels_out;V(O,B,q,z,Y,H,Z,Se,Ae,Ze),se(O,Ze);{for(var Fe=0;Fe<Zt;Fe++){var st=Fe&1;pe=We,Xe(O,B,q,Fe,z,Qe,pe,st),E(O,z,Fe,Qe),Ze[st]!=0?Q(ae,Qe,Ve[Fe],lt[Fe],Fe):G(ae,Fe)}Ze[0]+Ze[1]==2&&O.mode==Nt.JOINT_STEREO&&ve(Ve,lt,ae.mld_cb_l,ae.ATH.cb_l,O.ATHlower*ae.ATH.adjust,O.msfix,ae.npart_l);for(var Fe=0;Fe<Zt;Fe++){var st=Fe&1;Ze[st]!=0&&g(ae,Ve[Fe],lt[Fe],Fe)}}{for(var ut=0;ut<3;ut++){for(var Fe=0;Fe<Zt;++Fe){var st=Fe&1;Ze[st]!=0?$(ae,Fe,ut):(Pe=he,mt(O,B,q,Fe,ut,Te,Pe,st),le(O,Te,Ve[Fe],lt[Fe],Fe,ut))}Ze[0]+Ze[1]==0&&O.mode==Nt.JOINT_STEREO&&ve(Ve,lt,ae.mld_cb_s,ae.ATH.cb_s,O.ATHlower*ae.ATH.adjust,O.msfix,ae.npart_s);for(var Fe=0;Fe<Zt;++Fe){var st=Fe&1;Ze[st]==0&&K(ae,Ve[Fe],lt[Fe],Fe,ut)}}for(var Fe=0;Fe<Zt;Fe++){var st=Fe&1;if(Ze[st]==0)for(var rn=0;rn<D.SBMAX_s;rn++){for(var As=vn(3),ut=0;ut<3;ut++){var mn=ae.thm[Fe].s[rn][ut];if(mn*=c,Ae[Fe][ut]>=2||Ae[Fe][ut+1]==1){var on=ut!=0?ut-1:2,hs=ne(ae.thm[Fe].s[rn][on],mn,d*$e);mn=Math.min(mn,hs)}else if(Ae[Fe][ut]==1){var on=ut!=0?ut-1:2,hs=ne(ae.thm[Fe].s[rn][on],mn,u*$e);mn=Math.min(mn,hs)}else if(ut!=0&&Ae[Fe][ut-1]==3||ut==0&&ae.nsPsy.lastAttacks[Fe]==3){var on=ut!=2?ut+1:0,hs=ne(ae.thm[Fe].s[rn][on],mn,u*$e);mn=Math.min(mn,hs)}mn*=Se[Fe][ut],As[ut]=mn}for(var ut=0;ut<3;ut++)ae.thm[Fe].s[rn][ut]=As[ut]}}}for(var Fe=0;Fe<Zt;Fe++)ae.nsPsy.lastAttacks[Fe]=Ae[Fe][2];X(O,Ze,me);for(var Fe=0;Fe<Zt;Fe++){var Rs,Cs,ii,ri;Fe>1?(Rs=oe,Cs=-2,ii=D.NORM_TYPE,(me[0]==D.SHORT_TYPE||me[1]==D.SHORT_TYPE)&&(ii=D.SHORT_TYPE),ri=H[z][Fe-2]):(Rs=J,Cs=0,ii=me[Fe],ri=Y[z][Fe]),ii==D.SHORT_TYPE?Rs[Cs+Fe]=Ie(ri,ae.masking_lower):Rs[Cs+Fe]=be(ri,ae.masking_lower),O.analysis&&(ae.pinfo.pe[z][Fe]=Rs[Cs+Fe])}return 0};function de(O,B){var q=O,z;return q>=0?z=-q*27:z=q*B,z<=-72?0:Math.exp(z*h)}function ye(O){var B=0,q=0;{var z=0,Y,H;for(z=0;de(z,O)>1e-20;z-=1);for(Y=z,H=0;Math.abs(H-Y)>1e-12;)z=(H+Y)/2,de(z,O)>0?H=z:Y=z;B=Y}{var z=0,Y,H;for(z=0;de(z,O)>1e-20;z+=1);for(Y=0,H=z;Math.abs(H-Y)>1e-12;)z=(H+Y)/2,de(z,O)>0?Y=z:H=z;q=H}{var J=0,oe=1e3,Z;for(Z=0;Z<=oe;++Z){var z=B+Z*(q-B)/oe,me=de(z,O);J+=me}{var ae=(oe+1)/(J*(q-B));return ae}}}function Re(O){var B,q,z,Y;return B=O,B>=0?B*=3:B*=1.5,B>=.5&&B<=2.5?(Y=B-.5,q=8*(Y*Y-2*Y)):q=0,B+=.474,z=15.811389+7.5*B-17.5*Math.sqrt(1+B*B),z<=-60?0:(B=Math.exp((q+z)*h),B/=.6609193,B)}function Le(O){return O<0&&(O=0),O=O*.001,13*Math.atan(.76*O)+3.5*Math.atan(O*O/(7.5*7.5))}function ce(O,B,q,z,Y,H,J,oe,Z,me,ae,pe){var Pe=vn(D.CBANDS+1),Qe=oe/(pe>15?2*576:2*192),Te=ro(D.HBLKSIZE),We;oe/=Z;var he=0,Ve=0;for(We=0;We<D.CBANDS;We++){var lt,Se;for(lt=Le(oe*he),Pe[We]=oe*he,Se=he;Le(oe*Se)-lt<o&&Se<=Z/2;Se++);for(O[We]=Se-he,Ve=We+1;he<Se;)Te[he++]=We;if(he>Z/2){he=Z/2,++We;break}}Pe[We]=oe*he;for(var $e=0;$e<pe;$e++){var Ae,Ze,Zt,Fe,st;Zt=me[$e],Fe=me[$e+1],Ae=0|Math.floor(.5+ae*(Zt-.5)),Ae<0&&(Ae=0),Ze=0|Math.floor(.5+ae*(Fe-.5)),Ze>Z/2&&(Ze=Z/2),q[$e]=(Te[Ae]+Te[Ze])/2,B[$e]=Te[Ze];var ut=Qe*Fe;J[$e]=(ut-Pe[B[$e]])/(Pe[B[$e]+1]-Pe[B[$e]]),J[$e]<0?J[$e]=0:J[$e]>1&&(J[$e]=1),st=Le(oe*me[$e]*ae),st=Math.min(st,15.5)/15.5,H[$e]=Math.pow(10,1.25*(1-Math.cos(Math.PI*st))-2.5)}he=0;for(var rn=0;rn<Ve;rn++){var As=O[rn],lt,mn;lt=Le(oe*he),mn=Le(oe*(he+As-1)),z[rn]=.5*(lt+mn),lt=Le(oe*(he-.5)),mn=Le(oe*(he+As-.5)),Y[rn]=mn-lt,he+=As}return Ve}function _e(O,B,q,z,Y,H){var J=Gs([D.CBANDS,D.CBANDS]),oe,Z=0;if(H)for(var me=0;me<B;me++)for(oe=0;oe<B;oe++){var ae=Re(q[me]-q[oe])*z[oe];J[me][oe]=ae*Y[me]}else for(oe=0;oe<B;oe++)for(var pe=15+Math.min(21/q[oe],12),Pe=ye(pe),me=0;me<B;me++){var ae=Pe*de(q[me]-q[oe],pe)*z[oe];J[me][oe]=ae*Y[me]}for(var me=0;me<B;me++){for(oe=0;oe<B&&!(J[me][oe]>0);oe++);for(O[me][0]=oe,oe=B-1;oe>0&&!(J[me][oe]>0);oe--);O[me][1]=oe,Z+=O[me][1]-O[me][0]+1}for(var Qe=vn(Z),Te=0,me=0;me<B;me++)for(oe=O[me][0];oe<=O[me][1];oe++)Qe[Te++]=J[me][oe];return Qe}function ie(O){var B=Le(O);return B=Math.min(B,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*B))-2.5)}this.psymodel_init=function(O){var B=O.internal_flags,q,z=!0,Y=13,H=24,J=0,oe=0,Z=-8.25,me=-4.5,ae=vn(D.CBANDS),pe=vn(D.CBANDS),Pe=vn(D.CBANDS),Qe=O.out_samplerate;switch(O.experimentalZ){default:case 0:z=!0;break;case 1:z=!(O.VBR==wa.vbr_mtrh||O.VBR==wa.vbr_mt);break;case 2:z=!1;break;case 3:Y=8,J=-1.75,oe=-.0125,Z=-8.25,me=-2.25;break}for(B.ms_ener_ratio_old=.25,B.blocktype_old[0]=B.blocktype_old[1]=D.NORM_TYPE,q=0;q<4;++q){for(var he=0;he<D.CBANDS;++he)B.nb_1[q][he]=1e20,B.nb_2[q][he]=1e20,B.nb_s1[q][he]=B.nb_s2[q][he]=1;for(var Te=0;Te<D.SBMAX_l;Te++)B.en[q].l[Te]=1e20,B.thm[q].l[Te]=1e20;for(var he=0;he<3;++he){for(var Te=0;Te<D.SBMAX_s;Te++)B.en[q].s[Te][he]=1e20,B.thm[q].s[Te][he]=1e20;B.nsPsy.lastAttacks[q]=0}for(var he=0;he<9;he++)B.nsPsy.last_en_subshort[q][he]=10}for(B.loudness_sq_save[0]=B.loudness_sq_save[1]=0,B.npart_l=ce(B.numlines_l,B.bo_l,B.bm_l,ae,pe,B.mld_l,B.PSY.bo_l_weight,Qe,D.BLKSIZE,B.scalefac_band.l,D.BLKSIZE/(2*576),D.SBMAX_l),ct(B.npart_l<D.CBANDS),q=0;q<B.npart_l;q++){var We=J;ae[q]>=Y&&(We=oe*(ae[q]-Y)/(H-Y)+J*(H-ae[q])/(H-Y)),Pe[q]=Math.pow(10,We/10),B.numlines_l[q]>0?B.rnumlines_l[q]=1/B.numlines_l[q]:B.rnumlines_l[q]=0}B.s3_ll=_e(B.s3ind,B.npart_l,ae,pe,Pe,z);var he=0;for(q=0;q<B.npart_l;q++){var Ve;Ve=D3.MAX_VALUE;for(var lt=0;lt<B.numlines_l[q];lt++,he++){var Se=Qe*he/(1e3*D.BLKSIZE),$e;$e=this.ATHformula(Se*1e3,O)-20,$e=Math.pow(10,.1*$e),$e*=B.numlines_l[q],Ve>$e&&(Ve=$e)}B.ATH.cb_l[q]=Ve,Ve=-20+ae[q]*20/10,Ve>6&&(Ve=100),Ve<-15&&(Ve=-15),Ve-=8,B.minval_l[q]=Math.pow(10,Ve/10)*B.numlines_l[q]}for(B.npart_s=ce(B.numlines_s,B.bo_s,B.bm_s,ae,pe,B.mld_s,B.PSY.bo_s_weight,Qe,D.BLKSIZE_s,B.scalefac_band.s,D.BLKSIZE_s/(2*192),D.SBMAX_s),ct(B.npart_s<D.CBANDS),he=0,q=0;q<B.npart_s;q++){var Ve,We=Z;ae[q]>=Y&&(We=me*(ae[q]-Y)/(H-Y)+Z*(H-ae[q])/(H-Y)),Pe[q]=Math.pow(10,We/10),Ve=D3.MAX_VALUE;for(var lt=0;lt<B.numlines_s[q];lt++,he++){var Se=Qe*he/(1e3*D.BLKSIZE_s),$e;$e=this.ATHformula(Se*1e3,O)-20,$e=Math.pow(10,.1*$e),$e*=B.numlines_s[q],Ve>$e&&(Ve=$e)}B.ATH.cb_s[q]=Ve,Ve=-7+ae[q]*7/12,ae[q]>12&&(Ve*=1+Math.log(1+Ve)*3.1),ae[q]<12&&(Ve*=1+Math.log(1-Ve)*2.3),Ve<-15&&(Ve=-15),Ve-=8,B.minval_s[q]=Math.pow(10,Ve/10)*B.numlines_s[q]}B.s3_ss=_e(B.s3ind_s,B.npart_s,ae,pe,Pe,z),x(),t.init_fft(B),B.decay=Math.exp(-1*e/(l*Qe/192));{var Ae;Ae=f,(O.exp_nspsytune&2)!=0&&(Ae=1),Math.abs(O.msfix)>0&&(Ae=O.msfix),O.msfix=Ae;for(var Ze=0;Ze<B.npart_l;Ze++)B.s3ind[Ze][1]>B.npart_l-1&&(B.s3ind[Ze][1]=B.npart_l-1)}var Zt=576*B.mode_gr/Qe;if(B.ATH.decay=Math.pow(10,-12/10*Zt),B.ATH.adjust=.01,B.ATH.adjustLimit=1,ct(B.bo_l[D.SBMAX_l-1]<=B.npart_l),ct(B.bo_s[D.SBMAX_s-1]<=B.npart_s),O.ATHtype!=-1){var Se,Fe=O.out_samplerate/D.BLKSIZE,st=0;for(Se=0,q=0;q<D.BLKSIZE/2;++q)Se+=Fe,B.ATH.eql_w[q]=1/Math.pow(10,this.ATHformula(Se,O)/10),st+=B.ATH.eql_w[q];for(st=1/st,q=D.BLKSIZE/2;--q>=0;)B.ATH.eql_w[q]*=st}{for(var Ze=he=0;Ze<B.npart_s;++Ze)for(q=0;q<B.numlines_s[Ze];++q)++he;for(var Ze=he=0;Ze<B.npart_l;++Ze)for(q=0;q<B.numlines_l[Ze];++q)++he}for(he=0,q=0;q<B.npart_l;q++){var Se=Qe*(he+B.numlines_l[q]/2)/(1*D.BLKSIZE);B.mld_cb_l[q]=ie(Se),he+=B.numlines_l[q]}for(;q<D.CBANDS;++q)B.mld_cb_l[q]=1;for(he=0,q=0;q<B.npart_s;q++){var Se=Qe*(he+B.numlines_s[q]/2)/(1*D.BLKSIZE_s);B.mld_cb_s[q]=ie(Se),he+=B.numlines_s[q]}for(;q<D.CBANDS;++q)B.mld_cb_s[q]=1;return 0};function Ne(O,B){O<-.3&&(O=3410),O/=1e3,O=Math.max(.1,O);var q=3.64*Math.pow(O,-.8)-6.8*Math.exp(-.6*Math.pow(O-3.4,2))+6*Math.exp(-.15*Math.pow(O-8.7,2))+(.6+.04*B)*.001*Math.pow(O,4);return q}this.ATHformula=function(O,B){var q;switch(B.ATHtype){case 0:q=Ne(O,9);break;case 1:q=Ne(O,-1);break;case 2:q=Ne(O,0);break;case 3:q=Ne(O,1)+6;break;case 4:q=Ne(O,B.ATHcurve);break;default:q=Ne(O,0);break}return q}}function s$(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=Nt.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var Br={};Br.SFBMAX=D.SBMAX_s*3;var i$=Oe.new_float,oo=Oe.new_int;function Qd(){this.xr=i$(576),this.l3_enc=oo(576),this.scalefac=oo(Br.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=oo(3),this.subblock_gain=oo(3+1),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=oo(Br.SFBMAX),this.window=oo(Br.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=oo(4),this.max_nonzero_coeff=0;var t=this;function e(s){return new Int32Array(s)}function n(s){return new Float32Array(s)}this.assign=function(s){t.xr=n(s.xr),t.l3_enc=e(s.l3_enc),t.scalefac=e(s.scalefac),t.xrpow_max=s.xrpow_max,t.part2_3_length=s.part2_3_length,t.big_values=s.big_values,t.count1=s.count1,t.global_gain=s.global_gain,t.scalefac_compress=s.scalefac_compress,t.block_type=s.block_type,t.mixed_block_flag=s.mixed_block_flag,t.table_select=e(s.table_select),t.subblock_gain=e(s.subblock_gain),t.region0_count=s.region0_count,t.region1_count=s.region1_count,t.preflag=s.preflag,t.scalefac_scale=s.scalefac_scale,t.count1table_select=s.count1table_select,t.part2_length=s.part2_length,t.sfb_lmax=s.sfb_lmax,t.sfb_smin=s.sfb_smin,t.psy_lmax=s.psy_lmax,t.sfbmax=s.sfbmax,t.psymax=s.psymax,t.sfbdivide=s.sfbdivide,t.width=e(s.width),t.window=e(s.window),t.count1bits=s.count1bits,t.sfb_partition_table=s.sfb_partition_table.slice(0),t.slen=e(s.slen),t.max_nonzero_coeff=s.max_nonzero_coeff}}var B3=Oe.new_int;function r$(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[B3(4),B3(4)];for(var t=0;t<2;t++)for(var e=0;e<2;e++)this.tt[t][e]=new Qd}var Mh=Oe.System,Nh=Oe.new_int;function Si(t,e,n,s){this.l=Nh(1+D.SBMAX_l),this.s=Nh(1+D.SBMAX_s),this.psfb21=Nh(1+D.PSFB21),this.psfb12=Nh(1+D.PSFB12);var i=this.l,r=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],Mh.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),Mh.arraycopy(this.arrS,0,r,0,Math.min(this.arrS.length,this.s.length)),Mh.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),Mh.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Lm=Oe.new_float,o$=Oe.new_float_n,a$=Oe.new_int;function l$(){this.last_en_subshort=o$([4,9]),this.lastAttacks=a$(4),this.pefirbuf=Lm(19),this.longfact=Lm(D.SBMAX_l),this.shortfact=Lm(D.SBMAX_s),this.attackthre=0,this.attackthre_s=0}function c$(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var u$=Oe.new_byte,h$=Oe.new_double,Ws=Oe.new_float,ao=Oe.new_float_n,oi=Oe.new_int,Oh=Oe.new_int_n;Ct.MFSIZE=3*1152+D.ENCDELAY-D.MDCTDELAY;Ct.MAX_HEADER_BUF=256;Ct.MAX_BITS_PER_CHANNEL=4095;Ct.MAX_BITS_PER_GRANULE=7680;Ct.BPC=320;function Ct(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=ao([2,Ct.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new r$,this.ms_ratio=Ws(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=oi(2),this.CurrentStep=oi(2),this.masking_lower=0,this.bv_scf=oi(576),this.pseudohalf=oi(Br.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Ct.BPC+1),this.itime=h$(2),this.sideinfo_len=0,this.sb_sample=ao([2,2,18,D.SBLIMIT]),this.amp_filter=Ws(32);function e(){this.write_timing=0,this.ptr=0,this.buf=u$(t)}this.header=new Array(Ct.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new Si,this.minval_l=Ws(D.CBANDS),this.minval_s=Ws(D.CBANDS),this.nb_1=ao([4,D.CBANDS]),this.nb_2=ao([4,D.CBANDS]),this.nb_s1=ao([4,D.CBANDS]),this.nb_s2=ao([4,D.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ws(4),this.loudness_sq=ao([2,2]),this.loudness_sq_save=Ws(2),this.mld_l=Ws(D.SBMAX_l),this.mld_s=Ws(D.SBMAX_s),this.bm_l=oi(D.SBMAX_l),this.bo_l=oi(D.SBMAX_l),this.bm_s=oi(D.SBMAX_s),this.bo_s=oi(D.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Oh([D.CBANDS,2]),this.s3ind_s=Oh([D.CBANDS,2]),this.numlines_s=oi(D.CBANDS),this.numlines_l=oi(D.CBANDS),this.rnumlines_l=Ws(D.CBANDS),this.mld_cb_l=Ws(D.CBANDS),this.mld_cb_s=Ws(D.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ws(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=oi(2),this.nsPsy=new l$,this.VBR_seek_table=new c$,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Oh([16,4+1]),this.bitrate_blockType_Hist=Oh([16,4+1+1]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new Xd;for(var n=0;n<this.thm.length;n++)this.thm[n]=new Xd;for(var n=0;n<this.header.length;n++)this.header[n]=new e}var lo=Oe.new_float;function d$(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=lo(D.SBMAX_l),this.s=lo(D.SBMAX_s),this.psfb21=lo(D.PSFB21),this.psfb12=lo(D.PSFB12),this.cb_l=lo(D.CBANDS),this.cb_s=lo(D.CBANDS),this.eql_w=lo(D.BLKSIZE/2)}var ms=Oe.System,F3=Oe.Arrays;dn.STEPS_per_dB=100;dn.MAX_dB=120;dn.GAIN_NOT_ENOUGH_SAMPLES=-24601;dn.GAIN_ANALYSIS_ERROR=0;dn.GAIN_ANALYSIS_OK=1;dn.INIT_GAIN_ANALYSIS_ERROR=0;dn.INIT_GAIN_ANALYSIS_OK=1;dn.YULE_ORDER=10;dn.MAX_ORDER=dn.YULE_ORDER;dn.MAX_SAMP_FREQ=48e3;dn.RMS_WINDOW_TIME_NUMERATOR=1;dn.RMS_WINDOW_TIME_DENOMINATOR=20;dn.MAX_SAMPLES_PER_WINDOW=dn.MAX_SAMP_FREQ*dn.RMS_WINDOW_TIME_NUMERATOR/dn.RMS_WINDOW_TIME_DENOMINATOR+1;function dn(){var t=64.82,e=.95,n=dn.RMS_WINDOW_TIME_NUMERATOR,s=dn.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],r=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(u,f,m,h,k,I){for(;k--!=0;)m[h]=1e-10+u[f+0]*I[0]-m[h-1]*I[1]+u[f-1]*I[2]-m[h-2]*I[3]+u[f-2]*I[4]-m[h-3]*I[5]+u[f-3]*I[6]-m[h-4]*I[7]+u[f-4]*I[8]-m[h-5]*I[9]+u[f-5]*I[10]-m[h-6]*I[11]+u[f-6]*I[12]-m[h-7]*I[13]+u[f-7]*I[14]-m[h-8]*I[15]+u[f-8]*I[16]-m[h-9]*I[17]+u[f-9]*I[18]-m[h-10]*I[19]+u[f-10]*I[20],++h,++f}function a(u,f,m,h,k,I){for(;k--!=0;)m[h]=u[f+0]*I[0]-m[h-1]*I[1]+u[f-1]*I[2]-m[h-2]*I[3]+u[f-2]*I[4],++h,++f}function l(u,f){for(var m=0;m<MAX_ORDER;m++)u.linprebuf[m]=u.lstepbuf[m]=u.loutbuf[m]=u.rinprebuf[m]=u.rstepbuf[m]=u.routbuf[m]=0;switch(0|f){case 48e3:u.reqindex=0;break;case 44100:u.reqindex=1;break;case 32e3:u.reqindex=2;break;case 24e3:u.reqindex=3;break;case 22050:u.reqindex=4;break;case 16e3:u.reqindex=5;break;case 12e3:u.reqindex=6;break;case 11025:u.reqindex=7;break;case 8e3:u.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return u.sampleWindow=0|(f*n+s-1)/s,u.lsum=0,u.rsum=0,u.totsamp=0,F3.ill(u.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(u,f){return l(u,f)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(u.linpre=MAX_ORDER,u.rinpre=MAX_ORDER,u.lstep=MAX_ORDER,u.rstep=MAX_ORDER,u.lout=MAX_ORDER,u.rout=MAX_ORDER,F3.fill(u.B,0),INIT_GAIN_ANALYSIS_OK)};function c(u){return u*u}this.AnalyzeSamples=function(u,f,m,h,k,I,L){var p,C,P,M,F,_,S;if(I==0)return GAIN_ANALYSIS_OK;switch(S=0,F=I,L){case 1:h=f,k=m;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(I<MAX_ORDER?(ms.arraycopy(f,m,u.linprebuf,MAX_ORDER,I),ms.arraycopy(h,k,u.rinprebuf,MAX_ORDER,I)):(ms.arraycopy(f,m,u.linprebuf,MAX_ORDER,MAX_ORDER),ms.arraycopy(h,k,u.rinprebuf,MAX_ORDER,MAX_ORDER));F>0;){_=F>u.sampleWindow-u.totsamp?u.sampleWindow-u.totsamp:F,S<MAX_ORDER?(p=u.linpre+S,C=u.linprebuf,P=u.rinpre+S,M=u.rinprebuf,_>MAX_ORDER-S&&(_=MAX_ORDER-S)):(p=m+S,C=f,P=k+S,M=h),o(C,p,u.lstepbuf,u.lstep+u.totsamp,_,i[u.reqindex]),o(M,P,u.rstepbuf,u.rstep+u.totsamp,_,i[u.reqindex]),a(u.lstepbuf,u.lstep+u.totsamp,u.loutbuf,u.lout+u.totsamp,_,r[u.reqindex]),a(u.rstepbuf,u.rstep+u.totsamp,u.routbuf,u.rout+u.totsamp,_,r[u.reqindex]),p=u.lout+u.totsamp,C=u.loutbuf,P=u.rout+u.totsamp,M=u.routbuf;for(var x=_%8;x--!=0;)u.lsum+=c(C[p++]),u.rsum+=c(M[P++]);for(x=_/8;x--!=0;)u.lsum+=c(C[p+0])+c(C[p+1])+c(C[p+2])+c(C[p+3])+c(C[p+4])+c(C[p+5])+c(C[p+6])+c(C[p+7]),p+=8,u.rsum+=c(M[P+0])+c(M[P+1])+c(M[P+2])+c(M[P+3])+c(M[P+4])+c(M[P+5])+c(M[P+6])+c(M[P+7]),P+=8;if(F-=_,S+=_,u.totsamp+=_,u.totsamp==u.sampleWindow){var v=dn.STEPS_per_dB*10*Math.log10((u.lsum+u.rsum)/u.totsamp*.5+1e-37),w=v<=0?0:0|v;w>=u.A.length&&(w=u.A.length-1),u.A[w]++,u.lsum=u.rsum=0,ms.arraycopy(u.loutbuf,u.totsamp,u.loutbuf,0,MAX_ORDER),ms.arraycopy(u.routbuf,u.totsamp,u.routbuf,0,MAX_ORDER),ms.arraycopy(u.lstepbuf,u.totsamp,u.lstepbuf,0,MAX_ORDER),ms.arraycopy(u.rstepbuf,u.totsamp,u.rstepbuf,0,MAX_ORDER),u.totsamp=0}if(u.totsamp>u.sampleWindow)return GAIN_ANALYSIS_ERROR}return I<MAX_ORDER?(ms.arraycopy(u.linprebuf,I,u.linprebuf,0,MAX_ORDER-I),ms.arraycopy(u.rinprebuf,I,u.rinprebuf,0,MAX_ORDER-I),ms.arraycopy(f,m,u.linprebuf,MAX_ORDER-I,I),ms.arraycopy(h,k,u.rinprebuf,MAX_ORDER-I,I)):(ms.arraycopy(f,m+I-MAX_ORDER,u.linprebuf,0,MAX_ORDER),ms.arraycopy(h,k+I-MAX_ORDER,u.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function d(u,f){var m,h=0;for(m=0;m<f;m++)h+=u[m];if(h==0)return GAIN_NOT_ENOUGH_SAMPLES;var k=0|Math.ceil(h*(1-e));for(m=f;m-- >0&&!((k-=u[m])<=0););return t-m/dn.STEPS_per_dB}this.GetTitleGain=function(u){for(var f=d(u.A,u.A.length),m=0;m<u.A.length;m++)u.B[m]+=u.A[m],u.A[m]=0;for(var m=0;m<MAX_ORDER;m++)u.linprebuf[m]=u.lstepbuf[m]=u.loutbuf[m]=u.rinprebuf[m]=u.rstepbuf[m]=u.routbuf[m]=0;return u.totsamp=0,u.lsum=u.rsum=0,f}}var xa=Oe.new_float,U3=Oe.new_int;function f$(){this.linprebuf=xa(void 0*2),this.linpre=0,this.lstepbuf=xa(void 0+void 0),this.lstep=0,this.loutbuf=xa(void 0+void 0),this.lout=0,this.rinprebuf=xa(void 0*2),this.rinpre=0,this.rstepbuf=xa(void 0+void 0),this.rstep=0,this.routbuf=xa(void 0+void 0),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=U3(0|void 0*void 0),this.B=U3(0|void 0*void 0)}function CS(t){this.bits=t}var j3=Oe.new_float,m$=Oe.new_int,H3=Oe.assert;function p$(t){var e=t;this.quantize=e,this.iteration_loop=function(n,s,i,r){var o=n.internal_flags,a=j3(Br.SFBMAX),l=j3(576),c=m$(2),d=0,u,f=o.l3_side,m=new CS(d);this.quantize.rv.ResvFrameBegin(n,m),d=m.bits;for(var h=0;h<o.mode_gr;h++){u=this.quantize.qupvt.on_pe(n,s,c,d,h,h),o.mode_ext==D.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,h),this.quantize.qupvt.reduce_side(c,i[h],d,u));for(var k=0;k<o.channels_out;k++){var I,L,p=f.tt[h][k];p.block_type!=D.SHORT_TYPE?(I=0,L=o.PSY.mask_adjust-I):(I=0,L=o.PSY.mask_adjust_short-I),o.masking_lower=Math.pow(10,L*.1),this.quantize.init_outer_loop(o,p),this.quantize.init_xrpow(o,p,l)&&(this.quantize.qupvt.calc_xmin(n,r[h][k],p,a),this.quantize.outer_loop(n,p,a,l,k,c[k])),this.quantize.iteration_finish_one(o,h,k),H3(p.part2_3_length<=Ct.MAX_BITS_PER_CHANNEL),H3(p.part2_3_length<=c[k])}}this.quantize.rv.ResvFrameEnd(o,d)}}function At(t,e,n,s){this.xlen=t,this.linmax=e,this.table=n,this.hlen=s}var fe={};fe.t1HB=[1,1,1,0];fe.t2HB=[1,2,1,3,1,1,3,2,0];fe.t3HB=[3,2,1,1,1,1,3,2,0];fe.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];fe.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];fe.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];fe.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];fe.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];fe.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];fe.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];fe.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];fe.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];fe.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];fe.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];fe.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];fe.t32HB=[1<<0,5<<1,4<<1,5<<2,6<<1,5<<2,4<<2,4<<3,7<<1,3<<2,6<<2,0<<3,7<<2,2<<3,3<<3,1<<4];fe.t33HB=[15<<0,14<<1,13<<1,12<<2,11<<1,10<<2,9<<2,8<<3,7<<1,6<<2,5<<2,4<<3,3<<2,2<<3,1<<3,0<<4];fe.t1l=[1,4,3,5];fe.t2l=[1,4,7,4,5,7,6,7,8];fe.t3l=[2,3,7,4,4,7,6,7,8];fe.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];fe.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];fe.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];fe.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];fe.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];fe.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];fe.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];fe.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];fe.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];fe.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];fe.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];fe.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];fe.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];fe.t32l=[1+0,4+1,4+1,5+2,4+1,6+2,5+2,6+3,4+1,5+2,5+2,6+3,5+2,6+3,6+3,6+4];fe.t33l=[4+0,4+1,4+1,4+2,4+1,4+2,4+2,4+3,4+1,4+2,4+2,4+3,4+2,4+3,4+3,4+4];fe.ht=[new At(0,0,null,null),new At(2,0,fe.t1HB,fe.t1l),new At(3,0,fe.t2HB,fe.t2l),new At(3,0,fe.t3HB,fe.t3l),new At(0,0,null,null),new At(4,0,fe.t5HB,fe.t5l),new At(4,0,fe.t6HB,fe.t6l),new At(6,0,fe.t7HB,fe.t7l),new At(6,0,fe.t8HB,fe.t8l),new At(6,0,fe.t9HB,fe.t9l),new At(8,0,fe.t10HB,fe.t10l),new At(8,0,fe.t11HB,fe.t11l),new At(8,0,fe.t12HB,fe.t12l),new At(16,0,fe.t13HB,fe.t13l),new At(0,0,null,fe.t16_5l),new At(16,0,fe.t15HB,fe.t15l),new At(1,1,fe.t16HB,fe.t16l),new At(2,3,fe.t16HB,fe.t16l),new At(3,7,fe.t16HB,fe.t16l),new At(4,15,fe.t16HB,fe.t16l),new At(6,63,fe.t16HB,fe.t16l),new At(8,255,fe.t16HB,fe.t16l),new At(10,1023,fe.t16HB,fe.t16l),new At(13,8191,fe.t16HB,fe.t16l),new At(4,15,fe.t24HB,fe.t24l),new At(5,31,fe.t24HB,fe.t24l),new At(6,63,fe.t24HB,fe.t24l),new At(7,127,fe.t24HB,fe.t24l),new At(8,255,fe.t24HB,fe.t24l),new At(9,511,fe.t24HB,fe.t24l),new At(11,2047,fe.t24HB,fe.t24l),new At(13,8191,fe.t24HB,fe.t24l),new At(0,0,fe.t32HB,fe.t32l),new At(0,0,fe.t33HB,fe.t33l)];fe.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];fe.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];fe.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];fe.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];fe.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];fe.scfsi_band=[0,6,11,16,21];var co=Oe.VbrMode,Lh=Oe.Float,Pm=Oe.Util,uo=Oe.new_float,g$=Oe.new_int,Gl=Oe.assert;Vn.Q_MAX=256+1;Vn.Q_MAX2=116;Vn.LARGE_BITS=1e5;Vn.IXMAX_VAL=8206;function Vn(){var t=null,e=null,n=null;this.setModules=function(p,C,P){t=p,e=C,n=P};function s(p){return u[p+Vn.Q_MAX2]}this.IPOW20=function(p){return f[p]};var i=2220446049250313e-31,r=Vn.IXMAX_VAL,o=r+2,a=Vn.Q_MAX,l=Vn.Q_MAX2,c=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var d=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=d,this.sfBandIndex=[new Si([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new Si([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var u=uo(a+l+1),f=uo(a),m=uo(o),h=uo(o);this.adj43=h;function k(p,C){var P=n.ATHformula(C,p);return P-=c,P=Math.pow(10,P/10+p.ATHlower),P}function I(p){for(var C=p.internal_flags.ATH.l,P=p.internal_flags.ATH.psfb21,M=p.internal_flags.ATH.s,F=p.internal_flags.ATH.psfb12,_=p.internal_flags,S=p.out_samplerate,x=0;x<D.SBMAX_l;x++){var v=_.scalefac_band.l[x],w=_.scalefac_band.l[x+1];C[x]=Lh.MAX_VALUE;for(var b=v;b<w;b++){var y=b*S/1152,A=k(p,y);C[x]=Math.min(C[x],A)}}for(var x=0;x<D.PSFB21;x++){var v=_.scalefac_band.psfb21[x],w=_.scalefac_band.psfb21[x+1];P[x]=Lh.MAX_VALUE;for(var b=v;b<w;b++){var y=b*S/1152,A=k(p,y);P[x]=Math.min(P[x],A)}}for(var x=0;x<D.SBMAX_s;x++){var v=_.scalefac_band.s[x],w=_.scalefac_band.s[x+1];M[x]=Lh.MAX_VALUE;for(var b=v;b<w;b++){var y=b*S/384,A=k(p,y);M[x]=Math.min(M[x],A)}M[x]*=_.scalefac_band.s[x+1]-_.scalefac_band.s[x]}for(var x=0;x<D.PSFB12;x++){var v=_.scalefac_band.psfb12[x],w=_.scalefac_band.psfb12[x+1];F[x]=Lh.MAX_VALUE;for(var b=v;b<w;b++){var y=b*S/384,A=k(p,y);F[x]=Math.min(F[x],A)}F[x]*=_.scalefac_band.s[13]-_.scalefac_band.s[12]}if(p.noATH){for(var x=0;x<D.SBMAX_l;x++)C[x]=1e-20;for(var x=0;x<D.PSFB21;x++)P[x]=1e-20;for(var x=0;x<D.SBMAX_s;x++)M[x]=1e-20;for(var x=0;x<D.PSFB12;x++)F[x]=1e-20}_.ATH.floor=10*Math.log10(k(p,-1))}this.iteration_init=function(p){var C=p.internal_flags,P=C.l3_side,M;if(C.iteration_init_init==0){for(C.iteration_init_init=1,P.main_data_begin=0,I(p),m[0]=0,M=1;M<o;M++)m[M]=Math.pow(M,4/3);for(M=0;M<o-1;M++)h[M]=M+1-Math.pow(.5*(m[M]+m[M+1]),.75);for(h[M]=.5,M=0;M<a;M++)f[M]=Math.pow(2,(M-210)*-.1875);for(M=0;M<=a+l;M++)u[M]=Math.pow(2,(M-210-l)*.25);t.huffman_init(C);{var F,_,S,x;for(M=p.exp_nspsytune>>2&63,M>=32&&(M-=64),F=Math.pow(10,M/4/10),M=p.exp_nspsytune>>8&63,M>=32&&(M-=64),_=Math.pow(10,M/4/10),M=p.exp_nspsytune>>14&63,M>=32&&(M-=64),S=Math.pow(10,M/4/10),M=p.exp_nspsytune>>20&63,M>=32&&(M-=64),x=S*Math.pow(10,M/4/10),M=0;M<D.SBMAX_l;M++){var v;M<=6?v=F:M<=13?v=_:M<=20?v=S:v=x,C.nsPsy.longfact[M]=v}for(M=0;M<D.SBMAX_s;M++){var v;M<=5?v=F:M<=10?v=_:M<=11?v=S:v=x,C.nsPsy.shortfact[M]=v}}}},this.on_pe=function(p,C,P,M,F,_){var S=p.internal_flags,x=0,v,w=g$(2),b,y=new CS(x),A=e.ResvMaxBits(p,M,y,_);x=y.bits;var T=x+A;for(T>Ct.MAX_BITS_PER_GRANULE&&(T=Ct.MAX_BITS_PER_GRANULE),v=0,b=0;b<S.channels_out;++b)P[b]=Math.min(Ct.MAX_BITS_PER_CHANNEL,x/S.channels_out),w[b]=0|P[b]*C[F][b]/700-P[b],w[b]>M*3/4&&(w[b]=M*3/4),w[b]<0&&(w[b]=0),w[b]+P[b]>Ct.MAX_BITS_PER_CHANNEL&&(w[b]=Math.max(0,Ct.MAX_BITS_PER_CHANNEL-P[b])),v+=w[b];if(v>A)for(b=0;b<S.channels_out;++b)w[b]=A*w[b]/v;for(b=0;b<S.channels_out;++b)P[b]+=w[b],A-=w[b];for(v=0,b=0;b<S.channels_out;++b)v+=P[b];if(v>Ct.MAX_BITS_PER_GRANULE){var U=0;for(b=0;b<S.channels_out;++b)P[b]*=Ct.MAX_BITS_PER_GRANULE,P[b]/=v,U+=P[b]}return T},this.reduce_side=function(p,C,P,M){Gl(p[0]+p[1]<=Ct.MAX_BITS_PER_GRANULE);var F=.33*(.5-C)/.5;F<0&&(F=0),F>.5&&(F=.5);var _=0|F*.5*(p[0]+p[1]);_>Ct.MAX_BITS_PER_CHANNEL-p[0]&&(_=Ct.MAX_BITS_PER_CHANNEL-p[0]),_<0&&(_=0),p[1]>=125&&(p[1]-_>125?(p[0]<P&&(p[0]+=_),p[1]-=_):(p[0]+=p[1]-125,p[1]=125)),_=p[0]+p[1],_>M&&(p[0]=M*p[0]/_,p[1]=M*p[1]/_),Gl(p[0]<=Ct.MAX_BITS_PER_CHANNEL),Gl(p[1]<=Ct.MAX_BITS_PER_CHANNEL),Gl(p[0]+p[1]<=Ct.MAX_BITS_PER_GRANULE)},this.athAdjust=function(p,C,P){var M=90.30873362,F=94.82444863,_=Pm.FAST_LOG10_X(C,10),S=p*p,x=0;return _-=P,S>1e-20&&(x=1+Pm.FAST_LOG10_X(S,10/M)),x<0&&(x=0),_*=x,_+=P+M-F,Math.pow(10,.1*_)},this.calc_xmin=function(p,C,P,M){var F=0,_=p.internal_flags,S,x=0,v=0,w=_.ATH,b=P.xr,y=p.VBR==co.vbr_mtrh?1:0,A=_.masking_lower;for((p.VBR==co.vbr_mtrh||p.VBR==co.vbr_mt)&&(A=1),S=0;S<P.psy_lmax;S++){var T,U,W,j,K,g;p.VBR==co.vbr_rh||p.VBR==co.vbr_mtrh?U=athAdjust(w.adjust,w.l[S],w.floor):U=w.adjust*w.l[S],K=P.width[S],W=U/K,j=i,g=K>>1,T=0;do{var R,ee;R=b[x]*b[x],T+=R,j+=R<W?R:W,x++,ee=b[x]*b[x],T+=ee,j+=ee<W?ee:W,x++}while(--g>0);if(T>U&&v++,S==D.SBPSY_l){var ne=U*_.nsPsy.longfact[S];j<ne&&(j=ne)}if(y!=0&&(U=j),!p.ATHonly){var xe=C.en.l[S];if(xe>0){var ne;ne=T*C.thm.l[S]*A/xe,y!=0&&(ne*=_.nsPsy.longfact[S]),U<ne&&(U=ne)}}y!=0?M[F++]=U:M[F++]=U*_.nsPsy.longfact[S]}var Ie=575;if(P.block_type!=D.SHORT_TYPE)for(var Me=576;Me--!=0&&Ys.EQ(b[Me],0);)Ie=Me;P.max_nonzero_coeff=Ie;for(var be=P.sfb_smin;S<P.psymax;be++,S+=3){var K,ze,De;for(p.VBR==co.vbr_rh||p.VBR==co.vbr_mtrh?De=athAdjust(w.adjust,w.s[be],w.floor):De=w.adjust*w.s[be],K=P.width[S],ze=0;ze<3;ze++){var T=0,U,W,j,g=K>>1;W=De/K,j=i;do{var R,ee;R=b[x]*b[x],T+=R,j+=R<W?R:W,x++,ee=b[x]*b[x],T+=ee,j+=ee<W?ee:W,x++}while(--g>0);if(T>De&&v++,be==D.SBPSY_s){var ne=De*_.nsPsy.shortfact[be];j<ne&&(j=ne)}if(y!=0?U=j:U=De,!p.ATHonly&&!p.ATHshort){var xe=C.en.s[be][ze];if(xe>0){var ne;ne=T*C.thm.s[be][ze]*A/xe,y!=0&&(ne*=_.nsPsy.shortfact[be]),U<ne&&(U=ne)}}y!=0?M[F++]=U:M[F++]=U*_.nsPsy.shortfact[be]}p.useTemporal&&(M[F-3]>M[F-3+1]&&(M[F-3+1]+=(M[F-3]-M[F-3+1])*_.decay),M[F-3+1]>M[F-3+2]&&(M[F-3+2]+=(M[F-3+1]-M[F-3+2])*_.decay))}return v};function L(p){this.s=p}this.calc_noise_core=function(p,C,P,M){var F=0,_=C.s,S=p.l3_enc;if(_>p.count1)for(;P--!=0;){var x;x=p.xr[_],_++,F+=x*x,x=p.xr[_],_++,F+=x*x}else if(_>p.big_values){var v=uo(2);for(v[0]=0,v[1]=M;P--!=0;){var x;x=Math.abs(p.xr[_])-v[S[_]],_++,F+=x*x,x=Math.abs(p.xr[_])-v[S[_]],_++,F+=x*x}}else for(;P--!=0;){var x;x=Math.abs(p.xr[_])-m[S[_]]*M,_++,F+=x*x,x=Math.abs(p.xr[_])-m[S[_]]*M,_++,F+=x*x}return C.s=_,F},this.calc_noise=function(p,C,P,M,F){var _=0,S=0,x,v,w=0,b=0,y=0,A=-20,T=0,U=p.scalefac,W=0;for(M.over_SSD=0,x=0;x<p.psymax;x++){var j=p.global_gain-(U[W++]+(p.preflag!=0?d[x]:0)<<p.scalefac_scale+1)-p.subblock_gain[p.window[x]]*8,K=0;if(F!=null&&F.step[x]==j)K=F.noise[x],T+=p.width[x],P[_++]=K/C[S++],K=F.noise_log[x];else{var g=s(j);if(v=p.width[x]>>1,T+p.width[x]>p.max_nonzero_coeff){var R;R=p.max_nonzero_coeff-T+1,R>0?v=R>>1:v=0}var ee=new L(T);K=this.calc_noise_core(p,ee,v,g),T=ee.s,F!=null&&(F.step[x]=j,F.noise[x]=K),K=P[_++]=K/C[S++],K=Pm.FAST_LOG10(Math.max(K,1e-20)),F!=null&&(F.noise_log[x]=K)}if(F!=null&&(F.global_gain=p.global_gain),y+=K,K>0){var ne;ne=Math.max(0|K*10+.5,1),M.over_SSD+=ne*ne,w++,b+=K}A=Math.max(A,K)}return M.over_count=w,M.tot_noise=y,M.over_noise=b,M.max_noise=A,w},this.set_pinfo=function(p,C,P,M,F){var _=p.internal_flags,S,x,v,w,b,y=C.scalefac_scale==0?.5:1,A=C.scalefac,T=uo(L3Side.SFBMAX),U=uo(L3Side.SFBMAX),W=new CalcNoiseResult;calc_xmin(p,P,C,T),calc_noise(C,T,U,W,null);var j=0;for(x=C.sfb_lmax,C.block_type!=D.SHORT_TYPE&&C.mixed_block_flag==0&&(x=22),S=0;S<x;S++){var K=_.scalefac_band.l[S],g=_.scalefac_band.l[S+1],R=g-K;for(w=0;j<g;j++)w+=C.xr[j]*C.xr[j];w/=R,b=1e15,_.pinfo.en[M][F][S]=b*w,_.pinfo.xfsf[M][F][S]=b*T[S]*U[S]/R,P.en.l[S]>0&&!p.ATHonly?w=w/P.en.l[S]:w=0,_.pinfo.thr[M][F][S]=b*Math.max(w*P.thm.l[S],_.ATH.l[S]),_.pinfo.LAMEsfb[M][F][S]=0,C.preflag!=0&&S>=11&&(_.pinfo.LAMEsfb[M][F][S]=-y*d[S]),S<D.SBPSY_l&&(Gl(A[S]>=0),_.pinfo.LAMEsfb[M][F][S]-=y*A[S])}if(C.block_type==D.SHORT_TYPE)for(x=S,S=C.sfb_smin;S<D.SBMAX_s;S++)for(var K=_.scalefac_band.s[S],g=_.scalefac_band.s[S+1],R=g-K,ee=0;ee<3;ee++){for(w=0,v=K;v<g;v++)w+=C.xr[j]*C.xr[j],j++;w=Math.max(w/R,1e-20),b=1e15,_.pinfo.en_s[M][F][3*S+ee]=b*w,_.pinfo.xfsf_s[M][F][3*S+ee]=b*T[x]*U[x]/R,P.en.s[S][ee]>0?w=w/P.en.s[S][ee]:w=0,(p.ATHonly||p.ATHshort)&&(w=0),_.pinfo.thr_s[M][F][3*S+ee]=b*Math.max(w*P.thm.s[S][ee],_.ATH.s[S]),_.pinfo.LAMEsfb_s[M][F][3*S+ee]=-2*C.subblock_gain[ee],S<D.SBPSY_s&&(_.pinfo.LAMEsfb_s[M][F][3*S+ee]-=y*A[x]),x++}_.pinfo.LAMEqss[M][F]=C.global_gain,_.pinfo.LAMEmainbits[M][F]=C.part2_3_length+C.part2_length,_.pinfo.LAMEsfbits[M][F]=C.part2_length,_.pinfo.over[M][F]=W.over_count,_.pinfo.max_noise[M][F]=W.max_noise*10,_.pinfo.over_noise[M][F]=W.over_noise*10,_.pinfo.tot_noise[M][F]=W.tot_noise*10,_.pinfo.over_SSD[M][F]=W.over_SSD}}var _$=Oe.System,v$=Oe.Arrays,Wl=Oe.new_int,Dm=Oe.assert;function du(){var t=null;this.qupvt=null,this.setModules=function(v){this.qupvt=v,t=v};function e(v){this.bits=0|v}var n=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function s(v,w,b,y,A,T){var U=.5946/w;for(v=v>>1;v--!=0;)A[T++]=U>b[y++]?0:1,A[T++]=U>b[y++]?0:1}function i(v,w,b,y,A,T){v=v>>1;var U=v%2;for(v=v>>1;v--!=0;){var W,j,K,g,R,ee,ne,xe;W=b[y++]*w,j=b[y++]*w,R=0|W,K=b[y++]*w,ee=0|j,g=b[y++]*w,ne=0|K,W+=t.adj43[R],xe=0|g,j+=t.adj43[ee],A[T++]=0|W,K+=t.adj43[ne],A[T++]=0|j,g+=t.adj43[xe],A[T++]=0|K,A[T++]=0|g}if(U!=0){var W,j,R,ee;W=b[y++]*w,j=b[y++]*w,R=0|W,ee=0|j,W+=t.adj43[R],j+=t.adj43[ee],A[T++]=0|W,A[T++]=0|j}}function r(v,w,b,y,A){var T,U,W=0,j,K=0,g=0,R=0,ee=w,ne=0,xe=ee,Ie=0,Me=v,be=0;for(j=A!=null&&y.global_gain==A.global_gain,y.block_type==D.SHORT_TYPE?U=38:U=21,T=0;T<=U;T++){var ze=-1;if((j||y.block_type==D.NORM_TYPE)&&(ze=y.global_gain-(y.scalefac[T]+(y.preflag!=0?t.pretab[T]:0)<<y.scalefac_scale+1)-y.subblock_gain[y.window[T]]*8),Dm(y.width[T]>=0),j&&A.step[T]==ze)K!=0&&(i(K,b,Me,be,xe,Ie),K=0),g!=0&&(s(g,b,Me,be,xe,Ie),g=0);else{var De=y.width[T];if(W+y.width[T]>y.max_nonzero_coeff){var we;we=y.max_nonzero_coeff-W+1,v$.fill(w,y.max_nonzero_coeff,576,0),De=we,De<0&&(De=0),T=U+1}if(K==0&&g==0&&(xe=ee,Ie=ne,Me=v,be=R),A!=null&&A.sfb_count1>0&&T>=A.sfb_count1&&A.step[T]>0&&ze>=A.step[T]?(K!=0&&(i(K,b,Me,be,xe,Ie),K=0,xe=ee,Ie=ne,Me=v,be=R),g+=De):(g!=0&&(s(g,b,Me,be,xe,Ie),g=0,xe=ee,Ie=ne,Me=v,be=R),K+=De),De<=0){g!=0&&(s(g,b,Me,be,xe,Ie),g=0),K!=0&&(i(K,b,Me,be,xe,Ie),K=0);break}}T<=U&&(ne+=y.width[T],R+=y.width[T],W+=y.width[T])}K!=0&&(i(K,b,Me,be,xe,Ie),K=0),g!=0&&(s(g,b,Me,be,xe,Ie),g=0)}function o(v,w,b){var y=0,A=0;do{var T=v[w++],U=v[w++];y<T&&(y=T),A<U&&(A=U)}while(w<b);return y<A&&(y=A),y}function a(v,w,b,y,A,T){var U=fe.ht[y].xlen*65536+fe.ht[A].xlen,W=0,j;do{var K=v[w++],g=v[w++];K!=0&&(K>14&&(K=15,W+=U),K*=16),g!=0&&(g>14&&(g=15,W+=U),K+=g),W+=fe.largetbl[K]}while(w<b);return j=W&65535,W>>=16,W>j&&(W=j,y=A),T.bits+=W,y}function l(v,w,b,y){var A=0,T=fe.ht[1].hlen;do{var U=v[w+0]*2+v[w+1];w+=2,A+=T[U]}while(w<b);return y.bits+=A,1}function c(v,w,b,y,A){var T=0,U,W=fe.ht[y].xlen,j;y==2?j=fe.table23:j=fe.table56;do{var K=v[w+0]*W+v[w+1];w+=2,T+=j[K]}while(w<b);return U=T&65535,T>>=16,T>U&&(T=U,y++),A.bits+=T,y}function d(v,w,b,y,A){var T=0,U=0,W=0,j=fe.ht[y].xlen,K=fe.ht[y].hlen,g=fe.ht[y+1].hlen,R=fe.ht[y+2].hlen;do{var ee=v[w+0]*j+v[w+1];w+=2,T+=K[ee],U+=g[ee],W+=R[ee]}while(w<b);var ne=y;return T>U&&(T=U,ne++),T>W&&(T=W,ne=y+2),A.bits+=T,ne}var u=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function f(v,w,b,y){var A=o(v,w,b);switch(A){case 0:return A;case 1:return l(v,w,b,y);case 2:case 3:return c(v,w,b,u[A-1],y);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return d(v,w,b,u[A-1],y);default:if(A>Vn.IXMAX_VAL)return y.bits=Vn.LARGE_BITS,-1;A-=15;var T;for(T=24;T<32&&!(fe.ht[T].linmax>=A);T++);var U;for(U=T-8;U<24&&!(fe.ht[U].linmax>=A);U++);return a(v,w,b,U,T,y)}}this.noquant_count_bits=function(v,w,b){var y=w.l3_enc,A=Math.min(576,w.max_nonzero_coeff+2>>1<<1);for(b!=null&&(b.sfb_count1=0);A>1&&(y[A-1]|y[A-2])==0;A-=2);w.count1=A;for(var T=0,U=0;A>3;A-=4){var W;if(((y[A-1]|y[A-2]|y[A-3]|y[A-4])&2147483647)>1)break;W=((y[A-4]*2+y[A-3])*2+y[A-2])*2+y[A-1],T+=fe.t32l[W],U+=fe.t33l[W]}var j=T;if(w.count1table_select=0,T>U&&(j=U,w.count1table_select=1),w.count1bits=j,w.big_values=A,A==0)return j;if(w.block_type==D.SHORT_TYPE)T=3*v.scalefac_band.s[3],T>w.big_values&&(T=w.big_values),U=w.big_values;else if(w.block_type==D.NORM_TYPE){if(T=w.region0_count=v.bv_scf[A-2],U=w.region1_count=v.bv_scf[A-1],U=v.scalefac_band.l[T+U+2],T=v.scalefac_band.l[T+1],U<A){var K=new e(j);w.table_select[2]=f(y,U,A,K),j=K.bits}}else w.region0_count=7,w.region1_count=D.SBMAX_l-1-7-1,T=v.scalefac_band.l[7+1],U=A,T>U&&(T=U);if(T=Math.min(T,A),U=Math.min(U,A),T>0){var K=new e(j);w.table_select[0]=f(y,0,T,K),j=K.bits}if(T<U){var K=new e(j);w.table_select[1]=f(y,T,U,K),j=K.bits}if(v.use_best_huffman==2&&(w.part2_3_length=j,best_huffman_divide(v,w),j=w.part2_3_length),b!=null&&w.block_type==D.NORM_TYPE){for(var g=0;v.scalefac_band.l[g]<w.big_values;)g++;b.sfb_count1=g}return j},this.count_bits=function(v,w,b,y){var A=b.l3_enc,T=Vn.IXMAX_VAL/t.IPOW20(b.global_gain);if(b.xrpow_max>T)return Vn.LARGE_BITS;if(r(w,A,t.IPOW20(b.global_gain),b,y),(v.substep_shaping&2)!=0)for(var U=0,W=b.global_gain+b.scalefac_scale,j=.634521682242439/t.IPOW20(W),K=0;K<b.sfbmax;K++){var g=b.width[K];if(v.pseudohalf[K]==0)U+=g;else{var R;for(R=U,U+=g;R<U;++R)A[R]=w[R]>=j?A[R]:0}}return this.noquant_count_bits(v,b,y)};function m(v,w,b,y,A,T,U){for(var W=w.big_values,j=0;j<=7+15;j++)y[j]=Vn.LARGE_BITS;for(var j=0;j<16;j++){var K=v.scalefac_band.l[j+1];if(K>=W)break;var g=0,R=new e(g),ee=f(b,0,K,R);g=R.bits;for(var ne=0;ne<8;ne++){var xe=v.scalefac_band.l[j+ne+2];if(xe>=W)break;var Ie=g;R=new e(Ie);var Me=f(b,K,xe,R);Ie=R.bits,y[j+ne]>Ie&&(y[j+ne]=Ie,A[j+ne]=j,T[j+ne]=ee,U[j+ne]=Me)}}}function h(v,w,b,y,A,T,U,W){for(var j=w.big_values,K=2;K<D.SBMAX_l+1;K++){var g=v.scalefac_band.l[K];if(g>=j)break;var R=A[K-2]+w.count1bits;if(b.part2_3_length<=R)break;var ee=new e(R),ne=f(y,g,j,ee);R=ee.bits,!(b.part2_3_length<=R)&&(b.assign(w),b.part2_3_length=R,b.region0_count=T[K-2],b.region1_count=K-2-T[K-2],b.table_select[0]=U[K-2],b.table_select[1]=W[K-2],b.table_select[2]=ne)}}this.best_huffman_divide=function(v,w){var b=new Qd,y=w.l3_enc,A=Wl(7+15+1),T=Wl(7+15+1),U=Wl(7+15+1),W=Wl(7+15+1);if(!(w.block_type==D.SHORT_TYPE&&v.mode_gr==1)){b.assign(w),w.block_type==D.NORM_TYPE&&(m(v,w,y,A,T,U,W),h(v,b,w,y,A,T,U,W));var j=b.big_values;if(!(j==0||(y[j-2]|y[j-1])>1)&&(j=w.count1+2,!(j>576))){b.assign(w),b.count1=j;for(var K=0,g=0;j>b.big_values;j-=4){var R=((y[j-4]*2+y[j-3])*2+y[j-2])*2+y[j-1];K+=fe.t32l[R],g+=fe.t33l[R]}if(b.big_values=j,b.count1table_select=0,K>g&&(K=g,b.count1table_select=1),b.count1bits=K,b.block_type==D.NORM_TYPE)h(v,b,w,y,A,T,U,W);else{if(b.part2_3_length=K,K=v.scalefac_band.l[7+1],K>j&&(K=j),K>0){var ee=new e(b.part2_3_length);b.table_select[0]=f(y,0,K,ee),b.part2_3_length=ee.bits}if(j>K){var ee=new e(b.part2_3_length);b.table_select[1]=f(y,K,j,ee),b.part2_3_length=ee.bits}w.part2_3_length>b.part2_3_length&&w.assign(b)}}}};var k=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],I=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],L=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],p=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];du.slen1_tab=L,du.slen2_tab=p;function C(v,w){for(var b,y=w.tt[1][v],A=w.tt[0][v],T=0;T<fe.scfsi_band.length-1;T++){for(b=fe.scfsi_band[T];b<fe.scfsi_band[T+1]&&!(A.scalefac[b]!=y.scalefac[b]&&y.scalefac[b]>=0);b++);if(b==fe.scfsi_band[T+1]){for(b=fe.scfsi_band[T];b<fe.scfsi_band[T+1];b++)y.scalefac[b]=-1;w.scfsi[v][T]=1}}var U=0,W=0;for(b=0;b<11;b++)y.scalefac[b]!=-1&&(W++,U<y.scalefac[b]&&(U=y.scalefac[b]));for(var j=0,K=0;b<D.SBPSY_l;b++)y.scalefac[b]!=-1&&(K++,j<y.scalefac[b]&&(j=y.scalefac[b]));for(var T=0;T<16;T++)if(U<k[T]&&j<I[T]){var g=L[T]*W+p[T]*K;y.part2_length>g&&(y.part2_length=g,y.scalefac_compress=T)}}this.best_scalefac_store=function(v,w,b,y){var A=y.tt[w][b],T,U,W,j,K=0;for(W=0,T=0;T<A.sfbmax;T++){var g=A.width[T];for(W+=g,j=-g;j<0&&A.l3_enc[j+W]==0;j++);j==0&&(A.scalefac[T]=K=-2)}if(A.scalefac_scale==0&&A.preflag==0){var R=0;for(T=0;T<A.sfbmax;T++)A.scalefac[T]>0&&(R|=A.scalefac[T]);if((R&1)==0&&R!=0){for(T=0;T<A.sfbmax;T++)A.scalefac[T]>0&&(A.scalefac[T]>>=1);A.scalefac_scale=K=1}}if(A.preflag==0&&A.block_type!=D.SHORT_TYPE&&v.mode_gr==2){for(T=11;T<D.SBPSY_l&&!(A.scalefac[T]<t.pretab[T]&&A.scalefac[T]!=-2);T++);if(T==D.SBPSY_l){for(T=11;T<D.SBPSY_l;T++)A.scalefac[T]>0&&(A.scalefac[T]-=t.pretab[T]);A.preflag=K=1}}for(U=0;U<4;U++)y.scfsi[b][U]=0;for(v.mode_gr==2&&w==1&&y.tt[0][b].block_type!=D.SHORT_TYPE&&y.tt[1][b].block_type!=D.SHORT_TYPE&&(C(b,y),K=0),T=0;T<A.sfbmax;T++)A.scalefac[T]==-2&&(A.scalefac[T]=0);K!=0&&(v.mode_gr==2?this.scale_bitcount(A):this.scale_bitcount_lsf(v,A))};function P(v,w){for(var b=0;b<w;++b)if(v[b]<0)return!1;return!0}var M=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],F=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],_=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(v){var w,b,y=0,A=0,T,U=v.scalefac;if(Dm(P(U,v.sfbmax)),v.block_type==D.SHORT_TYPE)T=M,v.mixed_block_flag!=0&&(T=F);else if(T=_,v.preflag==0){for(b=11;b<D.SBPSY_l&&!(U[b]<t.pretab[b]);b++);if(b==D.SBPSY_l)for(v.preflag=1,b=11;b<D.SBPSY_l;b++)U[b]-=t.pretab[b]}for(b=0;b<v.sfbdivide;b++)y<U[b]&&(y=U[b]);for(;b<v.sfbmax;b++)A<U[b]&&(A=U[b]);for(v.part2_length=Vn.LARGE_BITS,w=0;w<16;w++)y<k[w]&&A<I[w]&&v.part2_length>T[w]&&(v.part2_length=T[w],v.scalefac_compress=w);return v.part2_length==Vn.LARGE_BITS};var S=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(v,w){var b,y,A,T,U,W,j,K,g=Wl(4),R=w.scalefac;for(w.preflag!=0?b=2:b=0,j=0;j<4;j++)g[j]=0;if(w.block_type==D.SHORT_TYPE){y=1;var ee=t.nr_of_sfb_block[b][y];for(K=0,A=0;A<4;A++)for(T=ee[A]/3,j=0;j<T;j++,K++)for(U=0;U<3;U++)R[K*3+U]>g[A]&&(g[A]=R[K*3+U])}else{y=0;var ee=t.nr_of_sfb_block[b][y];for(K=0,A=0;A<4;A++)for(T=ee[A],j=0;j<T;j++,K++)R[K]>g[A]&&(g[A]=R[K])}for(W=!1,A=0;A<4;A++)g[A]>S[b][A]&&(W=!0);if(!W){var ne,xe,Ie,Me;for(w.sfb_partition_table=t.nr_of_sfb_block[b][y],A=0;A<4;A++)w.slen[A]=x[g[A]];switch(ne=w.slen[0],xe=w.slen[1],Ie=w.slen[2],Me=w.slen[3],b){case 0:w.scalefac_compress=(ne*5+xe<<4)+(Ie<<2)+Me;break;case 1:w.scalefac_compress=400+(ne*5+xe<<2)+Ie;break;case 2:w.scalefac_compress=500+ne*3+xe;break;default:_$.err.printf(`intensity stereo not implemented yet
`);break}}if(!W)for(Dm(w.sfb_partition_table!=null),w.part2_length=0,A=0;A<4;A++)w.part2_length+=w.slen[A]*w.sfb_partition_table[A];return W};var x=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(v){for(var w=2;w<=576;w+=2){for(var b=0,y;v.scalefac_band.l[++b]<w;);for(y=n[b][0];v.scalefac_band.l[y+1]>w;)y--;for(y<0&&(y=n[b][0]),v.bv_scf[w-2]=y,y=n[b][1];v.scalefac_band.l[y+v.bv_scf[w-2]+2]>w;)y--;y<0&&(y=n[b][1]),v.bv_scf[w-1]=y}}}var wi=Oe.System,y$=Oe.Arrays,b$=Oe.new_byte,w$=Oe.new_float_n,E$=Oe.new_int,yn=Oe.assert;Ys.EQ=function(t,e){return Math.abs(t)>Math.abs(e)?Math.abs(t-e)<=Math.abs(t)*1e-6:Math.abs(t-e)<=Math.abs(e)*1e-6};Ys.NEQ=function(t,e){return!Ys.EQ(t,e)};function Ys(){var t=this,e=32773,n=null,s=null,i=null,r=null;this.setModules=function(S,x,v,w){n=S,s=x,i=v,r=w};var o=null,a=0,l=0,c=0;this.getframebits=function(S){var x=S.internal_flags,v;x.bitrate_index!=0?v=fe.bitrate_table[S.version][x.bitrate_index]:v=S.brate;var w=0|(S.version+1)*72e3*v/S.out_samplerate+x.padding;return 8*w};function d(S){wi.arraycopy(S.header[S.w_ptr].buf,0,o,l,S.sideinfo_len),l+=S.sideinfo_len,a+=S.sideinfo_len*8,S.w_ptr=S.w_ptr+1&Ct.MAX_HEADER_BUF-1}function u(S,x,v){for(;v>0;){var w;c==0&&(c=8,l++,yn(S.header[S.w_ptr].write_timing>=a),S.header[S.w_ptr].write_timing==a&&d(S),o[l]=0),w=Math.min(v,c),v-=w,c-=w,o[l]|=x>>v<<c,a+=w}}function f(S,x,v){for(;v>0;){var w;c==0&&(c=8,l++,o[l]=0),w=Math.min(v,c),v-=w,c-=w,o[l]|=x>>v<<c,a+=w}}function m(S,x){var v=S.internal_flags,w;if(x>=8&&(u(v,76,8),x-=8),x>=8&&(u(v,65,8),x-=8),x>=8&&(u(v,77,8),x-=8),x>=8&&(u(v,69,8),x-=8),x>=32){var b=i.getLameShortVersion();if(x>=32)for(w=0;w<b.length&&x>=8;++w)x-=8,u(v,b.charAt(w),8)}for(;x>=1;x-=1)u(v,v.ancillary_flag,1),v.ancillary_flag^=S.disable_reservoir?0:1}function h(S,x,v){for(var w=S.header[S.h_ptr].ptr;v>0;){var b=Math.min(v,8-(w&7));v-=b,S.header[S.h_ptr].buf[w>>3]|=x>>v<<8-(w&7)-b,w+=b}S.header[S.h_ptr].ptr=w}function k(S,x){S<<=8;for(var v=0;v<8;v++)S<<=1,x<<=1,((x^S)&65536)!=0&&(x^=e);return x}this.CRC_writeheader=function(S,x){var v=65535;v=k(x[2]&255,v),v=k(x[3]&255,v);for(var w=6;w<S.sideinfo_len;w++)v=k(x[w]&255,v);x[4]=byte(v>>8),x[5]=byte(v&255)};function I(S,x){var v=S.internal_flags,w,b,y;if(w=v.l3_side,v.header[v.h_ptr].ptr=0,y$.fill(v.header[v.h_ptr].buf,0,v.sideinfo_len,0),S.out_samplerate<16e3?h(v,4094,12):h(v,4095,12),h(v,S.version,1),h(v,4-3,2),h(v,S.error_protection?0:1,1),h(v,v.bitrate_index,4),h(v,v.samplerate_index,2),h(v,v.padding,1),h(v,S.extension,1),h(v,S.mode.ordinal(),2),h(v,v.mode_ext,2),h(v,S.copyright,1),h(v,S.original,1),h(v,S.emphasis,2),S.error_protection&&h(v,0,16),S.version==1){for(yn(w.main_data_begin>=0),h(v,w.main_data_begin,9),v.channels_out==2?h(v,w.private_bits,3):h(v,w.private_bits,5),y=0;y<v.channels_out;y++){var A;for(A=0;A<4;A++)h(v,w.scfsi[y][A],1)}for(b=0;b<2;b++)for(y=0;y<v.channels_out;y++){var T=w.tt[b][y];h(v,T.part2_3_length+T.part2_length,12),h(v,T.big_values/2,9),h(v,T.global_gain,8),h(v,T.scalefac_compress,4),T.block_type!=D.NORM_TYPE?(h(v,1,1),h(v,T.block_type,2),h(v,T.mixed_block_flag,1),T.table_select[0]==14&&(T.table_select[0]=16),h(v,T.table_select[0],5),T.table_select[1]==14&&(T.table_select[1]=16),h(v,T.table_select[1],5),h(v,T.subblock_gain[0],3),h(v,T.subblock_gain[1],3),h(v,T.subblock_gain[2],3)):(h(v,0,1),T.table_select[0]==14&&(T.table_select[0]=16),h(v,T.table_select[0],5),T.table_select[1]==14&&(T.table_select[1]=16),h(v,T.table_select[1],5),T.table_select[2]==14&&(T.table_select[2]=16),h(v,T.table_select[2],5),yn(T.region0_count>=0&&T.region0_count<16),yn(T.region1_count>=0&&T.region1_count<8),h(v,T.region0_count,4),h(v,T.region1_count,3)),h(v,T.preflag,1),h(v,T.scalefac_scale,1),h(v,T.count1table_select,1)}}else for(yn(w.main_data_begin>=0),h(v,w.main_data_begin,8),h(v,w.private_bits,v.channels_out),b=0,y=0;y<v.channels_out;y++){var T=w.tt[b][y];h(v,T.part2_3_length+T.part2_length,12),h(v,T.big_values/2,9),h(v,T.global_gain,8),h(v,T.scalefac_compress,9),T.block_type!=D.NORM_TYPE?(h(v,1,1),h(v,T.block_type,2),h(v,T.mixed_block_flag,1),T.table_select[0]==14&&(T.table_select[0]=16),h(v,T.table_select[0],5),T.table_select[1]==14&&(T.table_select[1]=16),h(v,T.table_select[1],5),h(v,T.subblock_gain[0],3),h(v,T.subblock_gain[1],3),h(v,T.subblock_gain[2],3)):(h(v,0,1),T.table_select[0]==14&&(T.table_select[0]=16),h(v,T.table_select[0],5),T.table_select[1]==14&&(T.table_select[1]=16),h(v,T.table_select[1],5),T.table_select[2]==14&&(T.table_select[2]=16),h(v,T.table_select[2],5),yn(T.region0_count>=0&&T.region0_count<16),yn(T.region1_count>=0&&T.region1_count<8),h(v,T.region0_count,4),h(v,T.region1_count,3)),h(v,T.scalefac_scale,1),h(v,T.count1table_select,1)}S.error_protection&&CRC_writeheader(v,v.header[v.h_ptr].buf);{var U=v.h_ptr;yn(v.header[U].ptr==v.sideinfo_len*8),v.h_ptr=U+1&Ct.MAX_HEADER_BUF-1,v.header[v.h_ptr].write_timing=v.header[U].write_timing+x,v.h_ptr==v.w_ptr&&wi.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function L(S,x){var v=fe.ht[x.count1table_select+32],w,b=0,y=x.big_values,A=x.big_values;for(yn(x.count1table_select<2),w=(x.count1-x.big_values)/4;w>0;--w){var T=0,U=0,W;W=x.l3_enc[y+0],W!=0&&(U+=8,x.xr[A+0]<0&&T++),W=x.l3_enc[y+1],W!=0&&(U+=4,T*=2,x.xr[A+1]<0&&T++),W=x.l3_enc[y+2],W!=0&&(U+=2,T*=2,x.xr[A+2]<0&&T++),W=x.l3_enc[y+3],W!=0&&(U++,T*=2,x.xr[A+3]<0&&T++),y+=4,A+=4,u(S,T+v.table[U],v.hlen[U]),b+=v.hlen[U]}return b}function p(S,x,v,w,b){var y=fe.ht[x],A=0;if(x==0)return A;for(var T=v;T<w;T+=2){var U=0,W=0,j=y.xlen,K=y.xlen,g=0,R=b.l3_enc[T],ee=b.l3_enc[T+1];if(R!=0&&(b.xr[T]<0&&g++,U--),x>15){if(R>14){var ne=R-15;yn(ne<=y.linmax),g|=ne<<1,W=j,R=15}if(ee>14){var xe=ee-15;yn(xe<=y.linmax),g<<=j,g|=xe,W+=j,ee=15}K=16}ee!=0&&(g<<=1,b.xr[T+1]<0&&g++,U--),R=R*K+ee,W-=U,U+=y.hlen[R],u(S,y.table[R],U),u(S,g,W),A+=U+W}return A}function C(S,x){var v=3*S.scalefac_band.s[3];v>x.big_values&&(v=x.big_values);var w=p(S,x.table_select[0],0,v,x);return w+=p(S,x.table_select[1],v,x.big_values,x),w}function P(S,x){var v,w,b,y;v=x.big_values;var A=x.region0_count+1;return yn(A<S.scalefac_band.l.length),b=S.scalefac_band.l[A],A+=x.region1_count+1,yn(A<S.scalefac_band.l.length),y=S.scalefac_band.l[A],b>v&&(b=v),y>v&&(y=v),w=p(S,x.table_select[0],0,b,x),w+=p(S,x.table_select[1],b,y,x),w+=p(S,x.table_select[2],y,v,x),w}function M(S){var x,v,w,b,y=0,A=S.internal_flags,T=A.l3_side;if(S.version==1)for(x=0;x<2;x++)for(v=0;v<A.channels_out;v++){var U=T.tt[x][v],W=du.slen1_tab[U.scalefac_compress],j=du.slen2_tab[U.scalefac_compress];for(b=0,w=0;w<U.sfbdivide;w++)U.scalefac[w]!=-1&&(u(A,U.scalefac[w],W),b+=W);for(;w<U.sfbmax;w++)U.scalefac[w]!=-1&&(u(A,U.scalefac[w],j),b+=j);yn(b==U.part2_length),U.block_type==D.SHORT_TYPE?b+=C(A,U):b+=P(A,U),b+=L(A,U),yn(b==U.part2_3_length+U.part2_length),y+=b}else for(x=0,v=0;v<A.channels_out;v++){var U=T.tt[x][v],K,g,R=0;if(yn(U.sfb_partition_table!=null),b=0,w=0,g=0,U.block_type==D.SHORT_TYPE){for(;g<4;g++){var ee=U.sfb_partition_table[g]/3,ne=U.slen[g];for(K=0;K<ee;K++,w++)u(A,Math.max(U.scalefac[w*3+0],0),ne),u(A,Math.max(U.scalefac[w*3+1],0),ne),u(A,Math.max(U.scalefac[w*3+2],0),ne),R+=3*ne}b+=C(A,U)}else{for(;g<4;g++){var ee=U.sfb_partition_table[g],ne=U.slen[g];for(K=0;K<ee;K++,w++)u(A,Math.max(U.scalefac[w],0),ne),R+=ne}b+=P(A,U)}b+=L(A,U),yn(b==U.part2_3_length),yn(R==U.part2_length),y+=R+b}return y}function F(){this.total=0}function _(S,x){var v=S.internal_flags,w,b,y,A,T;return T=v.w_ptr,A=v.h_ptr-1,A==-1&&(A=Ct.MAX_HEADER_BUF-1),w=v.header[A].write_timing-a,x.total=w,w>=0&&(b=1+A-T,A<T&&(b=1+A-T+Ct.MAX_HEADER_BUF),w-=b*8*v.sideinfo_len),y=t.getframebits(S),w+=y,x.total+=y,x.total%8!=0?x.total=1+x.total/8:x.total=x.total/8,x.total+=l+1,w<0&&wi.err.println(`strange error flushing buffer ... 
`),w}this.flush_bitstream=function(S){var x=S.internal_flags,v,w,b=x.h_ptr-1;if(b==-1&&(b=Ct.MAX_HEADER_BUF-1),v=x.l3_side,!((w=_(S,new F))<0)){if(m(S,w),yn(x.header[b].write_timing+this.getframebits(S)==a),x.ResvSize=0,v.main_data_begin=0,x.findReplayGain){var y=n.GetTitleGain(x.rgdata);yn(NEQ(y,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),x.RadioGain=Math.floor(y*10+.5)|0}x.findPeakSample&&(x.noclipGainChange=Math.ceil(Math.log10(x.PeakSample/32767)*20*10)|0,x.noclipGainChange>0&&(EQ(S.scale,1)||EQ(S.scale,0))?x.noclipScale=Math.floor(32767/x.PeakSample*100)/100:x.noclipScale=-1)}},this.add_dummy_byte=function(S,x,v){for(var w=S.internal_flags,b;v-- >0;)for(f(w,x,8),b=0;b<Ct.MAX_HEADER_BUF;++b)w.header[b].write_timing+=8},this.format_bitstream=function(S){var x=S.internal_flags,v;v=x.l3_side;var w=this.getframebits(S);m(S,v.resvDrain_pre),I(S,w);var b=8*x.sideinfo_len;if(b+=M(S),m(S,v.resvDrain_post),b+=v.resvDrain_post,v.main_data_begin+=(w-b)/8,_(S,new F)!=x.ResvSize&&wi.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),v.main_data_begin*8!=x.ResvSize&&(wi.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*v.main_data_begin,x.ResvSize,v.resvDrain_post,v.resvDrain_pre,8*x.sideinfo_len,b-v.resvDrain_post-8*x.sideinfo_len,b,b%8,w),wi.err.println("This is a fatal error.  It has several possible causes:"),wi.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),wi.err.println(" 9%%  Your system is overclocked"),wi.err.println(" 1%%  bug in LAME encoding library"),x.ResvSize=v.main_data_begin*8),a>1e9){var y;for(y=0;y<Ct.MAX_HEADER_BUF;++y)x.header[y].write_timing-=a;a=0}return 0},this.copy_buffer=function(S,x,v,w,b){var y=l+1;if(y<=0)return 0;if(w!=0&&y>w)return-1;if(wi.arraycopy(o,0,x,v,y),l=-1,c=0,b!=0){var A=E$(1);if(A[0]=S.nMusicCRC,r.updateMusicCRC(A,x,v,y),S.nMusicCRC=A[0],y>0&&(S.VBR_seek_table.nBytesWritten+=y),S.decode_on_the_fly){for(var T=w$([2,1152]),U=y,W=-1,j;W!=0;)if(W=s.hip_decode1_unclipped(S.hip,x,v,U,T[0],T[1]),U=0,W==-1&&(W=0),W>0){if(S.findPeakSample){for(j=0;j<W;j++)T[0][j]>S.PeakSample?S.PeakSample=T[0][j]:-T[0][j]>S.PeakSample&&(S.PeakSample=-T[0][j]);if(S.channels_out>1)for(j=0;j<W;j++)T[1][j]>S.PeakSample?S.PeakSample=T[1][j]:-T[1][j]>S.PeakSample&&(S.PeakSample=-T[1][j])}if(S.findReplayGain&&n.AnalyzeSamples(S.rgdata,T[0],0,T[1],0,W,S.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return y},this.init_bit_stream_w=function(S){o=b$(rt.LAME_MAXMP3BUFFER),S.h_ptr=S.w_ptr=0,S.header[S.h_ptr].write_timing=0,l=-1,c=0,a=0}}var x$=Oe.System,Kt=Oe.VbrMode,Bm=Oe.ShortBlock,ho=Oe.new_float,V3=Oe.new_int_n,T$=Oe.new_short_n,yr=Oe.assert;function rt(){var t=this,e=128*1024;rt.V9=410,rt.V8=420,rt.V7=430,rt.V6=440,rt.V5=450,rt.V4=460,rt.V3=470,rt.V2=480,rt.V1=490,rt.V0=500,rt.R3MIX=1e3,rt.STANDARD=1001,rt.EXTREME=1002,rt.INSANE=1003,rt.STANDARD_FAST=1004,rt.EXTREME_FAST=1005,rt.MEDIUM=1006,rt.MEDIUM_FAST=1007;var n=16384+e;rt.LAME_MAXMP3BUFFER=n;var s,i,r,o,a,l=new Om,c,d,u;this.enc=new D,this.setModules=function(g,R,ee,ne,xe,Ie,Me,be,ze){s=g,i=R,r=ee,o=ne,a=xe,c=Ie,d=be,u=ze,this.enc.setModules(i,l,o,c)};function f(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=ho(D.SBMAX_l),this.bo_s_weight=ho(D.SBMAX_s)}function m(){this.lowerlimit=0}function h(g,R){this.lowpass=R}var k=4294479419;function I(g){var R;return g.class_id=k,R=g.internal_flags=new Ct,g.mode=Nt.NOT_SET,g.original=1,g.in_samplerate=44100,g.num_channels=2,g.num_samples=-1,g.bWriteVbrTag=!0,g.quality=-1,g.short_blocks=null,R.subblock_gain=-1,g.lowpassfreq=0,g.highpassfreq=0,g.lowpasswidth=-1,g.highpasswidth=-1,g.VBR=Kt.vbr_off,g.VBR_q=4,g.ATHcurve=-1,g.VBR_mean_bitrate_kbps=128,g.VBR_min_bitrate_kbps=0,g.VBR_max_bitrate_kbps=0,g.VBR_hard_min=0,R.VBR_min_bitrate=1,R.VBR_max_bitrate=13,g.quant_comp=-1,g.quant_comp_short=-1,g.msfix=-1,R.resample_ratio=1,R.OldValue[0]=180,R.OldValue[1]=180,R.CurrentStep[0]=4,R.CurrentStep[1]=4,R.masking_lower=1,R.nsPsy.attackthre=-1,R.nsPsy.attackthre_s=-1,g.scale=-1,g.athaa_type=-1,g.ATHtype=-1,g.athaa_loudapprox=-1,g.athaa_sensitivity=0,g.useTemporal=null,g.interChRatio=-1,R.mf_samples_to_encode=D.ENCDELAY+D.POSTDELAY,g.encoder_padding=0,R.mf_size=D.ENCDELAY-D.MDCTDELAY,g.findReplayGain=!1,g.decode_on_the_fly=!1,R.decode_on_the_fly=!1,R.findReplayGain=!1,R.findPeakSample=!1,R.RadioGain=0,R.AudiophileGain=0,R.noclipGainChange=0,R.noclipScale=-1,g.preset=0,g.write_id3tag_automatic=!0,0}this.lame_init=function(){var g=new s$;return I(g),g.lame_allocated_gfp=1,g};function L(g){return g>1?0:g<=0?1:Math.cos(Math.PI/2*g)}this.nearestBitrateFullIndex=function(g){var R=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],ee=0,ne=0,xe=0,Ie=0;Ie=R[16],xe=16,ne=R[16],ee=16;for(var Me=0;Me<16;Me++)if(Math.max(g,R[Me+1])!=g){Ie=R[Me+1],xe=Me+1,ne=R[Me],ee=Me;break}return Ie-g>g-ne?ee:xe};function p(g,R){var ee=44100;return R>=48e3?ee=48e3:R>=44100?ee=44100:R>=32e3?ee=32e3:R>=24e3?ee=24e3:R>=22050?ee=22050:R>=16e3?ee=16e3:R>=12e3?ee=12e3:R>=11025?ee=11025:R>=8e3&&(ee=8e3),g==-1?ee:(g<=15960&&(ee=44100),g<=15250&&(ee=32e3),g<=11220&&(ee=24e3),g<=9970&&(ee=22050),g<=7230&&(ee=16e3),g<=5420&&(ee=12e3),g<=4510&&(ee=11025),g<=3970&&(ee=8e3),R<ee?R>44100?48e3:R>32e3?44100:R>24e3?32e3:R>22050?24e3:R>16e3?22050:R>12e3?16e3:R>11025?12e3:R>8e3?11025:8e3:ee)}function C(g,R){switch(g){case 44100:return R.version=1,0;case 48e3:return R.version=1,1;case 32e3:return R.version=1,2;case 22050:return R.version=0,0;case 24e3:return R.version=0,1;case 16e3:return R.version=0,2;case 11025:return R.version=0,0;case 12e3:return R.version=0,1;case 8e3:return R.version=0,2;default:return R.version=0,-1}}function P(g,R,ee){ee<16e3&&(R=2);for(var ne=fe.bitrate_table[R][1],xe=2;xe<=14;xe++)fe.bitrate_table[R][xe]>0&&Math.abs(fe.bitrate_table[R][xe]-g)<Math.abs(ne-g)&&(ne=fe.bitrate_table[R][xe]);return ne}function M(g,R,ee){ee<16e3&&(R=2);for(var ne=0;ne<=14;ne++)if(fe.bitrate_table[R][ne]>0&&fe.bitrate_table[R][ne]==g)return ne;return-1}function F(g,R){var ee=[new h(8,2e3),new h(16,3700),new h(24,3900),new h(32,5500),new h(40,7e3),new h(48,7500),new h(56,1e4),new h(64,11e3),new h(80,13500),new h(96,15100),new h(112,15600),new h(128,17e3),new h(160,17500),new h(192,18600),new h(224,19400),new h(256,19700),new h(320,20500)],ne=t.nearestBitrateFullIndex(R);g.lowerlimit=ee[ne].lowpass}function _(g){var R=g.internal_flags,ee=32,ne=-1;if(R.lowpass1>0){for(var xe=999,Ie=0;Ie<=31;Ie++){var Me=Ie/31;Me>=R.lowpass2&&(ee=Math.min(ee,Ie)),R.lowpass1<Me&&Me<R.lowpass2&&(xe=Math.min(xe,Ie))}xe==999?R.lowpass1=(ee-.75)/31:R.lowpass1=(xe-.75)/31,R.lowpass2=ee/31}if(R.highpass2>0&&R.highpass2<.9*(.75/31)&&(R.highpass1=0,R.highpass2=0,x$.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),R.highpass2>0){for(var be=-1,Ie=0;Ie<=31;Ie++){var Me=Ie/31;Me<=R.highpass1&&(ne=Math.max(ne,Ie)),R.highpass1<Me&&Me<R.highpass2&&(be=Math.max(be,Ie))}R.highpass1=ne/31,be==-1?R.highpass2=(ne+.75)/31:R.highpass2=(be+.75)/31}for(var Ie=0;Ie<32;Ie++){var ze,De,Me=Ie/31;R.highpass2>R.highpass1?ze=L((R.highpass2-Me)/(R.highpass2-R.highpass1+1e-20)):ze=1,R.lowpass2>R.lowpass1?De=L((Me-R.lowpass1)/(R.lowpass2-R.lowpass1+1e-20)):De=1,R.amp_filter[Ie]=ze*De}}function S(g){var R=g.internal_flags;switch(g.quality){default:case 9:R.psymodel=0,R.noise_shaping=0,R.noise_shaping_amp=0,R.noise_shaping_stop=0,R.use_best_huffman=0,R.full_outer_loop=0;break;case 8:g.quality=7;case 7:R.psymodel=1,R.noise_shaping=0,R.noise_shaping_amp=0,R.noise_shaping_stop=0,R.use_best_huffman=0,R.full_outer_loop=0;break;case 6:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.noise_shaping_amp=0,R.noise_shaping_stop=0,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=0,R.full_outer_loop=0;break;case 5:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.noise_shaping_amp=0,R.noise_shaping_stop=0,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=0,R.full_outer_loop=0;break;case 4:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.noise_shaping_amp=0,R.noise_shaping_stop=0,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=1,R.full_outer_loop=0;break;case 3:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.noise_shaping_amp=1,R.noise_shaping_stop=1,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=1,R.full_outer_loop=0;break;case 2:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.substep_shaping==0&&(R.substep_shaping=2),R.noise_shaping_amp=1,R.noise_shaping_stop=1,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=1,R.full_outer_loop=0;break;case 1:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.substep_shaping==0&&(R.substep_shaping=2),R.noise_shaping_amp=2,R.noise_shaping_stop=1,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=1,R.full_outer_loop=0;break;case 0:R.psymodel=1,R.noise_shaping==0&&(R.noise_shaping=1),R.substep_shaping==0&&(R.substep_shaping=2),R.noise_shaping_amp=2,R.noise_shaping_stop=1,R.subblock_gain==-1&&(R.subblock_gain=1),R.use_best_huffman=1,R.full_outer_loop=0;break}}function x(g){var R=g.internal_flags;g.frameNum=0,g.write_id3tag_automatic&&d.id3tag_write_v2(g),R.bitrate_stereoMode_Hist=V3([16,4+1]),R.bitrate_blockType_Hist=V3([16,4+1+1]),R.PeakSample=0,g.bWriteVbrTag&&c.InitVbrTag(g)}this.lame_init_params=function(g){var R=g.internal_flags;if(R.Class_ID=0,R.ATH==null&&(R.ATH=new d$),R.PSY==null&&(R.PSY=new f),R.rgdata==null&&(R.rgdata=new f$),R.channels_in=g.num_channels,R.channels_in==1&&(g.mode=Nt.MONO),R.channels_out=g.mode==Nt.MONO?1:2,R.mode_ext=D.MPG_MD_MS_LR,g.mode==Nt.MONO&&(g.force_ms=!1),g.VBR==Kt.vbr_off&&g.VBR_mean_bitrate_kbps!=128&&g.brate==0&&(g.brate=g.VBR_mean_bitrate_kbps),g.VBR==Kt.vbr_off||g.VBR==Kt.vbr_mtrh||g.VBR==Kt.vbr_mt||(g.free_format=!1),g.VBR==Kt.vbr_off&&g.brate==0&&Ys.EQ(g.compression_ratio,0)&&(g.compression_ratio=11.025),g.VBR==Kt.vbr_off&&g.compression_ratio>0&&(g.out_samplerate==0&&(g.out_samplerate=map2MP3Frequency(int(.97*g.in_samplerate))),g.brate=0|g.out_samplerate*16*R.channels_out/(1e3*g.compression_ratio),R.samplerate_index=C(g.out_samplerate,g),g.free_format||(g.brate=P(g.brate,g.version,g.out_samplerate))),g.out_samplerate!=0&&(g.out_samplerate<16e3?(g.VBR_mean_bitrate_kbps=Math.max(g.VBR_mean_bitrate_kbps,8),g.VBR_mean_bitrate_kbps=Math.min(g.VBR_mean_bitrate_kbps,64)):g.out_samplerate<32e3?(g.VBR_mean_bitrate_kbps=Math.max(g.VBR_mean_bitrate_kbps,8),g.VBR_mean_bitrate_kbps=Math.min(g.VBR_mean_bitrate_kbps,160)):(g.VBR_mean_bitrate_kbps=Math.max(g.VBR_mean_bitrate_kbps,32),g.VBR_mean_bitrate_kbps=Math.min(g.VBR_mean_bitrate_kbps,320))),g.lowpassfreq==0){var ee=16e3;switch(g.VBR){case Kt.vbr_off:{var ne=new m;F(ne,g.brate),ee=ne.lowerlimit;break}case Kt.vbr_abr:{var ne=new m;F(ne,g.VBR_mean_bitrate_kbps),ee=ne.lowerlimit;break}case Kt.vbr_rh:{var xe=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(g.VBR_q>=0&&g.VBR_q<=9){var Ie=xe[g.VBR_q],Me=xe[g.VBR_q+1],be=g.VBR_q_frac;ee=linear_int(Ie,Me,be)}else ee=19500;break}default:{var xe=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(g.VBR_q>=0&&g.VBR_q<=9){var Ie=xe[g.VBR_q],Me=xe[g.VBR_q+1],be=g.VBR_q_frac;ee=linear_int(Ie,Me,be)}else ee=19500}}g.mode==Nt.MONO&&(g.VBR==Kt.vbr_off||g.VBR==Kt.vbr_abr)&&(ee*=1.5),g.lowpassfreq=ee|0}if(g.out_samplerate==0&&(2*g.lowpassfreq>g.in_samplerate&&(g.lowpassfreq=g.in_samplerate/2),g.out_samplerate=p(g.lowpassfreq|0,g.in_samplerate)),g.lowpassfreq=Math.min(20500,g.lowpassfreq),g.lowpassfreq=Math.min(g.out_samplerate/2,g.lowpassfreq),g.VBR==Kt.vbr_off&&(g.compression_ratio=g.out_samplerate*16*R.channels_out/(1e3*g.brate)),g.VBR==Kt.vbr_abr&&(g.compression_ratio=g.out_samplerate*16*R.channels_out/(1e3*g.VBR_mean_bitrate_kbps)),g.bWriteVbrTag||(g.findReplayGain=!1,g.decode_on_the_fly=!1,R.findPeakSample=!1),R.findReplayGain=g.findReplayGain,R.decode_on_the_fly=g.decode_on_the_fly,R.decode_on_the_fly&&(R.findPeakSample=!0),R.findReplayGain&&s.InitGainAnalysis(R.rgdata,g.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return g.internal_flags=null,-6;switch(R.decode_on_the_fly&&!g.decode_only&&(R.hip!=null&&u.hip_decode_exit(R.hip),R.hip=u.hip_decode_init()),R.mode_gr=g.out_samplerate<=24e3?1:2,g.framesize=576*R.mode_gr,g.encoder_delay=D.ENCDELAY,R.resample_ratio=g.in_samplerate/g.out_samplerate,g.VBR){case Kt.vbr_mt:case Kt.vbr_rh:case Kt.vbr_mtrh:{var ze=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];g.compression_ratio=ze[g.VBR_q]}break;case Kt.vbr_abr:g.compression_ratio=g.out_samplerate*16*R.channels_out/(1e3*g.VBR_mean_bitrate_kbps);break;default:g.compression_ratio=g.out_samplerate*16*R.channels_out/(1e3*g.brate);break}if(g.mode==Nt.NOT_SET&&(g.mode=Nt.JOINT_STEREO),g.highpassfreq>0?(R.highpass1=2*g.highpassfreq,g.highpasswidth>=0?R.highpass2=2*(g.highpassfreq+g.highpasswidth):R.highpass2=(1+0)*2*g.highpassfreq,R.highpass1/=g.out_samplerate,R.highpass2/=g.out_samplerate):(R.highpass1=0,R.highpass2=0),g.lowpassfreq>0?(R.lowpass2=2*g.lowpassfreq,g.lowpasswidth>=0?(R.lowpass1=2*(g.lowpassfreq-g.lowpasswidth),R.lowpass1<0&&(R.lowpass1=0)):R.lowpass1=(1-0)*2*g.lowpassfreq,R.lowpass1/=g.out_samplerate,R.lowpass2/=g.out_samplerate):(R.lowpass1=0,R.lowpass2=0),_(g),R.samplerate_index=C(g.out_samplerate,g),R.samplerate_index<0)return g.internal_flags=null,-1;if(g.VBR==Kt.vbr_off){if(g.free_format)R.bitrate_index=0;else if(g.brate=P(g.brate,g.version,g.out_samplerate),R.bitrate_index=M(g.brate,g.version,g.out_samplerate),R.bitrate_index<=0)return g.internal_flags=null,-1}else R.bitrate_index=1;g.analysis&&(g.bWriteVbrTag=!1),R.pinfo!=null&&(g.bWriteVbrTag=!1),i.init_bit_stream_w(R);for(var De=R.samplerate_index+3*g.version+6*(g.out_samplerate<16e3?1:0),we=0;we<D.SBMAX_l+1;we++)R.scalefac_band.l[we]=o.sfBandIndex[De].l[we];for(var we=0;we<D.PSFB21+1;we++){var Xe=(R.scalefac_band.l[22]-R.scalefac_band.l[21])/D.PSFB21,mt=R.scalefac_band.l[21]+we*Xe;R.scalefac_band.psfb21[we]=mt}R.scalefac_band.psfb21[D.PSFB21]=576;for(var we=0;we<D.SBMAX_s+1;we++)R.scalefac_band.s[we]=o.sfBandIndex[De].s[we];for(var we=0;we<D.PSFB12+1;we++){var Xe=(R.scalefac_band.s[13]-R.scalefac_band.s[12])/D.PSFB12,mt=R.scalefac_band.s[12]+we*Xe;R.scalefac_band.psfb12[we]=mt}R.scalefac_band.psfb12[D.PSFB12]=192,g.version==1?R.sideinfo_len=R.channels_out==1?4+17:4+32:R.sideinfo_len=R.channels_out==1?4+9:4+17,g.error_protection&&(R.sideinfo_len+=2),x(g),R.Class_ID=k;{var E;for(E=0;E<19;E++)R.nsPsy.pefirbuf[E]=700*R.mode_gr*R.channels_out;g.ATHtype==-1&&(g.ATHtype=4)}switch(yr(g.VBR_q<=9),yr(g.VBR_q>=0),g.VBR){case Kt.vbr_mt:g.VBR=Kt.vbr_mtrh;case Kt.vbr_mtrh:{g.useTemporal==null&&(g.useTemporal=!1),r.apply_preset(g,500-g.VBR_q*10,0),g.quality<0&&(g.quality=LAME_DEFAULT_QUALITY),g.quality<5&&(g.quality=0),g.quality>5&&(g.quality=5),R.PSY.mask_adjust=g.maskingadjust,R.PSY.mask_adjust_short=g.maskingadjust_short,g.experimentalY?R.sfb21_extra=!1:R.sfb21_extra=g.out_samplerate>44e3,R.iteration_loop=new VBRNewIterationLoop(a);break}case Kt.vbr_rh:{r.apply_preset(g,500-g.VBR_q*10,0),R.PSY.mask_adjust=g.maskingadjust,R.PSY.mask_adjust_short=g.maskingadjust_short,g.experimentalY?R.sfb21_extra=!1:R.sfb21_extra=g.out_samplerate>44e3,g.quality>6&&(g.quality=6),g.quality<0&&(g.quality=LAME_DEFAULT_QUALITY),R.iteration_loop=new VBROldIterationLoop(a);break}default:{var N;R.sfb21_extra=!1,g.quality<0&&(g.quality=LAME_DEFAULT_QUALITY),N=g.VBR,N==Kt.vbr_off&&(g.VBR_mean_bitrate_kbps=g.brate),r.apply_preset(g,g.VBR_mean_bitrate_kbps,0),g.VBR=N,R.PSY.mask_adjust=g.maskingadjust,R.PSY.mask_adjust_short=g.maskingadjust_short,N==Kt.vbr_off?R.iteration_loop=new p$(a):R.iteration_loop=new ABRIterationLoop(a);break}}if(yr(g.scale>=0),g.VBR!=Kt.vbr_off){if(R.VBR_min_bitrate=1,R.VBR_max_bitrate=14,g.out_samplerate<16e3&&(R.VBR_max_bitrate=8),g.VBR_min_bitrate_kbps!=0&&(g.VBR_min_bitrate_kbps=P(g.VBR_min_bitrate_kbps,g.version,g.out_samplerate),R.VBR_min_bitrate=M(g.VBR_min_bitrate_kbps,g.version,g.out_samplerate),R.VBR_min_bitrate<0)||g.VBR_max_bitrate_kbps!=0&&(g.VBR_max_bitrate_kbps=P(g.VBR_max_bitrate_kbps,g.version,g.out_samplerate),R.VBR_max_bitrate=M(g.VBR_max_bitrate_kbps,g.version,g.out_samplerate),R.VBR_max_bitrate<0))return-1;g.VBR_min_bitrate_kbps=fe.bitrate_table[g.version][R.VBR_min_bitrate],g.VBR_max_bitrate_kbps=fe.bitrate_table[g.version][R.VBR_max_bitrate],g.VBR_mean_bitrate_kbps=Math.min(fe.bitrate_table[g.version][R.VBR_max_bitrate],g.VBR_mean_bitrate_kbps),g.VBR_mean_bitrate_kbps=Math.max(fe.bitrate_table[g.version][R.VBR_min_bitrate],g.VBR_mean_bitrate_kbps)}return g.tune&&(R.PSY.mask_adjust+=g.tune_value_a,R.PSY.mask_adjust_short+=g.tune_value_a),S(g),yr(g.scale>=0),g.athaa_type<0?R.ATH.useAdjust=3:R.ATH.useAdjust=g.athaa_type,R.ATH.aaSensitivityP=Math.pow(10,g.athaa_sensitivity/-10),g.short_blocks==null&&(g.short_blocks=Bm.short_block_allowed),g.short_blocks==Bm.short_block_allowed&&(g.mode==Nt.JOINT_STEREO||g.mode==Nt.STEREO)&&(g.short_blocks=Bm.short_block_coupled),g.quant_comp<0&&(g.quant_comp=1),g.quant_comp_short<0&&(g.quant_comp_short=0),g.msfix<0&&(g.msfix=0),g.exp_nspsytune=g.exp_nspsytune|1,g.internal_flags.nsPsy.attackthre<0&&(g.internal_flags.nsPsy.attackthre=Om.NSATTACKTHRE),g.internal_flags.nsPsy.attackthre_s<0&&(g.internal_flags.nsPsy.attackthre_s=Om.NSATTACKTHRE_S),yr(g.scale>=0),g.scale<0&&(g.scale=1),g.ATHtype<0&&(g.ATHtype=4),g.ATHcurve<0&&(g.ATHcurve=4),g.athaa_loudapprox<0&&(g.athaa_loudapprox=2),g.interChRatio<0&&(g.interChRatio=0),g.useTemporal==null&&(g.useTemporal=!0),R.slot_lag=R.frac_SpF=0,g.VBR==Kt.vbr_off&&(R.slot_lag=R.frac_SpF=(g.version+1)*72e3*g.brate%g.out_samplerate|0),o.iteration_init(g),l.psymodel_init(g),yr(g.scale>=0),0};function v(g,R){(g.in_buffer_0==null||g.in_buffer_nsamples<R)&&(g.in_buffer_0=ho(R),g.in_buffer_1=ho(R),g.in_buffer_nsamples=R)}this.lame_encode_flush=function(g,R,ee,ne){var xe=g.internal_flags,Ie=T$([2,1152]),Me=0,be,ze,De,we,Xe=xe.mf_samples_to_encode-D.POSTDELAY,mt=w(g);if(xe.mf_samples_to_encode<1)return 0;for(be=0,g.in_samplerate!=g.out_samplerate&&(Xe+=16*g.out_samplerate/g.in_samplerate),De=g.framesize-Xe%g.framesize,De<576&&(De+=g.framesize),g.encoder_padding=De,we=(Xe+De)/g.framesize;we>0&&Me>=0;){var E=mt-xe.mf_size,N=g.frameNum;E*=g.in_samplerate,E/=g.out_samplerate,E>1152&&(E=1152),E<1&&(E=1),ze=ne-be,ne==0&&(ze=0),Me=this.lame_encode_buffer(g,Ie[0],Ie[1],E,R,ee,ze),ee+=Me,be+=Me,we-=N!=g.frameNum?1:0}if(xe.mf_samples_to_encode=0,Me<0||(ze=ne-be,ne==0&&(ze=0),i.flush_bitstream(g),Me=i.copy_buffer(xe,R,ee,ze,1),Me<0))return Me;if(ee+=Me,be+=Me,ze=ne-be,ne==0&&(ze=0),g.write_id3tag_automatic){if(d.id3tag_write_v1(g),Me=i.copy_buffer(xe,R,ee,ze,0),Me<0)return Me;be+=Me}return be},this.lame_encode_buffer=function(g,R,ee,ne,xe,Ie,Me){var be=g.internal_flags,ze=[null,null];if(be.Class_ID!=k)return-3;if(ne==0)return 0;v(be,ne),ze[0]=be.in_buffer_0,ze[1]=be.in_buffer_1;for(var De=0;De<ne;De++)ze[0][De]=R[De],be.channels_in>1&&(ze[1][De]=ee[De]);return b(g,ze[0],ze[1],ne,xe,Ie,Me)};function w(g){var R=D.BLKSIZE+g.framesize-D.FFTOFFSET;return R=Math.max(R,512+g.framesize-32),R}function b(g,R,ee,ne,xe,Ie,Me){var be=g.internal_flags,ze=0,De,we,Xe,mt,E,N=[null,null],V=[null,null];if(be.Class_ID!=k)return-3;if(ne==0)return 0;if(E=i.copy_buffer(be,xe,Ie,Me,0),E<0)return E;if(Ie+=E,ze+=E,V[0]=R,V[1]=ee,Ys.NEQ(g.scale,0)&&Ys.NEQ(g.scale,1))for(we=0;we<ne;++we)V[0][we]*=g.scale,be.channels_out==2&&(V[1][we]*=g.scale);if(Ys.NEQ(g.scale_left,0)&&Ys.NEQ(g.scale_left,1))for(we=0;we<ne;++we)V[0][we]*=g.scale_left;if(Ys.NEQ(g.scale_right,0)&&Ys.NEQ(g.scale_right,1))for(we=0;we<ne;++we)V[1][we]*=g.scale_right;if(g.num_channels==2&&be.channels_out==1)for(we=0;we<ne;++we)V[0][we]=.5*(V[0][we]+V[1][we]),V[1][we]=0;mt=w(g),N[0]=be.mfbuf[0],N[1]=be.mfbuf[1];for(var $=0;ne>0;){var G=[null,null],te=0,le=0;G[0]=V[0],G[1]=V[1];var Q=new A;if(K(g,N,G,$,ne,Q),te=Q.n_in,le=Q.n_out,be.findReplayGain&&!be.decode_on_the_fly&&s.AnalyzeSamples(be.rgdata,N[0],be.mf_size,N[1],be.mf_size,le,be.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(ne-=te,$+=te,be.channels_out==2,be.mf_size+=le,yr(be.mf_size<=Ct.MFSIZE),be.mf_samples_to_encode<1&&(be.mf_samples_to_encode=D.ENCDELAY+D.POSTDELAY),be.mf_samples_to_encode+=le,be.mf_size>=mt){var se=Me-ze;if(Me==0&&(se=0),De=y(g,N[0],N[1],xe,Ie,se),De<0)return De;for(Ie+=De,ze+=De,be.mf_size-=g.framesize,be.mf_samples_to_encode-=g.framesize,Xe=0;Xe<be.channels_out;Xe++)for(we=0;we<be.mf_size;we++)N[Xe][we]=N[Xe][we+g.framesize]}}return ze}function y(g,R,ee,ne,xe,Ie){var Me=t.enc.lame_encode_mp3_frame(g,R,ee,ne,xe,Ie);return g.frameNum++,Me}function A(){this.n_in=0,this.n_out=0}function T(){this.num_used=0}function U(g,R){return R!=0?U(R,g%R):g}function W(g,R,ee){var ne=Math.PI*R;g/=ee,g<0&&(g=0),g>1&&(g=1);var xe=g-.5,Ie=.42-.5*Math.cos(2*g*Math.PI)+.08*Math.cos(4*g*Math.PI);return Math.abs(xe)<1e-9?ne/Math.PI:Ie*Math.sin(ee*ne*xe)/(Math.PI*ee*xe)}function j(g,R,ee,ne,xe,Ie,Me,be,ze){var De=g.internal_flags,we,Xe=0,mt,E=g.out_samplerate/U(g.out_samplerate,g.in_samplerate);E>Ct.BPC&&(E=Ct.BPC);var N=Math.abs(De.resample_ratio-Math.floor(.5+De.resample_ratio))<1e-4?1:0,V=1/De.resample_ratio;V>1&&(V=1);var $=31;$%2==0&&--$,$+=N;var G=$+1;if(De.fill_buffer_resample_init==0){for(De.inbuf_old[0]=ho(G),De.inbuf_old[1]=ho(G),we=0;we<=2*E;++we)De.blackfilt[we]=ho(G);for(De.itime[0]=0,De.itime[1]=0,Xe=0;Xe<=2*E;Xe++){var te=0,le=(Xe-E)/(2*E);for(we=0;we<=$;we++)te+=De.blackfilt[Xe][we]=W(we-le,V,$);for(we=0;we<=$;we++)De.blackfilt[Xe][we]/=te}De.fill_buffer_resample_init=1}var Q=De.inbuf_old[ze];for(mt=0;mt<ne;mt++){var se,X;if(se=mt*De.resample_ratio,Xe=0|Math.floor(se-De.itime[ze]),$+Xe-$/2>=Me)break;var le=se-De.itime[ze]-(Xe+.5*($%2));X=0|Math.floor(le*2*E+E+.5);var ve=0;for(we=0;we<=$;++we){var de=0|we+Xe-$/2,ye;ye=de<0?Q[G+de]:xe[Ie+de],ve+=ye*De.blackfilt[X][we]}R[ee+mt]=ve}if(be.num_used=Math.min(Me,$+Xe-$/2),De.itime[ze]+=be.num_used-mt*De.resample_ratio,be.num_used>=G)for(we=0;we<G;we++)Q[we]=xe[Ie+be.num_used+we-G];else{var Re=G-be.num_used;for(we=0;we<Re;++we)Q[we]=Q[we+be.num_used];for(Xe=0;we<G;++we,++Xe)Q[we]=xe[Ie+Xe];yr(Xe==be.num_used)}return mt}function K(g,R,ee,ne,xe,Ie){var Me=g.internal_flags;if(Me.resample_ratio<.9999||Me.resample_ratio>1.0001)for(var be=0;be<Me.channels_out;be++){var ze=new T;Ie.n_out=j(g,R[be],Me.mf_size,g.framesize,ee[be],ne,xe,ze,be),Ie.n_in=ze.num_used}else{Ie.n_out=Math.min(g.framesize,xe),Ie.n_in=Ie.n_out;for(var De=0;De<Ie.n_out;++De)R[0][Me.mf_size+De]=ee[0][ne+De],Me.channels_out==2&&(R[1][Me.mf_size+De]=ee[1][ne+De])}}}var Ei=Oe.VbrMode;function S$(){function t(c,d,u,f,m,h,k,I,L,p,C,P,M,F,_){this.vbr_q=c,this.quant_comp=d,this.quant_comp_s=u,this.expY=f,this.st_lrm=m,this.st_s=h,this.masking_adj=k,this.masking_adj_short=I,this.ath_lower=L,this.ath_curve=p,this.ath_sensitivity=C,this.interch=P,this.safejoint=M,this.sfb21mod=F,this.msfix=_}function e(c,d,u,f,m,h,k,I,L,p,C,P,M,F){this.quant_comp=d,this.quant_comp_s=u,this.safejoint=f,this.nsmsfix=m,this.st_lrm=h,this.st_s=k,this.nsbass=I,this.scale=L,this.masking_adj=p,this.ath_lower=C,this.ath_curve=P,this.interch=M,this.sfscale=F}var n;this.setModules=function(c){n=c};var s=[new t(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new t(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new t(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new t(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new t(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new t(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new t(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new t(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new t(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],i=[new t(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new t(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new t(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new t(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new t(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new t(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new t(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new t(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new t(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new t(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new t(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function r(c,d,u){var f=c.VBR==Ei.vbr_rh?s:i,m=c.VBR_q_frac,h=f[d],k=f[d+1],I=h;h.st_lrm=h.st_lrm+m*(k.st_lrm-h.st_lrm),h.st_s=h.st_s+m*(k.st_s-h.st_s),h.masking_adj=h.masking_adj+m*(k.masking_adj-h.masking_adj),h.masking_adj_short=h.masking_adj_short+m*(k.masking_adj_short-h.masking_adj_short),h.ath_lower=h.ath_lower+m*(k.ath_lower-h.ath_lower),h.ath_curve=h.ath_curve+m*(k.ath_curve-h.ath_curve),h.ath_sensitivity=h.ath_sensitivity+m*(k.ath_sensitivity-h.ath_sensitivity),h.interch=h.interch+m*(k.interch-h.interch),h.msfix=h.msfix+m*(k.msfix-h.msfix),l(c,I.vbr_q),u!=0?c.quant_comp=I.quant_comp:Math.abs(c.quant_comp- -1)>0||(c.quant_comp=I.quant_comp),u!=0?c.quant_comp_short=I.quant_comp_s:Math.abs(c.quant_comp_short- -1)>0||(c.quant_comp_short=I.quant_comp_s),I.expY!=0&&(c.experimentalY=I.expY!=0),u!=0?c.internal_flags.nsPsy.attackthre=I.st_lrm:Math.abs(c.internal_flags.nsPsy.attackthre- -1)>0||(c.internal_flags.nsPsy.attackthre=I.st_lrm),u!=0?c.internal_flags.nsPsy.attackthre_s=I.st_s:Math.abs(c.internal_flags.nsPsy.attackthre_s- -1)>0||(c.internal_flags.nsPsy.attackthre_s=I.st_s),u!=0?c.maskingadjust=I.masking_adj:Math.abs(c.maskingadjust-0)>0||(c.maskingadjust=I.masking_adj),u!=0?c.maskingadjust_short=I.masking_adj_short:Math.abs(c.maskingadjust_short-0)>0||(c.maskingadjust_short=I.masking_adj_short),u!=0?c.ATHlower=-I.ath_lower/10:Math.abs(-c.ATHlower*10-0)>0||(c.ATHlower=-I.ath_lower/10),u!=0?c.ATHcurve=I.ath_curve:Math.abs(c.ATHcurve- -1)>0||(c.ATHcurve=I.ath_curve),u!=0?c.athaa_sensitivity=I.ath_sensitivity:Math.abs(c.athaa_sensitivity- -1)>0||(c.athaa_sensitivity=I.ath_sensitivity),I.interch>0&&(u!=0?c.interChRatio=I.interch:Math.abs(c.interChRatio- -1)>0||(c.interChRatio=I.interch)),I.safejoint>0&&(c.exp_nspsytune=c.exp_nspsytune|I.safejoint),I.sfb21mod>0&&(c.exp_nspsytune=c.exp_nspsytune|I.sfb21mod<<20),u!=0?c.msfix=I.msfix:Math.abs(c.msfix- -1)>0||(c.msfix=I.msfix),u==0&&(c.VBR_q=d,c.VBR_q_frac=m)}var o=[new e(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new e(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new e(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new e(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new e(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new e(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new e(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new e(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new e(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new e(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new e(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new e(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new e(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new e(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new e(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new e(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new e(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function a(c,d,u){var f=d,m=n.nearestBitrateFullIndex(d);if(c.VBR=Ei.vbr_abr,c.VBR_mean_bitrate_kbps=f,c.VBR_mean_bitrate_kbps=Math.min(c.VBR_mean_bitrate_kbps,320),c.VBR_mean_bitrate_kbps=Math.max(c.VBR_mean_bitrate_kbps,8),c.brate=c.VBR_mean_bitrate_kbps,c.VBR_mean_bitrate_kbps>320&&(c.disable_reservoir=!0),o[m].safejoint>0&&(c.exp_nspsytune=c.exp_nspsytune|2),o[m].sfscale>0&&(c.internal_flags.noise_shaping=2),Math.abs(o[m].nsbass)>0){var h=int(o[m].nsbass*4);h<0&&(h+=64),c.exp_nspsytune=c.exp_nspsytune|h<<2}return u!=0?c.quant_comp=o[m].quant_comp:Math.abs(c.quant_comp- -1)>0||(c.quant_comp=o[m].quant_comp),u!=0?c.quant_comp_short=o[m].quant_comp_s:Math.abs(c.quant_comp_short- -1)>0||(c.quant_comp_short=o[m].quant_comp_s),u!=0?c.msfix=o[m].nsmsfix:Math.abs(c.msfix- -1)>0||(c.msfix=o[m].nsmsfix),u!=0?c.internal_flags.nsPsy.attackthre=o[m].st_lrm:Math.abs(c.internal_flags.nsPsy.attackthre- -1)>0||(c.internal_flags.nsPsy.attackthre=o[m].st_lrm),u!=0?c.internal_flags.nsPsy.attackthre_s=o[m].st_s:Math.abs(c.internal_flags.nsPsy.attackthre_s- -1)>0||(c.internal_flags.nsPsy.attackthre_s=o[m].st_s),u!=0?c.scale=o[m].scale:Math.abs(c.scale- -1)>0||(c.scale=o[m].scale),u!=0?c.maskingadjust=o[m].masking_adj:Math.abs(c.maskingadjust-0)>0||(c.maskingadjust=o[m].masking_adj),o[m].masking_adj>0?u!=0?c.maskingadjust_short=o[m].masking_adj*.9:Math.abs(c.maskingadjust_short-0)>0||(c.maskingadjust_short=o[m].masking_adj*.9):u!=0?c.maskingadjust_short=o[m].masking_adj*1.1:Math.abs(c.maskingadjust_short-0)>0||(c.maskingadjust_short=o[m].masking_adj*1.1),u!=0?c.ATHlower=-o[m].ath_lower/10:Math.abs(-c.ATHlower*10-0)>0||(c.ATHlower=-o[m].ath_lower/10),u!=0?c.ATHcurve=o[m].ath_curve:Math.abs(c.ATHcurve- -1)>0||(c.ATHcurve=o[m].ath_curve),u!=0?c.interChRatio=o[m].interch:Math.abs(c.interChRatio- -1)>0||(c.interChRatio=o[m].interch),d}this.apply_preset=function(c,d,u){switch(d){case rt.R3MIX:{d=rt.V3,c.VBR=Ei.vbr_mtrh;break}case rt.MEDIUM:{d=rt.V4,c.VBR=Ei.vbr_rh;break}case rt.MEDIUM_FAST:{d=rt.V4,c.VBR=Ei.vbr_mtrh;break}case rt.STANDARD:{d=rt.V2,c.VBR=Ei.vbr_rh;break}case rt.STANDARD_FAST:{d=rt.V2,c.VBR=Ei.vbr_mtrh;break}case rt.EXTREME:{d=rt.V0,c.VBR=Ei.vbr_rh;break}case rt.EXTREME_FAST:{d=rt.V0,c.VBR=Ei.vbr_mtrh;break}case rt.INSANE:return d=320,c.preset=d,a(c,d,u),c.VBR=Ei.vbr_off,d}switch(c.preset=d,d){case rt.V9:return r(c,9,u),d;case rt.V8:return r(c,8,u),d;case rt.V7:return r(c,7,u),d;case rt.V6:return r(c,6,u),d;case rt.V5:return r(c,5,u),d;case rt.V4:return r(c,4,u),d;case rt.V3:return r(c,3,u),d;case rt.V2:return r(c,2,u),d;case rt.V1:return r(c,1,u),d;case rt.V0:return r(c,0,u),d}return d>=8&&d<=320?a(c,d,u):(c.preset=0,d)};function l(c,d){var u=0;return d<0&&(u=-1,d=0),d>9&&(u=-1,d=9),c.VBR_q=d,c.VBR_q_frac=0,u}}function A$(){this.setModules=function(t,e){}}function Fm(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var q3=Oe.new_float,R$=Oe.new_int;function C$(){this.global_gain=0,this.sfb_count1=0,this.step=R$(39),this.noise=q3(39),this.noise_log=q3(39)}var br=Oe.System,$3=Oe.VbrMode,Um=Oe.Util,Ta=Oe.Arrays,Yl=Oe.new_float,Xl=Oe.assert;function I$(){var t;this.rv=null;var e;this.qupvt=null;var n,s=new A$,i;this.setModules=function(L,p,C,P){t=L,e=p,this.rv=p,n=C,this.qupvt=C,i=P,s.setModules(n,i)},this.ms_convert=function(L,p){for(var C=0;C<576;++C){var P=L.tt[p][0].xr[C],M=L.tt[p][1].xr[C];L.tt[p][0].xr[C]=(P+M)*(Um.SQRT2*.5),L.tt[p][1].xr[C]=(P-M)*(Um.SQRT2*.5)}};function r(L,p,C,P){P=0;for(var M=0;M<=C;++M){var F=Math.abs(L.xr[M]);P+=F,p[M]=Math.sqrt(F*Math.sqrt(F)),p[M]>L.xrpow_max&&(L.xrpow_max=p[M])}return P}this.init_xrpow=function(L,p,C){var P=0,M=0|p.max_nonzero_coeff;if(p.xrpow_max=0,Ta.fill(C,M,576,0),P=r(p,C,M,P),P>1e-20){var F=0;(L.substep_shaping&2)!=0&&(F=1);for(var _=0;_<p.psymax;_++)L.pseudohalf[_]=F;return!0}return Ta.fill(p.l3_enc,0,576,0),!1};function o(L,p){var C=L.ATH,P=p.xr;if(p.block_type!=D.SHORT_TYPE)for(var M=!1,F=D.PSFB21-1;F>=0&&!M;F--){var _=L.scalefac_band.psfb21[F],S=L.scalefac_band.psfb21[F+1],x=n.athAdjust(C.adjust,C.psfb21[F],C.floor);L.nsPsy.longfact[21]>1e-12&&(x*=L.nsPsy.longfact[21]);for(var v=S-1;v>=_;v--)if(Math.abs(P[v])<x)P[v]=0;else{M=!0;break}}else for(var w=0;w<3;w++)for(var M=!1,F=D.PSFB12-1;F>=0&&!M;F--){var _=L.scalefac_band.s[12]*3+(L.scalefac_band.s[13]-L.scalefac_band.s[12])*w+(L.scalefac_band.psfb12[F]-L.scalefac_band.psfb12[0]),S=_+(L.scalefac_band.psfb12[F+1]-L.scalefac_band.psfb12[F]),b=n.athAdjust(C.adjust,C.psfb12[F],C.floor);L.nsPsy.shortfact[12]>1e-12&&(b*=L.nsPsy.shortfact[12]);for(var v=S-1;v>=_;v--)if(Math.abs(P[v])<b)P[v]=0;else{M=!0;break}}}this.init_outer_loop=function(L,p){p.part2_3_length=0,p.big_values=0,p.count1=0,p.global_gain=210,p.scalefac_compress=0,p.table_select[0]=0,p.table_select[1]=0,p.table_select[2]=0,p.subblock_gain[0]=0,p.subblock_gain[1]=0,p.subblock_gain[2]=0,p.subblock_gain[3]=0,p.region0_count=0,p.region1_count=0,p.preflag=0,p.scalefac_scale=0,p.count1table_select=0,p.part2_length=0,p.sfb_lmax=D.SBPSY_l,p.sfb_smin=D.SBPSY_s,p.psy_lmax=L.sfb21_extra?D.SBMAX_l:D.SBPSY_l,p.psymax=p.psy_lmax,p.sfbmax=p.sfb_lmax,p.sfbdivide=11;for(var C=0;C<D.SBMAX_l;C++)p.width[C]=L.scalefac_band.l[C+1]-L.scalefac_band.l[C],p.window[C]=3;if(p.block_type==D.SHORT_TYPE){var P=Yl(576);p.sfb_smin=0,p.sfb_lmax=0,p.mixed_block_flag!=0&&(p.sfb_smin=3,p.sfb_lmax=L.mode_gr*2+4),p.psymax=p.sfb_lmax+3*((L.sfb21_extra?D.SBMAX_s:D.SBPSY_s)-p.sfb_smin),p.sfbmax=p.sfb_lmax+3*(D.SBPSY_s-p.sfb_smin),p.sfbdivide=p.sfbmax-18,p.psy_lmax=p.sfb_lmax;var M=L.scalefac_band.l[p.sfb_lmax];br.arraycopy(p.xr,0,P,0,576);for(var C=p.sfb_smin;C<D.SBMAX_s;C++)for(var F=L.scalefac_band.s[C],_=L.scalefac_band.s[C+1],S=0;S<3;S++)for(var x=F;x<_;x++)p.xr[M++]=P[3*x+S];for(var v=p.sfb_lmax,C=p.sfb_smin;C<D.SBMAX_s;C++)p.width[v]=p.width[v+1]=p.width[v+2]=L.scalefac_band.s[C+1]-L.scalefac_band.s[C],p.window[v]=0,p.window[v+1]=1,p.window[v+2]=2,v+=3}p.count1bits=0,p.sfb_partition_table=n.nr_of_sfb_block[0][0],p.slen[0]=0,p.slen[1]=0,p.slen[2]=0,p.slen[3]=0,p.max_nonzero_coeff=575,Ta.fill(p.scalefac,0),o(L,p)};function a(L){this.ordinal=L}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function l(L,p,C,P,M){var F,_=L.CurrentStep[P],S=!1,x=L.OldValue[P],v=a.BINSEARCH_NONE;for(p.global_gain=x,C-=p.part2_length;;){var w;if(F=i.count_bits(L,M,p,null),_==1||F==C)break;F>C?(v==a.BINSEARCH_DOWN&&(S=!0),S&&(_/=2),v=a.BINSEARCH_UP,w=_):(v==a.BINSEARCH_UP&&(S=!0),S&&(_/=2),v=a.BINSEARCH_DOWN,w=-_),p.global_gain+=w,p.global_gain<0&&(p.global_gain=0,S=!0),p.global_gain>255&&(p.global_gain=255,S=!0)}for(Xl(p.global_gain>=0),Xl(p.global_gain<256);F>C&&p.global_gain<255;)p.global_gain++,F=i.count_bits(L,M,p,null);return L.CurrentStep[P]=x-p.global_gain>=4?4:2,L.OldValue[P]=p.global_gain,p.part2_3_length=F,F}this.trancate_smallspectrums=function(L,p,C,P){var M=Yl(Br.SFBMAX);if(!((L.substep_shaping&4)==0&&p.block_type==D.SHORT_TYPE||(L.substep_shaping&128)!=0)){n.calc_noise(p,C,M,new Fm,null);for(var _=0;_<576;_++){var F=0;p.l3_enc[_]!=0&&(F=Math.abs(p.xr[_])),P[_]=F}var _=0,S=8;p.block_type==D.SHORT_TYPE&&(S=6);do{var x,v,w,b,y=p.width[S];if(_+=y,!(M[S]>=1)&&(Ta.sort(P,_-y,y),!BitStream.EQ(P[_-1],0))){x=(1-M[S])*C[S],v=0,b=0;do{var A;for(w=1;b+w<y&&!BitStream.NEQ(P[b+_-y],P[b+_+w-y]);w++);if(A=P[b+_-y]*P[b+_-y]*w,x<A){b!=0&&(v=P[b+_-y-1]);break}x-=A,b+=w}while(b<y);if(!BitStream.EQ(v,0))do Math.abs(p.xr[_-y])<=v&&(p.l3_enc[_-y]=0);while(--y>0)}}while(++S<p.psymax);p.part2_3_length=i.noquant_count_bits(L,p,null)}};function c(L){for(var p=0;p<L.sfbmax;p++)if(L.scalefac[p]+L.subblock_gain[L.window[p]]==0)return!1;return!0}function d(L){return Um.FAST_LOG10(.368+.632*L*L*L)}function u(L,p){for(var C=1e-37,P=0;P<p.psymax;P++)C+=d(L[P]);return Math.max(1e-20,C)}function f(L,p,C,P,M){var F;switch(L){default:case 9:{p.over_count>0?(F=C.over_SSD<=p.over_SSD,C.over_SSD==p.over_SSD&&(F=C.bits<p.bits)):F=C.max_noise<0&&C.max_noise*10+C.bits<=p.max_noise*10+p.bits;break}case 0:F=C.over_count<p.over_count||C.over_count==p.over_count&&C.over_noise<p.over_noise||C.over_count==p.over_count&&BitStream.EQ(C.over_noise,p.over_noise)&&C.tot_noise<p.tot_noise;break;case 8:C.max_noise=u(M,P);case 1:F=C.max_noise<p.max_noise;break;case 2:F=C.tot_noise<p.tot_noise;break;case 3:F=C.tot_noise<p.tot_noise&&C.max_noise<p.max_noise;break;case 4:F=C.max_noise<=0&&p.max_noise>.2||C.max_noise<=0&&p.max_noise<0&&p.max_noise>C.max_noise-.2&&C.tot_noise<p.tot_noise||C.max_noise<=0&&p.max_noise>0&&p.max_noise>C.max_noise-.2&&C.tot_noise<p.tot_noise+p.over_noise||C.max_noise>0&&p.max_noise>-.05&&p.max_noise>C.max_noise-.1&&C.tot_noise+C.over_noise<p.tot_noise+p.over_noise||C.max_noise>0&&p.max_noise>-.1&&p.max_noise>C.max_noise-.15&&C.tot_noise+C.over_noise+C.over_noise<p.tot_noise+p.over_noise+p.over_noise;break;case 5:F=C.over_noise<p.over_noise||BitStream.EQ(C.over_noise,p.over_noise)&&C.tot_noise<p.tot_noise;break;case 6:F=C.over_noise<p.over_noise||BitStream.EQ(C.over_noise,p.over_noise)&&(C.max_noise<p.max_noise||BitStream.EQ(C.max_noise,p.max_noise)&&C.tot_noise<=p.tot_noise);break;case 7:F=C.over_count<p.over_count||C.over_noise<p.over_noise;break}return p.over_count==0&&(F=F&&C.bits<p.bits),F}function m(L,p,C,P,M){var F=L.internal_flags,_;p.scalefac_scale==0?_=1.2968395546510096:_=1.6817928305074292;for(var S=0,x=0;x<p.sfbmax;x++)S<C[x]&&(S=C[x]);var v=F.noise_shaping_amp;switch(v==3&&(M?v=2:v=1),v){case 2:break;case 1:S>1?S=Math.pow(S,.5):S*=.95;break;case 0:default:S>1?S=1:S*=.95;break}for(var w=0,x=0;x<p.sfbmax;x++){var b=p.width[x],y;if(w+=b,!(C[x]<S)){if((F.substep_shaping&2)!=0&&(F.pseudohalf[x]=F.pseudohalf[x]==0?1:0,F.pseudohalf[x]==0&&F.noise_shaping_amp==2))return;for(p.scalefac[x]++,y=-b;y<0;y++)P[w+y]*=_,P[w+y]>p.xrpow_max&&(p.xrpow_max=P[w+y]);if(F.noise_shaping_amp==2)return}}}function h(L,p){for(var C=1.2968395546510096,P=0,M=0;M<L.sfbmax;M++){var F=L.width[M],_=L.scalefac[M];if(L.preflag!=0&&(_+=n.pretab[M]),P+=F,(_&1)!=0){_++;for(var S=-F;S<0;S++)p[P+S]*=C,p[P+S]>L.xrpow_max&&(L.xrpow_max=p[P+S])}L.scalefac[M]=_>>1}L.preflag=0,L.scalefac_scale=1}function k(L,p,C){var P,M=p.scalefac;for(P=0;P<p.sfb_lmax;P++)if(M[P]>=16)return!0;for(var F=0;F<3;F++){var _=0,S=0;for(P=p.sfb_lmax+F;P<p.sfbdivide;P+=3)_<M[P]&&(_=M[P]);for(;P<p.sfbmax;P+=3)S<M[P]&&(S=M[P]);if(!(_<16&&S<8)){if(p.subblock_gain[F]>=7)return!0;p.subblock_gain[F]++;var x=L.scalefac_band.l[p.sfb_lmax];for(P=p.sfb_lmax+F;P<p.sfbmax;P+=3){var v,w=p.width[P],b=M[P];if(b=b-(4>>p.scalefac_scale),b>=0){M[P]=b,x+=w*3;continue}M[P]=0;{var y=210+(b<<p.scalefac_scale+1);v=n.IPOW20(y)}x+=w*(F+1);for(var A=-w;A<0;A++)C[x+A]*=v,C[x+A]>p.xrpow_max&&(p.xrpow_max=C[x+A]);x+=w*(3-F-1)}{var v=n.IPOW20(202);x+=p.width[P]*(F+1);for(var A=-p.width[P];A<0;A++)C[x+A]*=v,C[x+A]>p.xrpow_max&&(p.xrpow_max=C[x+A])}}}return!1}function I(L,p,C,P,M){var F=L.internal_flags;m(L,p,C,P,M);var _=c(p);return _?!1:(F.mode_gr==2?_=i.scale_bitcount(p):_=i.scale_bitcount_lsf(F,p),_?(F.noise_shaping>1&&(Ta.fill(F.pseudohalf,0),p.scalefac_scale==0?(h(p,P),_=!1):p.block_type==D.SHORT_TYPE&&F.subblock_gain>0&&(_=k(F,p,P)||c(p))),_||(F.mode_gr==2?_=i.scale_bitcount(p):_=i.scale_bitcount_lsf(F,p)),!_):!0)}this.outer_loop=function(L,p,C,P,M,F){var _=L.internal_flags,S=new Qd,x=Yl(576),v=Yl(Br.SFBMAX),w=new Fm,b,y=new C$,A=9999999,T=!1,U=!1,W=0;if(l(_,p,F,M,P),_.noise_shaping==0)return 100;n.calc_noise(p,C,v,w,y),w.bits=p.part2_3_length,S.assign(p);var j=0;for(br.arraycopy(P,0,x,0,576);!T;){do{var K=new Fm,g,R=255;if((_.substep_shaping&2)!=0?g=20:g=3,_.sfb21_extra&&(v[S.sfbmax]>1||S.block_type==D.SHORT_TYPE&&(v[S.sfbmax+1]>1||v[S.sfbmax+2]>1))||!I(L,S,v,P,U))break;S.scalefac_scale!=0&&(R=254);var ee=F-S.part2_length;if(ee<=0)break;for(;(S.part2_3_length=i.count_bits(_,P,S,y))>ee&&S.global_gain<=R;)S.global_gain++;if(S.global_gain>R)break;if(w.over_count==0){for(;(S.part2_3_length=i.count_bits(_,P,S,y))>A&&S.global_gain<=R;)S.global_gain++;if(S.global_gain>R)break}if(n.calc_noise(S,C,v,K,y),K.bits=S.part2_3_length,p.block_type!=D.SHORT_TYPE?b=L.quant_comp:b=L.quant_comp_short,b=f(b,w,K,S,v)?1:0,b!=0)A=p.part2_3_length,w=K,p.assign(S),j=0,br.arraycopy(P,0,x,0,576);else if(_.full_outer_loop==0&&(++j>g&&w.over_count==0||_.noise_shaping_amp==3&&U&&j>30||_.noise_shaping_amp==3&&U&&S.global_gain-W>15))break}while(S.global_gain+S.scalefac_scale<255);_.noise_shaping_amp==3?U?T=!0:(S.assign(p),br.arraycopy(x,0,P,0,576),j=0,W=S.global_gain,U=!0):T=!0}return Xl(p.global_gain+p.scalefac_scale<=255),L.VBR==$3.vbr_rh||L.VBR==$3.vbr_mtrh?br.arraycopy(x,0,P,0,576):(_.substep_shaping&1)!=0&&trancate_smallspectrums(_,p,C,P),w.over_count},this.iteration_finish_one=function(L,p,C){var P=L.l3_side,M=P.tt[p][C];i.best_scalefac_store(L,p,C,P),L.use_best_huffman==1&&i.best_huffman_divide(L,M),e.ResvAdjust(L,M)},this.VBR_encode_granule=function(L,p,C,P,M,F,_){var S=L.internal_flags,x=new Qd,v=Yl(576),w=_,b=_+1,y=(_+F)/2,A,T,U=0,W=S.sfb21_extra;Xl(w<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Ta.fill(x.l3_enc,0);do y>w-42?S.sfb21_extra=!1:S.sfb21_extra=W,T=outer_loop(L,p,C,P,M,y),T<=0?(U=1,b=p.part2_3_length,x.assign(p),br.arraycopy(P,0,v,0,576),_=b-32,A=_-F,y=(_+F)/2):(F=y+32,A=_-F,y=(_+F)/2,U!=0&&(U=2,p.assign(x),br.arraycopy(v,0,P,0,576)));while(A>12);S.sfb21_extra=W,U==2&&br.arraycopy(x.l3_enc,0,p.l3_enc,0,576),Xl(p.part2_3_length<=w)},this.get_framebits=function(L,p){var C=L.internal_flags;C.bitrate_index=C.VBR_min_bitrate;var P=t.getframebits(L);C.bitrate_index=1,P=t.getframebits(L);for(var M=1;M<=C.VBR_max_bitrate;M++){C.bitrate_index=M;var F=new MeanBits(P);p[M]=e.ResvFrameBegin(L,F),P=F.bits}},this.VBR_old_prepare=function(L,p,C,P,M,F,_,S,x){var v=L.internal_flags,w,b=0,y=1,A=0;v.bitrate_index=v.VBR_max_bitrate;var T=e.ResvFrameBegin(L,new MeanBits(0))/v.mode_gr;get_framebits(L,F);for(var U=0;U<v.mode_gr;U++){var W=n.on_pe(L,p,S[U],T,U,0);v.mode_ext==D.MPG_MD_MS_LR&&(ms_convert(v.l3_side,U),n.reduce_side(S[U],C[U],T,W));for(var j=0;j<v.channels_out;++j){var K=v.l3_side.tt[U][j];K.block_type!=D.SHORT_TYPE?(b=1.28/(1+Math.exp(3.5-p[U][j]/300))-.05,w=v.PSY.mask_adjust-b):(b=2.56/(1+Math.exp(3.5-p[U][j]/300))-.14,w=v.PSY.mask_adjust_short-b),v.masking_lower=Math.pow(10,w*.1),init_outer_loop(v,K),x[U][j]=n.calc_xmin(L,P[U][j],K,M[U][j]),x[U][j]!=0&&(y=0),_[U][j]=126,A+=S[U][j]}}for(var U=0;U<v.mode_gr;U++)for(var j=0;j<v.channels_out;j++)A>F[v.VBR_max_bitrate]&&(S[U][j]*=F[v.VBR_max_bitrate],S[U][j]/=A),_[U][j]>S[U][j]&&(_[U][j]=S[U][j]);return y},this.bitpressure_strategy=function(L,p,C,P){for(var M=0;M<L.mode_gr;M++)for(var F=0;F<L.channels_out;F++){for(var _=L.l3_side.tt[M][F],S=p[M][F],x=0,v=0;v<_.psy_lmax;v++)S[x++]*=1+.029*v*v/D.SBMAX_l/D.SBMAX_l;if(_.block_type==D.SHORT_TYPE)for(var v=_.sfb_smin;v<D.SBMAX_s;v++)S[x++]*=1+.029*v*v/D.SBMAX_s/D.SBMAX_s,S[x++]*=1+.029*v*v/D.SBMAX_s/D.SBMAX_s,S[x++]*=1+.029*v*v/D.SBMAX_s/D.SBMAX_s;P[M][F]=0|Math.max(C[M][F],.9*P[M][F])}},this.VBR_new_prepare=function(L,p,C,P,M,F){var _=L.internal_flags,S=1,x=0,v=0,w;if(L.free_format){_.bitrate_index=0;var b=new MeanBits(x);w=e.ResvFrameBegin(L,b),x=b.bits,M[0]=w}else{_.bitrate_index=_.VBR_max_bitrate;var b=new MeanBits(x);e.ResvFrameBegin(L,b),x=b.bits,get_framebits(L,M),w=M[_.VBR_max_bitrate]}for(var y=0;y<_.mode_gr;y++){n.on_pe(L,p,F[y],x,y,0),_.mode_ext==D.MPG_MD_MS_LR&&ms_convert(_.l3_side,y);for(var A=0;A<_.channels_out;++A){var T=_.l3_side.tt[y][A];_.masking_lower=Math.pow(10,_.PSY.mask_adjust*.1),init_outer_loop(_,T),n.calc_xmin(L,C[y][A],T,P[y][A])!=0&&(S=0),v+=F[y][A]}}for(var y=0;y<_.mode_gr;y++)for(var A=0;A<_.channels_out;A++)v>w&&(F[y][A]*=w,F[y][A]/=v);return S},this.calc_target_bits=function(L,p,C,P,M,F){var _=L.internal_flags,S=_.l3_side,x,v,w,b,y=0;_.bitrate_index=_.VBR_max_bitrate;var A=new MeanBits(y);for(F[0]=e.ResvFrameBegin(L,A),y=A.bits,_.bitrate_index=1,y=t.getframebits(L)-_.sideinfo_len*8,M[0]=y/(_.mode_gr*_.channels_out),y=L.VBR_mean_bitrate_kbps*L.framesize*1e3,(_.substep_shaping&1)!=0&&(y*=1.09),y/=L.out_samplerate,y-=_.sideinfo_len*8,y/=_.mode_gr*_.channels_out,x=.93+.07*(11-L.compression_ratio)/(11-5.5),x<.9&&(x=.9),x>1&&(x=1),v=0;v<_.mode_gr;v++){var T=0;for(w=0;w<_.channels_out;w++){if(P[v][w]=int(x*y),p[v][w]>700){var U=int((p[v][w]-700)/1.4),W=S.tt[v][w];P[v][w]=int(x*y),W.block_type==D.SHORT_TYPE&&U<y/2&&(U=y/2),U>y*3/2?U=y*3/2:U<0&&(U=0),P[v][w]+=U}P[v][w]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[v][w]=LameInternalFlags.MAX_BITS_PER_CHANNEL),T+=P[v][w]}if(T>LameInternalFlags.MAX_BITS_PER_GRANULE)for(w=0;w<_.channels_out;++w)P[v][w]*=LameInternalFlags.MAX_BITS_PER_GRANULE,P[v][w]/=T}if(_.mode_ext==D.MPG_MD_MS_LR)for(v=0;v<_.mode_gr;v++)n.reduce_side(P[v],C[v],y*_.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(b=0,v=0;v<_.mode_gr;v++)for(w=0;w<_.channels_out;w++)P[v][w]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[v][w]=LameInternalFlags.MAX_BITS_PER_CHANNEL),b+=P[v][w];if(b>F[0])for(v=0;v<_.mode_gr;v++)for(w=0;w<_.channels_out;w++)P[v][w]*=F[0],P[v][w]/=b}}var z3=Oe.assert;function k$(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(e,n){var s=e.internal_flags,i,r=s.l3_side,o=t.getframebits(e);n.bits=(o-s.sideinfo_len*8)/s.mode_gr;var a=8*256*s.mode_gr-8;e.brate>320?i=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(i=8*1440,e.strict_ISO&&(i=8*int(32e4/(e.out_samplerate/1152)/8+.5))),s.ResvMax=i-o,s.ResvMax>a&&(s.ResvMax=a),(s.ResvMax<0||e.disable_reservoir)&&(s.ResvMax=0);var l=n.bits*s.mode_gr+Math.min(s.ResvSize,s.ResvMax);return l>i&&(l=i),z3(s.ResvMax%8==0),z3(s.ResvMax>=0),r.resvDrain_pre=0,s.pinfo!=null&&(s.pinfo.mean_bits=n.bits/2,s.pinfo.resvsize=s.ResvSize),l},this.ResvMaxBits=function(e,n,s,i){var r=e.internal_flags,o,a=r.ResvSize,l=r.ResvMax;i!=0&&(a+=n),(r.substep_shaping&1)!=0&&(l*=.9),s.bits=n,a*10>l*9?(o=a-l*9/10,s.bits+=o,r.substep_shaping|=128):(o=0,r.substep_shaping&=127,!e.disable_reservoir&&(r.substep_shaping&1)==0&&(s.bits-=.1*n));var c=a<r.ResvMax*6/10?a:r.ResvMax*6/10;return c-=o,c<0&&(c=0),c},this.ResvAdjust=function(e,n){e.ResvSize-=n.part2_3_length+n.part2_length},this.ResvFrameEnd=function(e,n){var s,i=e.l3_side;e.ResvSize+=n*e.mode_gr;var r=0;i.resvDrain_post=0,i.resvDrain_pre=0,(s=e.ResvSize%8)!=0&&(r+=s),s=e.ResvSize-r-e.ResvMax,s>0&&(r+=s);{var o=Math.min(i.main_data_begin*8,r)/8;i.resvDrain_pre+=8*o,r-=8*o,e.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=r,e.ResvSize-=r}}function M$(){var t="http://www.mp3dev.org/",e=3,n=98,s=4,i=0,r=93;this.getLameVersion=function(){return e+"."+n+"."+s},this.getLameShortVersion=function(){return e+"."+n+"."+s},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+n+"r"},this.getPsyVersion=function(){return i+"."+r},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var N$=Oe.System,jm=Oe.VbrMode,K3=Oe.ShortBlock,O$=Oe.Arrays,Ph=Oe.new_byte,L$=Oe.assert;fu.NUMTOCENTRIES=100;fu.MAXFRAMESIZE=2880;function fu(){var t,e,n;this.setModules=function(y,A,T){t=y,e=A,n=T};var s=1,i=2,r=4,o=8,a=fu.NUMTOCENTRIES,l=fu.MAXFRAMESIZE,c=a+4+4+4+4+4,d=c+9+1+1+8+1+1+3+1+1+2+4+2+2,u=128,f=64,m=32,h=null,k="Xing",I="Info",L=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function p(y,A){if(y.nVbrNumFrames++,y.sum+=A,y.seen++,!(y.seen<y.want)&&(y.pos<y.size&&(y.bag[y.pos]=y.sum,y.pos++,y.seen=0),y.pos==y.size)){for(var T=1;T<y.size;T+=2)y.bag[T/2]=y.bag[T];y.want*=2,y.pos/=2}}function C(y,A){if(!(y.pos<=0))for(var T=1;T<a;++T){var U=T/a,W,j,K=0|Math.floor(U*y.pos);K>y.pos-1&&(K=y.pos-1),W=y.bag[K],j=y.sum;var g=0|256*W/j;g>255&&(g=255),A[T]=255&g}}this.addVbrFrame=function(y){var A=y.internal_flags,T=Tables.bitrate_table[y.version][A.bitrate_index];L$(A.VBR_seek_table.bag!=null),p(A.VBR_seek_table,T)};function P(y,A){var T=y[A+0]&255;return T<<=8,T|=y[A+1]&255,T<<=8,T|=y[A+2]&255,T<<=8,T|=y[A+3]&255,T}function M(y,A,T){y[A+0]=255&(T>>24&255),y[A+1]=255&(T>>16&255),y[A+2]=255&(T>>8&255),y[A+3]=255&(T&255)}function F(y,A,T){y[A+0]=255&(T>>8&255),y[A+1]=255&(T&255)}function _(y,A){return new String(y,A,k.length(),h).equals(k)||new String(y,A,I.length(),h).equals(I)}function S(y,A,T){return 255&(y<<A|T&~(-1<<A))}function x(y,A){var T=y.internal_flags;A[0]=S(A[0],8,255),A[1]=S(A[1],3,7),A[1]=S(A[1],1,y.out_samplerate<16e3?0:1),A[1]=S(A[1],1,y.version),A[1]=S(A[1],2,4-3),A[1]=S(A[1],1,y.error_protection?0:1),A[2]=S(A[2],4,T.bitrate_index),A[2]=S(A[2],2,T.samplerate_index),A[2]=S(A[2],1,0),A[2]=S(A[2],1,y.extension),A[3]=S(A[3],2,y.mode.ordinal()),A[3]=S(A[3],2,T.mode_ext),A[3]=S(A[3],1,y.copyright),A[3]=S(A[3],1,y.original),A[3]=S(A[3],2,y.emphasis),A[0]=255;var U=255&(A[1]&241),W;y.version==1?W=u:y.out_samplerate<16e3?W=m:W=f,y.VBR==jm.vbr_off&&(W=y.brate);var j;y.free_format?j=0:j=255&16*t.BitrateIndex(W,y.version,y.out_samplerate),y.version==1?(A[1]=255&(U|10),U=255&(A[2]&13),A[2]=255&(j|U)):(A[1]=255&(U|2),U=255&(A[2]&13),A[2]=255&(j|U))}this.getVbrTag=function(y){var A=new VBRTagData,T=0;A.flags=0;var U=y[T+1]>>3&1,W=y[T+2]>>2&3,j=y[T+3]>>6&3,K=y[T+2]>>4&15;if(K=Tables.bitrate_table[U][K],y[T+1]>>4==14?A.samprate=Tables.samplerate_table[2][W]:A.samprate=Tables.samplerate_table[U][W],U!=0?j!=3?T+=32+4:T+=17+4:j!=3?T+=17+4:T+=9+4,!_(y,T))return null;T+=4,A.hId=U;var g=A.flags=P(y,T);if(T+=4,(g&s)!=0&&(A.frames=P(y,T),T+=4),(g&i)!=0&&(A.bytes=P(y,T),T+=4),(g&r)!=0){if(A.toc!=null)for(var R=0;R<a;R++)A.toc[R]=y[T+R];T+=a}A.vbrScale=-1,(g&o)!=0&&(A.vbrScale=P(y,T),T+=4),A.headersize=(U+1)*72e3*K/A.samprate,T+=21;var ee=y[T+0]<<4;ee+=y[T+1]>>4;var ne=(y[T+1]&15)<<8;return ne+=y[T+2]&255,(ee<0||ee>3e3)&&(ee=-1),(ne<0||ne>3e3)&&(ne=-1),A.encDelay=ee,A.encPadding=ne,A},this.InitVbrTag=function(y){var A=y.internal_flags,T;y.version==1?T=u:y.out_samplerate<16e3?T=m:T=f,y.VBR==jm.vbr_off&&(T=y.brate);var U=(y.version+1)*72e3*T/y.out_samplerate,W=A.sideinfo_len+d;if(A.VBR_seek_table.TotalFrameSize=U,U<W||U>l){y.bWriteVbrTag=!1;return}A.VBR_seek_table.nVbrNumFrames=0,A.VBR_seek_table.nBytesWritten=0,A.VBR_seek_table.sum=0,A.VBR_seek_table.seen=0,A.VBR_seek_table.want=1,A.VBR_seek_table.pos=0,A.VBR_seek_table.bag==null&&(A.VBR_seek_table.bag=new int[400],A.VBR_seek_table.size=400);var j=Ph(l);x(y,j);for(var K=A.VBR_seek_table.TotalFrameSize,g=0;g<K;++g)e.add_dummy_byte(y,j[g]&255,1)};function v(y,A){var T=A^y;return A=A>>8^L[T&255],A}this.updateMusicCRC=function(y,A,T,U){for(var W=0;W<U;++W)y[0]=v(A[T+W],y[0])};function w(y,A,T,U,W){var j=y.internal_flags,K=0,g=y.encoder_delay,R=y.encoder_padding,ee=100-10*y.VBR_q-y.quality,ne=n.getLameVeryShortVersion(),xe,Ie=0,Me,be=[1,5,3,2,4,0,3],ze=0|(y.lowpassfreq/100+.5>255?255:y.lowpassfreq/100+.5),De=0,we=0,Xe=0,mt=y.internal_flags.noise_shaping,E=0,N=0,V=0,$=0,G=0,te=(y.exp_nspsytune&1)!=0,le=(y.exp_nspsytune&2)!=0,Q=!1,se=!1,X=y.internal_flags.nogap_total,ve=y.internal_flags.nogap_current,de=y.ATHtype,ye=0,Re;switch(y.VBR){case vbr_abr:Re=y.VBR_mean_bitrate_kbps;break;case vbr_off:Re=y.brate;break;default:Re=y.VBR_min_bitrate_kbps}switch(y.VBR.ordinal()<be.length?xe=be[y.VBR.ordinal()]:xe=0,Me=16*Ie+xe,j.findReplayGain&&(j.RadioGain>510&&(j.RadioGain=510),j.RadioGain<-510&&(j.RadioGain=-510),we=8192,we|=3072,j.RadioGain>=0?we|=j.RadioGain:(we|=512,we|=-j.RadioGain)),j.findPeakSample&&(De=Math.abs(0|j.PeakSample/32767*Math.pow(2,23)+.5)),X!=-1&&(ve>0&&(se=!0),ve<X-1&&(Q=!0)),ye=de+((te?1:0)<<4)+((le?1:0)<<5)+((Q?1:0)<<6)+((se?1:0)<<7),ee<0&&(ee=0),y.mode){case MONO:E=0;break;case STEREO:E=1;break;case DUAL_CHANNEL:E=2;break;case JOINT_STEREO:y.force_ms?E=4:E=3;break;case NOT_SET:default:E=7;break}y.in_samplerate<=32e3?V=0:y.in_samplerate==48e3?V=2:y.in_samplerate>48e3?V=3:V=1,(y.short_blocks==K3.short_block_forced||y.short_blocks==K3.short_block_dispensed||y.lowpassfreq==-1&&y.highpassfreq==-1||y.scale_left<y.scale_right||y.scale_left>y.scale_right||y.disable_reservoir&&y.brate<320||y.noATH||y.ATHonly||de==0||y.in_samplerate<=32e3)&&(N=1),$=mt+(E<<2)+(N<<5)+(V<<6),G=j.nMusicCRC,M(T,U+K,ee),K+=4;for(var Le=0;Le<9;Le++)T[U+K+Le]=255&ne.charAt(Le);K+=9,T[U+K]=255&Me,K++,T[U+K]=255&ze,K++,M(T,U+K,De),K+=4,F(T,U+K,we),K+=2,F(T,U+K,Xe),K+=2,T[U+K]=255&ye,K++,Re>=255?T[U+K]=255:T[U+K]=255&Re,K++,T[U+K]=255&g>>4,T[U+K+1]=255&(g<<4)+(R>>8),T[U+K+2]=255&R,K+=3,T[U+K]=255&$,K++,T[U+K++]=0,F(T,U+K,y.preset),K+=2,M(T,U+K,A),K+=4,F(T,U+K,G),K+=2;for(var ce=0;ce<K;ce++)W=v(T[U+ce],W);return F(T,U+K,W),K+=2,K}function b(y){y.seek(0);var A=Ph(10);y.readFully(A);var T;return new String(A,"ISO-8859-1").startsWith("ID3")?T=0:T=((A[6]&127)<<21|(A[7]&127)<<14|(A[8]&127)<<7|A[9]&127)+A.length,T}this.getLameTagFrame=function(y,A){var T=y.internal_flags;if(!y.bWriteVbrTag||T.Class_ID!=Lame.LAME_ID||T.VBR_seek_table.pos<=0)return 0;if(A.length<T.VBR_seek_table.TotalFrameSize)return T.VBR_seek_table.TotalFrameSize;O$.fill(A,0,T.VBR_seek_table.TotalFrameSize,0),x(y,A);var U=Ph(a);if(y.free_format)for(var W=1;W<a;++W)U[W]=255&255*W/100;else C(T.VBR_seek_table,U);var j=T.sideinfo_len;y.error_protection&&(j-=2),y.VBR==jm.vbr_off?(A[j++]=255&I.charAt(0),A[j++]=255&I.charAt(1),A[j++]=255&I.charAt(2),A[j++]=255&I.charAt(3)):(A[j++]=255&k.charAt(0),A[j++]=255&k.charAt(1),A[j++]=255&k.charAt(2),A[j++]=255&k.charAt(3)),M(A,j,s+i+r+o),j+=4,M(A,j,T.VBR_seek_table.nVbrNumFrames),j+=4;var K=T.VBR_seek_table.nBytesWritten+T.VBR_seek_table.TotalFrameSize;M(A,j,0|K),j+=4,N$.arraycopy(U,0,A,j,U.length),j+=U.length,y.error_protection&&e.CRC_writeheader(T,A);for(var g=0,W=0;W<j;W++)g=v(A[W],g);return j+=w(y,K,A,j,g),T.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(y,A){var T=y.internal_flags;if(T.VBR_seek_table.pos<=0||(A.seek(A.length()),A.length()==0))return-1;var U=b(A);A.seek(U);var W=Ph(l),j=getLameTagFrame(y,W);return j>W.length?-1:(j<1||A.write(W,0,j),0)}}var G3=Oe.new_byte,P$=Oe.assert;function D$(){this.setModules=function(t,e){}}function B$(){this.setModules=function(t,e,n){}}function F$(){}function U$(){this.setModules=function(t,e){}}function j$(t,e,n){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,e=44100,n=128);var s=new rt,i=new D$,r=new dn,o=new Ys,a=new S$,l=new Vn,c=new I$,d=new fu,u=new M$,f=new U$,m=new k$,h=new du,k=new B$,I=new F$;s.setModules(r,o,a,l,c,d,u,f,I),o.setModules(r,I,u,d),f.setModules(o,u),a.setModules(s),c.setModules(o,m,l,h),l.setModules(h,m,s.enc.psy),m.setModules(o),h.setModules(l),d.setModules(s,o,u),i.setModules(k,I),k.setModules(u,f,a);var L=s.lame_init();L.num_channels=t,L.in_samplerate=e,L.brate=n,L.mode=Nt.STEREO,L.quality=3,L.bWriteVbrTag=!1,L.disable_reservoir=!0,L.write_id3tag_automatic=!1,s.lame_init_params(L);var p=1152,C=0|1.25*p+7200,P=G3(C);this.encodeBuffer=function(M,F){t==1&&(F=M),P$(M.length==F.length),M.length>p&&(p=M.length,C=0|1.25*p+7200,P=G3(C));var _=s.lame_encode_buffer(L,M,F,M.length,P,0,C);return new Int8Array(P.subarray(0,_))},this.flush=function(){var M=s.lame_encode_flush(L,P,0,C);return new Int8Array(P.subarray(0,M))}}function k0(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}k0("RIFF");k0("WAVE");k0("fmt ");k0("data");class H${constructor(e){this.bitRate=e.bitRate,this.sampleRate=e.sampleRate,this.dataBuffer=[],this.encoder=new j$(1,this.sampleRate,this.bitRate)}encode(e){const s=this._convertBuffer(e);let i=s.length;for(let r=0;i>=0;r+=1152){const o=s.subarray(r,r+1152),a=this.encoder.encodeBuffer(o);this.dataBuffer.push(new Int8Array(a)),i-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const e=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:e,url:URL.createObjectURL(e)}}_floatTo16BitPCM(e,n){for(let s=0;s<e.length;s++){const i=Math.max(-1,Math.min(1,e[s]));n[s]=i<0?i*32768:i*32767}}_convertBuffer(e){const n=new Float32Array(e),s=new Int16Array(e.length);return this._floatTo16BitPCM(n,s),s}}class V${constructor(e={}){this.beforeRecording=e.beforeRecording,this.pauseRecording=e.pauseRecording,this.afterRecording=e.afterRecording,this.micFailed=e.micFailed,this.encoderOptions={bitRate:e.bitRate,sampleRate:e.sampleRate},this.bufferSize=4096,this.records=[],this.isPause=!1,this.isRecording=!1,this.duration=0,this.volume=0,this._duration=0}start(){const e={video:!1,audio:{channelCount:1,echoCancellation:!1}};this.beforeRecording&&this.beforeRecording("start recording"),navigator.mediaDevices.getUserMedia(e).then(this._micCaptured.bind(this)).catch(this._micError.bind(this)),this.isPause=!1,this.isRecording=!0,this.lameEncoder||(this.lameEncoder=new H$(this.encoderOptions))}stop(){this.stream.getTracks().forEach(n=>n.stop()),this.input.disconnect(),this.processor.disconnect(),this.context.close();let e=null;e=this.lameEncoder.finish(),e.duration=this.duration,this.records.push(e),this._duration=0,this.duration=0,this.isPause=!1,this.isRecording=!1,this.afterRecording&&this.afterRecording(e)}pause(){this.stream.getTracks().forEach(e=>e.stop()),this.input.disconnect(),this.processor.disconnect(),this._duration=this.duration,this.isPause=!0,this.pauseRecording&&this.pauseRecording("pause recording")}_micCaptured(e){this.context=new(window.AudioContext||window.webkitAudioContext),this.duration=this._duration,this.input=this.context.createMediaStreamSource(e),this.processor=this.context.createScriptProcessor(this.bufferSize,1,1),this.stream=e,this.processor.onaudioprocess=n=>{const s=n.inputBuffer.getChannelData(0);let i=0;this.lameEncoder&&this.lameEncoder.encode(s);for(let r=0;r<s.length;++r)i+=s[r]*s[r];this.duration=parseFloat(this._duration)+parseFloat(this.context.currentTime.toFixed(2)),this.volume=Math.sqrt(i/s.length).toFixed(2)},this.input.connect(this.processor),this.processor.connect(this.context.destination)}_micError(e){this.micFailed&&this.micFailed(e)}}function W3(){var t=q$(),e=t.substr(0,4);return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw(n|u)|c55\/|capi|ccwa|cdm|cell|chtm|cldc|cmd|co(mp|nd)|craw|da(it|ll|ng)|dbte|dcs|devi|dica|dmob|do(c|p)o|ds(12|d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(|_)|g1 u|g560|gene|gf5|gmo|go(\.w|od)|gr(ad|un)|haie|hcit|hd(m|p|t)|hei|hi(pt|ta)|hp( i|ip)|hsc|ht(c(| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i(20|go|ma)|i230|iac( ||\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|[a-w])|libw|lynx|m1w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|mcr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|([1-8]|c))|phil|pire|pl(ay|uc)|pn2|po(ck|rt|se)|prox|psio|ptg|qaa|qc(07|12|21|32|60|[2-7]|i)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h|oo|p)|sdk\/|se(c(|0|1)|47|mc|nd|ri)|sgh|shar|sie(|m)|sk0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h|v|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl|tdg|tel(i|m)|tim|tmo|to(pl|sh)|ts(70|m|m3|m5)|tx9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas|your|zeto|zte/i.test(e)}function q$(){var t=navigator.userAgent||navigator.vendor||window.opera||null;if(!t)throw new Error("Failed to look for user agent information.");return t}const $$={name:"RoomFooter",components:{SvgIcon:Un,EmojiPickerContainer:vS,RoomFiles:nq,RoomMessageReply:Sq,RoomUsersTag:Mq,RoomEmojis:Pq,RoomTemplatesText:Vq},directives:{clickOutside:R0},props:{room:{type:Object,required:!0},roomId:{type:[String,Number],required:!0},roomMessage:{type:String,default:null},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},textMessages:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},showEmojis:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},templatesText:{type:Array,default:null},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},initReplyMessage:{type:Object,default:null},initEditMessage:{type:Object,default:null}},emits:["edit-message","send-message","update-edited-message-id","textarea-action-handler","typing-message"],data(){return{message:"",editedMessage:{},messageReply:null,cursorRangePosition:null,files:[],fileDialog:!1,selectUsersTagItem:null,selectEmojiItem:null,selectTemplatesTextItem:null,format:"mp3",activeUpOrDownEmojis:null,activeUpOrDownUsersTag:null,activeUpOrDownTemplatesText:null,emojisDB:new rS,emojiOpened:!1,keepKeyboardOpen:!1,filteredEmojis:[],filteredUsersTag:[],selectedUsersTag:[],filteredTemplatesText:[],recorder:this.initRecorder(),isRecording:!1}},computed:{isMessageEmpty(){return!this.files.length&&!this.message.trim()},isFileLoading(){return this.files.some(t=>t.loading)},recordedTime(){return new Date(this.recorder.duration*1e3).toISOString().substr(14,5)},shadowFooter(){return!!this.filteredEmojis.length||!!this.filteredUsersTag.length||!!this.filteredTemplatesText.length||!!this.files.length||!!this.messageReply}},watch:{roomId(){this.resetMessage(!0,!0),this.roomMessage&&(this.message=this.roomMessage,setTimeout(()=>this.onChangeInput()))},message(t){this.getTextareaRef().value=t},roomMessage:{immediate:!0,handler(t){t&&(this.message=this.roomMessage)}},editedMessage(t){this.$emit("update-edited-message-id",t._id)},initReplyMessage(t){this.replyMessage(t)},initEditMessage(t){this.editMessage(t)}},mounted(){const t=W3();let e=!0;this.getTextareaRef().addEventListener("keyup",n=>{n.key==="Enter"&&!n.shiftKey&&!this.fileDialog&&(t?(this.message=this.message+`
`,setTimeout(()=>this.onChangeInput())):e&&!this.filteredEmojis.length&&!this.filteredUsersTag.length&&!this.filteredTemplatesText.length&&this.sendMessage()),e=!n.isComposing,setTimeout(()=>{this.updateFooterLists()},60)}),this.getTextareaRef().addEventListener("click",()=>{t&&(this.keepKeyboardOpen=!0),this.updateFooterLists()}),this.getTextareaRef().addEventListener("blur",()=>{this.resetFooterList(),t&&setTimeout(()=>this.keepKeyboardOpen=!1)})},beforeUnmount(){this.stopRecorder()},methods:{getTextareaRef(){return this.$refs.roomTextarea},focusTextarea(t){W3()&&t||!this.getTextareaRef()||(this.getTextareaRef().focus(),this.cursorRangePosition&&setTimeout(()=>{this.getTextareaRef().setSelectionRange(this.cursorRangePosition,this.cursorRangePosition),this.cursorRangePosition=null}))},onChangeInput(){var t,e,n;(((t=this.getTextareaRef())==null?void 0:t.value)||((e=this.getTextareaRef())==null?void 0:e.value)==="")&&(this.message=(n=this.getTextareaRef())==null?void 0:n.value),this.keepKeyboardOpen=!0,this.resizeTextarea(),this.$emit("typing-message",this.message)},resizeTextarea(){const t=this.getTextareaRef();if(!t)return;const e=window.getComputedStyle(t,null).getPropertyValue("padding-top").replace("px","");t.style.height=0,t.style.height=t.scrollHeight-e*2+"px"},escapeTextarea(){this.filteredEmojis.length?this.filteredEmojis=[]:this.filteredUsersTag.length?this.filteredUsersTag=[]:this.filteredTemplatesText.length?this.filteredTemplatesText=[]:this.resetMessage()},onPasteImage(t){var n;const e=(n=t.clipboardData)==null?void 0:n.items;e&&Array.from(e).forEach(s=>{if(s.type.includes("image")){const i=s.getAsFile();this.onFileChange([i])}})},updateActiveUpOrDown(t){this.filteredEmojis.length?this.activeUpOrDownEmojis=t:this.filteredUsersTag.length?this.activeUpOrDownUsersTag=t:this.filteredTemplatesText.length&&(this.activeUpOrDownTemplatesText=t)},selectItem(){this.filteredEmojis.length?this.selectEmojiItem=!0:this.filteredUsersTag.length?this.selectUsersTagItem=!0:this.filteredTemplatesText.length&&(this.selectTemplatesTextItem=!0)},selectEmoji(t){if(this.selectEmojiItem=!1,!t)return;const{position:e,endPosition:n}=this.getCharPosition(":");this.message=this.message.substr(0,e-1)+t+this.message.substr(n,this.message.length-1),this.cursorRangePosition=e,this.focusTextarea()},selectTemplateText(t){if(this.selectTemplatesTextItem=!1,!t)return;const{position:e,endPosition:n}=this.getCharPosition("/"),s=this.message.substr(n,n).length?"":" ";this.message=this.message.substr(0,e-1)+t.text+s+this.message.substr(n,this.message.length-1),this.cursorRangePosition=e+t.text.length+s.length+1,this.focusTextarea()},addEmoji(t){this.message+=t.unicode,this.focusTextarea(!0)},launchFilePicker(){this.$refs.file.value="",this.$refs.file.click()},async onFileChange(t){this.fileDialog=!0,this.focusTextarea(),Array.from(t).forEach(async e=>{const n=URL.createObjectURL(e),s=e.name.lastIndexOf(".");this.files.push({loading:!0,name:e.name.substring(0,s),size:e.size,type:e.type,extension:e.name.substring(s+1),localUrl:n});const i=await fetch(n).then(o=>o.blob());let r=this.files.find(o=>o.localUrl===n);r&&(r.blob=i,r.loading=!1,delete r.loading)}),setTimeout(()=>this.fileDialog=!1,500)},removeFile(t){this.files.splice(t,1),this.focusTextarea()},toggleRecorder(t){if(this.isRecording=t,!this.recorder.isRecording)setTimeout(()=>this.recorder.start(),200);else try{this.recorder.stop();const e=this.recorder.records[0];this.files.push({blob:e.blob,name:`audio.${this.format}`,size:e.blob.size,duration:e.duration,type:e.blob.type,audio:!0,localUrl:URL.createObjectURL(e.blob)}),this.recorder=this.initRecorder(),this.sendMessage()}catch{setTimeout(()=>this.stopRecorder(),100)}},stopRecorder(){if(this.recorder.isRecording)try{this.recorder.stop(),this.recorder=this.initRecorder()}catch{setTimeout(()=>this.stopRecorder(),100)}},textareaActionHandler(){this.$emit("textarea-action-handler",this.message)},sendMessage(){var n;let t=this.message.trim();if(!this.files.length&&!t||this.isFileLoading)return;this.selectedUsersTag.forEach(s=>{t=t.replace(`@${s.username}`,`<usertag>${s._id}</usertag>`)});const e=this.files.length?this.files:null;this.editedMessage._id?(this.editedMessage.content!==t||((n=this.editedMessage.files)==null?void 0:n.length)||this.files.length)&&this.$emit("edit-message",{messageId:this.editedMessage._id,newContent:t,files:e,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}):this.$emit("send-message",{content:t,files:e,replyMessage:this.messageReply,usersTag:this.selectedUsersTag}),this.resetMessage(!0)},editMessage(t){this.resetMessage(),this.editedMessage={...t};let e=t.content;const n=e,s="<usertag>",i="</usertag>";[...e.matchAll(new RegExp(s,"gi"))].map(o=>o.index).forEach(o=>{const a=n.substring(o+s.length,n.indexOf(i,o)),l=this.room.users.find(c=>c._id===a);e=e.replace(`${s}${a}${i}`,`@${(l==null?void 0:l.username)||"unknown"}`),this.selectUserTag(l,!0)}),this.message=e,t.files&&(this.files=[...t.files]),setTimeout(()=>this.resizeTextarea())},replyMessage(t){this.editedMessage={},this.messageReply=t,this.focusTextarea()},updateFooterLists(){this.updateFooterList("@"),this.updateFooterList(":"),this.updateFooterList("/")},updateFooterList(t){if(!this.getTextareaRef()||t===":"&&!this.emojisSuggestionEnabled||t==="@"&&(!this.userTagsEnabled||!this.room.users)||t==="/"&&!this.templatesText)return;const e=this.getTextareaRef().selectionStart;let n=e;for(;n>0&&this.message.charAt(n-1)!==t&&(this.message.charAt(n-1)!==" "||t!==":");)n--;const s=this.message.charAt(n-2),i=!s.match(/^[0-9a-zA-Z]+$/);if(this.message.charAt(n-1)===t&&(!s||s===" "||i)){const r=this.message.substring(n,e);t===":"?this.updateEmojis(r):t==="@"?this.updateShowUsersTag(r):t==="/"&&this.updateShowTemplatesText(r)}else this.resetFooterList(t)},updateShowUsersTag(t){this.filteredUsersTag=xp(this.room.users,"username",t,!0).filter(e=>e._id!==this.currentUserId)},selectUserTag(t,e=!1){if(this.selectUsersTagItem=!1,!t)return;const{position:n,endPosition:s}=this.getCharPosition("@"),i=this.message.substr(s,s).length?"":" ";this.message=this.message.substr(0,n)+t.username+i+this.message.substr(s,this.message.length-1),this.selectedUsersTag=[...this.selectedUsersTag,{...t}],e||(this.cursorRangePosition=n+t.username.length+i.length+1),this.focusTextarea()},updateShowTemplatesText(t){this.filteredTemplatesText=xp(this.templatesText,"tag",t,!0)},getCharPosition(t){let n=this.getTextareaRef().selectionStart;for(;n>0&&this.message.charAt(n-1)!==t;)n--;const s=this.getTextareaRef().selectionEnd;return{position:n,endPosition:s}},async updateEmojis(t){if(!t)return;const e=await this.emojisDB.getEmojiBySearchQuery(t);this.filteredEmojis=e.map(n=>n.unicode)},resetFooterList(t=null){t===":"?this.filteredEmojis=[]:t==="@"?this.filteredUsersTag=[]:t==="/"?this.filteredTemplatesText=[]:(this.filteredEmojis=[],this.filteredUsersTag=[],this.filteredTemplatesText=[])},resetMessage(t=!1,e=!1){e||this.$emit("typing-message",null),this.selectedUsersTag=[],this.resetFooterList(),this.resetTextareaSize(),this.message="",this.editedMessage={},this.messageReply=null,this.files=[],this.emojiOpened=!1,this.preventKeyboardFromClosing(),(this.textareaAutoFocus||!e)&&setTimeout(()=>this.focusTextarea(t))},resetTextareaSize(){this.getTextareaRef()&&(this.getTextareaRef().style.height="20px")},preventKeyboardFromClosing(){this.keepKeyboardOpen&&this.getTextareaRef().focus()},initRecorder(){return this.isRecording=!1,new V$({bitRate:Number(this.audioBitRate),sampleRate:Number(this.audioSampleRate),beforeRecording:null,afterRecording:null,pauseRecording:null,micFailed:this.micFailed})},micFailed(){this.isRecording=!1,this.recorder=this.initRecorder()}}},z$={key:0,class:"vac-icon-textarea-left"},K$=Ce("div",{class:"vac-dot-audio-record"},null,-1),G$={class:"vac-dot-audio-record-time"},W$=["placeholder"],Y$={class:"vac-icon-textarea"},X$={key:1},Q$=["accept"];function Z$(t,e,n,s,i,r){const o=et("room-emojis"),a=et("room-users-tag"),l=et("room-templates-text"),c=et("room-message-reply"),d=et("room-files"),u=et("svg-icon"),f=et("emoji-picker-container"),m=m0("click-outside");return ar((re(),ge("div",{id:"room-footer",class:yt(["vac-room-footer",{"vac-app-box-shadow":r.shadowFooter}])},[Ue(o,{"filtered-emojis":i.filteredEmojis,"select-item":i.selectEmojiItem,"active-up-or-down":i.activeUpOrDownEmojis,onSelectEmoji:e[0]||(e[0]=h=>r.selectEmoji(h)),onActivateItem:e[1]||(e[1]=h=>i.activeUpOrDownEmojis=0)},null,8,["filtered-emojis","select-item","active-up-or-down"]),Ue(a,{"filtered-users-tag":i.filteredUsersTag,"select-item":i.selectUsersTagItem,"active-up-or-down":i.activeUpOrDownUsersTag,onSelectUserTag:e[2]||(e[2]=h=>r.selectUserTag(h)),onActivateItem:e[3]||(e[3]=h=>i.activeUpOrDownUsersTag=0)},null,8,["filtered-users-tag","select-item","active-up-or-down"]),Ue(l,{"filtered-templates-text":i.filteredTemplatesText,"select-item":i.selectTemplatesTextItem,"active-up-or-down":i.activeUpOrDownTemplatesText,onSelectTemplateText:e[4]||(e[4]=h=>r.selectTemplateText(h)),onActivateItem:e[5]||(e[5]=h=>i.activeUpOrDownTemplatesText=0)},null,8,["filtered-templates-text","select-item","active-up-or-down"]),Ue(c,{room:n.room,"message-reply":i.messageReply,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onResetMessage:r.resetMessage},Jt({_:2},[gt(t.$slots,(h,k)=>({name:k,fn:Je(I=>[je(t.$slots,k,pt(ft(I)))])}))]),1032,["room","message-reply","text-formatting","link-options","onResetMessage"]),Ue(d,{files:i.files,onRemoveFile:r.removeFile,onResetMessage:r.resetMessage},Jt({_:2},[gt(t.$slots,(h,k)=>({name:k,fn:Je(I=>[je(t.$slots,k,pt(ft(I)))])}))]),1032,["files","onRemoveFile","onResetMessage"]),Ce("div",{class:yt(["vac-box-footer",{"vac-box-footer-border":!i.files.length}])},[n.showAudio&&!i.files.length?(re(),ge("div",z$,[i.isRecording?(re(),ge(kt,{key:0},[Ce("div",{class:"vac-svg-button vac-icon-audio-stop",onClick:e[6]||(e[6]=(...h)=>r.stopRecorder&&r.stopRecorder(...h))},[je(t.$slots,"audio-stop-icon",{},()=>[Ue(u,{name:"close-outline"})])]),K$,Ce("div",G$,ot(r.recordedTime),1),Ce("div",{class:"vac-svg-button vac-icon-audio-confirm",onClick:e[7]||(e[7]=h=>r.toggleRecorder(!1))},[je(t.$slots,"audio-stop-icon",{},()=>[Ue(u,{name:"checkmark"})])])],64)):(re(),ge("div",{key:1,class:"vac-svg-button",onClick:e[8]||(e[8]=h=>r.toggleRecorder(!0))},[je(t.$slots,"microphone-icon",{},()=>[Ue(u,{name:"microphone",class:"vac-icon-microphone"})])]))])):He("",!0),Ce("textarea",{id:"roomTextarea",ref:"roomTextarea",placeholder:n.textMessages.TYPE_MESSAGE,class:yt(["vac-textarea",{"vac-textarea-outline":i.editedMessage._id}]),style:{"min-height":"20px","padding-left":"12px"},onInput:e[9]||(e[9]=(...h)=>r.onChangeInput&&r.onChangeInput(...h)),onKeydown:[e[10]||(e[10]=Vi((...h)=>r.escapeTextarea&&r.escapeTextarea(...h),["esc"])),e[11]||(e[11]=Vi(Rr((...h)=>r.selectItem&&r.selectItem(...h),["exact","prevent"]),["enter"])),e[13]||(e[13]=Vi(Rr(()=>{},["exact","prevent"]),["tab"])),e[14]||(e[14]=Vi((...h)=>r.selectItem&&r.selectItem(...h),["tab"])),e[15]||(e[15]=Vi(Rr(()=>{},["exact","prevent"]),["up"])),e[16]||(e[16]=Vi(h=>r.updateActiveUpOrDown(-1),["up"])),e[17]||(e[17]=Vi(Rr(()=>{},["exact","prevent"]),["down"])),e[18]||(e[18]=Vi(h=>r.updateActiveUpOrDown(1),["down"]))],onPaste:e[12]||(e[12]=(...h)=>r.onPasteImage&&r.onPasteImage(...h))},null,42,W$),Ce("div",Y$,[i.editedMessage._id?(re(),ge("div",{key:0,class:"vac-svg-button",onClick:e[19]||(e[19]=(...h)=>r.resetMessage&&r.resetMessage(...h))},[je(t.$slots,"edit-close-icon",{},()=>[Ue(u,{name:"close-outline"})])])):He("",!0),n.showEmojis?ar((re(),ge("div",X$,[je(t.$slots,"emoji-picker",xv({emojiOpened:i.emojiOpened},{addEmoji:r.addEmoji}),()=>[Ue(f,{"emoji-opened":i.emojiOpened,"position-top":!0,onAddEmoji:r.addEmoji,onOpenEmoji:e[20]||(e[20]=h=>i.emojiOpened=h)},{"emoji-picker-icon":Je(()=>[je(t.$slots,"emoji-picker-icon")]),_:3},8,["emoji-opened","onAddEmoji"])])])),[[m,()=>i.emojiOpened=!1]]):He("",!0),n.showFiles?(re(),ge("div",{key:2,class:"vac-svg-button",onClick:e[21]||(e[21]=(...h)=>r.launchFilePicker&&r.launchFilePicker(...h))},[je(t.$slots,"paperclip-icon",{},()=>[Ue(u,{name:"paperclip"})])])):He("",!0),n.textareaActionEnabled?(re(),ge("div",{key:3,class:"vac-svg-button",onClick:e[22]||(e[22]=(...h)=>r.textareaActionHandler&&r.textareaActionHandler(...h))},[je(t.$slots,"custom-action-icon",{},()=>[Ue(u,{name:"deleted"})])])):He("",!0),n.showFiles?(re(),ge("input",{key:4,ref:"file",type:"file",multiple:"",accept:n.acceptedFiles,style:{display:"none"},onChange:e[23]||(e[23]=h=>r.onFileChange(h.target.files))},null,40,Q$)):He("",!0),n.showSendIcon?(re(),ge("div",{key:5,class:yt(["vac-svg-button",{"vac-send-disabled":r.isMessageEmpty}]),onClick:e[24]||(e[24]=(...h)=>r.sendMessage&&r.sendMessage(...h))},[je(t.$slots,"send-icon",{},()=>[Ue(u,{name:"send",param:r.isMessageEmpty||r.isFileLoading?"disabled":""},null,8,["param"])])],2)):He("",!0)])],2)],2)),[[_0,Object.keys(n.room).length&&n.showFooter]])}var J$=qt($$,[["render",Z$]]);const ez={name:"MessageReply",components:{AudioPlayer:Vv,SvgIcon:Un,FormatMessage:Xu},props:{message:{type:Object,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},roomUsers:{type:Array,required:!0}},computed:{replyUsername(){const{senderId:t}=this.message.replyMessage,e=this.roomUsers.find(n=>n._id===t);return e?e.username:""},firstFile(){var t,e;return(e=(t=this.message.replyMessage)==null?void 0:t.files)!=null&&e.length?this.message.replyMessage.files[0]:{}},isAudio(){return C0(this.firstFile)},isImage(){return fl(this.firstFile)},isVideo(){return Qu(this.firstFile)},isOtherFile(){var t;return((t=this.message.replyMessage.files)==null?void 0:t.length)&&!this.isAudio&&!this.isVideo&&!this.isImage}}},tz={class:"vac-reply-message"},nz={class:"vac-reply-username"},sz={key:0,class:"vac-image-reply-container"},iz={key:1,class:"vac-video-reply-container"},rz={width:"100%",height:"100%",controls:""},oz=["src"],az={key:3,class:"vac-file-container"},lz={class:"vac-text-ellipsis"},cz={key:0,class:"vac-text-ellipsis vac-text-extension"},uz={class:"vac-reply-content"};function hz(t,e,n,s,i,r){const o=et("audio-player"),a=et("svg-icon"),l=et("format-message");return re(),ge("div",tz,[Ce("div",nz,ot(r.replyUsername),1),r.isImage?(re(),ge("div",sz,[Ce("div",{class:"vac-message-image vac-message-image-reply",style:Lt({"background-image":`url('${r.firstFile.url}')`})},null,4)])):r.isVideo?(re(),ge("div",iz,[Ce("video",rz,[Ce("source",{src:r.firstFile.url},null,8,oz)])])):r.isAudio?(re(),Ut(o,{key:2,src:r.firstFile.url,onUpdateProgressTime:e[0]||(e[0]=c=>t.progressTime=c),onHoverAudioProgress:e[1]||(e[1]=c=>t.hoverAudioProgress=c)},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["src"])):r.isOtherFile?(re(),ge("div",az,[Ce("div",null,[je(t.$slots,"file-icon",{},()=>[Ue(a,{name:"file"})])]),Ce("div",lz,ot(r.firstFile.name),1),r.firstFile.extension?(re(),ge("div",cz,ot(r.firstFile.extension),1)):He("",!0)])):He("",!0),Ce("div",uz,[Ue(l,{content:n.message.replyMessage.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,reply:!0},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["content","users","text-formatting","link-options"])])])}var dz=qt(ez,[["render",hz]]);const fz={name:"ProgressBar",props:{progress:{type:Number,default:0}},data(){const s=54*Math.PI;return{radius:35,stroke:4,normalizedRadius:27,circumference:s}},computed:{strokeDashoffset(){return this.circumference-this.progress/100*this.circumference}}},mz={ref:"progress",class:"vac-progress-wrapper"},pz=["height","width"],gz=["stroke-dasharray","stroke-width","r","cx","cy"],_z={class:"vac-progress-text"},vz=Ce("span",{class:"vac-progress-pourcent"},"%",-1);function yz(t,e,n,s,i,r){return re(),Ut(gn,{name:"vac-fade-spinner",appear:""},{default:Je(()=>[Ce("div",mz,[(re(),ge("svg",{height:i.radius*2,width:i.radius*2},[Ce("circle",{stroke:"rgba(255, 255, 255, 0.7)","stroke-dasharray":i.circumference+" "+i.circumference,style:Lt({strokeDashoffset:r.strokeDashoffset,strokeLinecap:"round"}),"stroke-width":i.stroke,fill:"transparent",r:i.normalizedRadius,cx:i.radius,cy:i.radius},null,12,gz)],8,pz)),Ce("div",{class:"vac-progress-content",style:Lt({height:i.radius*2-19+"px",width:i.radius*2-19+"px"})},[Ce("div",_z,[ma(ot(n.progress),1),vz])],4)],512)]),_:1})}var IS=qt(fz,[["render",yz]]);const bz={name:"MessageFile",components:{SvgIcon:Un,Loader:v0,ProgressBar:IS},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},file:{type:Object,required:!0},index:{type:Number,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file"],data(){return{imageResponsive:"",imageLoading:!1,imageHover:!1}},computed:{isImageLoading(){return this.file.url.indexOf("blob:http")!==-1||this.imageLoading},isImage(){return fl(this.file)},isVideo(){return Qu(this.file)}},watch:{file:{immediate:!0,handler(){this.checkImgLoad()}}},mounted(){const t=this.$refs["imageRef"+this.index];t&&(this.imageResponsive={maxHeight:t.clientWidth-18,loaderTop:t.clientHeight/2-9})},methods:{checkImgLoad(){if(!fl(this.file))return;this.imageLoading=!0;const t=new Image;t.src=this.file.url,t.addEventListener("load",()=>this.imageLoading=!1)},openFile(t,e){this.messageSelectionEnabled||(t.stopPropagation(),this.$emit("open-file",{file:this.file,action:e}))}}},wz={class:"vac-message-file-container"},Ez={key:0,class:"vac-image-buttons"},xz={width:"100%",height:"100%",controls:""},Tz=["src"];function Sz(t,e,n,s,i,r){const o=et("progress-bar"),a=et("loader"),l=et("svg-icon");return re(),ge("div",wz,[r.isImage?(re(),ge("div",{key:0,ref:"imageRef"+n.index,class:"vac-message-image-container",onMouseover:e[2]||(e[2]=c=>i.imageHover=!0),onMouseleave:e[3]||(e[3]=c=>i.imageHover=!1),onClick:e[4]||(e[4]=c=>r.openFile(c,"preview"))},[n.file.progress>=0?(re(),Ut(o,{key:0,progress:n.file.progress,style:Lt({top:`${i.imageResponsive.loaderTop}px`})},null,8,["progress","style"])):(re(),Ut(a,{key:1,show:r.isImageLoading,style:Lt({top:`${i.imageResponsive.loaderTop}px`})},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["show","style"])),Ce("div",{class:yt(["vac-message-image",{"vac-blur-loading":r.isImageLoading&&n.message.senderId===n.currentUserId}]),style:Lt({"background-image":`url('${r.isImageLoading&&n.file.preview||n.file.url}')`,"max-height":`${i.imageResponsive.maxHeight}px`})},[Ue(gn,{name:"vac-fade-image"},{default:Je(()=>[!n.messageSelectionEnabled&&i.imageHover&&!r.isImageLoading?(re(),ge("div",Ez,[Ce("div",{class:"vac-svg-button vac-button-view",onClick:e[0]||(e[0]=c=>r.openFile(c,"preview"))},[je(t.$slots,"eye-icon",{},()=>[Ue(l,{name:"eye"})])]),Ce("div",{class:"vac-svg-button vac-button-download",onClick:e[1]||(e[1]=c=>r.openFile(c,"download"))},[je(t.$slots,"document-icon",{},()=>[Ue(l,{name:"document"})])])])):He("",!0)]),_:3})],6)],544)):r.isVideo?(re(),ge("div",{key:1,class:"vac-video-container",onClick:e[5]||(e[5]=Rr(c=>r.openFile("preview"),["prevent"]))},[n.file.progress>=0?(re(),Ut(o,{key:0,progress:n.file.progress},null,8,["progress"])):He("",!0),Ce("video",xz,[Ce("source",{src:n.file.url},null,8,Tz)])])):He("",!0)])}var Az=qt(bz,[["render",Sz]]);const Rz={name:"MessageFiles",components:{SvgIcon:Un,FormatMessage:Xu,ProgressBar:IS,MessageFile:Az},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},roomUsers:{type:Array,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0}},emits:["open-file","open-user-tag"],computed:{imageVideoFiles(){return this.message.files.filter(t=>u3(t))},otherFiles(){return this.message.files.filter(t=>!u3(t))}},methods:{openFile(t,e,n){this.messageSelectionEnabled||(t.stopPropagation(),this.$emit("open-file",{file:e,action:n}))}}},Cz={class:"vac-message-files-container"},Iz=["onClick"],kz={class:"vac-svg-button"},Mz={class:"vac-text-ellipsis"},Nz={key:0,class:"vac-text-ellipsis vac-text-extension"};function Oz(t,e,n,s,i,r){const o=et("message-file"),a=et("progress-bar"),l=et("svg-icon"),c=et("format-message");return re(),ge("div",Cz,[(re(!0),ge(kt,null,gt(r.imageVideoFiles,(d,u)=>(re(),ge("div",{key:u+"iv"},[Ue(o,{file:d,"current-user-id":n.currentUserId,message:n.message,index:u,"message-selection-enabled":n.messageSelectionEnabled,onOpenFile:e[0]||(e[0]=f=>t.$emit("open-file",f))},Jt({_:2},[gt(t.$slots,(f,m)=>({name:m,fn:Je(h=>[je(t.$slots,m,pt(ft(h)))])}))]),1032,["file","current-user-id","message","index","message-selection-enabled"])]))),128)),(re(!0),ge(kt,null,gt(r.otherFiles,(d,u)=>(re(),ge("div",{key:u+"a",class:"vac-file-wrapper"},[d.progress>=0?(re(),Ut(a,{key:0,progress:d.progress,style:{top:"44px"}},null,8,["progress"])):He("",!0),Ce("div",{class:yt(["vac-file-container",{"vac-file-container-progress":d.progress>=0}]),onClick:f=>r.openFile(f,d,"download")},[Ce("div",kz,[je(t.$slots,"document-icon",{},()=>[Ue(l,{name:"document"})])]),Ce("div",Mz,ot(d.name),1),d.extension?(re(),ge("div",Nz,ot(d.extension),1)):He("",!0)],10,Iz)]))),128)),Ue(c,{content:n.message.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onOpenUserTag:e[1]||(e[1]=d=>t.$emit("open-user-tag",d))},Jt({_:2},[gt(t.$slots,(d,u)=>({name:u,fn:Je(f=>[je(t.$slots,u,pt(ft(f)))])}))]),1032,["content","users","text-formatting","link-options"])])}var Lz=qt(Rz,[["render",Oz]]);const Pz={name:"MessageActions",components:{SvgIcon:Un,EmojiPickerContainer:vS},directives:{clickOutside:R0},props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0},messageActions:{type:Array,required:!0},showReactionEmojis:{type:Boolean,required:!0},messageHover:{type:Boolean,required:!0},hoverMessageId:{type:[String,Number],default:null},hoverAudioProgress:{type:Boolean,required:!0}},emits:["update-emoji-opened","update-options-opened","update-message-hover","message-action-handler","send-message-reaction"],data(){return{menuOptionsTop:0,optionsOpened:!1,optionsClosing:!1,emojiOpened:!1}},computed:{isMessageActions(){return this.filteredMessageActions.length&&this.messageHover&&!this.message.deleted&&!this.message.disableActions&&!this.hoverAudioProgress},isMessageReactions(){return this.showReactionEmojis&&this.messageHover&&!this.message.deleted&&!this.message.disableReactions&&!this.hoverAudioProgress},filteredMessageActions(){return this.message.senderId===this.currentUserId?this.messageActions:this.messageActions.filter(t=>!t.onlyMe)}},watch:{emojiOpened(t){this.$emit("update-emoji-opened",t),t&&(this.optionsOpened=!1)},optionsOpened(t){this.$emit("update-options-opened",t)}},methods:{openOptions(){this.optionsClosing||(this.optionsOpened=!this.optionsOpened,this.optionsOpened&&setTimeout(()=>{const t=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("room-footer");if(!t||!this.$refs.menuOptions||!this.$refs.actionIcon)return;const e=this.$refs.menuOptions.getBoundingClientRect().height,n=this.$refs.actionIcon.getBoundingClientRect().top;t.getBoundingClientRect().top-n>e+50?this.menuOptionsTop=30:this.menuOptionsTop=-e}))},closeOptions(){this.optionsOpened=!1,this.optionsClosing=!0,this.updateMessageHover(),setTimeout(()=>this.optionsClosing=!1,100)},openEmoji(){this.emojiOpened=!this.emojiOpened},closeEmoji(){this.emojiOpened=!1,this.updateMessageHover()},updateMessageHover(){this.hoverMessageId!==this.message._id&&this.$emit("update-message-hover",!1)},messageActionHandler(t){this.closeOptions(),this.$emit("message-action-handler",t)},sendMessageReaction(t,e){this.$emit("send-message-reaction",{emoji:t,reaction:e}),this.closeEmoji()}}},Dz={class:"vac-message-actions-wrapper"},Bz={key:"3"},Fz={class:"vac-menu-list"},Uz=["onClick"];function jz(t,e,n,s,i,r){const o=et("svg-icon"),a=et("emoji-picker-container"),l=m0("click-outside");return re(),ge("div",Dz,[Ce("div",{class:"vac-options-container",style:Lt({display:n.hoverAudioProgress?"none":"initial",width:r.filteredMessageActions.length&&n.showReactionEmojis?"70px":"45px"})},[Ue(Av,{name:"vac-slide-left",tag:"span"},{default:Je(()=>[r.isMessageActions||r.isMessageReactions?(re(),ge("div",{key:"1",class:yt(["vac-blur-container",{"vac-options-me":n.message.senderId===n.currentUserId}])},null,2)):He("",!0),r.isMessageActions?(re(),ge("div",{ref:"actionIcon",key:"2",class:"vac-svg-button vac-message-options",onClick:e[0]||(e[0]=(...c)=>r.openOptions&&r.openOptions(...c))},[je(t.$slots,"dropdown-icon",{},()=>[Ue(o,{name:"dropdown",param:"message"})])],512)):He("",!0),r.isMessageReactions?ar((re(),ge("div",Bz,[je(t.$slots,"emoji-picker",xv({emojiOpened:i.emojiOpened},{addEmoji:r.sendMessageReaction}),()=>[Ue(a,{class:"vac-message-emojis",style:Lt({right:r.isMessageActions?"30px":"5px"}),"emoji-opened":i.emojiOpened,"emoji-reaction":!0,"position-right":n.message.senderId===n.currentUserId,onAddEmoji:r.sendMessageReaction,onOpenEmoji:r.openEmoji},{"emoji-picker-icon":Je(()=>[je(t.$slots,"emoji-picker-reaction-icon")]),_:3},8,["style","emoji-opened","position-right","onAddEmoji","onOpenEmoji"])])])),[[l,r.closeEmoji]]):He("",!0)]),_:3})],4),r.filteredMessageActions.length?(re(),Ut(gn,{key:0,name:n.message.senderId===n.currentUserId?"vac-slide-left":"vac-slide-right"},{default:Je(()=>[i.optionsOpened?ar((re(),ge("div",{key:0,ref:"menuOptions",class:yt(["vac-menu-options",{"vac-menu-left":n.message.senderId!==n.currentUserId}]),style:Lt({top:`${i.menuOptionsTop}px`})},[Ce("div",Fz,[(re(!0),ge(kt,null,gt(r.filteredMessageActions,c=>(re(),ge("div",{key:c.name},[Ce("div",{class:"vac-menu-item",onClick:d=>r.messageActionHandler(c)},ot(c.title),9,Uz)]))),128))])],6)),[[l,r.closeOptions]]):He("",!0)]),_:1},8,["name"])):He("",!0)])}var Hz=qt(Pz,[["render",jz]]);const Vz={name:"MessageReactions",props:{currentUserId:{type:[String,Number],required:!0},message:{type:Object,required:!0}},emits:["send-message-reaction"],methods:{sendMessageReaction(t,e){this.$emit("send-message-reaction",{emoji:t,reaction:e})}}},qz=["onClick"];function $z(t,e,n,s,i,r){return n.message.deleted?He("",!0):(re(),Ut(Av,{key:0,name:"vac-slide-left",tag:"span"},{default:Je(()=>[(re(!0),ge(kt,null,gt(n.message.reactions,(o,a)=>ar((re(),ge("button",{key:a+0,class:yt(["vac-button-reaction",{"vac-reaction-me":o.indexOf(n.currentUserId)!==-1}]),style:Lt({float:n.message.senderId===n.currentUserId?"right":"left"}),onClick:l=>r.sendMessageReaction({unicode:a},o)},[ma(ot(a),1),Ce("span",null,ot(o.length),1)],14,qz)),[[_0,o.length]])),128))]),_:1}))}var zz=qt(Vz,[["render",$z]]);function Kz(t){if(!((s,i)=>i.every(r=>{let o=!1;return(r.type[0]==="array"&&Array.isArray(s[r.key])||r.type.find(a=>a===typeof s[r.key]))&&(o=!0),o&&qv(s,r.key)}))(t,[{key:"roomId",type:["string","number"]},{key:"roomName",type:["string"]},{key:"users",type:["array"]}]))throw new Error("Rooms object is not valid! Must contain roomId[String, Number], roomName[String] and users[Array]")}function Gz(t){if(!((s,i)=>i.every(r=>r.type.find(a=>a===typeof s[r.key])&&qv(s,r.key)))(t,[{key:"_id",type:["string","number"]},{key:"username",type:["string"]}]))throw new Error("Participants object is not valid! Must contain _id[String, Number] and username[String]")}function Wz(t){if(!((s,i)=>i.every(r=>r.type.find(a=>a===typeof s[r.key])&&qv(s,r.key)))(t,[{key:"_id",type:["string","number"]},{key:"content",type:["string","number"]},{key:"senderId",type:["string","number"]}]))throw new Error("Messages object is not valid! Must contain _id[String, Number], content[String, Number] and senderId[String, Number]")}function qv(t,e){return Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==null&&t[e]!==void 0}const Yz={name:"RoomMessage",components:{SvgIcon:Un,FormatMessage:Xu,AudioPlayer:Vv,MessageReply:dz,MessageFiles:Lz,MessageActions:Hz,MessageReactions:zz},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},index:{type:Number,required:!0},message:{type:Object,required:!0},messages:{type:Array,required:!0},editedMessageId:{type:[String,Number],default:null},roomUsers:{type:Array,default:()=>[]},messageActions:{type:Array,required:!0},newMessages:{type:Array,default:()=>[]},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},usernameOptions:{type:Object,required:!0},messageSelectionEnabled:{type:Boolean,required:!0},selectedMessages:{type:Array,default:()=>[]}},emits:["message-added","open-file","open-user-tag","open-failed-message","message-action-handler","send-message-reaction","select-message","unselect-message"],data(){return{hoverMessageId:null,messageHover:!1,optionsOpened:!1,emojiOpened:!1,newMessage:{},progressTime:"- : -",hoverAudioProgress:!1}},computed:{showUsername(){return!this.usernameOptions.currentUser&&this.message.senderId===this.currentUserId?!1:this.roomUsers.length>=this.usernameOptions.minUsers},showDate(){return this.index>0&&this.message.date!==this.messages[this.index-1].date},messageOffset(){return this.index>0&&this.message.senderId!==this.messages[this.index-1].senderId},isMessageHover(){return this.editedMessageId===this.message._id||this.hoverMessageId===this.message._id},isAudio(){var t;return(t=this.message.files)==null?void 0:t.some(e=>C0(e))},isCheckmarkVisible(){return this.message.senderId===this.currentUserId&&!this.message.deleted&&(this.message.saved||this.message.distributed||this.message.seen)},hasCurrentUserAvatar(){return this.messages.some(t=>t.senderId===this.currentUserId&&t.avatar)},hasSenderUserAvatar(){return this.messages.some(t=>t.senderId!==this.currentUserId&&t.avatar)},isMessageSelected(){return this.messageSelectionEnabled&&!!this.selectedMessages.find(t=>t._id===this.message._id)}},watch:{newMessages:{immediate:!0,deep:!0,handler(t){if(!t.length||!this.showNewMessagesDivider){this.newMessage={};return}this.newMessage=t.reduce((e,n)=>n.index<e.index?n:e)}},messageSelectionEnabled(){this.resetMessageHover()}},mounted(){Wz(this.message),this.$emit("message-added",{message:this.message,index:this.index,ref:this.$refs.message})},methods:{onHoverMessage(){this.messageSelectionEnabled||(this.messageHover=!0,this.canEditMessage()&&(this.hoverMessageId=this.message._id))},canEditMessage(){return!this.message.deleted},onLeaveMessage(){this.messageSelectionEnabled||(!this.optionsOpened&&!this.emojiOpened&&(this.messageHover=!1),this.hoverMessageId=null)},resetMessageHover(){this.messageHover=!1,this.hoverMessageId=null},openFile(t){this.$emit("open-file",{message:this.message,file:t})},openUserTag(t){this.$emit("open-user-tag",{user:t})},messageActionHandler(t){this.resetMessageHover(),setTimeout(()=>{this.$emit("message-action-handler",{action:t,message:this.message})},300)},sendMessageReaction({emoji:t,reaction:e}){this.$emit("send-message-reaction",{messageId:this.message._id,reaction:t,remove:e&&e.indexOf(this.currentUserId)!==-1}),this.messageHover=!1},selectMessage(){this.messageSelectionEnabled&&(this.isMessageSelected?this.$emit("unselect-message",this.message._id):this.$emit("select-message",this.message))}}},Xz=["id"],Qz={key:0,class:"vac-card-info vac-card-date"},Zz={key:1,class:"vac-line-new"},Jz={key:2,class:"vac-card-info vac-card-system"},eK={key:1,class:"vac-avatar-offset"},tK={key:2},nK={key:0,class:"vac-progress-time"},sK={class:"vac-text-timestamp"},iK={key:0,class:"vac-icon-edited"},rK={key:1},oK=Ce("div",{class:"vac-failure-text"}," ! ",-1),aK=[oK],lK={key:3,class:"vac-avatar-current-offset"};function cK(t,e,n,s,i,r){const o=et("format-message"),a=et("message-reply"),l=et("svg-icon"),c=et("message-files"),d=et("audio-player"),u=et("message-actions"),f=et("message-reactions");return re(),ge("div",{id:n.message._id,ref:"message",class:"vac-message-wrapper"},[r.showDate?(re(),ge("div",Qz,ot(n.message.date),1)):He("",!0),i.newMessage._id===n.message._id?(re(),ge("div",Zz,ot(n.textMessages.NEW_MESSAGES),1)):He("",!0),n.message.system?(re(),ge("div",Jz,[je(t.$slots,"system-message",pt(ft({message:n.message})),()=>[Ue(o,{content:n.message.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onOpenUserTag:r.openUserTag},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])])])):(re(),ge("div",{key:3,class:yt(["vac-message-box",{"vac-offset-current":n.message.senderId===n.currentUserId}]),onClick:e[8]||(e[8]=(...m)=>r.selectMessage&&r.selectMessage(...m))},[je(t.$slots,"message",pt(ft({message:n.message})),()=>[n.message.avatar&&n.message.senderId!==n.currentUserId?(re(),ge("div",{key:0,class:"vac-avatar",style:Lt({"background-image":`url('${n.message.avatar}')`})},null,4)):He("",!0),r.hasSenderUserAvatar&&!n.message.avatar?(re(),ge("div",eK)):He("",!0),Ce("div",{class:yt(["vac-message-container",{"vac-message-container-offset":r.messageOffset}])},[Ce("div",{class:yt(["vac-message-card",{"vac-message-highlight":r.isMessageHover,"vac-message-current":n.message.senderId===n.currentUserId,"vac-message-deleted":n.message.deleted,"vac-item-clickable":n.messageSelectionEnabled,"vac-message-selected":r.isMessageSelected}]),onMouseover:e[5]||(e[5]=(...m)=>r.onHoverMessage&&r.onHoverMessage(...m)),onMouseleave:e[6]||(e[6]=(...m)=>r.onLeaveMessage&&r.onLeaveMessage(...m))},[r.showUsername?(re(),ge("div",{key:0,class:yt(["vac-text-username",{"vac-username-reply":!n.message.deleted&&n.message.replyMessage}])},[Ce("span",null,ot(n.message.username),1)],2)):He("",!0),!n.message.deleted&&n.message.replyMessage?(re(),Ut(a,{key:1,message:n.message,"room-users":n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["message","room-users","text-formatting","link-options"])):He("",!0),n.message.deleted?(re(),ge("div",tK,[je(t.$slots,"deleted-icon",{},()=>[Ue(l,{name:"deleted",class:"vac-icon-deleted"})]),Ce("span",null,ot(n.textMessages.MESSAGE_DELETED),1)])):!n.message.files||!n.message.files.length?(re(),Ut(o,{key:3,content:n.message.content,users:n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,onOpenUserTag:r.openUserTag},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["content","users","text-formatting","link-options","onOpenUserTag"])):!r.isAudio||n.message.files.length>1?(re(),Ut(c,{key:4,"current-user-id":n.currentUserId,message:n.message,"room-users":n.roomUsers,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"message-selection-enabled":n.messageSelectionEnabled,onOpenFile:r.openFile,onOpenUserTag:r.openUserTag},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["current-user-id","message","room-users","text-formatting","link-options","message-selection-enabled","onOpenFile","onOpenUserTag"])):(re(),ge(kt,{key:5},[Ue(d,{"message-id":n.message._id,src:n.message.files[0].url,"message-selection-enabled":n.messageSelectionEnabled,onUpdateProgressTime:e[0]||(e[0]=m=>i.progressTime=m),onHoverAudioProgress:e[1]||(e[1]=m=>i.hoverAudioProgress=m)},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["message-id","src","message-selection-enabled"]),n.message.deleted?He("",!0):(re(),ge("div",nK,ot(i.progressTime),1))],64)),Ce("div",sK,[n.message.edited&&!n.message.deleted?(re(),ge("div",iK,[je(t.$slots,"pencil-icon",{},()=>[Ue(l,{name:"pencil"})])])):He("",!0),Ce("span",null,ot(n.message.timestamp),1),r.isCheckmarkVisible?(re(),ge("span",rK,[je(t.$slots,"checkmark-icon",pt(ft({message:n.message})),()=>[Ue(l,{name:n.message.distributed?"double-checkmark":"checkmark",param:n.message.seen?"seen":"",class:"vac-icon-check"},null,8,["name","param"])])])):He("",!0)]),Ue(u,{"current-user-id":n.currentUserId,message:n.message,"message-actions":n.messageActions,"show-reaction-emojis":n.showReactionEmojis,"message-hover":i.messageHover,"hover-message-id":i.hoverMessageId,"hover-audio-progress":i.hoverAudioProgress,onUpdateMessageHover:e[2]||(e[2]=m=>i.messageHover=m),onUpdateOptionsOpened:e[3]||(e[3]=m=>i.optionsOpened=m),onUpdateEmojiOpened:e[4]||(e[4]=m=>i.emojiOpened=m),onMessageActionHandler:r.messageActionHandler,onSendMessageReaction:r.sendMessageReaction},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["current-user-id","message","message-actions","show-reaction-emojis","message-hover","hover-message-id","hover-audio-progress","onMessageActionHandler","onSendMessageReaction"])],34),Ue(f,{"current-user-id":n.currentUserId,message:n.message,onSendMessageReaction:r.sendMessageReaction},null,8,["current-user-id","message","onSendMessageReaction"])],2),je(t.$slots,"message-failure",pt(ft({message:n.message})),()=>[n.message.failure&&n.message.senderId===n.currentUserId?(re(),ge("div",{key:0,class:yt(["vac-failure-container vac-svg-button",{"vac-failure-container-avatar":n.message.avatar&&n.message.senderId===n.currentUserId}]),onClick:e[7]||(e[7]=m=>t.$emit("open-failed-message",{message:n.message}))},aK,2)):He("",!0)]),n.message.avatar&&n.message.senderId===n.currentUserId?(re(),ge("div",{key:2,class:"vac-avatar vac-avatar-current",style:Lt({"background-image":`url('${n.message.avatar}')`})},null,4)):He("",!0),r.hasCurrentUserAvatar&&!n.message.avatar?(re(),ge("div",lK)):He("",!0)])],2))],8,Xz)}var uK=qt(Yz,[["render",cK]]);const hK={name:"ChatRoom",components:{Loader:v0,SvgIcon:Un,RoomHeader:hH,RoomFooter:J$,RoomMessage:uK},props:{currentUserId:{type:[String,Number],required:!0},textMessages:{type:Object,required:!0},singleRoom:{type:Boolean,required:!0},showRoomsList:{type:Boolean,required:!0},isMobile:{type:Boolean,required:!0},rooms:{type:Array,required:!0},roomId:{type:[String,Number],required:!0},loadFirstRoom:{type:Boolean,required:!0},messages:{type:Array,required:!0},roomMessage:{type:String,default:null},messagesLoaded:{type:Boolean,required:!0},menuActions:{type:Array,required:!0},messageActions:{type:Array,required:!0},messageSelectionActions:{type:Array,required:!0},autoScroll:{type:Object,required:!0},showSendIcon:{type:Boolean,required:!0},showFiles:{type:Boolean,required:!0},showAudio:{type:Boolean,required:!0},audioBitRate:{type:Number,required:!0},audioSampleRate:{type:Number,required:!0},showEmojis:{type:Boolean,required:!0},showReactionEmojis:{type:Boolean,required:!0},showNewMessagesDivider:{type:Boolean,required:!0},showFooter:{type:Boolean,required:!0},acceptedFiles:{type:String,required:!0},textFormatting:{type:Object,required:!0},linkOptions:{type:Object,required:!0},loadingRooms:{type:Boolean,required:!0},roomInfoEnabled:{type:Boolean,required:!0},textareaActionEnabled:{type:Boolean,required:!0},textareaAutoFocus:{type:Boolean,required:!0},userTagsEnabled:{type:Boolean,required:!0},emojisSuggestionEnabled:{type:Boolean,required:!0},scrollDistance:{type:Number,required:!0},templatesText:{type:Array,default:null},usernameOptions:{type:Object,required:!0}},emits:["toggle-rooms-list","room-info","menu-action-handler","message-selection-action-handler","edit-message","send-message","delete-message","message-action-handler","fetch-messages","send-message-reaction","typing-message","open-file","open-user-tag","open-failed-message","textarea-action-handler"],data(){return{editedMessageId:null,initReplyMessage:null,initEditMessage:null,infiniteState:null,loadingMessages:!1,observer:null,showLoader:!0,loadingMoreMessages:!1,scrollIcon:!1,scrollMessagesCount:0,newMessages:[],messageSelectionEnabled:!1,selectedMessages:[]}},computed:{room(){return this.rooms.find(t=>t.roomId===this.roomId)||{}},showNoMessages(){return this.roomId&&!this.messages.length&&!this.loadingMessages&&!this.loadingRooms},showNoRoom(){const t=!this.rooms.length&&!this.loadingRooms||!this.roomId&&!this.loadFirstRoom;return t&&this.updateLoadingMessages(!1),t},showMessagesStarted(){return this.messages.length&&this.messagesLoaded}},watch:{roomId(){this.onRoomChanged()},messages:{deep:!0,handler(t,e){t.forEach((n,s)=>{this.showNewMessagesDivider&&!n.seen&&n.senderId!==this.currentUserId&&this.newMessages.push({_id:n._id,index:s})}),(e==null?void 0:e.length)===(t==null?void 0:t.length)-1&&(this.newMessages=[]),this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.loadingMoreMessages=!1)}},messagesLoaded(t){t&&this.updateLoadingMessages(!1),this.infiniteState&&this.infiniteState.complete()}},mounted(){this.newMessages=[]},methods:{updateLoadingMessages(t){this.loadingMessages=t,t?this.infiniteState=null:(this.infiniteState&&this.infiniteState.loaded(),setTimeout(()=>this.initIntersectionObserver()))},initIntersectionObserver(){this.observer&&(this.showLoader=!0,this.observer.disconnect());const t=document.querySelector("vue-advanced-chat").shadowRoot.getElementById("infinite-loader-messages");if(t){const e={root:document.querySelector("vue-advanced-chat").shadowRoot.getElementById("messages-list"),rootMargin:`${this.scrollDistance}px`,threshold:0};this.observer=new IntersectionObserver(n=>{n[0].isIntersecting&&this.loadMoreMessages()},e),this.observer.observe(t)}},preventTopScroll(){const t=this.$refs.scrollContainer,e=t.scrollHeight,n=new ResizeObserver(i=>{t.scrollHeight!==e&&this.$refs.scrollContainer&&(this.$refs.scrollContainer.scrollTo({top:t.scrollHeight-e}),n.disconnect())});for(var s=0;s<t.children.length;s++)n.observe(t.children[s])},touchStart(t){if(!this.singleRoom&&t.changedTouches.length===1){const e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY;addEventListener("touchend",s=>this.touchEnd(s,e,n),{once:!0})}},touchEnd(t,e,n){if(t.changedTouches.length===1){const s=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY,r=s-e>100,o=Math.abs(i-n)>50;r&&!o&&this.$emit("toggle-rooms-list")}},onRoomChanged(){this.updateLoadingMessages(!0),this.scrollIcon=!1,this.scrollMessagesCount=0,this.resetMessageSelection();const t=this.$watch(()=>this.messages,e=>{if(!e||!e.length)return;const n=this.$refs.scrollContainer;!n||(t(),setTimeout(()=>{n.scrollTo({top:n.scrollHeight}),this.updateLoadingMessages(!1)}))})},resetMessageSelection(){this.messageSelectionEnabled=!1,this.selectedMessages=[]},selectMessage(t){this.selectedMessages.push(t)},unselectMessage(t){this.selectedMessages=this.selectedMessages.filter(e=>e._id!==t)},onMessageAdded({message:t,index:e,ref:n}){if(e!==this.messages.length-1)return;const s=n.offsetHeight+60;setTimeout(()=>{const i=this.getBottomScroll(this.$refs.scrollContainer)>s;t.senderId===this.currentUserId?i?this.autoScroll.send.newAfterScrollUp&&this.scrollToBottom():this.autoScroll.send.new&&this.scrollToBottom():i?this.autoScroll.receive.newAfterScrollUp?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++):this.autoScroll.receive.new?this.scrollToBottom():(this.scrollIcon=!0,this.scrollMessagesCount++)})},onContainerScroll(t){if(!t.target)return;const e=this.getBottomScroll(t.target);e<60&&(this.scrollMessagesCount=0),this.scrollIcon=e>500||this.scrollMessagesCount},loadMoreMessages(){this.loadingMessages||setTimeout(()=>{if(!this.loadingMoreMessages){if(this.messagesLoaded||!this.roomId){this.loadingMoreMessages=!1,this.showLoader=!1;return}this.preventTopScroll(),this.$emit("fetch-messages"),this.loadingMoreMessages=!0}},500)},messageActionHandler({action:t,message:e}){switch(t.name){case"replyMessage":this.initReplyMessage=e;return;case"editMessage":this.initEditMessage=e;return;case"deleteMessage":return this.$emit("delete-message",e);case"selectMessages":this.selectedMessages=[e],this.messageSelectionEnabled=!0;return;default:return this.$emit("message-action-handler",{action:t,message:e})}},messageSelectionActionHandler(t){this.$emit("message-selection-action-handler",{action:t,messages:this.selectedMessages}),this.resetMessageSelection()},sendMessageReaction(t){this.$emit("send-message-reaction",t)},getBottomScroll(t){const{scrollHeight:e,clientHeight:n,scrollTop:s}=t;return e-n-s},scrollToBottom(){setTimeout(()=>{const t=this.$refs.scrollContainer;t.classList.add("vac-scroll-smooth"),t.scrollTo({top:t.scrollHeight,behavior:"smooth"}),setTimeout(()=>t.classList.remove("vac-scroll-smooth"))},50)},openFile({message:t,file:e}){this.$emit("open-file",{message:t,file:e})},openUserTag(t){this.$emit("open-user-tag",t)}}},dK={class:"vac-container-center vac-room-empty"},fK={class:"vac-messages-container"},mK={key:0,class:"vac-text-started"},pK={key:1,class:"vac-text-started"},gK={key:0,id:"infinite-loader-messages"},_K={key:2},vK={key:0,class:"vac-badge-counter vac-messages-count"};function yK(t,e,n,s,i,r){const o=et("room-header"),a=et("loader"),l=et("room-message"),c=et("svg-icon"),d=et("room-footer");return ar((re(),ge("div",{class:"vac-col-messages",onTouchstart:e[12]||(e[12]=(...u)=>r.touchStart&&r.touchStart(...u))},[r.showNoRoom?je(t.$slots,"no-room-selected",{key:0},()=>[Ce("div",dK,[Ce("div",null,ot(n.textMessages.ROOM_EMPTY),1)])]):(re(),Ut(o,{key:1,"current-user-id":n.currentUserId,"text-messages":n.textMessages,"single-room":n.singleRoom,"show-rooms-list":n.showRoomsList,"is-mobile":n.isMobile,"room-info-enabled":n.roomInfoEnabled,"menu-actions":n.menuActions,room:r.room,"message-selection-enabled":i.messageSelectionEnabled,"message-selection-actions":n.messageSelectionActions,"selected-messages-total":i.selectedMessages.length,onToggleRoomsList:e[0]||(e[0]=u=>t.$emit("toggle-rooms-list")),onRoomInfo:e[1]||(e[1]=u=>t.$emit("room-info")),onMenuActionHandler:e[2]||(e[2]=u=>t.$emit("menu-action-handler",u)),onMessageSelectionActionHandler:r.messageSelectionActionHandler,onCancelMessageSelection:e[3]||(e[3]=u=>i.messageSelectionEnabled=!1)},Jt({_:2},[gt(t.$slots,(u,f)=>({name:f,fn:Je(m=>[je(t.$slots,f,pt(ft(m)))])}))]),1032,["current-user-id","text-messages","single-room","show-rooms-list","is-mobile","room-info-enabled","menu-actions","room","message-selection-enabled","message-selection-actions","selected-messages-total","onMessageSelectionActionHandler"])),Ce("div",{id:"messages-list",ref:"scrollContainer",class:"vac-container-scroll",onScroll:e[5]||(e[5]=(...u)=>r.onContainerScroll&&r.onContainerScroll(...u))},[Ue(a,{show:i.loadingMessages},Jt({_:2},[gt(t.$slots,(u,f)=>({name:f,fn:Je(m=>[je(t.$slots,f,pt(ft(m)))])}))]),1032,["show"]),Ce("div",fK,[Ce("div",{class:yt({"vac-messages-hidden":i.loadingMessages})},[Ue(gn,{name:"vac-fade-message"},{default:Je(()=>[Ce("div",null,[r.showNoMessages?(re(),ge("div",mK,[je(t.$slots,"messages-empty",{},()=>[ma(ot(n.textMessages.MESSAGES_EMPTY),1)])])):He("",!0),r.showMessagesStarted?(re(),ge("div",pK,ot(n.textMessages.CONVERSATION_STARTED)+" "+ot(n.messages[0].date),1)):He("",!0)])]),_:3}),n.messages.length&&!n.messagesLoaded?(re(),ge("div",gK,[Ue(a,{show:!0,infinite:!0},Jt({_:2},[gt(t.$slots,(u,f)=>({name:f,fn:Je(m=>[je(t.$slots,f,pt(ft(m)))])}))]),1024)])):He("",!0),(re(),Ut(Av,{key:n.roomId,name:"vac-fade-message",tag:"span"},{default:Je(()=>[(re(!0),ge(kt,null,gt(n.messages,(u,f)=>(re(),ge("div",{key:u.indexId||u._id},[Ue(l,{"current-user-id":n.currentUserId,message:u,index:f,messages:n.messages,"edited-message-id":i.editedMessageId,"message-actions":n.messageActions,"room-users":r.room.users,"text-messages":n.textMessages,"new-messages":i.newMessages,"show-reaction-emojis":n.showReactionEmojis,"show-new-messages-divider":n.showNewMessagesDivider,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"username-options":n.usernameOptions,"message-selection-enabled":i.messageSelectionEnabled,"selected-messages":i.selectedMessages,onMessageAdded:r.onMessageAdded,onMessageActionHandler:r.messageActionHandler,onOpenFile:r.openFile,onOpenUserTag:r.openUserTag,onOpenFailedMessage:e[4]||(e[4]=m=>t.$emit("open-failed-message",m)),onSendMessageReaction:r.sendMessageReaction,onSelectMessage:r.selectMessage,onUnselectMessage:r.unselectMessage},Jt({_:2},[gt(t.$slots,(m,h)=>({name:h,fn:Je(k=>[je(t.$slots,h,pt(ft(k)))])}))]),1032,["current-user-id","message","index","messages","edited-message-id","message-actions","room-users","text-messages","new-messages","show-reaction-emojis","show-new-messages-divider","text-formatting","link-options","username-options","message-selection-enabled","selected-messages","onMessageAdded","onMessageActionHandler","onOpenFile","onOpenUserTag","onSendMessageReaction","onSelectMessage","onUnselectMessage"])]))),128))]),_:3}))],2)])],544),i.loadingMessages?He("",!0):(re(),ge("div",_K,[Ue(gn,{name:"vac-bounce"},{default:Je(()=>[i.scrollIcon?(re(),ge("div",{key:0,class:"vac-icon-scroll",onClick:e[6]||(e[6]=(...u)=>r.scrollToBottom&&r.scrollToBottom(...u))},[Ue(gn,{name:"vac-bounce"},{default:Je(()=>[i.scrollMessagesCount?(re(),ge("div",vK,ot(i.scrollMessagesCount),1)):He("",!0)]),_:1}),je(t.$slots,"scroll-icon",{},()=>[Ue(c,{name:"dropdown",param:"scroll"})])])):He("",!0)]),_:3})])),Ue(d,{room:r.room,"room-id":n.roomId,"room-message":n.roomMessage,"text-messages":n.textMessages,"show-send-icon":n.showSendIcon,"show-files":n.showFiles,"show-audio":n.showAudio,"show-emojis":n.showEmojis,"show-footer":n.showFooter,"accepted-files":n.acceptedFiles,"textarea-action-enabled":n.textareaActionEnabled,"textarea-auto-focus":n.textareaAutoFocus,"user-tags-enabled":n.userTagsEnabled,"emojis-suggestion-enabled":n.emojisSuggestionEnabled,"templates-text":n.templatesText,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"audio-bit-rate":n.audioBitRate,"audio-sample-rate":n.audioSampleRate,"init-reply-message":i.initReplyMessage,"init-edit-message":i.initEditMessage,onUpdateEditedMessageId:e[7]||(e[7]=u=>i.editedMessageId=u),onEditMessage:e[8]||(e[8]=u=>t.$emit("edit-message",u)),onSendMessage:e[9]||(e[9]=u=>t.$emit("send-message",u)),onTypingMessage:e[10]||(e[10]=u=>t.$emit("typing-message",u)),onTextareaActionHandler:e[11]||(e[11]=u=>t.$emit("textarea-action-handler",u))},Jt({_:2},[gt(t.$slots,(u,f)=>({name:f,fn:Je(m=>[je(t.$slots,f,pt(ft(m)))])}))]),1032,["room","room-id","room-message","text-messages","show-send-icon","show-files","show-audio","show-emojis","show-footer","accepted-files","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","templates-text","text-formatting","link-options","audio-bit-rate","audio-sample-rate","init-reply-message","init-edit-message"])],544)),[[_0,n.isMobile&&!n.showRoomsList||!n.isMobile||n.singleRoom]])}var bK=qt(hK,[["render",yK]]);const wK={name:"MediaPreview",components:{SvgIcon:Un},props:{file:{type:Object,required:!0}},emits:["close-media-preview"],computed:{isImage(){return fl(this.file)},isVideo(){return Qu(this.file)}},mounted(){this.$refs.modal.focus()},methods:{closeModal(){this.$emit("close-media-preview")}}},EK={key:0,class:"vac-media-preview-container"},xK={key:1,class:"vac-media-preview-container"},TK={width:"100%",height:"100%",controls:"",autoplay:""},SK=["src"],AK={class:"vac-svg-button"};function RK(t,e,n,s,i,r){const o=et("svg-icon");return re(),ge("div",{ref:"modal",tabindex:"0",class:"vac-media-preview",onClick:e[0]||(e[0]=Rr((...a)=>r.closeModal&&r.closeModal(...a),["stop"])),onKeydown:e[1]||(e[1]=Vi((...a)=>r.closeModal&&r.closeModal(...a),["esc"]))},[Ue(gn,{name:"vac-bounce-preview",appear:""},{default:Je(()=>[r.isImage?(re(),ge("div",EK,[Ce("div",{class:"vac-image-preview",style:Lt({"background-image":`url('${n.file.url}')`})},null,4)])):r.isVideo?(re(),ge("div",xK,[Ce("video",TK,[Ce("source",{src:n.file.url},null,8,SK)])])):He("",!0)]),_:1}),Ce("div",AK,[je(t.$slots,"preview-close-icon",{},()=>[Ue(o,{name:"close-outline",param:"preview"})])])],544)}var CK=qt(wK,[["render",RK]]),IK={ROOMS_EMPTY:"No rooms",ROOM_EMPTY:"No room selected",NEW_MESSAGES:"New Messages",MESSAGE_DELETED:"This message was deleted",MESSAGES_EMPTY:"No messages",CONVERSATION_STARTED:"Conversation started on:",TYPE_MESSAGE:"Type message",SEARCH:"Search",IS_ONLINE:"is online",LAST_SEEN:"last seen ",IS_TYPING:"is writing...",CANCEL_SELECT_MESSAGE:"Cancel"};const kK={light:{general:{color:"#0a0a0a",colorButtonClear:"#1976d2",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#fff",colorPlaceholder:"#9ca6af",colorCaret:"#1976d2",colorSpinner:"#333",borderStyle:"1px solid #e1e4e8",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#fff",colorRoomName:"#0a0a0a",colorRoomInfo:"#9ca6af"},footer:{background:"#f8f9fa",borderStyleInput:"1px solid #e1e4e8",borderInputSelected:"#1976d2",backgroundReply:"#e5e5e6",backgroundTagActive:"#e5e5e6",backgroundTag:"#f8f9fa"},content:{background:"#f8f9fa"},sidemenu:{background:"#fff",backgroundHover:"#f6f6f6",backgroundActive:"#e5effa",colorActive:"#1976d2",borderColorSearch:"#e1e5e8"},dropdown:{background:"#fff",backgroundHover:"#f6f6f6"},message:{background:"#fff",backgroundMe:"#ccf2cf",color:"#0a0a0a",colorStarted:"#9ca6af",backgroundDeleted:"#dadfe2",backgroundSelected:"#c2dcf2",colorDeleted:"#757e85",colorUsername:"#9ca6af",colorTimestamp:"#828c94",backgroundDate:"#e5effa",colorDate:"#505a62",backgroundSystem:"#e5effa",colorSystem:"#505a62",backgroundMedia:"rgba(0, 0, 0, 0.15)",backgroundReply:"rgba(0, 0, 0, 0.08)",colorReplyUsername:"#0a0a0a",colorReply:"#6e6e6e",colorTag:"#0d579c",backgroundImage:"#ddd",colorNewMessages:"#1976d2",backgroundScrollCounter:"#0696c7",colorScrollCounter:"#fff",backgroundReaction:"#eee",borderStyleReaction:"1px solid #eee",backgroundReactionHover:"#fff",borderStyleReactionHover:"1px solid #ddd",colorReactionCounter:"#0a0a0a",backgroundReactionMe:"#cfecf5",borderStyleReactionMe:"1px solid #3b98b8",backgroundReactionHoverMe:"#cfecf5",borderStyleReactionHoverMe:"1px solid #3b98b8",colorReactionCounterMe:"#0b59b3",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(0, 0, 0, 0.15)",backgroundAudioProgress:"#455247",backgroundAudioProgressSelector:"#455247",colorFileExtension:"#757e85"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#0a0a0a",colorMessage:"#67717a",colorTimestamp:"#a2aeb8",colorStateOnline:"#4caf50",colorStateOffline:"#9ca6af",backgroundCounterBadge:"#0696c7",colorCounterBadge:"#fff"},emoji:{background:"#fff"},icons:{search:"#9ca6af",add:"#1976d2",toggle:"#0a0a0a",menu:"#0a0a0a",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#1976d2",closeOutline:"#000",closePreview:"#fff",send:"#1976d2",sendDisabled:"#9ca6af",emoji:"#1976d2",emojiReaction:"rgba(0, 0, 0, 0.3)",document:"#1976d2",pencil:"#9e9e9e",checkmark:"#9e9e9e",checkmarkSeen:"#0696c7",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#9e9e9e",dropdownScroll:"#0a0a0a",microphone:"#1976d2",audioPlay:"#455247",audioPause:"#455247",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}},dark:{general:{color:"#fff",colorButtonClear:"#fff",colorButton:"#fff",backgroundColorButton:"#1976d2",backgroundInput:"#202223",colorPlaceholder:"#596269",colorCaret:"#fff",colorSpinner:"#fff",borderStyle:"none",backgroundScrollIcon:"#fff"},container:{border:"none",borderRadius:"4px",boxShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)"},header:{background:"#181a1b",colorRoomName:"#fff",colorRoomInfo:"#9ca6af"},footer:{background:"#131415",borderStyleInput:"none",borderInputSelected:"#1976d2",backgroundReply:"#1b1c1c",backgroundTagActive:"#1b1c1c",backgroundTag:"#131415"},content:{background:"#131415"},sidemenu:{background:"#181a1b",backgroundHover:"#202224",backgroundActive:"#151617",colorActive:"#fff",borderColorSearch:"#181a1b"},dropdown:{background:"#2a2c33",backgroundHover:"#26282e"},message:{background:"#22242a",backgroundMe:"#1f7e80",color:"#fff",colorStarted:"#9ca6af",backgroundDeleted:"#1b1c21",backgroundSelected:"#c2dcf2",colorDeleted:"#a2a5a8",colorUsername:"#b3bac9",colorTimestamp:"#ebedf2",backgroundDate:"rgba(0, 0, 0, 0.3)",colorDate:"#bec5cc",backgroundSystem:"rgba(0, 0, 0, 0.3)",colorSystem:"#bec5cc",backgroundMedia:"rgba(0, 0, 0, 0.18)",backgroundReply:"rgba(0, 0, 0, 0.18)",colorReplyUsername:"#fff",colorReply:"#d6d6d6",colorTag:"#f0c60a",backgroundImage:"#ddd",colorNewMessages:"#fff",backgroundScrollCounter:"#1976d2",colorScrollCounter:"#fff",backgroundReaction:"none",borderStyleReaction:"none",backgroundReactionHover:"#202223",borderStyleReactionHover:"none",colorReactionCounter:"#fff",backgroundReactionMe:"#4e9ad1",borderStyleReactionMe:"none",backgroundReactionHoverMe:"#4e9ad1",borderStyleReactionHoverMe:"none",colorReactionCounterMe:"#fff",backgroundAudioRecord:"#eb4034",backgroundAudioLine:"rgba(255, 255, 255, 0.15)",backgroundAudioProgress:"#b7d4d3",backgroundAudioProgressSelector:"#b7d4d3",colorFileExtension:"#a2a5a8"},markdown:{background:"rgba(239, 239, 239, 0.7)",border:"rgba(212, 212, 212, 0.9)",color:"#e01e5a",colorMulti:"#0a0a0a"},room:{colorUsername:"#fff",colorMessage:"#6c7278",colorTimestamp:"#6c7278",colorStateOnline:"#4caf50",colorStateOffline:"#596269",backgroundCounterBadge:"#1976d2",colorCounterBadge:"#fff"},emoji:{background:"#343740"},icons:{search:"#596269",add:"#fff",toggle:"#fff",menu:"#fff",close:"#9ca6af",closeImage:"#fff",file:"#1976d2",paperclip:"#fff",closeOutline:"#fff",closePreview:"#fff",send:"#fff",sendDisabled:"#646a70",emoji:"#fff",emojiReaction:"#fff",document:"#1976d2",pencil:"#ebedf2",checkmark:"#ebedf2",checkmarkSeen:"#f0d90a",eye:"#fff",dropdownMessage:"#fff",dropdownMessageBackground:"rgba(0, 0, 0, 0.25)",dropdownRoom:"#fff",dropdownScroll:"#0a0a0a",microphone:"#fff",audioPlay:"#b7d4d3",audioPause:"#b7d4d3",audioCancel:"#eb4034",audioConfirm:"#1ba65b"}}},MK=({general:t,container:e,header:n,footer:s,sidemenu:i,content:r,dropdown:o,message:a,markdown:l,room:c,emoji:d,icons:u})=>({"--chat-color":t.color,"--chat-color-button-clear":t.colorButtonClear,"--chat-color-button":t.colorButton,"--chat-bg-color-button":t.backgroundColorButton,"--chat-bg-color-input":t.backgroundInput,"--chat-color-spinner":t.colorSpinner,"--chat-color-placeholder":t.colorPlaceholder,"--chat-color-caret":t.colorCaret,"--chat-border-style":t.borderStyle,"--chat-bg-scroll-icon":t.backgroundScrollIcon,"--chat-container-border":e.border,"--chat-container-border-radius":e.borderRadius,"--chat-container-box-shadow":e.boxShadow,"--chat-header-bg-color":n.background,"--chat-header-color-name":n.colorRoomName,"--chat-header-color-info":n.colorRoomInfo,"--chat-footer-bg-color":s.background,"--chat-border-style-input":s.borderStyleInput,"--chat-border-color-input-selected":s.borderInputSelected,"--chat-footer-bg-color-reply":s.backgroundReply,"--chat-footer-bg-color-tag-active":s.backgroundTagActive,"--chat-footer-bg-color-tag":s.backgroundTag,"--chat-content-bg-color":r.background,"--chat-sidemenu-bg-color":i.background,"--chat-sidemenu-bg-color-hover":i.backgroundHover,"--chat-sidemenu-bg-color-active":i.backgroundActive,"--chat-sidemenu-color-active":i.colorActive,"--chat-sidemenu-border-color-search":i.borderColorSearch,"--chat-dropdown-bg-color":o.background,"--chat-dropdown-bg-color-hover":o.backgroundHover,"--chat-message-bg-color":a.background,"--chat-message-bg-color-me":a.backgroundMe,"--chat-message-color-started":a.colorStarted,"--chat-message-bg-color-deleted":a.backgroundDeleted,"--chat-message-bg-color-selected":a.backgroundSelected,"--chat-message-color-deleted":a.colorDeleted,"--chat-message-color-username":a.colorUsername,"--chat-message-color-timestamp":a.colorTimestamp,"--chat-message-bg-color-date":a.backgroundDate,"--chat-message-color-date":a.colorDate,"--chat-message-bg-color-system":a.backgroundSystem,"--chat-message-color-system":a.colorSystem,"--chat-message-color":a.color,"--chat-message-bg-color-media":a.backgroundMedia,"--chat-message-bg-color-reply":a.backgroundReply,"--chat-message-color-reply-username":a.colorReplyUsername,"--chat-message-color-reply-content":a.colorReply,"--chat-message-color-tag":a.colorTag,"--chat-message-bg-color-image":a.backgroundImage,"--chat-message-color-new-messages":a.colorNewMessages,"--chat-message-bg-color-scroll-counter":a.backgroundScrollCounter,"--chat-message-color-scroll-counter":a.colorScrollCounter,"--chat-message-bg-color-reaction":a.backgroundReaction,"--chat-message-border-style-reaction":a.borderStyleReaction,"--chat-message-bg-color-reaction-hover":a.backgroundReactionHover,"--chat-message-border-style-reaction-hover":a.borderStyleReactionHover,"--chat-message-color-reaction-counter":a.colorReactionCounter,"--chat-message-bg-color-reaction-me":a.backgroundReactionMe,"--chat-message-border-style-reaction-me":a.borderStyleReactionMe,"--chat-message-bg-color-reaction-hover-me":a.backgroundReactionHoverMe,"--chat-message-border-style-reaction-hover-me":a.borderStyleReactionHoverMe,"--chat-message-color-reaction-counter-me":a.colorReactionCounterMe,"--chat-message-bg-color-audio-record":a.backgroundAudioRecord,"--chat-message-bg-color-audio-line":a.backgroundAudioLine,"--chat-message-bg-color-audio-progress":a.backgroundAudioProgress,"--chat-message-bg-color-audio-progress-selector":a.backgroundAudioProgressSelector,"--chat-message-color-file-extension":a.colorFileExtension,"--chat-markdown-bg":l.background,"--chat-markdown-border":l.border,"--chat-markdown-color":l.color,"--chat-markdown-color-multi":l.colorMulti,"--chat-room-color-username":c.colorUsername,"--chat-room-color-message":c.colorMessage,"--chat-room-color-timestamp":c.colorTimestamp,"--chat-room-color-online":c.colorStateOnline,"--chat-room-color-offline":c.colorStateOffline,"--chat-room-bg-color-badge":c.backgroundCounterBadge,"--chat-room-color-badge":c.colorCounterBadge,"--chat-emoji-bg-color":d.background,"--chat-icon-color-search":u.search,"--chat-icon-color-add":u.add,"--chat-icon-color-toggle":u.toggle,"--chat-icon-color-menu":u.menu,"--chat-icon-color-close":u.close,"--chat-icon-color-close-image":u.closeImage,"--chat-icon-color-file":u.file,"--chat-icon-color-paperclip":u.paperclip,"--chat-icon-color-close-outline":u.closeOutline,"--chat-icon-color-close-preview":u.closePreview,"--chat-icon-color-send":u.send,"--chat-icon-color-send-disabled":u.sendDisabled,"--chat-icon-color-emoji":u.emoji,"--chat-icon-color-emoji-reaction":u.emojiReaction,"--chat-icon-color-document":u.document,"--chat-icon-color-pencil":u.pencil,"--chat-icon-color-checkmark":u.checkmark,"--chat-icon-color-checkmark-seen":u.checkmarkSeen,"--chat-icon-color-eye":u.eye,"--chat-icon-color-dropdown-message":u.dropdownMessage,"--chat-icon-bg-dropdown-message":u.dropdownMessageBackground,"--chat-icon-color-dropdown-room":u.dropdownRoom,"--chat-icon-color-dropdown-scroll":u.dropdownScroll,"--chat-icon-color-microphone":u.microphone,"--chat-icon-color-audio-play":u.audioPlay,"--chat-icon-color-audio-pause":u.audioPause,"--chat-icon-color-audio-cancel":u.audioCancel,"--chat-icon-color-audio-confirm":u.audioConfirm});const NK={name:"ChatContainer",components:{RoomsList:Yj,Room:bK,MediaPreview:CK},props:{height:{type:String,default:"600px"},theme:{type:String,default:"light"},styles:{type:[Object,String],default:()=>({})},responsiveBreakpoint:{type:Number,default:900},singleRoom:{type:[Boolean,String],default:!1},roomsListOpened:{type:[Boolean,String],default:!0},textMessages:{type:[Object,String],default:null},currentUserId:{type:String,default:""},rooms:{type:[Array,String],default:null},roomsOrder:{type:String,default:"desc"},loadingRooms:{type:[Boolean,String],default:!1},roomsLoaded:{type:[Boolean,String],default:!1},roomId:{type:String,default:null},loadFirstRoom:{type:[Boolean,String],default:!0},messages:{type:[Array,String],default:null},messagesLoaded:{type:[Boolean,String],default:!1},roomActions:{type:Array,default:()=>[]},menuActions:{type:Array,default:()=>[]},messageActions:{type:Array,default:()=>[{name:"replyMessage",title:"Reply"},{name:"editMessage",title:"Edit Message",onlyMe:!0},{name:"deleteMessage",title:"Delete Message",onlyMe:!0},{name:"selectMessages",title:"Select"}]},messageSelectionActions:{type:Array,default:()=>[]},autoScroll:{type:Object,default:()=>({send:{new:!0,newAfterScrollUp:!0},receive:{new:!0,newAfterScrollUp:!1}})},showSearch:{type:[Boolean,String],default:!0},showAddRoom:{type:[Boolean,String],default:!0},showSendIcon:{type:[Boolean,String],default:!0},showFiles:{type:[Boolean,String],default:!0},showAudio:{type:[Boolean,String],default:!0},audioBitRate:{type:Number,default:128},audioSampleRate:{type:Number,default:44100},showEmojis:{type:[Boolean,String],default:!0},showReactionEmojis:{type:[Boolean,String],default:!0},showNewMessagesDivider:{type:[Boolean,String],default:!0},showFooter:{type:[Boolean,String],default:!0},textFormatting:{type:Object,default:()=>({disabled:!1,italic:"_",bold:"*",strike:"~",underline:"\xB0",multilineCode:"```",inlineCode:"`"})},linkOptions:{type:Object,default:()=>({disabled:!1,target:"_blank",rel:null})},roomInfoEnabled:{type:[Boolean,String],default:!1},textareaActionEnabled:{type:[Boolean,String],default:!1},textareaAutoFocus:{type:[Boolean,String],default:!0},userTagsEnabled:{type:[Boolean,String],default:!0},emojisSuggestionEnabled:{type:[Boolean,String],default:!0},roomMessage:{type:String,default:""},scrollDistance:{type:Number,default:60},acceptedFiles:{type:String,default:"*"},templatesText:{type:[Array,String],default:null},mediaPreviewEnabled:{type:[Boolean,String],default:!0},usernameOptions:{type:Object,default:()=>({minUsers:3,currentUser:!1})}},emits:["toggle-rooms-list","room-info","fetch-messages","send-message","edit-message","delete-message","open-file","open-user-tag","open-failed-message","menu-action-handler","message-action-handler","send-message-reaction","typing-message","textarea-action-handler","fetch-more-rooms","add-room","room-action-handler","message-selection-action-handler"],data(){return{room:{},loadingMoreRooms:!1,showRoomsList:!0,isMobile:!1,showMediaPreview:!1,previewFile:{}}},computed:{t(){return{...IK,...this.textMessages}},cssVars(){const t=kK[this.theme],e={};return Object.keys(t).map(n=>{e[n]={...t[n],...this.styles[n]||{}}}),MK(e)},orderedRooms(){return this.roomsCasted.slice().sort((t,e)=>{const n=t.index||0,s=e.index||0;return this.roomsOrder==="asc"?n<s?-1:s<n?1:0:n>s?-1:s>n?1:0})},roomsCasted(){return this.rooms||[]},messagesCasted(){return this.messages||[]},singleRoomCasted(){return this.castBooleanToString(this.singleRoom)},roomsListOpenedCasted(){return this.castBooleanToString(this.roomsListOpened)},loadingRoomsCasted(){return this.castBooleanToString(this.loadingRooms)},roomsLoadedCasted(){return this.castBooleanToString(this.roomsLoaded)},loadFirstRoomCasted(){return this.castBooleanToString(this.loadFirstRoom)},messagesLoadedCasted(){return this.castBooleanToString(this.messagesLoaded)},showSearchCasted(){return this.castBooleanToString(this.showSearch)},showAddRoomCasted(){return this.castBooleanToString(this.showAddRoom)},showSendIconCasted(){return this.castBooleanToString(this.showSendIcon)},showFilesCasted(){return this.castBooleanToString(this.showFiles)},showAudioCasted(){return this.castBooleanToString(this.showAudio)},showEmojisCasted(){return this.castBooleanToString(this.showEmojis)},showReactionEmojisCasted(){return this.castBooleanToString(this.showReactionEmojis)},showNewMessagesDividerCasted(){return this.castBooleanToString(this.showNewMessagesDivider)},showFooterCasted(){return this.castBooleanToString(this.showFooter)},roomInfoEnabledCasted(){return this.castBooleanToString(this.roomInfoEnabled)},textareaActionEnabledCasted(){return this.castBooleanToString(this.textareaActionEnabled)},textareaAutoFocusCasted(){return this.castBooleanToString(this.textareaAutoFocus)},userTagsEnabledCasted(){return this.castBooleanToString(this.userTagsEnabled)},emojisSuggestionEnabledCasted(){return this.castBooleanToString(this.emojisSuggestionEnabled)},mediaPreviewEnabledCasted(){return this.castBooleanToString(this.mediaPreviewEnabled)}},watch:{rooms:{immediate:!0,deep:!0,handler(t,e){if((!t[0]||!t.find(n=>n.roomId===this.room.roomId))&&(this.showRoomsList=!0),!this.loadingMoreRooms&&this.loadFirstRoomCasted&&t[0]&&(!e||t.length!==e.length))if(this.roomId){const n=t.find(s=>s.roomId===this.roomId)||{};this.fetchRoom({room:n})}else!this.isMobile||this.singleRoomCasted?this.fetchRoom({room:this.orderedRooms[0]}):this.showRoomsList=!0}},loadingRoomsCasted(t){t&&(this.room={})},roomId:{immediate:!0,handler(t,e){if(t&&!this.loadingRoomsCasted&&this.roomsCasted.length){const n=this.roomsCasted.find(s=>s.roomId===t);this.fetchRoom({room:n})}else e&&!t&&(this.room={})}},room(t){!t||Object.entries(t).length===0||(Kz(t),t.users.forEach(e=>{Gz(e)}))},roomsListOpenedCasted(t){this.showRoomsList=t}},created(){this.updateResponsive(),window.addEventListener("resize",t=>{t.isTrusted&&this.updateResponsive()})},methods:{castBooleanToString(t){return t==="true"||t===!0},updateResponsive(){this.isMobile=window.innerWidth<Number(this.responsiveBreakpoint)},toggleRoomsList(){this.showRoomsList=!this.showRoomsList,this.isMobile&&(this.room={}),this.$emit("toggle-rooms-list",{opened:this.showRoomsList})},fetchRoom({room:t}){this.room=t,this.fetchMessages({reset:!0}),this.isMobile&&(this.showRoomsList=!1)},fetchMoreRooms(){this.$emit("fetch-more-rooms")},roomInfo(){this.$emit("room-info",this.room)},addRoom(){this.$emit("add-room")},fetchMessages(t){this.$emit("fetch-messages",{room:this.room,options:t})},sendMessage(t){this.$emit("send-message",{...t,roomId:this.room.roomId})},editMessage(t){this.$emit("edit-message",{...t,roomId:this.room.roomId})},deleteMessage(t){this.$emit("delete-message",{message:t,roomId:this.room.roomId})},openFile({message:t,file:e}){this.mediaPreviewEnabledCasted&&e.action==="preview"?(this.previewFile=e.file,this.showMediaPreview=!0):this.$emit("open-file",{message:t,file:e})},openUserTag({user:t}){this.$emit("open-user-tag",{user:t})},openFailedMessage({message:t}){this.$emit("open-failed-message",{message:t,roomId:this.room.roomId})},menuActionHandler(t){this.$emit("menu-action-handler",{action:t,roomId:this.room.roomId})},roomActionHandler({action:t,roomId:e}){this.$emit("room-action-handler",{action:t,roomId:e})},messageActionHandler(t){this.$emit("message-action-handler",{...t,roomId:this.room.roomId})},messageSelectionActionHandler(t){this.$emit("message-selection-action-handler",{...t,roomId:this.room.roomId})},sendMessageReaction(t){this.$emit("send-message-reaction",{...t,roomId:this.room.roomId})},typingMessage(t){this.$emit("typing-message",{message:t,roomId:this.room.roomId})},textareaActionHandler(t){this.$emit("textarea-action-handler",{message:t,roomId:this.room.roomId})}}},OK={class:"vac-chat-container"};function LK(t,e,n,s,i,r){const o=et("rooms-list"),a=et("room"),l=et("media-preview");return re(),ge("div",{class:"vac-card-window",style:Lt([{height:n.height},r.cssVars])},[Ce("div",OK,[r.singleRoomCasted?He("",!0):(re(),Ut(o,{key:0,"current-user-id":n.currentUserId,rooms:r.orderedRooms,"loading-rooms":r.loadingRoomsCasted,"rooms-loaded":r.roomsLoadedCasted,room:i.room,"room-actions":n.roomActions,"text-messages":r.t,"show-search":r.showSearchCasted,"show-add-room":r.showAddRoomCasted,"show-rooms-list":i.showRoomsList,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"is-mobile":i.isMobile,"scroll-distance":n.scrollDistance,onFetchRoom:r.fetchRoom,onFetchMoreRooms:r.fetchMoreRooms,onLoadingMoreRooms:e[0]||(e[0]=c=>i.loadingMoreRooms=c),onAddRoom:r.addRoom,onRoomActionHandler:r.roomActionHandler},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["current-user-id","rooms","loading-rooms","rooms-loaded","room","room-actions","text-messages","show-search","show-add-room","show-rooms-list","text-formatting","link-options","is-mobile","scroll-distance","onFetchRoom","onFetchMoreRooms","onAddRoom","onRoomActionHandler"])),Ue(a,{"current-user-id":n.currentUserId,rooms:r.roomsCasted,"room-id":i.room.roomId||"","load-first-room":r.loadFirstRoomCasted,messages:r.messagesCasted,"room-message":n.roomMessage,"messages-loaded":r.messagesLoadedCasted,"menu-actions":n.menuActions,"message-actions":n.messageActions,"message-selection-actions":n.messageSelectionActions,"auto-scroll":n.autoScroll,"show-send-icon":r.showSendIconCasted,"show-files":r.showFilesCasted,"show-audio":r.showAudioCasted,"audio-bit-rate":n.audioBitRate,"audio-sample-rate":n.audioSampleRate,"show-emojis":r.showEmojisCasted,"show-reaction-emojis":r.showReactionEmojisCasted,"show-new-messages-divider":r.showNewMessagesDividerCasted,"show-footer":r.showFooterCasted,"text-messages":r.t,"single-room":r.singleRoomCasted,"show-rooms-list":i.showRoomsList,"text-formatting":n.textFormatting,"link-options":n.linkOptions,"is-mobile":i.isMobile,"loading-rooms":r.loadingRoomsCasted,"room-info-enabled":r.roomInfoEnabledCasted,"textarea-action-enabled":r.textareaActionEnabledCasted,"textarea-auto-focus":r.textareaAutoFocusCasted,"user-tags-enabled":r.userTagsEnabledCasted,"emojis-suggestion-enabled":r.emojisSuggestionEnabledCasted,"scroll-distance":n.scrollDistance,"accepted-files":n.acceptedFiles,"templates-text":n.templatesText,"username-options":n.usernameOptions,onToggleRoomsList:r.toggleRoomsList,onRoomInfo:r.roomInfo,onFetchMessages:r.fetchMessages,onSendMessage:r.sendMessage,onEditMessage:r.editMessage,onDeleteMessage:r.deleteMessage,onOpenFile:r.openFile,onOpenUserTag:r.openUserTag,onOpenFailedMessage:r.openFailedMessage,onMenuActionHandler:r.menuActionHandler,onMessageActionHandler:r.messageActionHandler,onMessageSelectionActionHandler:r.messageSelectionActionHandler,onSendMessageReaction:r.sendMessageReaction,onTypingMessage:r.typingMessage,onTextareaActionHandler:r.textareaActionHandler},Jt({_:2},[gt(t.$slots,(c,d)=>({name:d,fn:Je(u=>[je(t.$slots,d,pt(ft(u)))])}))]),1032,["current-user-id","rooms","room-id","load-first-room","messages","room-message","messages-loaded","menu-actions","message-actions","message-selection-actions","auto-scroll","show-send-icon","show-files","show-audio","audio-bit-rate","audio-sample-rate","show-emojis","show-reaction-emojis","show-new-messages-divider","show-footer","text-messages","single-room","show-rooms-list","text-formatting","link-options","is-mobile","loading-rooms","room-info-enabled","textarea-action-enabled","textarea-auto-focus","user-tags-enabled","emojis-suggestion-enabled","scroll-distance","accepted-files","templates-text","username-options","onToggleRoomsList","onRoomInfo","onFetchMessages","onSendMessage","onEditMessage","onDeleteMessage","onOpenFile","onOpenUserTag","onOpenFailedMessage","onMenuActionHandler","onMessageActionHandler","onMessageSelectionActionHandler","onSendMessageReaction","onTypingMessage","onTextareaActionHandler"])]),Ue(gn,{name:"vac-fade-preview",appear:""},{default:Je(()=>[i.showMediaPreview?(re(),Ut(l,{key:0,file:i.previewFile,onCloseMediaPreview:e[1]||(e[1]=c=>i.showMediaPreview=!1)},null,8,["file"])):He("",!0)]),_:1})],4)}var PK=qt(NK,[["render",LK]]);const DK=TF(PK);function BK(){customElements.define("vue-advanced-chat",DK)}var FK=`.vac-fade-spinner-enter-from{opacity:0}.vac-fade-spinner-enter-active{transition:opacity .8s}.vac-fade-spinner-leave-active{transition:opacity .2s;opacity:0}.vac-fade-image-enter-from{opacity:0}.vac-fade-image-enter-active{transition:opacity 1s}.vac-fade-image-leave-active{transition:opacity .5s;opacity:0}.vac-fade-message-enter-from{opacity:0}.vac-fade-message-enter-active{transition:opacity .5s}.vac-fade-message-leave-active{transition:opacity .2s;opacity:0}.vac-slide-left-enter-active,.vac-slide-right-enter-active{transition:all .3s ease;transition-property:transform,opacity}.vac-slide-left-leave-active,.vac-slide-right-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)!important;transition-property:transform,opacity}.vac-slide-left-enter-from,.vac-slide-left-leave-to{transform:translate(10px);opacity:0}.vac-slide-right-enter-from,.vac-slide-right-leave-to{transform:translate(-10px);opacity:0}.vac-slide-up-enter-active{transition:all .3s ease}.vac-slide-up-leave-active{transition:all .2s cubic-bezier(1,.5,.8,1)}.vac-slide-up-enter-from,.vac-slide-up-leave-to{transform:translateY(10px);opacity:0}.vac-bounce-enter-active{animation:vac-bounce-in .5s}.vac-bounce-leave-active{animation:vac-bounce-in .3s reverse}@keyframes vac-bounce-in{0%{transform:scale(0)}50%{transform:scale(1.05)}to{transform:scale(1)}}.vac-fade-preview-enter{opacity:0}.vac-fade-preview-enter-active{transition:opacity .1s}.vac-fade-preview-leave-active{transition:opacity .2s;opacity:0}.vac-bounce-preview-enter-active{animation:vac-bounce-image-in .4s}.vac-bounce-preview-leave-active{animation:vac-bounce-image-in .3s reverse}@keyframes vac-bounce-image-in{0%{transform:scale(.6)}to{transform:scale(1)}}.vac-menu-list{border-radius:4px;display:block;cursor:pointer;background:var(--chat-dropdown-bg-color);padding:6px 0}.vac-menu-list :hover{background:var(--chat-dropdown-bg-color-hover);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-list :not(:hover){transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-menu-item{-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-ms-flex:1 1 100%;flex:1 1 100%;min-height:30px;padding:5px 16px;position:relative;white-space:nowrap;line-height:30px}.vac-menu-options{position:absolute;right:10px;top:20px;z-index:9999;min-width:150px;display:inline-block;border-radius:4px;font-size:14px;color:var(--chat-color);overflow-y:auto;overflow-x:hidden;contain:content;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-app-border{border:var(--chat-border-style)}.vac-app-border-t{border-top:var(--chat-border-style)}.vac-app-border-r{border-right:var(--chat-border-style)}.vac-app-border-b{border-bottom:var(--chat-border-style)}.vac-app-box-shadow{transition:all .5s;box-shadow:0 2px 2px -4px #0000001a,0 2px 2px 1px #0000001f,0 1px 8px 1px #0000001f}.vac-item-clickable{cursor:pointer}.vac-vertical-center{display:flex;align-items:center;height:100%}.vac-vertical-center .vac-vertical-container{width:100%;text-align:center}.vac-svg-button{max-height:30px;display:flex;cursor:pointer;transition:all .2s}.vac-svg-button:hover{transform:scale(1.1);opacity:.7}.vac-avatar{background-size:cover;background-position:center center;background-repeat:no-repeat;background-color:#ddd;height:42px;width:42px;min-height:42px;min-width:42px;margin-right:15px;border-radius:50%}.vac-blur-loading{filter:blur(3px)}.vac-badge-counter{height:13px;width:auto;min-width:13px;border-radius:50%;display:flex;align-items:center;justify-content:center;padding:3px;font-size:11px;font-weight:500}.vac-text-ellipsis{width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-text-bold{font-weight:700}.vac-text-italic{font-style:italic}.vac-text-strike{text-decoration:line-through}.vac-text-underline{text-decoration:underline}.vac-text-inline-code{display:inline-block;font-size:12px;color:var(--chat-markdown-color);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:2px 0;padding:2px 3px}.vac-text-multiline-code{display:block;font-size:12px;color:var(--chat-markdown-color-multi);background:var(--chat-markdown-bg);border:1px solid var(--chat-markdown-border);border-radius:3px;margin:4px 0;padding:7px}.vac-text-tag{color:var(--chat-message-color-tag);cursor:pointer}.vac-file-container{display:flex;align-content:center;justify-content:center;flex-wrap:wrap;text-align:center;background:var(--chat-bg-color-input);border:var(--chat-border-style-input);border-radius:4px;padding:10px}.vac-file-container svg{height:28px;width:28px}.vac-file-container .vac-text-extension{font-size:12px;color:var(--chat-message-color-file-extension);margin-top:-2px}.vac-card-window{width:100%;display:block;max-width:100%;background:var(--chat-content-bg-color);color:var(--chat-color);overflow-wrap:break-word;white-space:normal;border:var(--chat-container-border);border-radius:var(--chat-container-border-radius);box-shadow:var(--chat-container-box-shadow);-webkit-tap-highlight-color:transparent}.vac-card-window *{font-family:inherit}.vac-card-window a{color:#0d579c;font-weight:500}.vac-card-window .vac-chat-container{height:100%;display:flex}.vac-card-window .vac-chat-container input{min-width:10px}.vac-card-window .vac-chat-container textarea,.vac-card-window .vac-chat-container input[type=text],.vac-card-window .vac-chat-container input[type=search]{-webkit-appearance:none}.vac-media-preview{position:fixed;top:0;left:0;z-index:99;width:100vw;height:100vh;display:flex;align-items:center;background-color:#000c;outline:none}.vac-media-preview .vac-media-preview-container{height:calc(100% - 140px);width:calc(100% - 80px);padding:70px 40px;margin:0 auto}.vac-media-preview .vac-image-preview{width:100%;height:100%;background-size:contain;background-repeat:no-repeat;background-position:center}.vac-media-preview .vac-svg-button{position:absolute;top:30px;right:30px;transform:scale(1.4)}@media only screen and (max-width: 768px){.vac-media-preview .vac-svg-button{top:20px;right:20px;transform:scale(1.2)}.vac-media-preview .vac-media-preview-container{width:calc(100% - 40px);padding:70px 20px}}.vac-col-messages{position:relative;height:100%;flex:1;overflow:hidden;display:flex;flex-flow:column}.vac-col-messages .vac-container-center{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}.vac-col-messages .vac-room-empty{font-size:14px;color:#9ca6af;font-style:italic;line-height:20px;white-space:pre-line}.vac-col-messages .vac-room-empty div{padding:0 10%}.vac-col-messages .vac-container-scroll{background:var(--chat-content-bg-color);flex:1;overflow-y:auto;margin-right:1px;margin-top:60px;-webkit-overflow-scrolling:touch}.vac-col-messages .vac-container-scroll.vac-scroll-smooth{scroll-behavior:smooth}.vac-col-messages .vac-messages-container{padding:0 5px 5px}.vac-col-messages .vac-text-started{font-size:14px;color:var(--chat-message-color-started);font-style:italic;text-align:center;margin-top:30px;margin-bottom:20px}.vac-col-messages .vac-icon-scroll{position:absolute;bottom:80px;right:20px;padding:8px;background:var(--chat-bg-scroll-icon);border-radius:50%;box-shadow:0 1px 1px -1px #0003,0 1px 1px #00000024,0 1px 2px #0000001f;display:flex;cursor:pointer;z-index:10}.vac-col-messages .vac-icon-scroll svg{height:25px;width:25px}.vac-col-messages .vac-messages-count{position:absolute;top:-8px;left:11px;background-color:var(--chat-message-bg-color-scroll-counter);color:var(--chat-message-color-scroll-counter)}.vac-col-messages .vac-messages-hidden{opacity:0}@media only screen and (max-width: 768px){.vac-col-messages .vac-container-scroll{margin-top:50px}.vac-col-messages .vac-text-started{margin-top:20px}.vac-col-messages .vac-icon-scroll{bottom:70px}}.vac-room-header{position:absolute;display:flex;align-items:center;height:64px;width:100%;z-index:10;margin-right:1px;background:var(--chat-header-bg-color);border-top-right-radius:var(--chat-container-border-radius)}.vac-room-header .vac-room-wrapper{display:flex;align-items:center;min-width:0;height:100%;width:100%;padding:0 16px}.vac-room-header .vac-toggle-button{margin-right:15px}.vac-room-header .vac-toggle-button svg{height:26px;width:26px}.vac-room-header .vac-rotate-icon{transform:rotate(180deg)!important}.vac-room-header .vac-rotate-icon-init{transform:rotate(360deg)}.vac-room-header .vac-info-wrapper,.vac-room-header .vac-room-selection{display:flex;align-items:center;min-width:0;width:100%;height:100%}.vac-room-header .vac-room-selection .vac-selection-button{padding:8px 16px;color:var(--chat-color-button);background-color:var(--chat-bg-color-button);border-radius:4px;margin-right:10px;cursor:pointer;transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-button:hover{opacity:.7}.vac-room-header .vac-room-selection .vac-selection-button:active{opacity:.9}.vac-room-header .vac-room-selection .vac-selection-button .vac-selection-button-count{margin-left:6px;opacity:.9}.vac-room-header .vac-room-selection .vac-selection-cancel{display:flex;align-items:center;margin-left:auto;white-space:nowrap;color:var(--chat-color-button-clear);transition:all .2s}.vac-room-header .vac-room-selection .vac-selection-cancel:hover{opacity:.7}.vac-room-header .vac-room-name{font-size:17px;font-weight:500;line-height:22px;color:var(--chat-header-color-name)}.vac-room-header .vac-room-info{font-size:13px;line-height:18px;color:var(--chat-header-color-info)}.vac-room-header .vac-room-options{margin-left:auto}@media only screen and (max-width: 768px){.vac-room-header{height:50px}.vac-room-header .vac-room-wrapper{padding:0 10px}.vac-room-header .vac-room-name{font-size:16px;line-height:22px}.vac-room-header .vac-room-info{font-size:12px;line-height:16px}.vac-room-header .vac-avatar{height:37px;width:37px;min-height:37px;min-width:37px}}.vac-room-footer{width:100%;border-bottom-right-radius:4px;z-index:10}.vac-box-footer{display:flex;position:relative;background:var(--chat-footer-bg-color);padding:10px 8px}.vac-textarea{height:20px;width:100%;line-height:20px;overflow:hidden;outline:0;resize:none;border-radius:20px;padding:12px 16px;box-sizing:content-box;font-size:16px;background:var(--chat-bg-color-input);color:var(--chat-color);caret-color:var(--chat-color-caret);border:var(--chat-border-style-input)}.vac-textarea::placeholder{color:var(--chat-color-placeholder);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.vac-textarea-outline{border:1px solid var(--chat-border-color-input-selected);box-shadow:inset 0 0 0 1px var(--chat-border-color-input-selected)}.vac-icon-textarea,.vac-icon-textarea-left{display:flex;align-items:center}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea{margin-left:5px}.vac-icon-textarea-left{display:flex;align-items:center;margin-right:5px}.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 7px}.vac-icon-textarea-left .vac-icon-microphone{fill:var(--chat-icon-color-microphone);margin:0 7px}.vac-icon-textarea-left .vac-dot-audio-record{height:15px;width:15px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-record);animation:vac-scaling .8s ease-in-out infinite alternate}@keyframes vac-scaling{0%{transform:scale(1);opacity:.4}to{transform:scale(1.1);opacity:1}}.vac-icon-textarea-left .vac-dot-audio-record-time{font-size:16px;color:var(--chat-color);margin-left:8px;width:45px}.vac-icon-textarea-left .vac-icon-audio-stop,.vac-icon-textarea-left .vac-icon-audio-confirm{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop svg,.vac-icon-textarea-left .vac-icon-audio-confirm svg{min-height:28px;min-width:28px}.vac-icon-textarea-left .vac-icon-audio-stop{margin-right:20px}.vac-icon-textarea-left .vac-icon-audio-stop #vac-icon-close-outline{fill:var(--chat-icon-color-audio-cancel)}.vac-icon-textarea-left .vac-icon-audio-confirm{margin-right:3px;margin-left:12px}.vac-icon-textarea-left .vac-icon-audio-confirm #vac-icon-checkmark{fill:var(--chat-icon-color-audio-confirm)}.vac-send-disabled,.vac-send-disabled svg{cursor:none!important;pointer-events:none!important;transform:none!important}@media only screen and (max-width: 768px){.vac-room-footer{width:100%}.vac-box-footer{padding:7px 2px 7px 7px}.vac-box-footer.vac-box-footer-border{border-top:var(--chat-border-style-input)}.vac-textarea{padding:7px;line-height:18px}.vac-textarea::placeholder{color:transparent}.vac-icon-textarea svg,.vac-icon-textarea .vac-wrapper,.vac-icon-textarea-left svg,.vac-icon-textarea-left .vac-wrapper{margin:0 5px!important}}.vac-emojis-container{width:calc(100% - 16px);padding:10px 8px;background:var(--chat-footer-bg-color);display:flex;align-items:center;overflow:auto}.vac-emojis-container .vac-emoji-element{padding:0 8px;font-size:30px;border-radius:4px;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-emojis-container .vac-emoji-element-active{background:var(--chat-footer-bg-color-tag-active)}@media only screen and (max-width: 768px){.vac-emojis-container{width:calc(100% - 10px);padding:7px 5px}.vac-emojis-container .vac-emoji-element{padding:0 7px;font-size:26px}}.vac-reply-container{display:flex;padding:10px 10px 0;background:var(--chat-footer-bg-color);align-items:center;width:calc(100% - 20px)}.vac-reply-container .vac-reply-box{width:100%;overflow:hidden;background:var(--chat-footer-bg-color-reply);border-radius:4px;padding:8px 10px}.vac-reply-container .vac-reply-info{overflow:hidden}.vac-reply-container .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-container .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content);white-space:pre-line}.vac-reply-container .vac-icon-reply{margin-left:10px}.vac-reply-container .vac-icon-reply svg{height:20px;width:20px}.vac-reply-container .vac-image-reply{max-height:100px;max-width:200px;margin:4px 10px 0 0;border-radius:4px}.vac-reply-container .vac-audio-reply{margin-right:10px}.vac-reply-container .vac-file-container{max-width:80px}@media only screen and (max-width: 768px){.vac-reply-container{padding:5px 8px;width:calc(100% - 16px)}}.vac-room-files-container{display:flex;align-items:center;padding:10px 6px 0;background:var(--chat-footer-bg-color)}.vac-room-files-container .vac-files-box{display:flex;overflow:auto;width:calc(100% - 30px)}.vac-room-files-container video{height:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-files-container .vac-icon-close{margin-left:auto}.vac-room-files-container .vac-icon-close svg{height:20px;width:20px}@media only screen and (max-width: 768px){.vac-files-container{padding:6px 4px 4px 2px}}.vac-room-file-container{display:flex;position:relative;margin:0 4px}.vac-room-file-container .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:100px;width:100px;border:var(--chat-border-style-input);border-radius:4px}.vac-room-file-container .vac-file-container{height:80px;width:80px}.vac-room-file-container .vac-icon-remove{position:absolute;top:6px;left:6px;z-index:10}.vac-room-file-container .vac-icon-remove svg{height:20px;width:20px;border-radius:50%}.vac-room-file-container .vac-icon-remove:before{content:" ";position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5);border-radius:50%;z-index:-1}.vac-tags-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-tags-container .vac-tags-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-tags-container .vac-tags-box-active{background:var(--chat-footer-bg-color-tag-active)}.vac-tags-container .vac-tags-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-tags-container .vac-tags-avatar{height:34px;width:34px;min-height:34px;min-width:34px}.vac-tags-container .vac-tags-username{font-size:14px}@media only screen and (max-width: 768px){.vac-tags-container .vac-tags-box{height:50px}.vac-tags-container .vac-tags-info{padding:0 12px}}.vac-template-container{display:flex;flex-direction:column;align-items:center;width:100%}.vac-template-container .vac-template-box{display:flex;width:100%;height:54px;overflow:hidden;cursor:pointer;background:var(--chat-footer-bg-color-tag);transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-template-container .vac-template-active{background:var(--chat-footer-bg-color-tag-active)}.vac-template-container .vac-template-info{display:flex;overflow:hidden;padding:0 20px;align-items:center}.vac-template-container .vac-template-tag{font-size:14px;font-weight:700;margin-right:10px}.vac-template-container .vac-template-text{font-size:14px}@media only screen and (max-width: 768px){.vac-template-container .vac-template-box{height:50px}.vac-template-container .vac-template-info{padding:0 12px}}.vac-rooms-container{display:flex;flex-flow:column;flex:0 0 25%;min-width:260px;max-width:500px;position:relative;background:var(--chat-sidemenu-bg-color);height:100%;border-top-left-radius:var(--chat-container-border-radius);border-bottom-left-radius:var(--chat-container-border-radius)}.vac-rooms-container.vac-rooms-container-full{flex:0 0 100%;max-width:100%}.vac-rooms-container .vac-rooms-empty{font-size:14px;color:#9ca6af;font-style:italic;text-align:center;margin:40px 0;line-height:20px;white-space:pre-line}.vac-rooms-container .vac-room-list{flex:1;position:relative;max-width:100%;cursor:pointer;padding:0 10px 5px;overflow-y:auto}.vac-rooms-container .vac-room-item{border-radius:8px;align-items:center;display:flex;flex:1 1 100%;margin-bottom:5px;padding:0 14px;position:relative;min-height:71px;transition:background-color .3s cubic-bezier(.25,.8,.5,1)}.vac-rooms-container .vac-room-item:hover{background:var(--chat-sidemenu-bg-color-hover)}.vac-rooms-container .vac-room-selected{color:var(--chat-sidemenu-color-active)!important;background:var(--chat-sidemenu-bg-color-active)!important}.vac-rooms-container .vac-room-selected:hover{background:var(--chat-sidemenu-bg-color-active)!important}@media only screen and (max-width: 768px){.vac-rooms-container .vac-room-list{padding:0 7px 5px}.vac-rooms-container .vac-room-item{min-height:60px;padding:0 8px}}.vac-room-container{display:flex;flex:1;align-items:center;width:100%}.vac-room-container .vac-name-container{flex:1}.vac-room-container .vac-title-container{display:flex;align-items:center;line-height:25px}.vac-room-container .vac-state-circle{width:9px;height:9px;border-radius:50%;background-color:var(--chat-room-color-offline);margin-right:6px;transition:.3s}.vac-room-container .vac-state-online{background-color:var(--chat-room-color-online)}.vac-room-container .vac-room-name{flex:1;color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-text-date{margin-left:5px;font-size:11px;color:var(--chat-room-color-timestamp)}.vac-room-container .vac-text-last{display:flex;align-items:center;font-size:12px;line-height:19px;color:var(--chat-room-color-message)}.vac-room-container .vac-message-new{color:var(--chat-room-color-username);font-weight:500}.vac-room-container .vac-icon-check{display:flex;vertical-align:middle;height:14px;width:14px;margin-top:-2px;margin-right:2px}.vac-room-container .vac-icon-microphone{height:15px;width:15px;vertical-align:middle;margin:-3px 1px 0 -2px;fill:var(--chat-room-color-message)}.vac-room-container .vac-room-options-container{display:flex;margin-left:auto}.vac-room-container .vac-room-badge{background-color:var(--chat-room-bg-color-badge);color:var(--chat-room-color-badge);margin-left:5px}.vac-room-container .vac-list-room-options{height:19px;width:19px;align-items:center;margin-left:5px}.vac-box-empty{margin-top:10px}@media only screen and (max-width: 768px){.vac-box-empty{margin-top:7px}}.vac-box-search{position:sticky;display:flex;align-items:center;height:64px;padding:0 15px}.vac-box-search .vac-icon-search{display:flex;position:absolute;left:30px}.vac-box-search .vac-icon-search svg{width:18px;height:18px}.vac-box-search .vac-input{height:38px;width:100%;background:var(--chat-bg-color-input);color:var(--chat-color);font-size:15px;outline:0;caret-color:var(--chat-color-caret);padding:10px 10px 10px 40px;border:1px solid var(--chat-sidemenu-border-color-search);border-radius:20px}.vac-box-search .vac-input::placeholder{color:var(--chat-color-placeholder)}.vac-box-search .vac-add-icon{margin-left:auto;padding-left:10px}@media only screen and (max-width: 768px){.vac-box-search{height:58px}}.vac-message-wrapper .vac-card-info{border-radius:4px;text-align:center;margin:10px auto;font-size:12px;padding:4px;display:block;overflow-wrap:break-word;position:relative;white-space:normal;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-card-date{max-width:150px;font-weight:500;text-transform:uppercase;color:var(--chat-message-color-date);background-color:var(--chat-message-bg-color-date)}.vac-message-wrapper .vac-card-system{max-width:250px;padding:8px 4px;color:var(--chat-message-color-system);background-color:var(--chat-message-bg-color-system)}.vac-message-wrapper .vac-line-new{color:var(--chat-message-color-new-messages);position:relative;text-align:center;font-size:13px;padding:10px 0}.vac-message-wrapper .vac-line-new:after,.vac-message-wrapper .vac-line-new:before{border-top:1px solid var(--chat-message-color-new-messages);content:"";left:0;position:absolute;top:50%;width:calc(50% - 60px)}.vac-message-wrapper .vac-line-new:before{left:auto;right:0}.vac-message-wrapper .vac-message-box{display:flex;flex:0 0 50%;max-width:50%;justify-content:flex-start;line-height:1.4}.vac-message-wrapper .vac-avatar{height:28px;width:28px;min-height:28px;min-width:28px;margin:0 0 2px;align-self:flex-end}.vac-message-wrapper .vac-avatar-current-offset{margin-right:28px}.vac-message-wrapper .vac-avatar-offset{margin-left:28px}.vac-message-wrapper .vac-failure-container{position:relative;align-self:flex-end;height:20px;width:20px;margin:0 0 2px -4px;border-radius:50%;background-color:#f44336}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:6px}.vac-message-wrapper .vac-failure-container .vac-failure-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:15px;font-weight:700}.vac-message-wrapper .vac-message-container{position:relative;padding:2px 10px;align-items:end;min-width:100px;box-sizing:content-box}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-offset-current{margin-left:50%;justify-content:flex-end}.vac-message-wrapper .vac-message-card{background-color:var(--chat-message-bg-color);color:var(--chat-message-color);border-radius:8px;font-size:14px;padding:6px 9px 3px;white-space:pre-line;max-width:100%;-webkit-transition-property:box-shadow,opacity;transition-property:box-shadow,opacity;transition:box-shadow .28s cubic-bezier(.4,0,.2,1);will-change:box-shadow;box-shadow:0 1px 1px -1px #0000001a,0 1px 1px -1px #0000001c,0 1px 2px -1px #0000001c}.vac-message-wrapper .vac-message-highlight{box-shadow:0 1px 2px -1px #0000001a,0 1px 2px -1px #0000001c,0 1px 5px -1px #0000001c}.vac-message-wrapper .vac-message-current{background-color:var(--chat-message-bg-color-me)!important}.vac-message-wrapper .vac-message-deleted{color:var(--chat-message-color-deleted)!important;font-size:13px!important;font-style:italic!important;background-color:var(--chat-message-bg-color-deleted)!important}.vac-message-wrapper .vac-message-selected{background-color:var(--chat-message-bg-color-selected)!important;transition:background-color .2s}.vac-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-2px 2px 0 0;fill:var(--chat-message-color-deleted)}.vac-message-wrapper .vac-message-image{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:cover!important;background-position:center center!important;background-repeat:no-repeat!important;height:250px;width:250px;max-width:100%;border-radius:4px;margin:4px auto 5px;transition:.4s filter linear}.vac-message-wrapper .vac-text-username{font-size:13px;color:var(--chat-message-color-username);margin-bottom:2px}.vac-message-wrapper .vac-username-reply{margin-bottom:5px}.vac-message-wrapper .vac-text-timestamp{font-size:10px;color:var(--chat-message-color-timestamp);text-align:right}.vac-message-wrapper .vac-progress-time{float:left;margin:-2px 0 0 40px;color:var(--chat-color);font-size:12px}.vac-message-wrapper .vac-icon-edited{-webkit-box-align:center;align-items:center;display:-webkit-inline-box;display:inline-flex;justify-content:center;letter-spacing:normal;line-height:1;text-indent:0;vertical-align:middle;margin:0 4px 2px}.vac-message-wrapper .vac-icon-edited svg{height:12px;width:12px}.vac-message-wrapper .vac-icon-check{height:14px;width:14px;vertical-align:middle;margin:-3px -3px 0 3px}@media only screen and (max-width: 768px){.vac-message-wrapper .vac-message-container{padding:2px 3px 1px}.vac-message-wrapper .vac-message-container-offset{margin-top:10px}.vac-message-wrapper .vac-message-box{flex:0 0 80%;max-width:80%}.vac-message-wrapper .vac-avatar{height:25px;width:25px;min-height:25px;min-width:25px;margin:0 6px 1px 0}.vac-message-wrapper .vac-avatar.vac-avatar-current{margin:0 0 1px 6px}.vac-message-wrapper .vac-avatar-current-offset{margin-right:31px}.vac-message-wrapper .vac-avatar-offset{margin-left:31px}.vac-message-wrapper .vac-failure-container{margin-left:2px}.vac-message-wrapper .vac-failure-container.vac-failure-container-avatar{margin-right:0}.vac-message-wrapper .vac-offset-current{margin-left:20%}.vac-message-wrapper .vac-progress-time{margin-left:37px}}.vac-audio-player{display:flex;margin:8px 0 5px}.vac-audio-player .vac-svg-button{max-width:18px;margin-left:7px}@media only screen and (max-width: 768px){.vac-audio-player{margin:4px 0 0}.vac-audio-player .vac-svg-button{max-width:16px;margin-left:5px}}.vac-player-bar{display:flex;align-items:center;max-width:calc(100% - 18px);margin-right:7px;margin-left:20px}.vac-player-bar .vac-player-progress{width:190px}.vac-player-bar .vac-player-progress .vac-line-container{position:relative;height:4px;border-radius:5px;background-color:var(--chat-message-bg-color-audio-line)}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-progress{position:absolute;height:inherit;background-color:var(--chat-message-bg-color-audio-progress);border-radius:inherit}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{position:absolute;top:-5px;margin-left:-7px;height:14px;width:14px;border-radius:50%;background-color:var(--chat-message-bg-color-audio-progress-selector);transition:transform .25s}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot__active{transform:scale(1.2)}@media only screen and (max-width: 768px){.vac-player-bar{margin-right:5px}.vac-player-bar .vac-player-progress .vac-line-container{height:3px}.vac-player-bar .vac-player-progress .vac-line-container .vac-line-dot{height:12px;width:12px;top:-5px;margin-left:-5px}}.vac-message-actions-wrapper .vac-options-container{position:absolute;top:2px;right:10px;height:40px;width:70px;overflow:hidden;border-top-right-radius:8px}.vac-message-actions-wrapper .vac-blur-container{position:absolute;height:100%;width:100%;left:8px;bottom:10px;background:var(--chat-message-bg-color);filter:blur(3px);border-bottom-left-radius:8px}.vac-message-actions-wrapper .vac-options-me{background:var(--chat-message-bg-color-me)}.vac-message-actions-wrapper .vac-message-options{background:var(--chat-icon-bg-dropdown-message);border-radius:50%;position:absolute;top:7px;right:7px}.vac-message-actions-wrapper .vac-message-options svg{height:17px;width:17px;padding:5px;margin:-5px}.vac-message-actions-wrapper .vac-message-emojis{position:absolute;top:6px;right:30px}.vac-message-actions-wrapper .vac-menu-options{right:15px}.vac-message-actions-wrapper .vac-menu-left{right:-118px}@media only screen and (max-width: 768px){.vac-message-actions-wrapper .vac-options-container{right:3px}.vac-message-actions-wrapper .vac-menu-left{right:-50px}}.vac-message-files-container .vac-file-wrapper{position:relative;width:fit-content}.vac-message-files-container .vac-file-wrapper .vac-file-container{height:60px;width:60px;margin:3px 0 5px;cursor:pointer;transition:all .6s}.vac-message-files-container .vac-file-wrapper .vac-file-container:hover{opacity:.85}.vac-message-files-container .vac-file-wrapper .vac-file-container svg{height:30px;width:30px}.vac-message-files-container .vac-file-wrapper .vac-file-container.vac-file-container-progress{background-color:#0000004d}.vac-message-file-container{position:relative;z-index:0}.vac-message-file-container .vac-message-image-container{cursor:pointer}.vac-message-file-container .vac-image-buttons{position:absolute;width:100%;height:100%;border-radius:4px;background:linear-gradient(to bottom,rgba(0,0,0,0) 55%,rgba(0,0,0,.02) 60%,rgba(0,0,0,.05) 65%,rgba(0,0,0,.1) 70%,rgba(0,0,0,.2) 75%,rgba(0,0,0,.3) 80%,rgba(0,0,0,.5) 85%,rgba(0,0,0,.6) 90%,rgba(0,0,0,.7) 95%,rgba(0,0,0,.8) 100%)}.vac-message-file-container .vac-image-buttons svg{height:26px;width:26px}.vac-message-file-container .vac-image-buttons .vac-button-view,.vac-message-file-container .vac-image-buttons .vac-button-download{position:absolute;bottom:6px;left:7px}.vac-message-file-container .vac-image-buttons :first-child{left:40px}.vac-message-file-container .vac-image-buttons .vac-button-view{max-width:18px;bottom:8px}.vac-message-file-container .vac-video-container{width:350px;max-width:100%;margin:4px auto 5px;cursor:pointer}.vac-message-file-container .vac-video-container video{border-radius:4px}.vac-button-reaction{display:inline-flex;align-items:center;border:var(--chat-message-border-style-reaction);outline:none;background:var(--chat-message-bg-color-reaction);border-radius:4px;margin:4px 2px 0;transition:.3s;padding:0 5px;font-size:18px;line-height:23px}.vac-button-reaction span{font-size:11px;font-weight:500;min-width:7px;color:var(--chat-message-color-reaction-counter)}.vac-button-reaction:hover{border:var(--chat-message-border-style-reaction-hover);background:var(--chat-message-bg-color-reaction-hover);cursor:pointer}.vac-button-reaction.vac-reaction-me{border:var(--chat-message-border-style-reaction-me);background:var(--chat-message-bg-color-reaction-me)}.vac-button-reaction.vac-reaction-me span{color:var(--chat-message-color-reaction-counter-me)}.vac-button-reaction.vac-reaction-me:hover{border:var(--chat-message-border-style-reaction-hover-me);background:var(--chat-message-bg-color-reaction-hover-me)}.vac-reply-message{background:var(--chat-message-bg-color-reply);border-radius:4px;margin:-1px -5px 8px;padding:8px 10px}.vac-reply-message .vac-reply-username{color:var(--chat-message-color-reply-username);font-size:12px;line-height:15px;margin-bottom:2px}.vac-reply-message .vac-image-reply-container{width:70px}.vac-reply-message .vac-image-reply-container .vac-message-image-reply{height:70px;width:70px;margin:4px auto 3px}.vac-reply-message .vac-video-reply-container{width:200px;max-width:100%}.vac-reply-message .vac-video-reply-container video{border-radius:4px}.vac-reply-message .vac-reply-content{font-size:12px;color:var(--chat-message-color-reply-content)}.vac-reply-message .vac-file-container{height:60px;width:60px}.vac-emoji-wrapper{position:relative;display:flex}.vac-emoji-wrapper .vac-emoji-reaction svg{height:19px;width:19px}.vac-emoji-wrapper .vac-emoji-picker{position:absolute;z-index:9999;bottom:32px;right:10px;width:300px;padding-top:4px;overflow:scroll;box-sizing:border-box;border-radius:.5rem;background:var(--chat-emoji-bg-color);box-shadow:0 1px 2px -2px #0000001a,0 1px 2px -1px #0000001a,0 1px 2px 1px #0000001a;scrollbar-width:none}.vac-emoji-wrapper .vac-emoji-picker::-webkit-scrollbar{display:none}.vac-emoji-wrapper .vac-emoji-picker.vac-picker-reaction{position:fixed;top:initial;right:initial}.vac-emoji-wrapper .vac-emoji-picker emoji-picker{height:100%;width:100%;--emoji-size: 1.2rem;--background: var(--chat-emoji-bg-color);--emoji-padding: .4rem;--border-color: var(--chat-sidemenu-border-color-search);--button-hover-background: var(--chat-sidemenu-bg-color-hover);--button-active-background: var(--chat-sidemenu-bg-color-hover)}.vac-format-message-wrapper .vac-format-container{display:inline}.vac-format-message-wrapper .vac-icon-deleted{height:14px;width:14px;vertical-align:middle;margin:-3px 1px 0 0;fill:var(--chat-room-color-message)}.vac-format-message-wrapper .vac-image-link-container{background-color:var(--chat-message-bg-color-media);padding:8px;margin:2px auto;border-radius:4px}.vac-format-message-wrapper .vac-image-link{position:relative;background-color:var(--chat-message-bg-color-image)!important;background-size:contain;background-position:center center!important;background-repeat:no-repeat!important;height:150px;width:150px;max-width:100%;border-radius:4px;margin:0 auto}.vac-format-message-wrapper .vac-image-link-message{max-width:166px;font-size:12px}.vac-loader-wrapper.vac-container-center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-loader-wrapper.vac-container-top{padding:21px}.vac-loader-wrapper.vac-container-top #vac-circle{height:20px;width:20px}.vac-loader-wrapper #vac-circle{margin:auto;height:28px;width:28px;border:3px rgba(0,0,0,.25) solid;border-top:3px var(--chat-color-spinner) solid;border-right:3px var(--chat-color-spinner) solid;border-bottom:3px var(--chat-color-spinner) solid;border-radius:50%;-webkit-animation:vac-spin 1s infinite linear;animation:vac-spin 1s infinite linear}@media only screen and (max-width: 768px){.vac-loader-wrapper #vac-circle{height:24px;width:24px}.vac-loader-wrapper.vac-container-top{padding:18px}.vac-loader-wrapper.vac-container-top #vac-circle{height:16px;width:16px}}@-webkit-keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes vac-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}#vac-icon-search{fill:var(--chat-icon-color-search)}#vac-icon-add{fill:var(--chat-icon-color-add)}#vac-icon-toggle{fill:var(--chat-icon-color-toggle)}#vac-icon-menu{fill:var(--chat-icon-color-menu)}#vac-icon-close{fill:var(--chat-icon-color-close)}#vac-icon-close-image{fill:var(--chat-icon-color-close-image)}#vac-icon-file{fill:var(--chat-icon-color-file)}#vac-icon-paperclip{fill:var(--chat-icon-color-paperclip)}#vac-icon-close-outline{fill:var(--chat-icon-color-close-outline)}#vac-icon-close-outline-preview{fill:var(--chat-icon-color-close-preview)}#vac-icon-send{fill:var(--chat-icon-color-send)}#vac-icon-send-disabled{fill:var(--chat-icon-color-send-disabled)}#vac-icon-emoji{fill:var(--chat-icon-color-emoji)}#vac-icon-emoji-reaction{fill:var(--chat-icon-color-emoji-reaction)}#vac-icon-document{fill:var(--chat-icon-color-document)}#vac-icon-pencil{fill:var(--chat-icon-color-pencil)}#vac-icon-checkmark,#vac-icon-double-checkmark{fill:var(--chat-icon-color-checkmark)}#vac-icon-checkmark-seen,#vac-icon-double-checkmark-seen{fill:var(--chat-icon-color-checkmark-seen)}#vac-icon-eye{fill:var(--chat-icon-color-eye)}#vac-icon-dropdown-message{fill:var(--chat-icon-color-dropdown-message)}#vac-icon-dropdown-room{fill:var(--chat-icon-color-dropdown-room)}#vac-icon-dropdown-scroll{fill:var(--chat-icon-color-dropdown-scroll)}#vac-icon-audio-play{fill:var(--chat-icon-color-audio-play)}#vac-icon-audio-pause{fill:var(--chat-icon-color-audio-pause)}.vac-progress-wrapper{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9}.vac-progress-wrapper circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%}.vac-progress-wrapper .vac-progress-content{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:-1;margin-top:-2px;background-color:#000000b3;border-radius:50%}.vac-progress-wrapper .vac-progress-content .vac-progress-text{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-weight:700;color:#fff}.vac-progress-wrapper .vac-progress-content .vac-progress-text .vac-progress-pourcent{font-size:9px;font-weight:400}
`;BK();const UK={props:{currentUserId:{type:String,required:!0},theme:{type:String,required:!0},isDevice:{type:Boolean,required:!0}},emits:["show-demo-options"],data(){return{roomsPerPage:15,rooms:[],roomId:"",startRooms:null,endRooms:null,roomsLoaded:!1,loadingRooms:!0,allUsers:[],loadingLastMessageByRoom:0,roomsLoadedCount:!1,selectedRoom:null,messagesPerPage:20,messages:[],messagesLoaded:!1,roomMessage:"",lastLoadedMessage:null,previousLastLoadedMessage:null,roomsListeners:[],listeners:[],typingMessageCache:"",disableForm:!1,addNewRoom:null,addRoomUsername:"",inviteRoomId:null,invitedUsername:"",removeRoomId:null,removeUserId:"",removeUsers:[],roomActions:[{name:"inviteUser",title:"Invite User"},{name:"removeUser",title:"Remove User"},{name:"deleteRoom",title:"Delete Room"}],menuActions:[{name:"inviteUser",title:"Invite User"},{name:"removeUser",title:"Remove User"},{name:"deleteRoom",title:"Delete Room"}],messageSelectionActions:[{name:"deleteMessages",title:"Delete"}],styles:{container:{borderRadius:"4px"}},templatesText:[{tag:"help",text:"This is the help"},{tag:"action",text:"This is the action"},{tag:"action 2",text:"This is the second action"}]}},computed:{loadedRooms(){return this.rooms.slice(0,this.roomsLoadedCount)},screenHeight(){return this.isDevice?window.innerHeight+"px":"calc(100vh - 80px)"}},mounted(){this.addCss(),this.fetchRooms(),HP(this.currentUserId)},methods:{addCss(){const t=document.createElement("style");t.innerHTML=FK,this.$refs.chatWindow.shadowRoot.appendChild(t)},resetRooms(){this.loadingRooms=!0,this.loadingLastMessageByRoom=0,this.roomsLoadedCount=0,this.rooms=[],this.roomsLoaded=!0,this.startRooms=null,this.endRooms=null,this.roomsListeners.forEach(t=>t()),this.roomsListeners=[],this.resetMessages()},resetMessages(){this.messages=[],this.messagesLoaded=!1,this.lastLoadedMessage=null,this.previousLastLoadedMessage=null,this.listeners.forEach(t=>t()),this.listeners=[]},fetchRooms(){this.resetRooms(),this.fetchMoreRooms()},async fetchMoreRooms(){if(this.endRooms&&!this.startRooms){this.roomsLoaded=!0;return}const t=EP(this.currentUserId,this.roomsPerPage,this.startRooms),{data:e,docs:n}=await TP(t);this.roomsLoaded=e.length===0||e.length<this.roomsPerPage,this.startRooms&&(this.endRooms=this.startRooms),this.startRooms=n[n.length-1];const s=[];e.forEach(a=>{a.users.forEach(l=>{!this.allUsers.find(d=>(d==null?void 0:d._id)===l)&&s.indexOf(l)===-1&&s.push(l)})});const i=[];s.forEach(a=>{const l=yP(a);i.push(l)}),this.allUsers=[...this.allUsers,...await Promise.all(i)];const r={};e.forEach(a=>{r[a.id]={...a,users:[]},a.users.forEach(l=>{const c=this.allUsers.find(d=>(d==null?void 0:d._id)===l);c&&r[a.id].users.push(c)})});const o=[];Object.keys(r).forEach(a=>{const l=r[a],c=l.users.filter(u=>u._id!==this.currentUserId);l.roomName=c.map(u=>u.username).join(", ")||"Myself";const d=c.length===1&&c[0].avatar?c[0].avatar:qP;o.push({...l,roomId:a,avatar:d,index:l.lastUpdated.seconds,lastMessage:{content:"Room created",timestamp:gm(new Date(l.lastUpdated.seconds),l.lastUpdated)}})}),this.rooms=this.rooms.concat(o),o.forEach(a=>this.listenLastMessage(a)),this.rooms.length||(this.loadingRooms=!1,this.roomsLoadedCount=0),this.listenUsersOnlineStatus(o),this.listenRooms(t)},listenLastMessage(t){const e=LP(t.roomId,n=>{n.forEach(s=>{const i=this.formatLastMessage(s,t),r=this.rooms.findIndex(o=>t.roomId===o.roomId);this.rooms[r].lastMessage=i,this.rooms=[...this.rooms]}),this.loadingLastMessageByRoom<this.rooms.length&&(this.loadingLastMessageByRoom++,this.loadingLastMessageByRoom===this.rooms.length&&(this.loadingRooms=!1,this.roomsLoadedCount=this.rooms.length))});this.roomsListeners.push(e)},formatLastMessage(t,e){var i,r;if(!t.timestamp)return;let n=t.content;if((i=t.files)!=null&&i.length){const o=t.files[0];n=`${o.name}.${o.extension||o.type}`}const s=t.sender_id!==this.currentUserId?(r=e.users.find(o=>t.sender_id===o._id))==null?void 0:r.username:"";return{...t,content:n,senderId:t.sender_id,timestamp:gm(new Date(t.timestamp.seconds*1e3),t.timestamp),username:s,distributed:!0,seen:t.sender_id===this.currentUserId?t.seen:null,new:t.sender_id!==this.currentUserId&&(!t.seen||!t.seen[this.currentUserId]),lastMessage:{...t.lastMessage,senderId:t.sender_id}}},fetchMessages({room:t,options:e={}}){if(this.$emit("show-demo-options",!1),e.reset&&this.resetMessages(),this.previousLastLoadedMessage&&!this.lastLoadedMessage){this.messagesLoaded=!0;return}this.selectedRoom=t.roomId,Z1(t.roomId,this.messagesPerPage,this.lastLoadedMessage).then(({data:n,docs:s})=>{this.selectedRoom===t.roomId&&((n.length===0||n.length<this.messagesPerPage)&&setTimeout(()=>{this.messagesLoaded=!0},0),e.reset&&(this.messages=[]),n.forEach(i=>{const r=this.formatMessage(t,i);this.messages.unshift(r)}),this.lastLoadedMessage&&(this.previousLastLoadedMessage=this.lastLoadedMessage),this.lastLoadedMessage=s[s.length-1],this.listenMessages(t))})},listenMessages(t){const e=NP(t.roomId,this.lastLoadedMessage,this.previousLastLoadedMessage,n=>{n.forEach(s=>{const i=this.formatMessage(t,s),r=this.messages.findIndex(o=>o._id===s.id);r===-1?this.messages=this.messages.concat([i]):(this.messages[r]=i,this.messages=[...this.messages]),this.markMessagesSeen(t,s)})});this.listeners.push(e)},markMessagesSeen(t,e){e.sender_id!==this.currentUserId&&(!e.seen||!e.seen[this.currentUserId])&&nc(t.roomId,e.id,{[`seen.${this.currentUserId}`]:new Date})},formatMessage(t,e){var s;const n={...e,senderId:e.sender_id,_id:e.id,seconds:e.timestamp.seconds,timestamp:tp(e.timestamp,"HH:mm"),date:tp(e.timestamp,"DD MMMM YYYY"),username:(s=t.users.find(i=>e.sender_id===i._id))==null?void 0:s.username,distributed:!0,lastMessage:{...e.lastMessage,senderId:e.sender_id}};return e.replyMessage&&(n.replyMessage={...e.replyMessage,senderId:e.replyMessage.sender_id}),n},async sendMessage({content:t,roomId:e,files:n,replyMessage:s}){const i={sender_id:this.currentUserId,content:t,timestamp:new Date};n&&(i.files=this.formattedFiles(n)),s&&(i.replyMessage={_id:s._id,content:s.content,sender_id:s.senderId},s.files&&(i.replyMessage.files=s.files));const{id:r}=await IP(e,i);if(n)for(let o=0;o<n.length;o++)await this.uploadFile({file:n[o],messageId:r,roomId:e});Qc(e,{lastUpdated:new Date})},async editMessage({messageId:t,newContent:e,roomId:n,files:s}){var r;const i={edited:new Date};if(i.content=e,s?i.files=this.formattedFiles(s):i.files=gP,await nc(n,t,i),s)for(let o=0;o<s.length;o++)(r=s[o])!=null&&r.blob&&await this.uploadFile({file:s[o],messageId:t,roomId:n})},async deleteMessage({message:t,roomId:e}){await nc(e,t._id,{deleted:new Date});const{files:n}=t;n&&n.forEach(s=>{J1(this.currentUserId,t._id,s)})},async uploadFile({file:t,messageId:e,roomId:n}){return new Promise(s=>{let i=t.extension||t.type;(i==="svg"||i==="pdf")&&(i=t.type),UP(this.currentUserId,e,t,i,r=>{this.updateFileProgress(e,t.localUrl,r)},r=>{s(!1)},async r=>{const o=await CP(n,e);o.files.forEach(a=>{a.url===t.localUrl&&(a.url=r)}),await nc(n,e,{files:o.files}),s(!0)})})},updateFileProgress(t,e,n){const s=this.messages.find(i=>i._id===t);!s||!s.files||(s.files.find(i=>i.url===e).progress=n,this.messages=[...this.messages])},formattedFiles(t){const e=[];return t.forEach(n=>{const s={name:n.name,size:n.size,type:n.type,extension:n.extension||n.type,url:n.url||n.localUrl};n.audio&&(s.audio=!0,s.duration=n.duration),e.push(s)}),e},openFile({file:t}){window.open(t.file.url,"_blank")},async openUserTag({user:t}){let e;if(this.rooms.forEach(o=>{if(o.users.length===2){const a=o.users[0]._id,l=o.users[1]._id;(a===t._id||a===this.currentUserId)&&(l===t._id||l===this.currentUserId)&&(e=o.roomId)}}),e){this.roomId=e;return}const n=await Tb(this.currentUserId,t._id);if(n.data.length)return this.loadRoom(n);const s=await Tb(t._id,this.currentUserId);if(s.data.length)return this.loadRoom(s);const i=t._id===this.currentUserId?[this.currentUserId]:[t._id,this.currentUserId],r=await Na({users:i,lastUpdated:new Date});this.roomId=r.id,this.fetchRooms()},async loadRoom(t){t.forEach(async e=>{this.loadingRooms||(await Qc(e.id,{lastUpdated:new Date}),this.roomId=e.id,this.fetchRooms())})},menuActionHandler({action:t,roomId:e}){switch(t.name){case"inviteUser":return this.inviteUser(e);case"removeUser":return this.removeUser(e);case"deleteRoom":return this.deleteRoom(e)}},messageSelectionActionHandler({action:t,messages:e,roomId:n}){switch(t.name){case"deleteMessages":e.forEach(s=>{this.deleteMessage({message:s,roomId:n})})}},async sendMessageReaction({reaction:t,remove:e,messageId:n,roomId:s}){PP(s,n,this.currentUserId,t.unicode,e?"remove":"add")},typingMessage({message:t,roomId:e}){if(e){if((t==null?void 0:t.length)>1){this.typingMessageCache=t;return}if((t==null?void 0:t.length)===1&&this.typingMessageCache){this.typingMessageCache=t;return}this.typingMessageCache=t,RP(e,this.currentUserId,t?"add":"remove")}},async listenRooms(t){const e=kP(t,n=>{n.forEach(s=>{const i=this.rooms.find(r=>r.roomId===s.id);i&&(i.typingUsers=s.typingUsers,i.index=s.lastUpdated.seconds)})});this.roomsListeners.push(e)},listenUsersOnlineStatus(t){t.forEach(e=>{e.users.forEach(n=>{const s=jP(ep(n._id),i=>{if(!i||!i.val())return;const r=gm(new Date(i.val().lastChanged),new Date(i.val().lastChanged));n.status={...i.val(),lastChanged:r};const o=this.rooms.findIndex(a=>e.roomId===a.roomId);this.rooms[o]=e,this.rooms=[...this.rooms]});this.roomsListeners.push(s)})})},addRoom(){this.resetForms(),this.addNewRoom=!0},async createRoom(){this.disableForm=!0;const{id:t}=await Eb({username:this.addRoomUsername});await xb(t,{_id:t}),await Na({users:[t,this.currentUserId],lastUpdated:new Date}),this.addNewRoom=!1,this.addRoomUsername="",this.fetchRooms()},inviteUser(t){this.resetForms(),this.inviteRoomId=t},async addRoomUser(){this.disableForm=!0;const{id:t}=await Eb({username:this.invitedUsername});await xb(t,{_id:t}),await SP(this.inviteRoomId,t),this.inviteRoomId=null,this.invitedUsername="",this.fetchRooms()},removeUser(t){this.resetForms(),this.removeRoomId=t,this.removeUsers=this.rooms.find(e=>e.roomId===t).users},async deleteRoomUser(){this.disableForm=!0,await AP(this.removeRoomId,this.removeUserId),this.removeRoomId=null,this.removeUserId="",this.fetchRooms()},async deleteRoom(t){const e=this.rooms.find(n=>n.roomId===t);if(e.users.find(n=>n._id==="SGmFnBZB4xxMv9V4CVlW")||e.users.find(n=>n._id==="6jMsIXUrBHBj7o2cRlau"))return alert("Nope, for demo purposes you cannot delete this room");Z1(t).then(({data:n})=>{n.forEach(s=>{iT(t,s.id),s.files&&s.files.forEach(i=>{J1(this.currentUserId,s.id,i)})})}),await nT(t),this.fetchRooms()},resetForms(){this.disableForm=!1,this.addNewRoom=null,this.addRoomUsername="",this.inviteRoomId=null,this.invitedUsername="",this.removeRoomId=null,this.removeUserId=""}}},jK=t=>(U8("data-v-0047aff1"),t=t(),j8(),t),HK=["disabled"],VK=["disabled"],qK=jK(()=>Tn("option",{default:"",value:""},"Select User",-1)),$K=["value"],zK=["disabled"],KK=["height","theme","styles","current-user-id","room-id","rooms","loading-rooms","rooms-loaded","messages","messages-loaded","room-message",".room-actions",".menu-actions",".message-selection-actions",".templates-text"];function GK(t,e,n,s,i,r){return ys(),Qs("div",{class:Ka(["window-container",{"window-mobile":n.isDevice}])},[i.addNewRoom?(ys(),Qs("form",{key:0,onSubmit:e[2]||(e[2]=G0((...o)=>r.createRoom&&r.createRoom(...o),["prevent"]))},[Uh(Tn("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>i.addRoomUsername=o),type:"text",placeholder:"Add username"},null,512),[[C2,i.addRoomUsername]]),Tn("button",{type:"submit",disabled:i.disableForm||!i.addRoomUsername}," Create Room ",8,HK),Tn("button",{class:"button-cancel",onClick:e[1]||(e[1]=o=>i.addNewRoom=!1)},"Cancel")],32)):So("",!0),i.inviteRoomId?(ys(),Qs("form",{key:1,onSubmit:e[5]||(e[5]=G0((...o)=>r.addRoomUser&&r.addRoomUser(...o),["prevent"]))},[Uh(Tn("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.invitedUsername=o),type:"text",placeholder:"Add username"},null,512),[[C2,i.invitedUsername]]),Tn("button",{type:"submit",disabled:i.disableForm||!i.invitedUsername}," Add User ",8,VK),Tn("button",{class:"button-cancel",onClick:e[4]||(e[4]=o=>i.inviteRoomId=null)},"Cancel")],32)):So("",!0),i.removeRoomId?(ys(),Qs("form",{key:2,onSubmit:e[8]||(e[8]=G0((...o)=>r.deleteRoomUser&&r.deleteRoomUser(...o),["prevent"]))},[Uh(Tn("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>i.removeUserId=o)},[qK,(ys(!0),Qs(Xs,null,Pw(i.removeUsers,o=>(ys(),Qs("option",{key:o._id,value:o._id},hw(o.username),9,$K))),128))],512),[[i4,i.removeUserId]]),Tn("button",{type:"submit",disabled:i.disableForm||!i.removeUserId}," Remove User ",8,zK),Tn("button",{class:"button-cancel",onClick:e[7]||(e[7]=o=>i.removeRoomId=null)},"Cancel")],32)):So("",!0),Tn("vue-advanced-chat",{ref:"chatWindow",height:r.screenHeight,theme:n.theme,styles:i.styles,"current-user-id":n.currentUserId,"room-id":i.roomId,rooms:r.loadedRooms,"loading-rooms":i.loadingRooms,"rooms-loaded":i.roomsLoaded,messages:i.messages,"messages-loaded":i.messagesLoaded,"room-message":i.roomMessage,".room-actions":i.roomActions,".menu-actions":i.menuActions,".message-selection-actions":i.messageSelectionActions,".templates-text":i.templatesText,onFetchMoreRooms:e[9]||(e[9]=(...o)=>r.fetchMoreRooms&&r.fetchMoreRooms(...o)),onFetchMessages:e[10]||(e[10]=o=>r.fetchMessages(o.detail[0])),onSendMessage:e[11]||(e[11]=o=>r.sendMessage(o.detail[0])),onEditMessage:e[12]||(e[12]=o=>r.editMessage(o.detail[0])),onDeleteMessage:e[13]||(e[13]=o=>r.deleteMessage(o.detail[0])),onOpenFile:e[14]||(e[14]=o=>r.openFile(o.detail[0])),onOpenUserTag:e[15]||(e[15]=o=>r.openUserTag(o.detail[0])),onAddRoom:e[16]||(e[16]=o=>r.addRoom(o.detail[0])),onRoomActionHandler:e[17]||(e[17]=o=>r.menuActionHandler(o.detail[0])),onMenuActionHandler:e[18]||(e[18]=o=>r.menuActionHandler(o.detail[0])),onMessageSelectionActionHandler:e[19]||(e[19]=o=>r.messageSelectionActionHandler(o.detail[0])),onSendMessageReaction:e[20]||(e[20]=o=>r.sendMessageReaction(o.detail[0])),onTypingMessage:e[21]||(e[21]=o=>r.typingMessage(o.detail[0])),onToggleRoomsList:e[22]||(e[22]=o=>t.$emit("show-demo-options",o.detail[0].opened))},null,40,KK)],2)}var WK=qt(UK,[["render",GK],["__scopeId","data-v-0047aff1"]]),YK="/vue-advanced-chat/assets/github.12794390.svg";const XK={components:{ChatContainer:WK},data(){return{theme:"light",showChat:!0,users:[{_id:"6R0MijpK6M4AIrwaaCY2",username:"Luke",avatar:"https://66.media.tumblr.com/avatar_c6a8eae4303e_512.pnj"},{_id:"SGmFnBZB4xxMv9V4CVlW",username:"Leia",avatar:"https://avatarfiles.alphacoders.com/184/thumb-184913.jpg"},{_id:"6jMsIXUrBHBj7o2cRlau",username:"Yoda",avatar:"https://vignette.wikia.nocookie.net/teamavatarone/images/4/45/Yoda.jpg/revision/latest?cb=20130224160049"}],currentUserId:"6R0MijpK6M4AIrwaaCY2",isDevice:!1,showDemoOptions:!0,updatingData:!1}},computed:{showOptions(){return!this.isDevice||this.showDemoOptions}},watch:{currentUserId(){this.showChat=!1,setTimeout(()=>this.showChat=!0,150)}},mounted(){this.isDevice=window.innerWidth<500,window.addEventListener("resize",t=>{t.isTrusted&&(this.isDevice=window.innerWidth<500)})},methods:{resetData(){xP().then(({data:t})=>{t.forEach(async e=>{await Z1(e.id).then(({data:n})=>{n.forEach(s=>{iT(e.id,s.id),s.files&&s.files.forEach(i=>{J1(this.currentUserId,s.id,i)})})}),nT(e.id)})}),vP().then(({data:t})=>{t.forEach(e=>{bP(e.id)})})},async addData(){this.updatingData=!0;const t=this.users[0];await pm(t._id,t);const e=this.users[1];await pm(e._id,e);const n=this.users[2];await pm(n._id,n),await Na({users:[t._id,e._id],lastUpdated:new Date}),await Na({users:[t._id,n._id],lastUpdated:new Date}),await Na({users:[e._id,n._id],lastUpdated:new Date}),await Na({users:[t._id,e._id,n._id],lastUpdated:new Date}),this.updatingData=!1,location.reload()}}},QK=["value"],ZK={key:2,class:"button-theme"},JK=Tn("button",{class:"button-github"},[Tn("a",{href:"https://github.com/antoine92190/vue-advanced-chat"},[Tn("img",{src:YK})])],-1);function eG(t,e,n,s,i,r){const o=cA("chat-container");return ys(),Qs("div",null,[Tn("div",{class:Ka(["app-container",{"app-mobile":i.isDevice,"app-mobile-dark":i.theme==="dark"}])},[r.showOptions?(ys(),Qs("span",{key:0,class:Ka(["user-logged",{"user-logged-dark":i.theme==="dark"}])}," Logged as ",2)):So("",!0),r.showOptions?Uh((ys(),Qs("select",{key:1,"onUpdate:modelValue":e[0]||(e[0]=a=>i.currentUserId=a)},[(ys(!0),Qs(Xs,null,Pw(i.users,a=>(ys(),Qs("option",{key:a._id,value:a._id},hw(a.username),9,QK))),128))],512)),[[i4,i.currentUserId]]):So("",!0),r.showOptions?(ys(),Qs("div",ZK,[Tn("button",{class:"button-light",onClick:e[1]||(e[1]=a=>i.theme="light")}," Light "),Tn("button",{class:"button-dark",onClick:e[2]||(e[2]=a=>i.theme="dark")}," Dark "),JK])):So("",!0),i.showChat?(ys(),Kw(o,{key:3,"current-user-id":i.currentUserId,theme:i.theme,"is-device":i.isDevice,onShowDemoOptions:e[3]||(e[3]=a=>i.showDemoOptions=a)},null,8,["current-user-id","theme","is-device"])):So("",!0)],2)])}var tG=qt(XK,[["render",eG]]);const nG=IR({render:()=>zA(tG)});nG.mount("#app");
